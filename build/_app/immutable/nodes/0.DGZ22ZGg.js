const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["../chunks/Dqyum4BN.js","../chunks/CE8Bg3hM.js","../chunks/C1FmrZbK.js"])))=>i.map(i=>d[i]);
var Id=Object.defineProperty;var Rd=(t,r,a)=>r in t?Id(t,r,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[r]=a;var Zs=(t,r,a)=>Rd(t,typeof r!="symbol"?r+"":r,a);import"../chunks/CWj6FrbW.js";import"../chunks/DsZmANqb.js";import{w as Us,p as pa,K as Ra,o as Aa,V as Yn,W as Nt,m as p,n as Q,X as kt,l as e,Y as Va,i as ha,f as k,r as o,b as X,Z as m,v as c,u as n,R as Ms,Q as Nd,_ as Pd,t as R,s as wt,a0 as $r,C as na,F as y,a as Z,c as g,j as ma,P as Ca,H as Bt,a1 as ir,G as hr,a2 as Bl,B as Mt,J as sr,I as Zr,x as At,a3 as ks,a4 as Xt,y as zt,a5 as ra,D as $e,A as Ur,q as Et,T as Ya,E as Lt,a6 as vs,a7 as Jr,z as tr,a8 as Or,k as $l,g as Ul,a9 as Ld,aa as Od,ab as zd,ac as gs,ad as $i,ae as Bd,af as $d,ag as Do}from"../chunks/CE8Bg3hM.js";import{s as Tt,c as Ud,d as fa,g as Mo,a as ql,b as qd,u as jd,e as Io,t as da,i as Wd,l as Hd}from"../chunks/Dqyum4BN.js";import{b as pi,c as us,a as qs,d as Vd,p as Ls,i as jl}from"../chunks/COcYFW_x.js";import{s as Gd,g as Xd}from"../chunks/CfR4tY9u.js";import{w as Kt}from"../chunks/8-4YllIr.js";import{_ as Yd}from"../chunks/C1FmrZbK.js";function Kd(){const{subscribe:t,set:r,update:a}=Us({collapsed:!1,width:140});return{subscribe:t,toggle:()=>a(s=>({collapsed:!1,width:140})),setCollapsed:s=>a(i=>({collapsed:!1,width:140}))}}const Wl=Kd(),Qd=()=>{const t=Gd;return{page:{subscribe:t.page.subscribe},navigating:{subscribe:t.navigating.subscribe},updated:t.updated}},Zd={subscribe(t){return Qd().page.subscribe(t)}};var Jd=k('<img alt="" class="window-icon svelte-4yyt8s"/>'),ev=k('<span class="window-icon-emoji svelte-4yyt8s"> </span>'),tv=k('<button class="control-button minimize svelte-4yyt8s" title="Minimize" aria-label="Minimize window"><svg viewBox="0 0 12 12" width="12" height="12"><rect x="2" y="5" width="8" height="2" fill="currentColor"></rect></svg></button>'),av=hr('<svg viewBox="0 0 12 12" width="12" height="12"><rect x="1" y="3" width="7" height="7" stroke="currentColor" stroke-width="1" fill="none"></rect><rect x="3" y="1" width="7" height="7" stroke="currentColor" stroke-width="1" fill="none"></rect></svg>'),rv=hr('<svg viewBox="0 0 12 12" width="12" height="12"><rect x="2" y="2" width="8" height="8" stroke="currentColor" stroke-width="1" fill="none"></rect></svg>'),sv=k('<button class="control-button maximize svelte-4yyt8s"><!></button>'),iv=k('<button class="control-button close svelte-4yyt8s" title="Close" aria-label="Close window"><svg viewBox="0 0 12 12" width="12" height="12"><path d="M2,2 L10,10 M10,2 L2,10" stroke="currentColor" stroke-width="1.5"></path></svg></button>'),nv=k('<div class="resize-handle resize-n svelte-4yyt8s" role="separator" aria-label="Resize window north"></div> <div class="resize-handle resize-s svelte-4yyt8s" role="separator" aria-label="Resize window south"></div> <div class="resize-handle resize-e svelte-4yyt8s" role="separator" aria-label="Resize window east"></div> <div class="resize-handle resize-w svelte-4yyt8s" role="separator" aria-label="Resize window west"></div> <div class="resize-handle resize-nw svelte-4yyt8s" role="separator" aria-label="Resize window northwest"></div> <div class="resize-handle resize-ne svelte-4yyt8s" role="separator" aria-label="Resize window northeast"></div> <div class="resize-handle resize-sw svelte-4yyt8s" role="separator" aria-label="Resize window southwest"></div> <div class="resize-handle resize-se svelte-4yyt8s" role="separator" aria-label="Resize window southeast"></div>',1),ov=k('<div role="dialog"><div class="title-bar svelte-4yyt8s" role="banner" aria-label="Window title bar"><div class="title-bar-content svelte-4yyt8s"><!> <span class="window-title svelte-4yyt8s"> </span></div> <div class="title-bar-controls svelte-4yyt8s"><!> <!> <!></div></div> <div class="window-content svelte-4yyt8s"><!></div> <!></div>');function lv(t,r){pa(r,!1);const a=Q(),s=Q(),i=Q(),l=Q();let d=Ra(r,"window",8),v=Q(),u=Q(),f=!1,h=!1,_={x:0,y:0},x={x:0,y:0,width:0,height:0},T="";Aa(()=>{document.addEventListener("mousemove",A),document.addEventListener("mouseup",C)}),Yn(()=>{document.removeEventListener("mousemove",A),document.removeEventListener("mouseup",C)});function b(I){if(d().state==="maximized")return;f=!0,Kt.setWindowDragging(d().id,!0),Kt.activateWindow(d().id);const Y=e(v).getBoundingClientRect();_={x:I.clientX-Y.left,y:I.clientY-Y.top},I.preventDefault()}function w(I,Y){!d().resizable||d().state==="maximized"||(h=!0,T=Y,Kt.setWindowResizing(d().id,!0),Kt.activateWindow(d().id),x={x:I.clientX,y:I.clientY,width:d().size.width,height:d().size.height},I.preventDefault(),I.stopPropagation())}function A(I){var Y,fe,ce,J;if(f){const le=I.clientX-_.x,S=Math.max(0,I.clientY-_.y);Kt.updateWindowPosition(d().id,{x:le,y:S})}else if(h){const le=I.clientX-x.x,S=I.clientY-x.y;let De=x.width,Ue=x.height,We=d().position.x,ke=d().position.y;T.includes("e")&&(De=Math.max(((Y=d().minSize)==null?void 0:Y.width)||200,x.width+le)),T.includes("w")&&(De=Math.max(((fe=d().minSize)==null?void 0:fe.width)||200,x.width-le),We=d().position.x+(x.width-De)),T.includes("s")&&(Ue=Math.max(((ce=d().minSize)==null?void 0:ce.height)||150,x.height+S)),T.includes("n")&&(Ue=Math.max(((J=d().minSize)==null?void 0:J.height)||150,x.height-S),ke=d().position.y+(x.height-Ue)),d().maxSize&&(De=Math.min(De,d().maxSize.width),Ue=Math.min(Ue,d().maxSize.height)),Kt.updateWindowSize(d().id,{width:De,height:Ue}),(T.includes("w")||T.includes("n"))&&Kt.updateWindowPosition(d().id,{x:We,y:ke})}}function C(){f&&(f=!1,Kt.setWindowDragging(d().id,!1)),h&&(h=!1,T="",Kt.setWindowResizing(d().id,!1))}function z(){e(i)||Kt.activateWindow(d().id)}function F(){d().maximizable&&Kt.toggleMaximizeWindow(d().id)}function re(){d().minimizable&&Kt.minimizeWindow(d().id)}function me(){d().maximizable&&(console.log("Toggling maximize for window:",d().id,"current state:",d().state),Kt.toggleMaximizeWindow(d().id))}function ue(){d().closable&&Kt.closeWindow(d().id)}Nt(()=>kt(d()),()=>{p(a,d().state==="maximized")}),Nt(()=>kt(d()),()=>{p(s,d().state==="minimized")}),Nt(()=>kt(d()),()=>{p(i,d().isActive)}),Nt(()=>(kt(d()),e(a)),()=>{console.log("Window state changed:",{id:d().id,state:d().state,isMaximized:e(a),position:d().position,size:d().size})}),Nt(()=>(e(a),kt(d()),e(s)),()=>{p(l,`
		left: ${e(a)?"0px !important":d().position.x+"px"};
		top: ${e(a)?"0px !important":d().position.y+"px"};
		width: ${e(a)?"100% !important":d().size.width+"px"};
		height: ${e(a)?"calc(100vh - 48px) !important":d().size.height+"px"};
		z-index: ${d().zIndex};
		display: ${e(s)?"none":"flex"};
	`)}),Va(),ha();var D=ov();let E;var he=o(D),xe=o(he),K=o(xe);{var q=I=>{var Y=Ca(),fe=Bt(Y);{var ce=le=>{var S=Jd();R(()=>na(S,"src",(kt(d()),m(()=>d().icon)))),g(le,S)},J=le=>{var S=ev(),De=o(S,!0);n(S),R(()=>y(De,(kt(d()),m(()=>d().icon)))),g(le,S)};X(fe,le=>{kt(d()),m(()=>d().icon.startsWith("http")||d().icon.startsWith("/")||d().icon.includes("."))?le(ce):le(J,!1)})}g(I,Y)};X(K,I=>{kt(d()),m(()=>d().icon)&&I(q)})}var ae=c(K,2),Me=o(ae,!0);n(ae),n(xe);var ge=c(xe,2),Ne=o(ge);{var Be=I=>{var Y=tv();Z("click",Y,ir(re)),g(I,Y)};X(Ne,I=>{kt(d()),m(()=>d().minimizable)&&I(Be)})}var be=c(Ne,2);{var L=I=>{var Y=sv(),fe=o(Y);{var ce=le=>{var S=av();g(le,S)},J=le=>{var S=rv();g(le,S)};X(fe,le=>{e(a)?le(ce):le(J,!1)})}n(Y),R(()=>{na(Y,"title",e(a)?"Restore":"Maximize"),na(Y,"aria-label",e(a)?"Restore window":"Maximize window")}),Z("click",Y,ir(me)),g(I,Y)};X(be,I=>{kt(d()),m(()=>d().maximizable)&&I(L)})}var Te=c(be,2);{var ye=I=>{var Y=iv();Z("click",Y,ir(ue)),g(I,Y)};X(Te,I=>{kt(d()),m(()=>d().closable)&&I(ye)})}n(ge),n(he),Ms(he,I=>p(u,I),()=>e(u));var P=c(he,2),pe=o(P);Nd(pe,()=>d().component,(I,Y)=>{Y(I,Pd(()=>d().props))}),n(P);var B=c(P,2);{var j=I=>{var Y=nv(),fe=Bt(Y),ce=c(fe,2),J=c(ce,2),le=c(J,2),S=c(le,2),De=c(S,2),Ue=c(De,2),We=c(Ue,2);Z("mousedown",fe,ke=>w(ke,"n")),Z("mousedown",ce,ke=>w(ke,"s")),Z("mousedown",J,ke=>w(ke,"e")),Z("mousedown",le,ke=>w(ke,"w")),Z("mousedown",S,ke=>w(ke,"nw")),Z("mousedown",De,ke=>w(ke,"ne")),Z("mousedown",Ue,ke=>w(ke,"sw")),Z("mousedown",We,ke=>w(ke,"se")),g(I,Y)};X(B,I=>{kt(d()),e(a),m(()=>d().resizable&&!e(a))&&I(j)})}n(D),Ms(D,I=>p(v,I),()=>e(v)),R(I=>{E=wt(D,1,"window svelte-4yyt8s",null,E,I),$r(D,e(l)),na(D,"aria-label",(kt(d()),m(()=>d().title))),na(D,"aria-modal",(kt(d()),m(()=>d().modal?"true":"false"))),y(Me,(kt(d()),m(()=>d().title)))},[()=>({active:e(i),maximized:e(a),modal:d().modal,"window-maximized":e(a)})]),Z("mousedown",he,b),Z("dblclick",he,F),Z("mousedown",D,z),g(t,D),ma()}var cv=k('<div class="modal-backdrop svelte-xy0ftz"></div>'),dv=k('<div class="window-manager svelte-xy0ftz"><!> <!></div>');function vv(t,r){pa(r,!1);const a=()=>sr(Wl,"$sidebar",i),s=()=>sr(e(d),"$windows",i),[i,l]=Zr(),d=Q();Nt(()=>Kt,()=>{Bl(p(d,Kt.windowList),"$windows",i)}),Va(),ha();var v=dv(),u=o(v);Mt(u,1,s,_=>_.id,(_,x)=>{lv(_,{get window(){return e(x)}})});var f=c(u,2);{var h=_=>{var x=cv();g(_,x)};X(f,_=>{s(),m(()=>s().some(x=>x.modal&&x.state!=="minimized"))&&_(h)})}n(v),R(()=>$r(v,`left: ${a(),m(()=>a().width)??""}px; width: calc(100vw - ${a(),m(()=>a().width)??""}px);`)),g(t,v),ma(),l()}const bi=Us({unread:0,total:0,loading:!0}),sn=Us([]),La={add:t=>{const r=Date.now().toString()+Math.random().toString(36).substr(2,9),a={id:r,...t,duration:t.duration||5e3};sn.update(s=>[...s,a]),a.duration>0&&setTimeout(()=>{La.remove(r)},a.duration)},remove:t=>{sn.update(r=>r.filter(a=>a.id!==t))},clear:()=>{sn.set([])}};async function Di(t="e1fdaee2-97f0-4fc1-872f-9d99c6bd684b"){bi.update(r=>({...r,loading:!0}));try{const{data:r,error:a}=await Tt.from("notifications").select(`
				*,
				notification_read_states(
					read_at,
					user_id
				)
			`).eq("status","published");if(a)throw a;const s=(r==null?void 0:r.length)||0,i=(r==null?void 0:r.filter(l=>{var v;const d=(v=l.notification_read_states)==null?void 0:v.find(u=>u.user_id===t);return!(d!=null&&d.read_at)}).length)||0;bi.set({unread:i,total:s,loading:!1})}catch(r){console.error("Error fetching notification counts:",r),bi.update(a=>({...a,loading:!1}))}}function Hl(){Di()}const hi="https://vmypotfsyrvuublyddyt.supabase.co",Vl="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZteXBvdGZzeXJ2dXVibHlkZHl0Iiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc1NjQ4MjQ4OSwiZXhwIjoyMDcyMDU4NDg5fQ.RmkgY9IQ-XzNeUvcuEbrQlF6P4-8BjJkjKnB8h8HoPQ",ss=Ud(hi,Vl);class uv{constructor(){Zs(this,"isProcessing",!1);Zs(this,"intervalId",null)}start(){if(this.isProcessing){console.log("🔄 Push notification processor already running");return}console.log("🚀 Starting push notification processor with URL:",hi),console.log("🔧 Using service key ending in:",Vl.slice(-10)),this.isProcessing=!0,this.processQueue().catch(r=>{console.error("❌ Initial queue processing failed:",r)}),console.log("✅ Push notification processor started successfully")}stop(){console.log("🛑 Stopping push notification processor..."),this.isProcessing=!1,this.intervalId&&(clearInterval(this.intervalId),this.intervalId=null)}async processQueue(){try{console.log("🔍 Processing notification queue with URL:",hi);const{data:r,error:a}=await ss.from("notification_queue").select(`
                    id,
                    notification_id,
                    user_id,
                    device_id,
                    push_subscription_id,
                    payload,
                    status,
                    created_at,
                    push_subscriptions (
                        endpoint,
                        p256dh,
                        auth
                    )
                `).eq("status","pending").order("created_at",{ascending:!0}).limit(20);if(a){console.error("❌ Error fetching queued notifications:",a),console.error("❌ Database URL:",hi);return}if(console.log(`📊 Found ${(r==null?void 0:r.length)||0} pending notifications in queue`),console.log("🔍 Database response:",{queuedNotifications:r,error:a}),!r||r.length===0)return;console.log(`📬 Processing ${r.length} pending notifications...`),console.log("🔍 Queue items:",r);for(const s of r)if(console.log("🔍 Processing queue item:",s),s.push_subscription_id){const{data:i,error:l}=await ss.from("push_subscriptions").select("endpoint, p256dh, auth").eq("id",s.push_subscription_id).eq("is_active",!0).single();i&&!l?(console.log("✅ Found push subscription for queue item:",s.id),console.log("🔍 Subscription details:",i),await this.sendPushNotification(s)):(console.warn("⚠️ No active push subscription found for queue item:",s.id,"subscription_id:",s.push_subscription_id),console.warn("🔍 Subscription error:",l),await ss.from("notification_queue").update({status:"failed",error_message:"Push subscription not found or inactive"}).eq("id",s.id))}else console.warn("⚠️ Queue item has no push_subscription_id:",s.id),await ss.from("notification_queue").update({status:"failed",error_message:"No push subscription ID"}).eq("id",s.id)}catch(r){console.error("❌ Error processing notification queue:",r),console.error("❌ Database URL being used:",hi)}}async sendPushNotification(r){try{if(console.log(`📤 Sending push notification ${r.id} to device ${r.device_id}...`),console.log("🔍 Notification payload:",r.payload),console.log("🔍 Notification permission:",Notification.permission),Notification.permission!=="granted")throw console.error("❌ Notification permission not granted:",Notification.permission),new Error(`Notification permission not granted: ${Notification.permission}`);if(await ss.from("notification_queue").update({status:"processing"}).eq("id",r.id),"serviceWorker"in navigator&&"Notification"in window){console.log("🔍 Service Worker and Notification API available");const a=await navigator.serviceWorker.ready;console.log("🔍 Service Worker ready:",a),console.log("🔔 Showing notification with title:",r.payload.title),await a.showNotification(r.payload.title,{body:r.payload.body,icon:r.payload.icon,badge:r.payload.badge,data:r.payload.data,tag:`notification-${r.notification_id}`,requireInteraction:!0,silent:!1}),console.log("🎉 Notification shown successfully!"),await ss.from("notification_queue").update({status:"sent",sent_at:new Date().toISOString()}).eq("id",r.id),console.log(`✅ Push notification ${r.id} sent successfully`)}else throw console.error("❌ Service Worker or Notifications not supported"),new Error("Service Worker or Notifications not supported")}catch(a){console.error(`❌ Failed to send push notification ${r.id}:`,a),await ss.from("notification_queue").update({status:"failed",error_message:a instanceof Error?a.message:"Unknown error",failed_at:new Date().toISOString()}).eq("id",r.id)}}async processOnce(){console.log("🧪 Manual queue processing..."),await this.processQueue()}async createTestQueueEntry(){try{console.log("🧪 Creating test notification queue entry...");const r={title:"Test Push Notification",body:"This is a test notification to verify the processor works",icon:"/favicon.png",badge:"/badge-icon.png",data:{notification_id:"test-notification-id",url:"/notifications?test=true",created_at:new Date().toISOString(),sender:"System Test"}},{data:a,error:s}=await ss.from("notification_queue").insert({notification_id:"test-notification-id",user_id:"e1fdaee2-97f0-4fc1-872f-9d99c6bd684b",device_id:"test-device",push_subscription_id:null,status:"pending",payload:r}).select();s?console.error("❌ Failed to create test queue entry:",s):(console.log("✅ Test queue entry created:",a),console.log("🔄 Processing queue immediately..."),await this.processQueue())}catch(r){console.error("❌ Error creating test queue entry:",r)}}}const _s=new uv;typeof window<"u"&&(window.testPushNotificationQueue=()=>{_s.createTestQueueEntry()},window.processPushNotificationQueue=()=>{_s.processOnce()},window.stopPushNotificationProcessor=()=>{_s.stop(),console.log("🛑 Emergency stop: Push notification processor stopped")},window.testDatabaseTrigger=async()=>{console.log("🧪 Testing if database trigger function exists and works...");try{const{data:t,error:r}=await ss.rpc("queue_push_notification",{p_notification_id:"0d1dc630-c253-4269-b30b-f416a747e69e"});r?(console.error("❌ Database trigger function failed:",r),console.error("❌ This suggests the trigger function was not properly installed")):(console.log("✅ Database trigger function executed successfully"),console.log("🔄 Now checking if notification was queued..."),setTimeout(async()=>{await _s.processOnce()},1e3))}catch(t){console.error("❌ Error testing database trigger:",t)}},window.manualQueueTest=async()=>{var t;console.log("🧪 Manually adding notification to queue...");try{const r=await((t=window.persistentAuth)==null?void 0:t.getCurrentUser());if(!r){console.error("❌ No current user found");return}const a={notification_id:"0d1dc630-c253-4269-b30b-f416a747e69e",user_id:r.id,device_id:"manual-test-device",status:"pending",payload:{title:"Test Notification",body:"This is a manual test from the browser console",icon:"/favicon.png",data:{notification_id:"0d1dc630-c253-4269-b30b-f416a747e69e",url:"/notifications"}}},{data:s,error:i}=await ss.from("notification_queue").insert([a]).select();i?console.error("❌ Failed to manually queue notification:",i):(console.log("✅ Manually queued notification:",s),console.log("🔄 Now processing queue..."),setTimeout(async()=>{await _s.processOnce()},1e3))}catch(r){console.error("❌ Manual queue test failed:",r)}},window.testExistingNotification=async()=>{console.log("🧪 Testing trigger function with existing notification...");try{const t="0d1dc630-c253-4269-b30b-f416a747e69e";console.log(`🔍 Calling queue_push_notification function for notification: ${t}`);const{data:r,error:a}=await ss.rpc("queue_push_notification",{p_notification_id:t});a?(console.error("❌ Trigger function failed:",a),console.error("❌ Error details:",a.message),a.message.includes("function")&&a.message.includes("does not exist")&&console.log("💡 The queue_push_notification function was not properly applied to the database")):(console.log("✅ Trigger function executed successfully"),console.log("📋 Result:",r),console.log("🔄 Now checking queue..."),setTimeout(async()=>{await _s.processOnce()},2e3))}catch(t){console.error("❌ Test failed with error:",t)}},window.testBasicNotification=async()=>{console.log("🧪 Testing basic browser notification...");try{if(console.log("🔍 Notification permission:",Notification.permission),Notification.permission!=="granted"){console.log("📝 Requesting notification permission...");const r=await Notification.requestPermission();if(console.log("📋 Permission result:",r),r!=="granted"){console.error("❌ Permission denied");return}}console.log("🔔 Creating direct browser notification...");const t=new Notification("Direct Test",{body:"This is a direct browser notification test",icon:"/favicon.png"});t.onclick=()=>{console.log("🖱️ Direct notification clicked"),t.close()},setTimeout(()=>t.close(),5e3),"serviceWorker"in navigator&&(console.log("🔔 Creating service worker notification..."),await(await navigator.serviceWorker.ready).showNotification("Service Worker Test",{body:"This is a service worker notification test",icon:"/favicon.png",requireInteraction:!0}),console.log("✅ Service worker notification created"))}catch(t){console.error("❌ Basic notification test failed:",t)}});class fv{constructor(){}async getAllNotifications(r){try{if(r){const{data:a,error:s}=await Tt.from("notifications").select(`
						*,
						notification_read_states!left(
							is_read,
							read_at
						)
					`).eq("notification_read_states.user_id",r).order("created_at",{ascending:!1});if(s)throw s;return(a==null?void 0:a.map(i=>{var l,d,v,u;return{...i,is_read:((d=(l=i.notification_read_states)==null?void 0:l[0])==null?void 0:d.is_read)||!1,read_at:(u=(v=i.notification_read_states)==null?void 0:v[0])==null?void 0:u.read_at}}))||[]}else{const{data:a,error:s}=await Tt.from("notifications").select("*").order("created_at",{ascending:!1});if(s)throw s;return a||[]}}catch(a){throw console.error("Error fetching notifications:",a),new Error("Failed to fetch notifications")}}async getUserNotifications(r){try{const{data:a,error:s}=await Tt.from("notifications").select(`
					*,
					notification_read_states(
						is_read,
						read_at
					)
				`).eq("notification_read_states.user_id",r).eq("status","published").order("created_at",{ascending:!1});if(s)throw s;return(a==null?void 0:a.map(l=>{var d,v,u,f;return{id:l.id,notification_id:l.id,title:l.title,message:l.message,type:l.type,priority:l.priority,is_read:((v=(d=l.notification_read_states)==null?void 0:d[0])==null?void 0:v.is_read)||!1,read_at:(f=(u=l.notification_read_states)==null?void 0:u[0])==null?void 0:f.read_at,created_at:l.created_at}}))||[]}catch(a){throw console.error("Error fetching user notifications:",a),new Error("Failed to fetch user notifications")}}async createNotification(r,a){var s;try{const{data:i,error:l}=await Tt.from("users").select("id, username, role_type").eq("username",a).single();if(l||!i)throw console.error("❌ [NotificationManagement] Could not find user:",a,l),new Error("User not found");const d=i.id,v=i.username,u=i.role_type||"Admin";let f=r.type;["info","warning","error","success","announcement","task_assigned","task_completed","task_overdue","system_maintenance","policy_update","birthday_reminder","leave_approved","leave_rejected","document_uploaded","meeting_scheduled"].includes(r.type)||(f="info");let h=r.priority;["low","medium","high","urgent","critical"].includes(r.priority)||(h="medium");const _={title:r.title,message:r.message,type:f,priority:h,target_type:r.target_type,target_users:r.target_users||null,target_roles:r.target_roles||null,target_branches:r.target_branches||null,created_by:a,created_by_name:v,created_by_role:u,status:"published",scheduled_for:r.scheduled_at?new Date(r.scheduled_at).toISOString():null,expires_at:r.expires_at?new Date(r.expires_at).toISOString():null,has_attachments:!1,read_count:0,total_recipients:((s=r.target_users)==null?void 0:s.length)||0};console.log("📝 [NotificationManagement] Creating notification with username:",_);const{data:x,error:T}=await Tt.from("notifications").insert(_).select("*").single();if(T)throw console.error("❌ [NotificationManagement] Database error:",T),T;console.log("✅ [NotificationManagement] Notification created successfully:",x);try{console.log("🔄 [NotificationManagement] Triggering automatic push notification processing..."),setTimeout(()=>{_s.processOnce().catch(b=>{console.error("❌ [NotificationManagement] Auto push processing failed:",b)})},1e3)}catch(b){console.error("❌ [NotificationManagement] Failed to trigger automatic push processing:",b)}return x}catch(i){throw console.error("Error creating notification:",i),new Error("Failed to create notification")}}async updateNotification(r,a){try{const{data:s,error:i}=await Tt.from("notifications").update(a).eq("id",r).select().single();if(i)throw i;return s}catch(s){throw console.error("Error updating notification:",s),new Error("Failed to update notification")}}async deleteNotification(r){try{const{error:a}=await Tt.from("notifications").delete().eq("id",r);if(a)throw a;return{success:!0}}catch(a){throw console.error("Error deleting notification:",a),new Error("Failed to delete notification")}}async markAsRead(r,a){try{const{error:s}=await Tt.from("notification_read_states").upsert({notification_id:r,user_id:a,is_read:!0,read_at:new Date().toISOString()});if(s)throw s;return{success:!0}}catch(s){throw console.error("Error marking notification as read:",s),new Error("Failed to mark notification as read")}}async markAsUnread(r,a){try{const{error:s}=await Tt.from("notification_read_states").upsert({notification_id:r,user_id:a,is_read:!1,read_at:null});if(s)throw s}catch(s){throw console.error("Error marking notification as unread:",s),new Error("Failed to mark notification as unread")}}async markAllAsRead(r){var a;try{const{data:s,error:i}=await Tt.from("notifications").select("id").eq("status","published");if(i)throw i;const{data:l,error:d}=await Tt.from("notification_read_states").select("notification_id").eq("user_id",r);if(d)throw d;const v=new Set((l==null?void 0:l.map(f=>f.notification_id))||[]),u=((a=s==null?void 0:s.filter(f=>!v.has(f.id)))==null?void 0:a.map(f=>({notification_id:f.id,user_id:r,is_read:!0,read_at:new Date().toISOString()})))||[];if(u.length>0){const{error:f}=await Tt.from("notification_read_states").insert(u);if(f)throw f}if(l&&l.length>0){const{error:f}=await Tt.from("notification_read_states").update({is_read:!0,read_at:new Date().toISOString()}).eq("user_id",r).eq("is_read",!1);if(f)throw f}return{success:!0}}catch(s){throw console.error("Error marking all notifications as read:",s),new Error("Failed to mark all notifications as read")}}async getNotificationAttachments(r){try{const{data:a,error:s}=await Tt.from("notification_attachments").select("*").eq("notification_id",r);if(s)throw s;return a||[]}catch(a){throw console.error("Error fetching notification attachments:",a),new Error("Failed to fetch notification attachments")}}async getBranches(){try{const{data:r,error:a}=await Tt.from("branches").select("*").eq("is_active",!0).order("name_en");if(a)throw a;return r||[]}catch(r){throw console.error("Error fetching branches:",r),new Error("Failed to fetch branches")}}async getUsers(){try{const{data:r,error:a}=await Tt.from("users").select("*").order("username");if(a)throw a;return r||[]}catch(r){throw console.error("Error fetching users:",r),new Error("Failed to fetch users")}}async getNotificationStatistics(){try{const{count:r,error:a}=await Tt.from("notifications").select("*",{count:"exact",head:!0});if(a)throw a;const{count:s,error:i}=await Tt.from("notifications").select("*",{count:"exact",head:!0}).eq("status","published");if(i)throw i;const{count:l,error:d}=await Tt.from("notifications").select("*",{count:"exact",head:!0}).eq("status","scheduled");if(d)throw d;return{total:r||0,published:s||0,scheduled:l||0,draft:(r||0)-(s||0)-(l||0)}}catch(r){throw console.error("Error fetching notification statistics:",r),new Error("Failed to fetch notification statistics")}}async getReadStatus(r){try{const{data:a,error:s}=await Tt.from("notification_read_states").select("*").eq("user_id",r);if(s)throw s;return a||[]}catch(a){throw console.error("Error fetching read status:",a),new Error("Failed to fetch read status")}}async getAdminReadStatus(){try{const{data:r,error:a}=await Tt.from("notifications").select("*").eq("status","published").order("created_at",{ascending:!1});if(a)throw a;const{data:s,error:i}=await Tt.from("users").select(`
					id, 
					username, 
					role_type,
					employee_id,
					hr_employees(name, employee_id)
				`).order("username");if(i)throw i;const{data:l,error:d}=await Tt.from("notification_read_states").select("*").order("created_at",{ascending:!1});if(d)throw d;return{readStates:(l==null?void 0:l.map(u=>{var x,T,b,w,A;const f=r==null?void 0:r.find(C=>C.id===u.notification_id),h=s==null?void 0:s.find(C=>C.username===u.user_id||C.id===u.user_id);let _=u.user_id;if(h){const C=(x=h.hr_employees)==null?void 0:x[0];C!=null&&C.name?_=C.name:_=h.username}return{...u,display_name:_,notification:f?{title:f.title,type:f.type,priority:f.priority,created_at:f.created_at}:null,user:h?{username:h.username,role_type:h.role_type,employee_name:((b=(T=h.hr_employees)==null?void 0:T[0])==null?void 0:b.name)||null,employee_id:((A=(w=h.hr_employees)==null?void 0:w[0])==null?void 0:A.employee_id)||null}:null}}))||[],notifications:r||[],users:s||[]}}catch(r){throw console.error("Error fetching admin read status:",r),new Error("Failed to fetch admin read status")}}async createTaskAssignmentNotification(r,a,s,i,l,d,v,u){try{let f=i,h=l;if(i.includes("-")){const{data:b,error:w}=await Tt.from("users").select("username").eq("id",i).single();w||!b?(console.error("❌ [NotificationManagement] Could not find user for UUID:",i,w),f=l||"Admin"):f=b.username}const _={title:`New Task Assigned: ${a}`,message:`You have been assigned a new task: "${a}"${d?` with deadline: ${new Date(d).toLocaleDateString()}`:""}${v?`

Notes: ${v}`:""}${u!=null&&u.require_photo_upload?`
📷 Photo upload required`:""}${u!=null&&u.require_erp_reference?`
📋 ERP reference required`:""}`,type:"task_assigned",priority:"medium",target_type:"specific_users",target_users:s};console.log("🔄 [NotificationManagement] Creating notification with data:",{title:_.title,type:_.type,target_type:_.target_type,target_users:s,created_by:f,task_id:r,task_assignment_id:u==null?void 0:u.assignmentId});const{data:x,error:T}=await Tt.from("notifications").insert({title:_.title,message:_.message,type:_.type,priority:_.priority,target_type:_.target_type,target_users:s,created_by:f,created_by_name:h,created_by_role:"Admin",status:"published",total_recipients:s.length,task_id:r,task_assignment_id:(u==null?void 0:u.assignmentId)||null,metadata:{task_id:r,task_assignment_id:(u==null?void 0:u.assignmentId)||null,task_title:a,require_task_finished:(u==null?void 0:u.require_task_finished)||!1,require_photo_upload:(u==null?void 0:u.require_photo_upload)||!1,require_erp_reference:(u==null?void 0:u.require_erp_reference)||!1,deadline:d,notes:v}}).select("*").single();if(T)throw T;console.log("Task assignment notification created:",x);try{console.log("🔄 [NotificationManagement] Triggering automatic push notification processing for task assignment..."),setTimeout(()=>{_s.processOnce().catch(b=>{console.error("❌ [NotificationManagement] Auto push processing failed for task assignment:",b)})},1e3)}catch(b){console.error("❌ [NotificationManagement] Failed to trigger automatic push processing for task assignment:",b)}return x}catch(f){throw console.error("Error creating task assignment notification:",f),new Error("Failed to create task assignment notification")}}async sendPushNotification(r,a,s,i){try{await pi.showNotification({title:r,body:a,data:i}),console.log("Push notification sent:",{title:r,body:a,userIds:s,data:i})}catch(l){console.error("Error sending push notification:",l)}}async registerForPushNotifications(){try{return await pi.initialize()}catch(r){return console.error("Error registering for push notifications:",r),!1}}async unregisterFromPushNotifications(){try{await pi.unregisterDevice()}catch(r){console.error("Error unregistering from push notifications:",r)}}isPushNotificationSupported(){return typeof window>"u"?!1:"serviceWorker"in navigator&&"PushManager"in window&&"Notification"in window}getPushNotificationPermission(){return typeof window>"u"?"denied":Notification.permission}async requestPushNotificationPermission(){try{return await pi.requestPermission()}catch(r){return console.error("Error requesting push notification permission:",r),"denied"}}async sendTestNotification(){try{await pi.sendTestNotification()}catch(r){console.error("Error sending test notification:",r)}}async startRealtimeNotificationListener(){try{const r=await this.getCurrentUser();if(!r)return;const a=Tt.channel("user-notifications").on("postgres_changes",{event:"INSERT",schema:"public",table:"notification_recipients",filter:`user_id=eq.${r.id}`},async s=>{console.log("New notification received:",s);const{data:i}=await Tt.from("notifications").select("*").eq("id",s.new.notification_id).single();i&&await this.sendPushNotification(i.title,i.message,[r.id],{notification_id:i.id,url:`/notifications?id=${i.id}`})}).subscribe();console.log("Real-time notification listener started")}catch(r){console.error("Error starting real-time notification listener:",r)}}async getCurrentUser(){return new Promise(r=>{let a;a=us.subscribe(s=>{a&&a(),r(s)})})}}const jr=new fv,Wr=jr;var pv=k('<div class="message success svelte-1wucfgi"><span class="icon">✅</span> </div>'),hv=k('<div class="message error svelte-1wucfgi"><span class="icon">❌</span> </div>'),mv=k("<option>Loading branches...</option>"),_v=k("<option> </option>"),gv=k('<div class="loading-users svelte-1wucfgi"><div class="loading-spinner-small svelte-1wucfgi"></div> <p>Loading users...</p></div>'),xv=k('<div class="no-users svelte-1wucfgi"><p>No users found for the selected branch.</p></div>'),bv=k('<div><div class="col-select svelte-1wucfgi"><input type="checkbox" class="svelte-1wucfgi"/></div> <div class="col-username svelte-1wucfgi"> </div> <div class="col-name svelte-1wucfgi"> </div> <div class="col-employee-id svelte-1wucfgi"> </div> <div class="col-position svelte-1wucfgi"> </div> <div class="col-role svelte-1wucfgi"> </div> <div class="col-branch svelte-1wucfgi"> </div></div>'),wv=k('<div class="selection-summary svelte-1wucfgi"><strong> </strong></div>'),yv=k('<div class="users-table svelte-1wucfgi"><div class="table-header svelte-1wucfgi"><div class="col-select svelte-1wucfgi">Select</div> <div class="col-username svelte-1wucfgi">Username</div> <div class="col-name svelte-1wucfgi">Employee Name</div> <div class="col-employee-id svelte-1wucfgi">Employee ID</div> <div class="col-position svelte-1wucfgi">Position</div> <div class="col-role svelte-1wucfgi">Role</div> <div class="col-branch svelte-1wucfgi">Branch</div></div> <div class="table-body svelte-1wucfgi"></div></div> <!>',1),kv=k('<div class="users-selection svelte-1wucfgi"><div class="users-header svelte-1wucfgi"><h4 class="users-title svelte-1wucfgi">Select Users</h4> <div class="users-controls svelte-1wucfgi"><div class="branch-filter svelte-1wucfgi"><label for="branch_filter" class="svelte-1wucfgi">Filter by Branch:</label> <select id="branch_filter" class="svelte-1wucfgi"><!></select></div> <button type="button" class="select-all-btn svelte-1wucfgi"> </button></div></div> <!></div>'),Tv=k('<span class="loading-spinner svelte-1wucfgi"></span> Sending...',1),Ev=k('<div class="create-notification svelte-1wucfgi"><!> <!> <div class="form-content svelte-1wucfgi"><form><div class="user-section svelte-1wucfgi"><div class="user-info svelte-1wucfgi"><span class="role-label svelte-1wucfgi">Creating as:</span> <span> </span></div></div> <div class="form-section svelte-1wucfgi"><h3 class="section-title svelte-1wucfgi">Basic Information</h3> <div class="form-group svelte-1wucfgi"><label for="title" class="svelte-1wucfgi">Title *</label> <input id="title" type="text" placeholder="Enter notification title" maxlength="100" required class="svelte-1wucfgi"/></div> <div class="form-group svelte-1wucfgi"><label for="message" class="svelte-1wucfgi">Message *</label> <textarea id="message" placeholder="Enter your notification message..." rows="4" maxlength="500" required class="svelte-1wucfgi"></textarea></div> <div class="form-row svelte-1wucfgi"><div class="form-group svelte-1wucfgi"><label for="priority" class="svelte-1wucfgi">Priority</label> <select id="priority" class="svelte-1wucfgi"><option>Low Priority</option><option>Medium Priority</option><option>High Priority</option><option>Urgent Priority</option></select></div> <div class="form-group svelte-1wucfgi"><label for="type" class="svelte-1wucfgi">Type</label> <select id="type" class="svelte-1wucfgi"><option>Information</option><option>Success</option><option>Warning</option><option>Error</option><option>Announcement</option></select></div></div></div> <div class="form-section svelte-1wucfgi"><h3 class="section-title svelte-1wucfgi">Target Audience</h3> <div class="form-group svelte-1wucfgi"><label for="target_type" class="svelte-1wucfgi">Target Type</label> <select id="target_type" class="svelte-1wucfgi"><option>All Users</option><option>User Specific</option></select></div> <!></div> <div class="form-actions svelte-1wucfgi"><button type="button" class="btn secondary svelte-1wucfgi">Reset</button> <button type="submit" class="btn primary svelte-1wucfgi"><!></button></div></form></div></div>');function Av(t,r){pa(r,!1);const a=()=>sr(qs,"$auth",s),[s,i]=Zr(),l=Q(),d=Q(),v=Q();let u=Q({title:"",message:"",priority:"medium",type:"info",target_type:"all_users",target_users:[]}),f=Q([]),h=[],_=Q([]),x=Q("all"),T=Q(!0),b=Q(!1),w=Q(!1),A=Q(""),C=Q("");Aa(async()=>{await z(),await F()});async function z(){try{p(T,!0);const Oe=await Wr.getBranches();p(f,[{id:"all",name:"All Branches"},...Oe.map(Ee=>({id:Ee.id.toString(),name:Ee.name_en||Ee.name}))])}catch(Oe){console.error("Error loading branches:",Oe),p(f,[{id:"all",name:"All Branches"},{id:"1",name:"Main Branch"},{id:"2",name:"Downtown Branch"},{id:"3",name:"Westside Branch"}])}finally{p(T,!1)}}async function F(){try{p(b,!0);const{data:Oe,error:Ee}=await Tt.from("users").select(`
					id,
					username,
					role_type,
					employee_id,
					branch_id,
					hr_employees(
						id,
						name,
						employee_id,
						branch_id,
						hr_position_assignments(
							id,
							position_id,
							is_current,
							hr_positions(position_title_en, position_title_ar)
						)
					),
					branches(
						id,
						name_en
					)
				`).order("username");if(Ee)throw console.error("Supabase error loading users:",Ee),Ee;console.log("🔍 Raw users data from Supabase:",Oe),h=(Oe==null?void 0:Oe.map(et=>{var tt,lt,Xe;const dt=et.hr_employees,ut=et.branches;console.log(`👤 Processing user ${et.username}:`,{employee_data:dt,branch_data:ut,raw_user:et});const Pe=(tt=dt==null?void 0:dt.hr_position_assignments)==null?void 0:tt.find(at=>at.is_current===!0),qe={id:et.id,username:et.username,employee_name:(dt==null?void 0:dt.name)||null,employee_id:(dt==null?void 0:dt.employee_id)||null,position_name:((lt=Pe==null?void 0:Pe.hr_positions)==null?void 0:lt.position_title_en)||null,role_type:et.role_type,branch_id:((Xe=et.branch_id)==null?void 0:Xe.toString())||null,branch_name:(ut==null?void 0:ut.name_en)||"Unknown Branch"};return console.log(`✅ Transformed user ${et.username}:`,qe),qe}))||[],re()}catch(Oe){console.error("Error loading users:",Oe);try{h=(await Wr.getUsers()).map(et=>({id:et.id,username:et.username,employee_name:null,employee_id:null,position_name:null,role_type:et.role_type||"Employee",branch_id:null,branch_name:"Unknown Branch"})),re()}catch(Ee){console.error("Fallback user loading failed:",Ee),h=[],p(_,[])}}finally{p(b,!1)}}function re(){let Oe=h;e(x)!=="all"&&(Oe=h.filter(Ee=>Ee.branch_id===e(x))),p(_,Oe.map(Ee=>({...Ee,selected:e(u).target_users.includes(Ee.id)})))}function me(){re()}function ue(Oe,Ee){Ee?$e(u,e(u).target_users=[...e(u).target_users,Oe]):$e(u,e(u).target_users=e(u).target_users.filter(et=>et!==Oe)),p(_,e(_).map(et=>et.id===Oe?{...et,selected:Ee}:et))}function D(){e(_).every(Ee=>Ee.selected)?e(_).forEach(Ee=>{$e(u,e(u).target_users=e(u).target_users.filter(et=>et!==Ee.id)),Ee.selected=!1}):e(_).forEach(Ee=>{Ee.selected||($e(u,e(u).target_users=[...e(u).target_users,Ee.id]),Ee.selected=!0)}),p(_,[...e(_)]),$e(u,e(u).target_users=[...e(u).target_users])}async function E(){var Oe,Ee,et;if(!e(u).title.trim()||!e(u).message.trim()){p(C,"Title and message are required");return}if(e(u).target_type==="specific_users"&&e(u).target_users.length===0){p(C,"Please select at least one user for specific user targeting");return}p(w,!0),p(C,"");try{const dt={title:e(u).title.trim(),message:e(u).message.trim(),type:e(u).type,priority:e(u).priority,target_type:e(u).target_type,target_users:e(u).target_type==="specific_users"?e(u).target_users:void 0};console.log("🧪 Debug currentUser:",e(l)),console.log("🧪 Debug auth store:",a());const ut=((Oe=e(l))==null?void 0:Oe.username)||((et=(Ee=a())==null?void 0:Ee.user)==null?void 0:et.username)||"madmin";console.log("🧪 Using createdByUser:",ut);const Pe=await Wr.createNotification(dt,ut);Pe&&Pe.id?(p(A,"Notification published successfully!"),setTimeout(()=>{he(),p(A,"")},2e3)):p(C,"Failed to publish notification. Please try again.")}catch(dt){p(C,dt instanceof Error?dt.message:"Failed to publish notification. Please try again."),console.error("Publish notification error:",dt)}finally{p(w,!1)}}function he(){p(u,{title:"",message:"",priority:"medium",type:"info",target_type:"all_users",target_users:[]}),p(_,e(_).map(Oe=>({...Oe,selected:!1}))),p(x,"all"),re()}Nt(()=>a(),()=>{var Oe;p(l,(Oe=a())==null?void 0:Oe.user)}),Nt(()=>e(l),()=>{var Oe;p(d,((Oe=e(l))==null?void 0:Oe.role)||"Position-based")}),Nt(()=>e(d),()=>{p(v,e(d)==="Admin"||e(d)==="Master Admin")}),Va(),ha();var xe=Ev(),K=o(xe);{var q=Oe=>{var Ee=pv(),et=c(o(Ee));n(Ee),R(()=>y(et,` ${e(A)??""}`)),g(Oe,Ee)};X(K,Oe=>{e(A)&&Oe(q)})}var ae=c(K,2);{var Me=Oe=>{var Ee=hv(),et=c(o(Ee));n(Ee),R(()=>y(et,` ${e(C)??""}`)),g(Oe,Ee)};X(ae,Oe=>{e(C)&&Oe(Me)})}var ge=c(ae,2),Ne=o(ge),Be=o(Ne),be=o(Be),L=c(o(be),2),Te=o(L,!0);n(L),n(be),n(Be);var ye=c(Be,2),P=c(o(ye),2),pe=c(o(P),2);At(pe),n(P);var B=c(P,2),j=c(o(B),2);ks(j),n(B);var I=c(B,2),Y=o(I),fe=c(o(Y),2);R(()=>{e(u),Xt(()=>{})});var ce=o(fe);ce.value=ce.__value="low";var J=c(ce);J.value=J.__value="medium";var le=c(J);le.value=le.__value="high";var S=c(le);S.value=S.__value="urgent",n(fe),n(Y);var De=c(Y,2),Ue=c(o(De),2);R(()=>{e(u),Xt(()=>{})});var We=o(Ue);We.value=We.__value="info";var ke=c(We);ke.value=ke.__value="success";var N=c(ke);N.value=N.__value="warning";var V=c(N);V.value=V.__value="error";var G=c(V);G.value=G.__value="announcement",n(Ue),n(De),n(I),n(ye);var de=c(ye,2),ve=c(o(de),2),Ie=c(o(ve),2);R(()=>{e(u),Xt(()=>{})});var Ye=o(Ie);Ye.value=Ye.__value="all_users";var oe=c(Ye);oe.value=oe.__value="specific_users",n(Ie),n(ve);var se=c(ve,2);{var U=Oe=>{var Ee=kv(),et=o(Ee),dt=c(o(et),2),ut=o(dt),Pe=c(o(ut),2);R(()=>{e(x),Xt(()=>{e(T),e(f)})});var qe=o(Pe);{var tt=_e=>{var Ve=mv();Ve.value=Ve.__value="all",g(_e,Ve)},lt=_e=>{var Ve=Ca(),Je=Bt(Ve);Mt(Je,1,()=>e(f),Lt,(st,ot)=>{var Le=_v(),nt=o(Le,!0);n(Le);var vt={};R(()=>{y(nt,(e(ot),m(()=>e(ot).name))),vt!==(vt=(e(ot),m(()=>e(ot).id)))&&(Le.value=(Le.__value=(e(ot),m(()=>e(ot).id)))??"")}),g(st,Le)}),g(_e,Ve)};X(qe,_e=>{e(T)?_e(tt):_e(lt,!1)})}n(Pe),n(ut);var Xe=c(ut,2),at=o(Xe,!0);n(Xe),n(dt),n(et);var Fe=c(et,2);{var rt=_e=>{var Ve=gv();g(_e,Ve)},Ce=_e=>{var Ve=Ca(),Je=Bt(Ve);{var st=Le=>{var nt=xv();g(Le,nt)},ot=Le=>{var nt=yv(),vt=Bt(nt),xt=c(o(vt),2);Mt(xt,5,()=>e(_),Lt,(O,te)=>{var ne=bv();let ie;var Se=o(ne),Qe=o(Se);At(Qe),n(Se);var je=c(Se,2),ze=o(je,!0);n(je);var Re=c(je,2),it=o(Re,!0);n(Re);var ft=c(Re,2),mt=o(ft,!0);n(ft);var ht=c(ft,2),pt=o(ht,!0);n(ht);var _t=c(ht,2),Ge=o(_t,!0);n(_t);var ct=c(_t,2),Ze=o(ct,!0);n(ct),n(ne),R(bt=>{ie=wt(ne,1,"table-row svelte-1wucfgi",null,ie,bt),vs(Qe,(e(te),m(()=>e(te).selected))),y(ze,(e(te),m(()=>e(te).username))),y(it,(e(te),m(()=>e(te).employee_name||"-"))),y(mt,(e(te),m(()=>e(te).employee_id||"-"))),y(pt,(e(te),m(()=>e(te).position_name||"-"))),y(Ge,(e(te),m(()=>e(te).role_type))),y(Ze,(e(te),m(()=>e(te).branch_name)))},[()=>({selected:e(te).selected})]),Z("change",Qe,bt=>ue(e(te).id,bt.target.checked)),g(O,ne)}),n(xt),n(vt);var M=c(vt,2);{var H=O=>{var te=wv(),ne=o(te),ie=o(ne);n(ne),n(te),R(()=>y(ie,`${e(u),m(()=>e(u).target_users.length)??""} user(s) selected`)),g(O,te)};X(M,O=>{e(u),m(()=>e(u).target_users.length>0)&&O(H)})}g(Le,nt)};X(Je,Le=>{e(_),m(()=>e(_).length===0)?Le(st):Le(ot,!1)},!0)}g(_e,Ve)};X(Fe,_e=>{e(b)?_e(rt):_e(Ce,!1)})}n(Ee),R(_e=>y(at,_e),[()=>(e(_),m(()=>e(_).every(_e=>_e.selected)?"Deselect All":"Select All"))]),ra(Pe,()=>e(x),_e=>p(x,_e)),Z("change",Pe,me),Z("click",Xe,D),g(Oe,Ee)};X(se,Oe=>{e(u),m(()=>e(u).target_type==="specific_users")&&Oe(U)})}n(de);var W=c(de,2),ee=o(W),we=c(ee,2),Ae=o(we);{var He=Oe=>{var Ee=Tv();Et(),g(Oe,Ee)},Ke=Oe=>{var Ee=Ya("📋 Publish");g(Oe,Ee)};X(Ae,Oe=>{e(w)?Oe(He):Oe(Ke,!1)})}n(we),n(W),n(Ne),n(ge),n(xe),R(Oe=>{wt(L,1,`role-badge ${Oe??""}`,"svelte-1wucfgi"),y(Te,e(d)),ee.disabled=e(w),we.disabled=e(w)},[()=>(e(d),m(()=>e(d).toLowerCase().replace(" ","-")))]),zt(pe,()=>e(u).title,Oe=>$e(u,e(u).title=Oe)),zt(j,()=>e(u).message,Oe=>$e(u,e(u).message=Oe)),ra(fe,()=>e(u).priority,Oe=>$e(u,e(u).priority=Oe)),ra(Ue,()=>e(u).type,Oe=>$e(u,e(u).type=Oe)),ra(Ie,()=>e(u).target_type,Oe=>$e(u,e(u).target_type=Oe)),Z("change",Ie,()=>{$e(u,e(u).target_users=[]),re()}),Z("click",ee,he),Z("submit",Ne,Ur(E)),g(t,xe),ma(),i()}var Sv=k('<div class="error-banner svelte-5fib9p"><span class="error-icon svelte-5fib9p">❌</span> <button class="retry-btn svelte-5fib9p">Retry</button></div>'),Cv=k('<div class="loading-state svelte-5fib9p"><div class="loading-spinner svelte-5fib9p"></div> <p class="svelte-5fib9p">Loading read status data...</p></div>'),Fv=k('<option class="svelte-5fib9p"> </option>'),Dv=k('<option class="svelte-5fib9p"> </option>'),Mv=k('<div class="read-item svelte-5fib9p"><span class="user-id svelte-5fib9p"> </span> <span class="read-time svelte-5fib9p"> </span></div>'),Iv=k('<div class="read-details svelte-5fib9p"><h4 class="details-title svelte-5fib9p">Users who read this notification:</h4> <div class="read-list svelte-5fib9p"></div></div>'),Rv=k('<div class="notification-group svelte-5fib9p"><div class="notification-header svelte-5fib9p"><div class="notification-info svelte-5fib9p"><span class="notification-icon svelte-5fib9p"> </span> <div class="svelte-5fib9p"><h3 class="notification-title svelte-5fib9p"> </h3> <p class="notification-meta svelte-5fib9p"> </p></div></div> <div class="read-stats svelte-5fib9p"><div class="stat svelte-5fib9p"><span> </span> <span class="stat-label svelte-5fib9p">Read Rate</span></div> <div class="stat svelte-5fib9p"><span class="stat-number text-green-600 svelte-5fib9p"> </span> <span class="stat-label svelte-5fib9p">Read</span></div> <div class="stat svelte-5fib9p"><span class="stat-number text-red-600 svelte-5fib9p"> </span> <span class="stat-label svelte-5fib9p">Unread</span></div></div></div> <!></div>'),Nv=k('<div class="notification-groups svelte-5fib9p"></div>'),Pv=k('<span class="status-badge read svelte-5fib9p">✓ Read</span> <span class="read-time svelte-5fib9p"> </span>',1),Lv=k('<span class="status-badge unread svelte-5fib9p">⚪ Unread</span> <span class="created-time svelte-5fib9p"> </span>',1),Ov=k('<div><div class="notification-content svelte-5fib9p"><span class="notification-title svelte-5fib9p"> </span> <span class="notification-type svelte-5fib9p"> </span></div> <div class="notification-status svelte-5fib9p"><!></div></div>'),zv=k('<div class="notification-details svelte-5fib9p"><h4 class="details-title svelte-5fib9p">All Notifications for this user:</h4> <div class="notification-list svelte-5fib9p"></div></div>'),Bv=k('<div class="user-group svelte-5fib9p"><div class="user-header svelte-5fib9p"><div class="user-info svelte-5fib9p"><span class="user-icon svelte-5fib9p">👤</span> <div class="svelte-5fib9p"><h3 class="user-name svelte-5fib9p"> </h3> <p class="user-meta svelte-5fib9p"> </p></div></div> <div class="read-stats svelte-5fib9p"><div class="stat svelte-5fib9p"><span> </span> <span class="stat-label svelte-5fib9p">Read Rate</span></div> <div class="stat svelte-5fib9p"><span class="stat-number text-green-600 svelte-5fib9p"> </span> <span class="stat-label svelte-5fib9p">Read</span></div> <div class="stat svelte-5fib9p"><span class="stat-number text-red-600 svelte-5fib9p"> </span> <span class="stat-label svelte-5fib9p">Unread</span></div></div></div> <!></div>'),$v=k('<div class="user-groups svelte-5fib9p"></div>'),Uv=k('<div class="empty-state svelte-5fib9p"><div class="empty-icon svelte-5fib9p">📊</div> <h3 class="svelte-5fib9p">No data available</h3> <p class="svelte-5fib9p">No read status data matches your current filters.</p></div>'),qv=k('<div class="controls svelte-5fib9p"><div class="view-toggle svelte-5fib9p"><button>📢 By Notification</button> <button>👤 By User</button></div> <div class="filters svelte-5fib9p"><select class="filter-select svelte-5fib9p"><option class="svelte-5fib9p">All Notifications</option><!></select> <select class="filter-select svelte-5fib9p"><option class="svelte-5fib9p">All Users</option><!></select> <input type="text" placeholder="Search..." class="search-input svelte-5fib9p"/></div></div> <div class="content svelte-5fib9p"><!> <!></div>',1),jv=k('<div class="admin-read-status svelte-5fib9p"><div class="header svelte-5fib9p"><h2 class="title svelte-5fib9p">📊 Notification Read Status - Admin View</h2> <button class="refresh-btn svelte-5fib9p"><span class="icon svelte-5fib9p">🔄</span> Refresh</button></div> <!> <!></div>');function Gl(t,r){pa(r,!1);const a=Q(),s=Q(),i=Q();let l=Q([]),d=Q([]),v=Q([]),u=Q(!0),f=Q(""),h=Q("all"),_=Q("all"),x=Q("");Aa(async()=>{await T()});async function T(){try{p(u,!0),p(f,"");const xe=await Wr.getAdminReadStatus();p(l,xe.readStates||[]),p(d,xe.notifications||[]),p(v,xe.users||[])}catch(xe){console.error("Error loading read status data:",xe),p(f,"Failed to load read status data. Please try again.")}finally{p(u,!1)}}let b=Q("by-notification");function w(xe){if(!xe)return"Never";const K=new Date(xe);return K.toLocaleDateString()+" "+K.toLocaleTimeString()}function A(xe){switch(xe){case"success":return"✅";case"warning":return"⚠️";case"error":return"❌";case"info":return"ℹ️";case"announcement":return"📢";default:return"📢"}}function C(xe){return xe>=80?"text-green-600":xe>=50?"text-yellow-600":"text-red-600"}Nt(()=>(e(l),e(h),e(_),e(v),e(x)),()=>{p(a,e(l).filter(xe=>{var K,q,ae,Me;if(e(h)!=="all"&&xe.notification_id!==e(h))return!1;if(e(_)!=="all"){const ge=e(v).find(Ne=>Ne.id===e(_));if(ge&&xe.user_id!==ge.id&&xe.user_id!==ge.username)return!1}return!(e(x)&&!((q=(K=xe.notification)==null?void 0:K.title)!=null&&q.toLowerCase().includes(e(x).toLowerCase()))&&!((ae=xe.display_name)!=null&&ae.toLowerCase().includes(e(x).toLowerCase()))&&!((Me=xe.user_id)!=null&&Me.toLowerCase().includes(e(x).toLowerCase())))}))}),Nt(()=>(e(d),e(a),e(v),e(h)),()=>{p(s,e(d).map(xe=>{const K=e(a).filter(ge=>ge.notification_id===xe.id),q=K.length,ae=e(v).length,Me=ae-q;return{...xe,readStates:K,readCount:q,totalUsers:ae,unreadCount:Me,readPercentage:ae>0?Math.round(q/ae*100):0}}).filter(xe=>e(h)==="all"||xe.id===e(h)))}),Nt(()=>(e(v),e(a),e(d),e(_)),()=>{p(i,e(v).map(xe=>{var L,Te,ye;const K=e(a).filter(P=>P.user_id===xe.id||P.user_id===xe.username),q=K.length,ae=e(d).length,Me=ae-q,ge=((L=K[0])==null?void 0:L.display_name)||((ye=(Te=xe.hr_employees)==null?void 0:Te[0])==null?void 0:ye.name)||xe.username||xe.id,Ne=K.map(P=>P.notification_id),Be=e(d).filter(P=>P&&!Ne.includes(P.id)).map(P=>({notification_id:P.id,notification:{title:P.title,type:P.type,priority:P.priority,created_at:P.created_at},user_id:xe.id,is_read:!1,read_at:null,created_at:P.created_at})),be=[...K.map(P=>({...P,is_read:!0})),...Be].sort((P,pe)=>{var I,Y;const B=((I=P.notification)==null?void 0:I.created_at)||P.created_at||P.read_at||new Date().toISOString(),j=((Y=pe.notification)==null?void 0:Y.created_at)||pe.created_at||pe.read_at||new Date().toISOString();return new Date(j)-new Date(B)});return{...xe,name:ge,readStates:K,allNotifications:be,readCount:q,totalNotifications:ae,unreadCount:Me,readPercentage:ae>0?Math.round(q/ae*100):0}}).filter(xe=>e(_)==="all"||xe.id===e(_)))}),Va(),ha();var z=jv(),F=o(z),re=c(o(F),2);n(F);var me=c(F,2);{var ue=xe=>{var K=Sv(),q=c(o(K)),ae=c(q);n(K),R(()=>y(q,` ${e(f)??""} `)),Z("click",ae,T),g(xe,K)};X(me,xe=>{e(f)&&xe(ue)})}var D=c(me,2);{var E=xe=>{var K=Cv();g(xe,K)},he=xe=>{var K=qv(),q=Bt(K),ae=o(q),Me=o(ae),ge=c(Me,2);n(ae);var Ne=c(ae,2),Be=o(Ne);R(()=>{e(h),Xt(()=>{e(d)})});var be=o(Be);be.value=be.__value="all";var L=c(be);Mt(L,1,()=>e(d),Lt,(J,le)=>{var S=Fv(),De=o(S,!0);n(S);var Ue={};R(()=>{y(De,(e(le),m(()=>e(le).title))),Ue!==(Ue=(e(le),m(()=>e(le).id)))&&(S.value=(S.__value=(e(le),m(()=>e(le).id)))??"")}),g(J,S)}),n(Be);var Te=c(Be,2);R(()=>{e(_),Xt(()=>{e(v)})});var ye=o(Te);ye.value=ye.__value="all";var P=c(ye);Mt(P,1,()=>e(v),Lt,(J,le)=>{var S=Dv(),De=o(S,!0);n(S);var Ue={};R(()=>{y(De,(e(le),m(()=>{var We,ke;return((ke=(We=e(le).hr_employees)==null?void 0:We[0])==null?void 0:ke.name)||e(le).username||e(le).id}))),Ue!==(Ue=(e(le),m(()=>e(le).id)))&&(S.value=(S.__value=(e(le),m(()=>e(le).id)))??"")}),g(J,S)}),n(Te);var pe=c(Te,2);At(pe),n(Ne),n(q);var B=c(q,2),j=o(B);{var I=J=>{var le=Nv();Mt(le,5,()=>e(s),Lt,(S,De)=>{var Ue=Rv(),We=o(Ue),ke=o(We),N=o(ke),V=o(N,!0);n(N);var G=c(N,2),de=o(G),ve=o(de,!0);n(de);var Ie=c(de,2),Ye=o(Ie);n(Ie),n(G),n(ke);var oe=c(ke,2),se=o(oe),U=o(se),W=o(U);n(U),Et(2),n(se);var ee=c(se,2),we=o(ee),Ae=o(we,!0);n(we),Et(2),n(ee);var He=c(ee,2),Ke=o(He),Oe=o(Ke,!0);n(Ke),Et(2),n(He),n(oe),n(We);var Ee=c(We,2);{var et=dt=>{var ut=Iv(),Pe=c(o(ut),2);Mt(Pe,5,()=>(e(De),m(()=>e(De).readStates)),Lt,(qe,tt)=>{var lt=Mv(),Xe=o(lt),at=o(Xe,!0);n(Xe);var Fe=c(Xe,2),rt=o(Fe,!0);n(Fe),n(lt),R(Ce=>{y(at,(e(tt),m(()=>e(tt).display_name||e(tt).user_name||e(tt).user_id))),y(rt,Ce)},[()=>(e(tt),m(()=>w(e(tt).read_at)))]),g(qe,lt)}),n(Pe),n(ut),g(dt,ut)};X(Ee,dt=>{e(De),m(()=>e(De).readStates.length>0)&&dt(et)})}n(Ue),R((dt,ut,Pe)=>{y(V,dt),y(ve,(e(De),m(()=>e(De).title))),y(Ye,`Created: ${ut??""} • 
											Type: ${e(De),m(()=>e(De).type)??""} • 
											Priority: ${e(De),m(()=>e(De).priority)??""}`),wt(U,1,`stat-number ${Pe??""}`,"svelte-5fib9p"),y(W,`${e(De),m(()=>e(De).readPercentage)??""}%`),y(Ae,(e(De),m(()=>e(De).readCount))),y(Oe,(e(De),m(()=>e(De).unreadCount)))},[()=>(e(De),m(()=>A(e(De).type))),()=>(e(De),m(()=>w(e(De).created_at))),()=>(e(De),m(()=>C(e(De).readPercentage)))]),g(S,Ue)}),n(le),g(J,le)},Y=J=>{var le=$v();Mt(le,5,()=>e(i),Lt,(S,De)=>{var Ue=Bv(),We=o(Ue),ke=o(We),N=c(o(ke),2),V=o(N),G=o(V,!0);n(V);var de=c(V,2),ve=o(de);n(de),n(N),n(ke);var Ie=c(ke,2),Ye=o(Ie),oe=o(Ye),se=o(oe);n(oe),Et(2),n(Ye);var U=c(Ye,2),W=o(U),ee=o(W,!0);n(W),Et(2),n(U);var we=c(U,2),Ae=o(we),He=o(Ae,!0);n(Ae),Et(2),n(we),n(Ie),n(We);var Ke=c(We,2);{var Oe=Ee=>{var et=zv(),dt=c(o(et),2);Mt(dt,5,()=>(e(De),m(()=>e(De).allNotifications)),Lt,(ut,Pe)=>{var qe=Ov(),tt=o(qe),lt=o(tt),Xe=o(lt,!0);n(lt);var at=c(lt,2),Fe=o(at,!0);n(at),n(tt);var rt=c(tt,2),Ce=o(rt);{var _e=Je=>{var st=Pv(),ot=c(Bt(st),2),Le=o(ot,!0);n(ot),R(nt=>y(Le,nt),[()=>(e(Pe),m(()=>w(e(Pe).read_at)))]),g(Je,st)},Ve=Je=>{var st=Lv(),ot=c(Bt(st),2),Le=o(ot,!0);n(ot),R(nt=>y(Le,nt),[()=>(e(Pe),m(()=>{var nt;return w((nt=e(Pe).notification)==null?void 0:nt.created_at)}))]),g(Je,st)};X(Ce,Je=>{e(Pe),m(()=>e(Pe).is_read)?Je(_e):Je(Ve,!1)})}n(rt),n(qe),R(()=>{wt(qe,1,`notification-item ${e(Pe),m(()=>e(Pe).is_read?"read":"unread")??""}`,"svelte-5fib9p"),y(Xe,(e(Pe),m(()=>{var Je;return((Je=e(Pe).notification)==null?void 0:Je.title)||"Unknown Notification"}))),y(Fe,(e(Pe),m(()=>{var Je;return((Je=e(Pe).notification)==null?void 0:Je.type)||""})))}),g(ut,qe)}),n(dt),n(et),g(Ee,et)};X(Ke,Ee=>{e(De),m(()=>e(De).allNotifications.length>0)&&Ee(Oe)})}n(Ue),R(Ee=>{y(G,(e(De),m(()=>e(De).name))),y(ve,`User ID: ${e(De),m(()=>e(De).id)??""}`),wt(oe,1,`stat-number ${Ee??""}`,"svelte-5fib9p"),y(se,`${e(De),m(()=>e(De).readPercentage)??""}%`),y(ee,(e(De),m(()=>e(De).readCount))),y(He,(e(De),m(()=>e(De).unreadCount)))},[()=>(e(De),m(()=>C(e(De).readPercentage)))]),g(S,Ue)}),n(le),g(J,le)};X(j,J=>{e(b)==="by-notification"?J(I):J(Y,!1)})}var fe=c(j,2);{var ce=J=>{var le=Uv();g(J,le)};X(fe,J=>{e(b),e(s),e(i),m(()=>(e(b)==="by-notification"?e(s):e(i)).length===0)&&J(ce)})}n(B),R(()=>{wt(Me,1,`toggle-btn ${e(b)==="by-notification"?"active":""}`,"svelte-5fib9p"),wt(ge,1,`toggle-btn ${e(b)==="by-user"?"active":""}`,"svelte-5fib9p")}),Z("click",Me,()=>p(b,"by-notification")),Z("click",ge,()=>p(b,"by-user")),ra(Be,()=>e(h),J=>p(h,J)),ra(Te,()=>e(_),J=>p(_,J)),zt(pe,()=>e(x),J=>p(x,J)),g(xe,K)};X(D,xe=>{e(u)?xe(E):xe(he,!1)})}n(z),R(()=>re.disabled=e(u)),Z("click",re,T),g(t,z),ma()}var Wv=k('<div class="loading-section svelte-1tffaz9"><div class="loading-spinner svelte-1tffaz9"></div> <p class="svelte-1tffaz9">Loading task details...</p></div>'),Hv=k(" <!>",1),Vv=k('<div class="detail-item svelte-1tffaz9"><label class="svelte-1tffaz9">⚠️ Status:</label> <span><!></span></div>'),Gv=k('<div class="detail-item svelte-1tffaz9"><label class="svelte-1tffaz9">📅 Scheduled:</label> <span class="value svelte-1tffaz9"> <!></span></div>'),Xv=k('<div class="detail-item svelte-1tffaz9"><label class="svelte-1tffaz9">📌 Assigned to:</label> <span class="value svelte-1tffaz9"> </span></div> <div class="detail-item svelte-1tffaz9"><label class="svelte-1tffaz9">👤 Assigned by:</label> <span class="value svelte-1tffaz9"> </span></div> <div class="detail-item svelte-1tffaz9"><label class="svelte-1tffaz9">� Assignment date:</label> <span class="value svelte-1tffaz9"> </span></div>',1),Yv=k('<div class="description-block svelte-1tffaz9"><label class="svelte-1tffaz9">📄 Description:</label> <div class="description-text svelte-1tffaz9"> </div></div>'),Kv=k('<div class="description-block svelte-1tffaz9"><label class="svelte-1tffaz9">📝 Assignment Notes:</label> <div class="description-text svelte-1tffaz9"> </div></div>'),Qv=k('<div class="reassignment-section svelte-1tffaz9"><div class="section-header svelte-1tffaz9"><h3 class="svelte-1tffaz9">🔄 Task Reassignment</h3> <p class="svelte-1tffaz9">This task can be reassigned to other users</p></div> <button class="reassign-btn svelte-1tffaz9">👥 Reassign Task</button></div>'),Zv=k('<button class="image-thumbnail svelte-1tffaz9"><img alt="Task image" class="thumbnail-img svelte-1tffaz9" loading="lazy"/></button>'),Jv=k('<div class="images-section svelte-1tffaz9"><label class="svelte-1tffaz9">🖼️ Task Images:</label> <div class="images-grid svelte-1tffaz9"></div></div>'),e0=k('<div class="reassign-section svelte-1tffaz9"><label class="svelte-1tffaz9">🔄 Reassignment:</label> <button class="reassign-btn svelte-1tffaz9">👥 Reassign Task</button> <p class="reassign-note svelte-1tffaz9">This task can be reassigned to other users</p></div>'),t0=k('<div class="details-content svelte-1tffaz9"><div class="detail-grid svelte-1tffaz9"><div class="detail-item svelte-1tffaz9"><label class="svelte-1tffaz9">📝 Title:</label> <span class="value svelte-1tffaz9"> </span></div> <div class="detail-item svelte-1tffaz9"><label class="svelte-1tffaz9">🎯 Priority:</label> <span> </span></div> <div class="detail-item svelte-1tffaz9"><label class="svelte-1tffaz9">📅 Created:</label> <span class="value svelte-1tffaz9"> </span></div> <div class="detail-item svelte-1tffaz9"><label class="svelte-1tffaz9">⏰ Deadline:</label> <span class="value svelte-1tffaz9"><!></span></div> <!> <!> <!></div> <!> <!> <!> <!> <!></div>'),a0=k('<div class="task-details-section svelte-1tffaz9"><div class="details-header svelte-1tffaz9"><h3 class="svelte-1tffaz9">📋 Task Details</h3> <button class="toggle-btn svelte-1tffaz9"> </button></div> <!></div>'),r0=k('<div class="description-section svelte-1tffaz9"><h3 class="svelte-1tffaz9">Task Description:</h3> <p class="svelte-1tffaz9"> </p></div>'),s0=k('<div class="message error svelte-1tffaz9"><span class="icon svelte-1tffaz9">❌</span> </div>'),i0=k('<div class="message success svelte-1tffaz9"><span class="icon svelte-1tffaz9">✅</span> </div>'),n0=k('<div class="requirement-item svelte-1tffaz9"><div class="requirement-header svelte-1tffaz9"><span class="label-text required svelte-1tffaz9">✅ Task Finished (Required)</span> <input type="checkbox" class="completion-checkbox svelte-1tffaz9"/></div></div>'),o0=k('<div class="upload-section svelte-1tffaz9"><input id="photo-upload" type="file" accept="image/*" class="file-input svelte-1tffaz9" required/> <label for="photo-upload" class="upload-btn svelte-1tffaz9"><svg class="w-5 h-5 svelte-1tffaz9" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" class="svelte-1tffaz9"></path></svg> Choose Photo</label></div>'),l0=k('<div class="photo-preview svelte-1tffaz9"><img alt="Task completion" class="preview-image svelte-1tffaz9"/> <button class="remove-photo svelte-1tffaz9"><svg class="w-4 h-4 svelte-1tffaz9" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" class="svelte-1tffaz9"></path></svg></button></div>'),c0=k('<div class="requirement-item svelte-1tffaz9"><div class="requirement-header svelte-1tffaz9"><span class="label-text required svelte-1tffaz9">📷 Upload Photo (Required)</span></div> <!></div>'),d0=k('<div class="requirement-item svelte-1tffaz9"><div class="requirement-header svelte-1tffaz9"><span class="label-text required svelte-1tffaz9">🔢 ERP Reference (Required)</span></div> <div class="input-section svelte-1tffaz9"><input type="text" placeholder="Enter ERP reference number" class="erp-input svelte-1tffaz9" required/></div></div>'),v0=k('<div class="loading-spinner svelte-1tffaz9"></div> Completing...',1),u0=k('<label class="user-item svelte-1tffaz9"><input type="checkbox" class="svelte-1tffaz9"/> <div class="user-info svelte-1tffaz9"><span class="user-name svelte-1tffaz9"> </span> <span class="user-role svelte-1tffaz9"> </span></div></label>'),f0=k('<div class="loading-spinner svelte-1tffaz9"></div> Reassigning...',1),p0=k('<div class="modal-overlay svelte-1tffaz9"><div class="reassign-modal svelte-1tffaz9"><div class="modal-header svelte-1tffaz9"><h3 class="svelte-1tffaz9">👥 Reassign Task</h3> <button class="close-btn svelte-1tffaz9">×</button></div> <div class="modal-body svelte-1tffaz9"><p class="reassign-info svelte-1tffaz9">Select users to reassign this task to:</p> <div class="users-list svelte-1tffaz9"></div></div> <div class="modal-actions svelte-1tffaz9"><button class="cancel-btn svelte-1tffaz9">Cancel</button> <button class="reassign-confirm-btn svelte-1tffaz9"><!></button></div></div></div>'),h0=k('<div class="modal-overlay svelte-1tffaz9"><div class="image-modal svelte-1tffaz9"><button class="image-close-btn svelte-1tffaz9"><svg class="w-6 h-6 svelte-1tffaz9" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" class="svelte-1tffaz9"></path></svg></button> <img alt="Task image full size" class="modal-image svelte-1tffaz9"/></div></div>'),m0=k('<div class="task-completion-modal svelte-1tffaz9"><div class="header svelte-1tffaz9"><div class="title-section svelte-1tffaz9"><h2 class="title svelte-1tffaz9">Complete Task</h2> <p class="task-title svelte-1tffaz9"> </p></div> <button class="close-btn svelte-1tffaz9"><svg class="w-6 h-6 svelte-1tffaz9" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" class="svelte-1tffaz9"></path></svg></button></div> <!> <div class="progress-section svelte-1tffaz9"><div class="progress-label svelte-1tffaz9"> </div> <div class="progress-bar svelte-1tffaz9"><div class="progress-fill svelte-1tffaz9"></div></div></div> <!> <!> <!> <div class="completion-form svelte-1tffaz9"><h3 class="svelte-1tffaz9">Completion Requirements:</h3> <!> <!> <!> <div class="notes-section svelte-1tffaz9"><label for="completion-notes" class="svelte-1tffaz9">Additional Notes (optional):</label> <textarea id="completion-notes" placeholder="Add any additional notes about the task completion..." class="notes-textarea svelte-1tffaz9"></textarea></div></div> <div class="actions svelte-1tffaz9"><button class="cancel-btn svelte-1tffaz9">Cancel</button> <button class="complete-btn svelte-1tffaz9"><!></button></div></div> <!> <!>',1);function Kn(t,r){pa(r,!1);const a=()=>sr(us,"$currentUser",s),[s,i]=Zr(),l=Q(),d=Q(),v=Q(),u=Q(),f=Q(),h=Q(),_=Q(),x=Q(),T=Q(),b=Q(),w=Jr();let A=Ra(r,"task",8,null),C=Ra(r,"taskId",8,""),z=Ra(r,"taskTitle",8,""),F=Ra(r,"taskDescription",8,""),re=Ra(r,"requireTaskFinished",8,!1),me=Ra(r,"requirePhotoUpload",8,!1),ue=Ra(r,"requireErpReference",8,!1),D=Ra(r,"assignmentId",8,""),E=Ra(r,"notificationId",8,""),he=Ra(r,"onClose",8,()=>{}),xe=Ra(r,"onTaskCompleted",8,()=>{}),K=Q(null),q=Q([]),ae=Q(null),Me=Q(!0),ge=Q(!1),Ne=Q([]),Be=Q(new Set),be=Q(!1),L=Q(""),Te=Q(!1),ye=Q(!1),P=Q(""),pe=Q(""),B=Q({task_finished_completed:!1,photo_uploaded_completed:!1,erp_reference_completed:!1,erp_reference_number:"",completion_notes:""}),j=Q(null),I=Q(null),Y=Q(""),fe=Q(""),ce=Q(""),J=null;function le(Ge,ct,Ze,bt,It,Ot){let Pt=0,gt=0;e(h)&&(gt++,e(B).task_finished_completed&&Pt++),e(_)&&(gt++,e(j)&&Pt++),e(x)&&(gt++,e(B).erp_reference_number.trim()&&Pt++);const yt=gt>0?Math.round(Pt/gt*100):0;return console.log("🔍 [TaskCompletion] Progress calculation:",{total:gt,completed:Pt,progress:yt,taskFinished:e(B).task_finished_completed,hasPhoto:!!e(j),erpRef:e(B).erp_reference_number.trim()}),yt}async function S(){try{if(p(Te,!0),console.log("🔍 [TaskCompletion] Debug values:",{task:A(),taskId:C(),resolvedTaskId:e(l),taskTitle:z(),assignmentId:D()}),!e(l)||e(l)==="unknown"||e(l)==="null"){console.error("❌ [TaskCompletion] Invalid task ID detected:",{resolvedTaskId:e(l),task:A(),taskId:C(),originalProps:{taskId:C(),taskTitle:z(),taskDescription:F(),assignmentId:D()}}),alert("Error: Cannot load task details. The task information is missing or invalid. Please try refreshing the page or contact support."),he()();return}console.log("🔍 [TaskCompletion] Loading task details for:",e(l));const Ge=await fa.tasks.getById(e(l));Ge.data&&(p(K,Ge.data),console.log("✅ [TaskCompletion] Task details loaded:",e(K)));const ct=await fa.taskImages.getByTaskId(e(l));if(ct.data&&(p(q,ct.data),console.log("🖼️ [TaskCompletion] Task images loaded:",e(q).length)),e(u)&&e(u)!=="unknown"&&e(u)!=="null"){console.log("📋 [TaskCompletion] Loading assignment details for:",e(u));try{const bt=await fa.taskAssignments.getById(e(u));if(console.log("📋 [TaskCompletion] Assignment query result:",bt),bt.data){if(p(ae,bt.data),console.log("✅ [TaskCompletion] Assignment details loaded:",e(ae)),e(ae).assigned_by){const It=await fa.users.getById(e(ae).assigned_by);if(It.data)if(It.data.employee_id){const Ot=await fa.employees.getById(It.data.employee_id);Ot.data&&Ot.data.name?p(Y,Ot.data.name):p(Y,It.data.username||e(ae).assigned_by_name||"Unknown User")}else p(Y,It.data.username||e(ae).assigned_by_name||"Unknown User");else p(Y,e(ae).assigned_by_name||"Unknown User")}if(e(ae).assigned_to_user_id){const It=await fa.users.getById(e(ae).assigned_to_user_id);if(It.data)if(It.data.employee_id){const Ot=await fa.employees.getById(It.data.employee_id);Ot.data&&Ot.data.name?p(fe,Ot.data.name):p(fe,It.data.username||"Unknown User")}else p(fe,It.data.username||"Unknown User");else p(fe,"Unknown User")}else p(fe,"Not assigned to specific user");console.log("👥 [TaskCompletion] User names loaded:",{assignedBy:e(Y),assignedTo:e(fe)}),console.log("🎯 [TaskCompletion] Completion criteria from assignment:"),console.log("  - require_task_finished:",e(ae).require_task_finished),console.log("  - require_photo_upload:",e(ae).require_photo_upload),console.log("  - require_erp_reference:",e(ae).require_erp_reference),console.log("🔍 [TaskCompletion] Deadline info check:"),console.log("  - deadline_date:",e(ae).deadline_date),console.log("  - deadline_time:",e(ae).deadline_time),console.log("  - deadline_datetime:",e(ae).deadline_datetime),e(ae).deadline_datetime||e(ae).deadline_date?console.log("⏰ [TaskCompletion] Assignment has deadline:",e(ae).deadline_datetime||e(ae).deadline_date):console.log("⚠️ [TaskCompletion] No deadline found in assignment details"),se(),e(ae).is_reassignable&&console.log("🔄 [TaskCompletion] Assignment is reassignable")}else console.log("❌ [TaskCompletion] Failed to load assignment details:",bt.error)}catch(bt){console.error("❌ [TaskCompletion] Error loading assignment details:",bt)}}else console.log("⚠️ [TaskCompletion] No valid assignment ID provided:",e(u));const Ze=await fa.users.getAll();Ze.data&&(p(Ne,Ze.data.filter(bt=>bt.status==="active")),console.log("👥 [TaskCompletion] Available users loaded:",e(Ne).length))}catch(Ge){console.error("❌ [TaskCompletion] Error loading task details:",Ge),p(P,"Failed to load task details")}finally{p(Te,!1)}}function De(Ge){p(L,Ge),p(be,!0)}function Ue(){p(be,!1),p(L,"")}function We(){p(ge,!0),e(Be).clear()}function ke(){p(ge,!1),e(Be).clear()}function N(Ge){e(Be).has(Ge)?e(Be).delete(Ge):e(Be).add(Ge),p(Be,new Set(e(Be)))}async function V(){var Ge,ct;if(e(Be).size===0){p(P,"Please select at least one user to reassign the task to");return}try{p(ye,!0);for(const Ze of e(Be)){const{data:bt,error:It}=await Tt.rpc("reassign_task",{p_assignment_id:e(u),p_reassigned_by:((Ge=us)==null?void 0:Ge.id)||"",p_new_user_id:Ze,p_reassignment_reason:`Reassigned from task completion modal by ${((ct=us)==null?void 0:ct.username)||"Unknown"}`,p_copy_deadline:!0});if(It)throw new Error(`Failed to reassign to user ${Ze}: ${It.message}`);console.log(`✅ [TaskCompletion] Task reassigned to user ${Ze}, new assignment ID:`,bt)}p(pe,`Task successfully reassigned to ${e(Be).size} user(s)`),ke(),setTimeout(()=>{he()()},2e3)}catch(Ze){console.error("❌ [TaskCompletion] Error reassigning task:",Ze),p(P,Ze.message||"Failed to reassign task")}finally{p(ye,!1)}}function G(Ge){if(!Ge)return"Not set";try{return new Date(Ge).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})}catch{return"Invalid date"}}function de(Ge){if(!Ge)return"";try{return new Date(Ge).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"})}catch{return""}}function ve(Ge){if(!Ge)return!1;try{return new Date(Ge)<new Date}catch{return!1}}function Ie(Ge){if(!Ge)return"";try{const ct=new Date(Ge),bt=new Date().getTime()-ct.getTime(),It=Math.floor(bt/(1e3*60*60)),Ot=Math.floor(It/24);return Ot>0?`${Ot} day${Ot!==1?"s":""}`:`${It} hour${It!==1?"s":""}`}catch{return"Unknown"}}function Ye(Ge){if(!Ge)return"";try{const ct=new Date(Ge),Ze=new Date,bt=ct.getTime()-Ze.getTime();if(bt<=0)return"Overdue";const It=Math.floor(bt/(1e3*60)),Ot=Math.floor(bt/(1e3*60*60)),Pt=Math.floor(bt/(1e3*60*60*24)),gt=Math.floor(bt/(1e3*60*60*24)),yt=Math.floor(bt%(1e3*60*60*24)/(1e3*60*60)),qt=Math.floor(bt%(1e3*60*60)/(1e3*60));let sa="";return gt>0&&(sa+=`${gt} day${gt!==1?"s":""}`),yt>0&&(sa&&(sa+=", "),sa+=`${yt} hour${yt!==1?"s":""}`),(qt>0||sa==="")&&(sa&&(sa+=", "),sa+=`${qt} minute${qt!==1?"s":""}`),sa}catch{return"Unknown"}}function oe(){var ct,Ze;const Ge=((ct=e(ae))==null?void 0:ct.deadline_datetime)||((Ze=e(ae))==null?void 0:Ze.deadline_date);Ge?p(ce,Ye(Ge)):p(ce,"")}function se(){J&&clearInterval(J),oe(),J=setInterval(oe,6e4)}function U(){J&&(clearInterval(J),J=null)}function W(Ge){switch(Ge==null?void 0:Ge.toLowerCase()){case"high":case"urgent":return"priority-high";case"medium":return"priority-medium";case"low":return"priority-low";default:return"priority-medium"}}Aa(()=>{S()}),Yn(()=>{U()});async function ee(Ge){var bt;const Ze=(bt=Ge.target.files)==null?void 0:bt[0];if(Ze){if(!Ze.type.startsWith("image/")){p(P,"Please select a valid image file");return}if(Ze.size>5*1024*1024){p(P,"Image file must be less than 5MB");return}p(j,Ze);const It=new FileReader;It.onload=Ot=>{var Pt;p(I,(Pt=Ot.target)==null?void 0:Pt.result)},It.readAsDataURL(Ze),$e(B,e(B).photo_uploaded_completed=!0),p(P,"")}}function we(){p(j,null),p(I,null),$e(B,e(B).photo_uploaded_completed=!1);const Ge=document.getElementById("photo-upload");Ge&&(Ge.value="")}async function Ae(){if(!e(j)||!e(f))return null;try{const Ge=e(j).name.split(".").pop(),ct=`task-completion-${e(l)}-${Date.now()}.${Ge}`;console.log("📤 [TaskCompletion] Uploading photo:",{fileName:ct,fileSize:e(j).size,fileType:e(j).type,currentUser:e(f).id,bucket:"completion-photos"});const{data:Ze,error:bt}=await Tt.storage.from("completion-photos").upload(ct,e(j),{cacheControl:"3600",upsert:!1});if(bt)throw console.error("❌ [TaskCompletion] Storage upload error:",bt),bt;console.log("✅ [TaskCompletion] Photo uploaded successfully:",Ze);const{data:It}=Tt.storage.from("completion-photos").getPublicUrl(ct);return console.log("🔗 [TaskCompletion] Public URL generated:",It.publicUrl),It.publicUrl}catch(Ge){return console.error("❌ [TaskCompletion] Error uploading photo:",Ge),console.warn("⚠️ [TaskCompletion] Skipping photo upload due to storage permissions"),null}}async function He(){if(!(!e(f)||!e(b))){p(ye,!0),p(P,""),p(pe,"");try{let Ge=null;if(e(_)&&e(j))try{Ge=await Ae(),Ge||console.warn("⚠️ [TaskCompletion] Photo upload failed, continuing without photo")}catch(Ot){console.error("❌ [TaskCompletion] Photo upload failed:",Ot),console.warn("⚠️ [TaskCompletion] Continuing task completion without photo due to upload error")}const ct={task_id:e(l),assignment_id:e(u),completed_by:e(f).id,completed_by_name:e(f).name||e(f).username,completed_by_branch_id:e(f).branch_id,task_finished_completed:e(h)?e(B).task_finished_completed:null,photo_uploaded_completed:e(_)?!!Ge:null,completion_photo_url:Ge,erp_reference_completed:e(x)?e(B).erp_reference_completed:null,erp_reference_number:e(x)?e(B).erp_reference_number:null,completion_notes:e(B).completion_notes||null,completed_at:new Date().toISOString()};console.log("💾 [TaskCompletion] Creating completion record:",ct);const{data:Ze,error:bt}=await Tt.from("task_completions").insert([ct]).select().single();if(bt)throw bt;console.log("✅ [TaskCompletion] Completion record created successfully:",Ze);const{error:It}=await Tt.from("task_assignments").update({status:"completed",completed_at:new Date().toISOString()}).eq("id",e(u));It&&console.error("Error updating assignment status:",It),E()&&await Wr.markAsRead(E(),e(f).id),p(pe,"Task completed successfully!"),xe()&&xe()(),w("taskCompleted",{taskId:e(l),completionId:Ze.id,completionData:ct}),setTimeout(()=>{w("close"),he()()},2e3)}catch(Ge){console.error("Error submitting completion:",Ge),p(P,Ge.message||"Failed to complete task")}finally{p(ye,!1)}}}function Ke(){w("close")}Nt(()=>(kt(A()),kt(C())),()=>{var Ge;p(l,((Ge=A())==null?void 0:Ge.id)||C())}),Nt(()=>(kt(A()),kt(z())),()=>{var Ge;p(d,((Ge=A())==null?void 0:Ge.title)||z())}),Nt(()=>(kt(A()),kt(F())),()=>{var Ge;p(v,((Ge=A())==null?void 0:Ge.description)||F())}),Nt(()=>(kt(A()),kt(D())),()=>{var Ge;p(u,((Ge=A())==null?void 0:Ge.assignment_id)||D())}),Nt(()=>a(),()=>{p(f,a())}),Nt(()=>(e(ae),kt(A()),kt(re())),()=>{var Ge,ct;p(h,((Ge=e(ae))==null?void 0:Ge.require_task_finished)??((ct=A())==null?void 0:ct.require_task_finished)??re()??!0)}),Nt(()=>(e(ae),kt(A()),kt(me())),()=>{var Ge,ct;p(_,((Ge=e(ae))==null?void 0:Ge.require_photo_upload)??((ct=A())==null?void 0:ct.require_photo_upload)??me()??!1)}),Nt(()=>(e(ae),kt(A()),kt(ue())),()=>{var Ge,ct;p(x,((Ge=e(ae))==null?void 0:Ge.require_erp_reference)??((ct=A())==null?void 0:ct.require_erp_reference)??ue()??!1)}),Nt(()=>(e(h),e(_),e(x),e(ae),kt(A()),kt(re()),kt(me()),kt(ue())),()=>{console.log("🔍 [TaskCompletion] Resolved requirements:",{resolvedRequireTaskFinished:e(h),resolvedRequirePhotoUpload:e(_),resolvedRequireErpReference:e(x),assignmentRequirements:e(ae)?{require_task_finished:e(ae).require_task_finished,require_photo_upload:e(ae).require_photo_upload,require_erp_reference:e(ae).require_erp_reference}:"No assignment details",taskRequirements:A()?{require_task_finished:A().require_task_finished,require_photo_upload:A().require_photo_upload,require_erp_reference:A().require_erp_reference}:"No task object",propRequirements:{requireTaskFinished:re(),requirePhotoUpload:me(),requireErpReference:ue()}})}),Nt(()=>(e(B),e(j),e(h),e(_),e(x)),()=>{p(T,le(e(B).task_finished_completed,e(B).erp_reference_number,e(j),e(h),e(_),e(x)))}),Nt(()=>(e(h),e(B),e(_),e(j),e(x)),()=>{p(b,(()=>{var bt,It;const Ge=!e(h)||e(B).task_finished_completed,ct=!e(_)||!!e(j),Ze=!e(x)||!!((bt=e(B).erp_reference_number)!=null&&bt.trim());return console.log("🔍 [TaskCompletion] FORCED canSubmit calculation:",{resolvedRequireTaskFinished:e(h),resolvedRequirePhotoUpload:e(_),resolvedRequireErpReference:e(x),taskFinishedCompleted:e(B).task_finished_completed,photoFile:!!e(j),erpReference:e(B).erp_reference_number,erpTrimmed:(It=e(B).erp_reference_number)==null?void 0:It.trim(),taskCheck:Ge,photoCheck:ct,erpCheck:Ze,finalCanSubmit:Ge&&ct&&Ze}),Ge&&ct&&Ze})())}),Nt(()=>e(B),()=>{var Ge;(Ge=e(B).erp_reference_number)!=null&&Ge.trim()?$e(B,e(B).erp_reference_completed=!0):$e(B,e(B).erp_reference_completed=!1)}),Nt(()=>(e(B),e(j),e(b),e(h),e(_),e(x)),()=>{console.log("🔍 [TaskCompletion] Completion data updated:",{task_finished_completed:e(B).task_finished_completed,photo_uploaded_completed:e(B).photo_uploaded_completed,erp_reference_completed:e(B).erp_reference_completed,erp_reference_number:e(B).erp_reference_number,photoFile:!!e(j),canSubmit:e(b),resolvedRequireTaskFinished:e(h),resolvedRequirePhotoUpload:e(_),resolvedRequireErpReference:e(x)})}),Nt(()=>(kt(A()),kt(re()),kt(me()),kt(ue()),e(h),e(_),e(x)),()=>{console.log("🔍 [TaskCompletion] Task requirements debug:",{taskObject:A()?{require_task_finished:A().require_task_finished,require_photo_upload:A().require_photo_upload,require_erp_reference:A().require_erp_reference}:"No task object",props:{requireTaskFinished:re(),requirePhotoUpload:me(),requireErpReference:ue()},resolved:{resolvedRequireTaskFinished:e(h),resolvedRequirePhotoUpload:e(_),resolvedRequireErpReference:e(x)}})}),Va(),ha();var Oe=m0(),Ee=Bt(Oe),et=o(Ee),dt=o(et),ut=c(o(dt),2),Pe=o(ut,!0);n(ut),n(dt);var qe=c(dt,2);n(et);var tt=c(et,2);{var lt=Ge=>{var ct=Wv();g(Ge,ct)},Xe=Ge=>{var ct=a0(),Ze=o(ct),bt=c(o(Ze),2),It=o(bt);n(bt),n(Ze);var Ot=c(Ze,2);{var Pt=gt=>{var yt=t0(),qt=o(yt),sa=o(qt),oa=c(o(sa),2),Ia=o(oa,!0);n(oa),n(sa);var ka=c(sa,2),St=c(o(ka),2),Dt=o(St,!0);n(St),n(ka);var Wt=c(ka,2),ea=c(o(Wt),2),Ht=o(ea,!0);n(ea),n(Wt);var Qt=c(Wt,2),la=c(o(Qt),2),Ft=o(la);{var Ct=aa=>{var jt=Ya();R((Vt,ca)=>y(jt,`${Vt??""} at ${ca??""}`),[()=>(e(ae),m(()=>G(e(ae).deadline_datetime))),()=>(e(ae),m(()=>de(e(ae).deadline_datetime)))]),g(aa,jt)},$t=aa=>{var jt=Ca(),Vt=Bt(jt);{var ca=ua=>{var va=Hv(),Ta=Bt(va),Ha=c(Ta);{var xa=wa=>{var Pa=Ya();R(()=>y(Pa,`at ${e(ae),m(()=>e(ae).deadline_time)??""}`)),g(wa,Pa)};X(Ha,wa=>{e(ae),m(()=>{var Pa;return(Pa=e(ae))==null?void 0:Pa.deadline_time})&&wa(xa)})}R(wa=>y(Ta,`${wa??""} `),[()=>(e(ae),m(()=>G(e(ae).deadline_date)))]),g(ua,va)},ya=ua=>{var va=Ya("No deadline set");g(ua,va)};X(Vt,ua=>{e(ae),m(()=>{var va;return(va=e(ae))==null?void 0:va.deadline_date})?ua(ca):ua(ya,!1)},!0)}g(aa,jt)};X(Ft,aa=>{e(ae),m(()=>{var jt;return(jt=e(ae))==null?void 0:jt.deadline_datetime})?aa(Ct):aa($t,!1)})}n(la),n(Qt);var Zt=c(Qt,2);{var Da=aa=>{var jt=Vv(),Vt=c(o(jt),2),ca=o(Vt);{var ya=va=>{var Ta=Ya();R(Ha=>y(Ta,`Overdue by ${Ha??""}`),[()=>(e(ae),m(()=>Ie(e(ae).deadline_datetime||e(ae).deadline_date)))]),g(va,Ta)},ua=va=>{var Ta=Ya();R(()=>y(Ta,`${e(ce)??""} remaining`)),g(va,Ta)};X(ca,va=>{e(ae),m(()=>ve(e(ae).deadline_datetime||e(ae).deadline_date))?va(ya):va(ua,!1)})}n(Vt),n(jt),R(va=>wt(Vt,1,`value ${va??""}`,"svelte-1tffaz9"),[()=>(e(ae),m(()=>ve(e(ae).deadline_datetime||e(ae).deadline_date)?"overdue":"on-time"))]),g(aa,jt)};X(Zt,aa=>{e(ae),m(()=>{var jt,Vt;return((jt=e(ae))==null?void 0:jt.deadline_datetime)||((Vt=e(ae))==null?void 0:Vt.deadline_date)})&&aa(Da)})}var ta=c(Zt,2);{var Rt=aa=>{var jt=Gv(),Vt=c(o(jt),2),ca=o(Vt),ya=c(ca);{var ua=va=>{var Ta=Ya();R(()=>y(Ta,`at ${e(ae),m(()=>e(ae).schedule_time)??""}`)),g(va,Ta)};X(ya,va=>{e(ae),m(()=>{var Ta;return(Ta=e(ae))==null?void 0:Ta.schedule_time})&&va(ua)})}n(Vt),n(jt),R(va=>y(ca,`${va??""} `),[()=>(e(ae),m(()=>G(e(ae).schedule_date)))]),g(aa,jt)};X(ta,aa=>{e(ae),m(()=>{var jt;return(jt=e(ae))==null?void 0:jt.schedule_date})&&aa(Rt)})}var Ut=c(ta,2);{var Jt=aa=>{var jt=Xv(),Vt=Bt(jt),ca=c(o(Vt),2),ya=o(ca,!0);n(ca),n(Vt);var ua=c(Vt,2),va=c(o(ua),2),Ta=o(va,!0);n(va),n(ua);var Ha=c(ua,2),xa=c(o(Ha),2),wa=o(xa,!0);n(xa),n(Ha),R(Pa=>{y(ya,e(fe)),y(Ta,e(Y)),y(wa,Pa)},[()=>(e(ae),m(()=>G(e(ae).assigned_at)))]),g(aa,jt)};X(Ut,aa=>{e(ae)&&aa(Jt)})}n(qt);var Ma=c(qt,2);{var qa=aa=>{var jt=Yv(),Vt=c(o(jt),2),ca=o(Vt,!0);n(Vt),n(jt),R(()=>y(ca,(e(K),m(()=>e(K).description)))),g(aa,jt)};X(Ma,aa=>{e(K),m(()=>e(K).description)&&aa(qa)})}var ar=c(Ma,2);{var Ga=aa=>{var jt=Kv(),Vt=c(o(jt),2),ca=o(Vt,!0);n(Vt),n(jt),R(()=>y(ca,(e(ae),m(()=>e(ae).notes)))),g(aa,jt)};X(ar,aa=>{e(ae),m(()=>{var jt;return(jt=e(ae))==null?void 0:jt.notes})&&aa(Ga)})}var Qa=c(ar,2);{var _a=aa=>{var jt=Qv(),Vt=c(o(jt),2);n(jt),R(()=>Vt.disabled=e(ye)),Z("click",Vt,We),g(aa,jt)};X(Qa,aa=>{e(ae),m(()=>{var jt,Vt;return((jt=e(ae))==null?void 0:jt.is_reassignable)&&!ve((Vt=e(ae))==null?void 0:Vt.deadline_datetime)})&&aa(_a)})}var Gt=c(Qa,2);{var Yt=aa=>{var jt=Jv(),Vt=c(o(jt),2);Mt(Vt,5,()=>e(q),Lt,(ca,ya)=>{var ua=Zv(),va=o(ua);n(ua),R(()=>na(va,"src",(e(ya),m(()=>e(ya).file_url)))),Z("click",ua,()=>De(e(ya).file_url)),g(ca,ua)}),n(Vt),n(jt),g(aa,jt)};X(Gt,aa=>{e(q),m(()=>e(q).length>0)&&aa(Yt)})}var ia=c(Gt,2);{var ga=aa=>{var jt=e0(),Vt=c(o(jt),2);Et(2),n(jt),R(()=>Vt.disabled=e(ye)),Z("click",Vt,We),g(aa,jt)};X(ia,aa=>{e(ae),m(()=>{var jt;return(jt=e(ae))==null?void 0:jt.enable_reassigning})&&aa(ga)})}n(yt),R((aa,jt,Vt)=>{y(Ia,(e(K),m(()=>e(K).title))),wt(St,1,`priority-badge ${aa??""}`,"svelte-1tffaz9"),y(Dt,jt),y(Ht,Vt)},[()=>(e(K),m(()=>W(e(K).priority))),()=>(e(K),m(()=>{var aa;return((aa=e(K).priority)==null?void 0:aa.toUpperCase())||"MEDIUM"})),()=>(e(K),m(()=>G(e(K).created_at)))]),g(gt,yt)};X(Ot,gt=>{e(Me)&&e(K)&&gt(Pt)})}n(ct),R(()=>y(It,`${e(Me)?"▼":"▶"} ${e(Me)?"Hide":"Show"} Details`)),Z("click",bt,()=>p(Me,!e(Me))),g(Ge,ct)};X(tt,Ge=>{e(Te)?Ge(lt):Ge(Xe,!1)})}var at=c(tt,2),Fe=o(at),rt=o(Fe);n(Fe);var Ce=c(Fe,2),_e=o(Ce);n(Ce),n(at);var Ve=c(at,2);{var Je=Ge=>{var ct=r0(),Ze=c(o(ct),2),bt=o(Ze,!0);n(Ze),n(ct),R(()=>y(bt,F())),g(Ge,ct)};X(Ve,Ge=>{F()&&Ge(Je)})}var st=c(Ve,2);{var ot=Ge=>{var ct=s0(),Ze=c(o(ct));n(ct),R(()=>y(Ze,` ${e(P)??""}`)),g(Ge,ct)};X(st,Ge=>{e(P)&&Ge(ot)})}var Le=c(st,2);{var nt=Ge=>{var ct=i0(),Ze=c(o(ct));n(ct),R(()=>y(Ze,` ${e(pe)??""}`)),g(Ge,ct)};X(Le,Ge=>{e(pe)&&Ge(nt)})}var vt=c(Le,2),xt=c(o(vt),2);{var M=Ge=>{var ct=n0(),Ze=o(ct),bt=c(o(Ze),2);At(bt),n(Ze),n(ct),R(()=>bt.disabled=e(ye)),tr(bt,()=>e(B).task_finished_completed,It=>$e(B,e(B).task_finished_completed=It)),g(Ge,ct)};X(xt,Ge=>{e(h)&&Ge(M)})}var H=c(xt,2);{var O=Ge=>{var ct=c0(),Ze=c(o(ct),2);{var bt=Ot=>{var Pt=o0(),gt=o(Pt);Et(2),n(Pt),R(()=>gt.disabled=e(ye)),Z("change",gt,ee),g(Ot,Pt)},It=Ot=>{var Pt=l0(),gt=o(Pt),yt=c(gt,2);n(Pt),R(()=>{na(gt,"src",e(I)),yt.disabled=e(ye)}),Z("click",yt,we),g(Ot,Pt)};X(Ze,Ot=>{e(I)?Ot(It,!1):Ot(bt)})}n(ct),g(Ge,ct)};X(H,Ge=>{e(_)&&Ge(O)})}var te=c(H,2);{var ne=Ge=>{var ct=d0(),Ze=c(o(ct),2),bt=o(Ze);At(bt),n(Ze),n(ct),R(()=>bt.disabled=e(ye)),zt(bt,()=>e(B).erp_reference_number,It=>$e(B,e(B).erp_reference_number=It)),g(Ge,ct)};X(te,Ge=>{e(x)&&Ge(ne)})}var ie=c(te,2),Se=c(o(ie),2);ks(Se),n(ie),n(vt);var Qe=c(vt,2),je=o(Qe),ze=c(je,2),Re=o(ze);{var it=Ge=>{var ct=v0();Et(),g(Ge,ct)},ft=Ge=>{var ct=Ya("Complete Task");g(Ge,ct)};X(Re,Ge=>{e(ye)?Ge(it):Ge(ft,!1)})}n(ze),n(Qe),n(Ee);var mt=c(Ee,2);{var ht=Ge=>{var ct=p0(),Ze=o(ct),bt=o(Ze),It=c(o(bt),2);n(bt);var Ot=c(bt,2),Pt=c(o(Ot),2);Mt(Pt,5,()=>e(Ne),Lt,(ka,St)=>{var Dt=u0(),Wt=o(Dt);At(Wt);var ea=c(Wt,2),Ht=o(ea),Qt=o(Ht,!0);n(Ht);var la=c(Ht,2),Ft=o(la,!0);n(la),n(ea),n(Dt),R(Ct=>{vs(Wt,Ct),y(Qt,(e(St),m(()=>e(St).username))),y(Ft,(e(St),m(()=>e(St).role_type)))},[()=>(e(Be),e(St),m(()=>e(Be).has(e(St).id)))]),Z("change",Wt,()=>N(e(St).id)),g(ka,Dt)}),n(Pt),n(Ot);var gt=c(Ot,2),yt=o(gt),qt=c(yt,2),sa=o(qt);{var oa=ka=>{var St=f0();Et(),g(ka,St)},Ia=ka=>{var St=Ya();R(()=>y(St,`Reassign Task (${e(Be),m(()=>e(Be).size)??""})`)),g(ka,St)};X(sa,ka=>{e(ye)?ka(oa):ka(Ia,!1)})}n(qt),n(gt),n(Ze),n(ct),R(()=>qt.disabled=(e(Be),e(ye),m(()=>e(Be).size===0||e(ye)))),Z("click",It,ke),Z("click",yt,ke),Z("click",qt,V),Z("click",Ze,ir(function(ka){Or.call(this,r,ka)})),Z("click",ct,ke),g(Ge,ct)};X(mt,Ge=>{e(ge)&&Ge(ht)})}var pt=c(mt,2);{var _t=Ge=>{var ct=h0(),Ze=o(ct),bt=o(Ze),It=c(bt,2);n(Ze),n(ct),R(()=>na(It,"src",e(L))),Z("click",bt,Ue),Z("click",Ze,ir(function(Ot){Or.call(this,r,Ot)})),Z("click",ct,Ue),g(Ge,ct)};X(pt,Ge=>{e(be)&&Ge(_t)})}R(()=>{y(Pe,z()),y(rt,`Completion Progress: ${e(T)??""}%`),$r(_e,`width: ${e(T)??""}%`),Se.disabled=e(ye),je.disabled=e(ye),ze.disabled=!e(b)||e(ye)}),Z("click",qe,Ke),zt(Se,()=>e(B).completion_notes,Ge=>$e(B,e(B).completion_notes=Ge)),Z("click",je,Ke),Z("click",ze,He),g(t,Oe),ma(),i()}var _0=k('<button class="create-btn svelte-xt1mvd"><span class="icon svelte-xt1mvd">📝</span> Create Notification</button> <button class="status-btn svelte-xt1mvd"><span class="icon svelte-xt1mvd">👥</span> Read Status</button>',1),g0=k('<button class="mark-all-btn svelte-xt1mvd">Mark All as Read</button>'),x0=k('<div class="error-banner svelte-xt1mvd"><span class="error-icon svelte-xt1mvd">❌</span> <button class="retry-btn svelte-xt1mvd">Retry</button></div>'),b0=k('<div class="loading-state svelte-xt1mvd"><div class="loading-spinner svelte-xt1mvd"></div> <p class="svelte-xt1mvd">Loading notifications...</p></div>'),w0=k('<div class="empty-state svelte-xt1mvd"><div class="empty-icon svelte-xt1mvd">🔔</div> <h3 class="svelte-xt1mvd">No notifications found</h3> <p class="svelte-xt1mvd">All caught up! No notifications match your current filters.</p></div>'),y0=k('<span class="read-stats svelte-xt1mvd"> </span>'),k0=k('<span class="notification-creator svelte-xt1mvd"> </span> <!>',1),T0=k('<button class="action-btn complete-task-btn svelte-xt1mvd" title="Complete task">✅ Complete</button>'),E0=k('<button class="action-btn read-btn svelte-xt1mvd" title="Mark as read">👁️</button>'),A0=k('<button class="action-btn delete-btn svelte-xt1mvd" title="Delete notification">🗑️</button>'),S0=k('<div class="notification-image svelte-xt1mvd"><button class="image-thumbnail svelte-xt1mvd" title="Click to view full image"><img alt="Task image" class="notification-img svelte-xt1mvd" loading="lazy"/></button></div>'),C0=k('<div class="unread-indicator svelte-xt1mvd"></div>'),F0=k('<div><div class="notification-content svelte-xt1mvd"><div class="notification-header svelte-xt1mvd"><div class="notification-icon svelte-xt1mvd"> </div> <div class="notification-meta svelte-xt1mvd"><h3 class="notification-title svelte-xt1mvd"> </h3> <div class="notification-details svelte-xt1mvd"><span class="notification-timestamp svelte-xt1mvd"> </span> <!></div></div> <div class="notification-actions svelte-xt1mvd"><!> <!> <!></div></div> <div class="notification-message svelte-xt1mvd"> </div> <!></div> <!></div>'),D0=k('<div class="filters svelte-xt1mvd"><div class="filter-group svelte-xt1mvd"><label for="type-filter" class="filter-label svelte-xt1mvd">Filter by type:</label> <select id="type-filter" class="filter-select svelte-xt1mvd"><option class="svelte-xt1mvd">All Types</option><option class="svelte-xt1mvd">Success</option><option class="svelte-xt1mvd">Warning</option><option class="svelte-xt1mvd">Error</option><option class="svelte-xt1mvd">Info</option><option class="svelte-xt1mvd">Announcement</option></select></div> <label class="checkbox-filter svelte-xt1mvd"><input type="checkbox" class="svelte-xt1mvd"/> Hide read notifications</label></div> <div class="notifications-list svelte-xt1mvd"><!></div>',1),M0=k('<div class="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-75 svelte-xt1mvd"><div class="relative max-w-4xl max-h-4xl p-4 svelte-xt1mvd"><button class="absolute top-2 right-2 z-10 bg-white bg-opacity-80 hover:bg-opacity-100 rounded-full p-2 transition-all duration-200 svelte-xt1mvd"><svg class="w-6 h-6 text-gray-800 svelte-xt1mvd" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" class="svelte-xt1mvd"></path></svg></button> <img alt="Task image full size" class="max-w-full max-h-full object-contain rounded-lg svelte-xt1mvd"/></div></div>'),I0=k('<div class="notification-center svelte-xt1mvd"><div class="header svelte-xt1mvd"><h1 class="title svelte-xt1mvd">Notification Center</h1> <div class="header-actions svelte-xt1mvd"><!> <button class="refresh-btn svelte-xt1mvd" title="Force refresh and clear cache"><span class="icon svelte-xt1mvd">🔄</span> </button> <span class="unread-badge svelte-xt1mvd"> </span> <!></div></div> <!> <!></div> <!>',1);function Qn(t,r){pa(r,!1);const a=()=>sr(us,"$persistentCurrentUser",i),s=()=>sr(qs,"$auth",i),[i,l]=Zr(),d=Q(),v=Q(),u=Q(),f=Q(),h=Q(),_=Q();let x=Q([]),T=Q(!0),b=Q(""),w=Q(!1),A=Q("");async function C(N){const V=[];for(const G of N){const de={id:G.id,title:G.title,message:G.message,type:G.type,timestamp:z(G.created_at),read:G.is_read||!1,priority:G.priority,createdBy:G.created_by_name,targetUsers:G.target_type,targetBranch:"all",status:G.status,readCount:G.read_count,totalRecipients:G.total_recipients,metadata:G.metadata,image_url:null};if(G.metadata&&G.metadata.task_id)try{console.log(`🖼️ [Notification] Loading image for task ${G.metadata.task_id}`);const ve=await fa.taskImages.getByTaskId(G.metadata.task_id);ve.data&&ve.data.length>0?(de.image_url=ve.data[0].file_url,console.log(`✅ [Notification] Found image for task ${G.metadata.task_id}: ${de.image_url}`)):console.log(`📭 [Notification] No image found for task ${G.metadata.task_id}`)}catch(ve){console.warn(`❌ [Notification] Failed to load image for task ${G.metadata.task_id}:`,ve)}V.push(de)}return V}function z(N){const V=new Date(N),de=new Date().getTime()-V.getTime(),ve=Math.floor(de/6e4),Ie=Math.floor(ve/60),Ye=Math.floor(Ie/24);return ve<1?"Just now":ve<60?`${ve} minute${ve>1?"s":""} ago`:Ie<24?`${Ie} hour${Ie>1?"s":""} ago`:Ye<7?`${Ye} day${Ye>1?"s":""} ago`:V.toLocaleDateString()}Aa(async()=>{await F()});async function F(){var N,V;try{if(p(T,!0),p(b,""),console.log("🔍 [NotificationCenter] Loading notifications..."),console.log("🔍 [NotificationCenter] Current user:",e(d)),console.log("🔍 [NotificationCenter] User role:",e(v)),console.log("🔍 [NotificationCenter] Is admin or master:",e(u)),e(u)){console.log("🔍 [NotificationCenter] Loading all notifications for admin user");const G=await Wr.getAllNotifications(((N=e(d))==null?void 0:N.id)||"default-user");console.log("🔍 [NotificationCenter] Raw API notifications:",G),p(x,await C(G)),console.log("🔍 [NotificationCenter] Transformed notifications:",e(x))}else if((V=e(d))!=null&&V.id){console.log("🔍 [NotificationCenter] Loading user-specific notifications");const G=await Wr.getUserNotifications(e(d).id);p(x,G.map(de=>({id:de.notification_id,title:de.title,message:de.message,type:de.type,timestamp:z(de.created_at),read:de.is_read,priority:de.priority,createdBy:de.created_by_name,targetUsers:"user-specific",targetBranch:"user-specific",recipientId:de.recipient_id})))}}catch(G){console.error("Error loading notifications:",G),p(b,"Failed to load notifications. Please try again.")}finally{p(T,!1)}}async function re(){var N,V,G;try{p(x,[]),p(T,!0),p(b,"");const de=Date.now();if(console.log("🔄 [NotificationCenter] Force refreshing notifications at:",new Date().toISOString()),e(u)){const Ie=await Wr.getAllNotifications(((N=e(d))==null?void 0:N.id)||"default-user");p(x,await C(Ie))}else if((V=e(d))!=null&&V.id){const Ie=await Wr.getUserNotifications(e(d).id);p(x,Ie.map(Ye=>({id:Ye.notification_id,title:Ye.title,message:Ye.message,type:Ye.type,content:Ye.message,metadata:Ye.metadata||{},read:Ye.is_read,timestamp:Ye.created_at,createdBy:Ye.created_by_name,attachments:Ye.attachments||[]})))}const ve=[];for(const Ie of e(x))if(Ie.type==="task_assigned")try{(G=Ie.metadata)!=null&&G.task_id,ve.push(Ie)}catch{console.warn("Skipping potentially invalid notification:",Ie.id)}else ve.push(Ie);p(x,ve),console.log("✅ [NotificationCenter] Force refresh completed. Total notifications:",e(x).length)}catch(de){console.error("❌ [NotificationCenter] Error force refreshing notifications:",de),p(b,"Failed to refresh notifications. Please try again.")}finally{p(T,!1)}}let me=Q("all"),ue=Q(!0);async function D(N){var V;if((V=e(d))!=null&&V.id)try{(await Wr.markAsRead(N,e(d).id)).success&&p(x,e(x).map(de=>de.id===N?{...de,read:!0}:de))}catch(G){console.error("Error marking notification as read:",G)}}async function E(){var N;if((N=e(d))!=null&&N.id)try{(await Wr.markAllAsRead(e(d).id)).success&&p(x,e(x).map(G=>({...G,read:!0})))}catch(V){console.error("Error marking all notifications as read:",V)}}async function he(N){try{(await Wr.deleteNotification(N)).success&&p(x,e(x).filter(G=>G.id!==N))}catch(V){console.error("Error deleting notification:",V)}}function xe(N){switch(N){case"success":return"✅";case"warning":return"⚠️";case"error":return"❌";case"info":return"ℹ️";case"announcement":return"📢";default:return"📢"}}function K(N){switch(N){case"urgent":return"priority-urgent";case"high":return"priority-high";case"medium":return"priority-medium";case"low":return"priority-low";default:return"priority-medium"}}function q(N){p(A,N),p(w,!0)}function ae(){p(w,!1),p(A,"")}function Me(){const N=`create-notification-${Date.now()}-${Math.random().toString(36).substr(2,9)}`;Kt.openWindow({id:N,title:"Create Notification",component:Av,icon:"📝",size:{width:600,height:700},position:{x:150+Math.random()*100,y:50+Math.random()*100},resizable:!0,minimizable:!0,maximizable:!0,closable:!0})}function ge(){const N=`admin-read-status-${Date.now()}-${Math.random().toString(36).substr(2,9)}`;Kt.openWindow({id:N,title:"Admin: Read Status Per User",component:Gl,icon:"👥",size:{width:800,height:600},position:{x:100+Math.random()*100,y:100+Math.random()*100},resizable:!0,minimizable:!0,maximizable:!0,closable:!0})}async function Ne(N){const V=`task-completion-${N.id}-${Date.now()}`,G=Be(N);if(!G.taskId){console.error("❌ [NotificationCenter] Cannot open task completion - no task ID found in notification:",N),alert("Error: Cannot complete task. The notification does not contain valid task information. This may be an older notification format.");return}let de=null,ve=null;if(G.taskId&&G.assignmentId)try{console.log("🔍 [NotificationCenter] Fetching complete task data for:",G.taskId);const Ie=await fa.tasks.getById(G.taskId),Ye=await fa.taskAssignments.getById(G.assignmentId);Ie.data&&Ye.data&&(ve=Ye.data,de={...Ie.data,assignment_id:G.assignmentId,deadline_date:ve.deadline_date,deadline_time:ve.deadline_time,deadline_datetime:ve.deadline_datetime,schedule_date:ve.schedule_date,schedule_time:ve.schedule_time,assignment_date:ve.assignment_date,notes:ve.notes,require_task_finished:ve.require_task_finished??!1,require_photo_upload:ve.require_photo_upload??!1,require_erp_reference:ve.require_erp_reference??!1},console.log("✅ [NotificationCenter] Complete task object created:",de))}catch(Ie){console.error("❌ [NotificationCenter] Error fetching complete task data:",Ie)}Kt.openWindow({id:V,title:`Complete Task: ${G.title||"Task"}`,component:Kn,icon:"✅",props:{task:de,assignmentId:G.assignmentId,requireTaskFinished:!0,requirePhotoUpload:(ve==null?void 0:ve.require_photo_upload)??!1,requireErpReference:(ve==null?void 0:ve.require_erp_reference)??!1,notificationId:N.id,onTaskCompleted:()=>{F(),Kt.closeWindow(V)}},size:{width:600,height:700},position:{x:150+Math.random()*100,y:50+Math.random()*100},resizable:!0,minimizable:!0,maximizable:!0,closable:!0})}function Be(N){console.log("🔍 [NotificationCenter] Parsing notification:",{notification:N,metadata:N.metadata,message:N.message,type:N.type});const V=N.metadata||{},G=N.message||"";if(V.task_id)return console.log("✅ [NotificationCenter] Found task_id in metadata:",V.task_id),{taskId:V.task_id,title:V.task_title||"Unknown Task",description:V.notes||"",deadline:V.deadline||"",requireTaskFinished:V.require_task_finished||!1,requirePhotoUpload:V.require_photo_upload||!1,requireErpReference:V.require_erp_reference||!1,assignmentId:V.task_assignment_id||null};if(N.task_id)return console.log("✅ [NotificationCenter] Found task_id in notification properties:",N.task_id),{taskId:N.task_id,title:V.task_title||"Unknown Task",description:V.notes||"",deadline:V.deadline||"",requireTaskFinished:V.require_task_finished||!1,requirePhotoUpload:V.require_photo_upload||!1,requireErpReference:V.require_erp_reference||!1,assignmentId:N.task_assignment_id||V.task_assignment_id||null};const de=G.match(/task:\s*"([^"]+)"/i),ve=G.match(/deadline:\s*([^.\n]+)/i),Ie=G.match(/notes:\s*(.+)/i);return console.warn("⚠️ [NotificationCenter] No task_id in metadata, falling back to message parsing"),console.log("🔍 [NotificationCenter] Message parsing results:",{titleMatch:de,deadlineMatch:ve,notesMatch:Ie,message:G}),{taskId:null,title:de?de[1].trim():"Unknown Task",description:Ie?Ie[1].trim():"",deadline:ve?ve[1].trim():"",requireTaskFinished:!0,requirePhotoUpload:!1,requireErpReference:!1,assignmentId:null}}Aa(()=>{const N=setInterval(()=>{F()},3e4);return()=>clearInterval(N)}),Nt(()=>(a(),s()),()=>{var N;p(d,a()||((N=s())==null?void 0:N.user))}),Nt(()=>e(d),()=>{var N;p(v,((N=e(d))==null?void 0:N.role)||"Position-based")}),Nt(()=>e(v),()=>{p(u,e(v)==="Admin"||e(v)==="Master Admin")}),Nt(()=>e(x),()=>{p(f,e(x))}),Nt(()=>(e(f),e(ue),e(me)),()=>{p(h,e(f).filter(N=>e(ue)&&N.read?!1:e(me)==="all"?!0:N.type===e(me)))}),Nt(()=>e(f),()=>{p(_,e(f).filter(N=>!N.read).length)}),Va(),ha();var be=I0(),L=Bt(be),Te=o(L),ye=c(o(Te),2),P=o(ye);{var pe=N=>{var V=_0(),G=Bt(V),de=c(G,2);Z("click",G,Me),Z("click",de,ge),g(N,V)};X(P,N=>{e(u)&&N(pe)})}var B=c(P,2),j=c(o(B));n(B);var I=c(B,2),Y=o(I);n(I);var fe=c(I,2);{var ce=N=>{var V=g0();Z("click",V,E),g(N,V)};X(fe,N=>{e(_)>0&&N(ce)})}n(ye),n(Te);var J=c(Te,2);{var le=N=>{var V=x0(),G=c(o(V)),de=c(G);n(V),R(()=>y(G,` ${e(b)??""} `)),Z("click",de,F),g(N,V)};X(J,N=>{e(b)&&N(le)})}var S=c(J,2);{var De=N=>{var V=b0();g(N,V)},Ue=N=>{var V=D0(),G=Bt(V),de=o(G),ve=c(o(de),2);R(()=>{e(me),Xt(()=>{})});var Ie=o(ve);Ie.value=Ie.__value="all";var Ye=c(Ie);Ye.value=Ye.__value="success";var oe=c(Ye);oe.value=oe.__value="warning";var se=c(oe);se.value=se.__value="error";var U=c(se);U.value=U.__value="info";var W=c(U);W.value=W.__value="announcement",n(ve),n(de);var ee=c(de,2),we=o(ee);At(we),Et(),n(ee),n(G);var Ae=c(G,2),He=o(Ae);{var Ke=Ee=>{var et=w0();g(Ee,et)},Oe=Ee=>{var et=Ca(),dt=Bt(et);Mt(dt,1,()=>e(h),ut=>ut.id,(ut,Pe)=>{var qe=F0(),tt=o(qe),lt=o(tt),Xe=o(lt),at=o(Xe,!0);n(Xe);var Fe=c(Xe,2),rt=o(Fe),Ce=o(rt,!0);n(rt);var _e=c(rt,2),Ve=o(_e),Je=o(Ve,!0);n(Ve);var st=c(Ve,2);{var ot=ze=>{var Re=k0(),it=Bt(Re),ft=o(it);n(it);var mt=c(it,2);{var ht=pt=>{var _t=y0(),Ge=o(_t);n(_t),R(()=>y(Ge,`• ${e(Pe),m(()=>e(Pe).readCount)??""}/${e(Pe),m(()=>e(Pe).totalRecipients)??""} read`)),g(pt,_t)};X(mt,pt=>{e(Pe),m(()=>e(Pe).readCount!==void 0&&e(Pe).totalRecipients!==void 0)&&pt(ht)})}R(()=>y(ft,`• by ${e(Pe),m(()=>e(Pe).createdBy)??""}`)),g(ze,Re)};X(st,ze=>{e(u)&&ze(ot)})}n(_e),n(Fe);var Le=c(Fe,2),nt=o(Le);{var vt=ze=>{var Re=T0();Z("click",Re,()=>Ne(e(Pe))),g(ze,Re)};X(nt,ze=>{e(Pe),m(()=>e(Pe).type==="task_assigned"&&!e(Pe).read)&&ze(vt)})}var xt=c(nt,2);{var M=ze=>{var Re=E0();Z("click",Re,()=>D(e(Pe).id)),g(ze,Re)};X(xt,ze=>{e(Pe),m(()=>!e(Pe).read)&&ze(M)})}var H=c(xt,2);{var O=ze=>{var Re=A0();Z("click",Re,()=>he(e(Pe).id)),g(ze,Re)};X(H,ze=>{e(u)&&ze(O)})}n(Le),n(lt);var te=c(lt,2),ne=o(te,!0);n(te);var ie=c(te,2);{var Se=ze=>{var Re=S0(),it=o(Re),ft=o(it);n(it),n(Re),R(()=>na(ft,"src",(e(Pe),m(()=>e(Pe).image_url)))),Z("error",ft,mt=>{console.warn(`Failed to load notification image: ${e(Pe).image_url}`),mt.target.parentElement.style.display="none"}),Z("click",it,()=>q(e(Pe).image_url)),g(ze,Re)};X(ie,ze=>{e(Pe),m(()=>e(Pe).image_url)&&ze(Se)})}n(tt);var Qe=c(tt,2);{var je=ze=>{var Re=C0();g(ze,Re)};X(Qe,ze=>{e(Pe),m(()=>!e(Pe).read)&&ze(je)})}n(qe),R((ze,Re)=>{wt(qe,1,`notification-item ${e(Pe),m(()=>e(Pe).read?"read":"unread")??""} ${ze??""}`,"svelte-xt1mvd"),na(qe,"data-notification-id",(e(Pe),m(()=>e(Pe).id))),y(at,Re),y(Ce,(e(Pe),m(()=>e(Pe).title))),y(Je,(e(Pe),m(()=>e(Pe).timestamp))),y(ne,(e(Pe),m(()=>e(Pe).message)))},[()=>(e(Pe),m(()=>K(e(Pe).priority))),()=>(e(Pe),m(()=>xe(e(Pe).type)))]),g(ut,qe)}),g(Ee,et)};X(He,Ee=>{e(h),m(()=>e(h).length===0)?Ee(Ke):Ee(Oe,!1)})}n(Ae),ra(ve,()=>e(me),Ee=>p(me,Ee)),tr(we,()=>e(ue),Ee=>p(ue,Ee)),g(N,V)};X(S,N=>{e(T)?N(De):N(Ue,!1)})}n(L);var We=c(L,2);{var ke=N=>{var V=M0(),G=o(V),de=o(G),ve=c(de,2);n(G),n(V),R(()=>na(ve,"src",e(A))),Z("click",de,ae),Z("click",ve,ir(function(Ie){Or.call(this,r,Ie)})),Z("click",V,ae),g(N,V)};X(We,N=>{e(w)&&N(ke)})}R(()=>{B.disabled=e(T),y(j,` ${e(T)?"Refreshing...":"Refresh"}`),y(Y,`${e(_)??""} Unread`)}),Z("click",B,re),g(t,be),ma(),l()}var R0=k('<img alt="" class="task-icon svelte-1jbozvi"/>'),N0=k('<span class="task-icon-emoji svelte-1jbozvi"> </span>'),P0=k('<button><!> <span class="task-title svelte-1jbozvi"> </span></button>'),L0=k('<div class="quick-badge svelte-1jbozvi"> </div>'),O0=k('<button class="tray-button logout-button svelte-1jbozvi" aria-label="Logout from system" type="button"><svg viewBox="0 0 16 16" width="16" height="16"><rect x="2" y="2" width="8" height="12" rx="1" stroke="currentColor" stroke-width="1" fill="none"></rect><rect x="4" y="6" width="1" height="1" fill="currentColor"></rect><path d="M11 5 L14 8 L11 11 M14 8 L7 8" stroke="currentColor" stroke-width="1" fill="none"></path></svg></button>'),z0=hr('<path d="M6 6 L10 6 M8 4 L8 8" stroke="currentColor" stroke-width="1"></path>'),B0=k('<button class="menu-action svelte-1jbozvi"><span class="action-icon svelte-1jbozvi">🔄</span> Switch User</button>'),$0=k('<button class="menu-action svelte-1jbozvi"><span class="action-icon svelte-1jbozvi">🧪</span> Test Notification</button>'),U0=k('<div class="user-menu svelte-1jbozvi"><div class="user-menu-header svelte-1jbozvi"><div class="user-avatar-large svelte-1jbozvi"><span> </span></div> <div class="user-info svelte-1jbozvi"><div class="user-name svelte-1jbozvi"> </div> <div class="user-role svelte-1jbozvi"> </div> <div class="user-branch svelte-1jbozvi"> </div></div></div> <div class="menu-divider svelte-1jbozvi"></div> <div class="user-menu-actions svelte-1jbozvi"><button class="menu-action svelte-1jbozvi"><span class="action-icon svelte-1jbozvi">👤</span> Profile</button> <button class="menu-action svelte-1jbozvi"><span class="action-icon svelte-1jbozvi">⚙️</span> Settings</button> <!> <button class="menu-action svelte-1jbozvi"><span class="action-icon svelte-1jbozvi">🔔</span> Notifications</button> <!> <div class="menu-divider svelte-1jbozvi"></div> <button class="menu-action logout svelte-1jbozvi"><span class="action-icon svelte-1jbozvi">🚪</span> Logout</button></div></div>'),q0=k('<div class="extended-overlay svelte-1jbozvi"><div class="extended-menu svelte-1jbozvi"><button class="language-toggle svelte-1jbozvi" title="Switch Language / تبديل اللغة" aria-label="Switch language"><span class="language-text svelte-1jbozvi"> </span></button> <div><button class="user-button svelte-1jbozvi" title="User Menu"><div class="user-avatar-taskbar svelte-1jbozvi"><span> </span></div> <div class="user-details-taskbar svelte-1jbozvi"><div class="user-name-taskbar svelte-1jbozvi"> </div> <div class="user-role-taskbar svelte-1jbozvi"> </div></div> <span class="dropdown-arrow svelte-1jbozvi">▼</span></button> <!></div> <div class="clock svelte-1jbozvi"> </div> <div class="date svelte-1jbozvi" title="Current date"> </div></div></div>'),j0=k('<div class="logout-overlay svelte-1jbozvi"><div class="logout-confirm-dialog svelte-1jbozvi"><div class="dialog-header svelte-1jbozvi"><h3 class="svelte-1jbozvi">Confirm Logout</h3></div> <div class="dialog-body svelte-1jbozvi"><p class="svelte-1jbozvi">Are you sure you want to logout from your account?</p> <div class="current-user-info svelte-1jbozvi"><div class="user-avatar-dialog svelte-1jbozvi"><span> </span></div> <div class="user-details-dialog svelte-1jbozvi"><div class="username svelte-1jbozvi"> </div> <div class="role svelte-1jbozvi"> </div></div></div></div> <div class="dialog-actions svelte-1jbozvi"><button class="cancel-button svelte-1jbozvi">Cancel</button> <button class="confirm-button svelte-1jbozvi">Logout</button></div></div></div>'),W0=k('<div class="taskbar svelte-1jbozvi"><div class="task-list svelte-1jbozvi"></div> <div class="quick-access svelte-1jbozvi"><button class="quick-btn notifications-btn svelte-1jbozvi"><div class="quick-icon svelte-1jbozvi">🔔</div> <!></button> <button class="quick-btn announcements-btn svelte-1jbozvi" title="My Announcements (2 active)"><div class="quick-icon svelte-1jbozvi">📢</div> <div class="quick-badge svelte-1jbozvi">2</div></button> <button class="quick-btn calendar-btn svelte-1jbozvi" title="My Calendar Events (4 today)"><div class="quick-icon svelte-1jbozvi">📅</div> <div class="quick-badge svelte-1jbozvi">4</div></button></div> <div class="system-tray svelte-1jbozvi"><!> <button><svg viewBox="0 0 16 16" width="16" height="16"><rect x="2" y="3" width="12" height="9" stroke="currentColor" stroke-width="1" fill="none"></rect><rect x="4" y="5" width="8" height="1" fill="currentColor"></rect><!></svg></button></div></div> <!> <!>',1);function H0(t,r){pa(r,!1);const a=()=>sr(us,"$persistentCurrentUser",u),s=()=>sr(qs,"$auth",u),i=()=>sr(bi,"$notificationCounts",u),l=()=>sr(ql,"$currentLocale",u),d=()=>sr(Vd,"$deviceSessions",u),v=()=>sr(e(h),"$taskbarItems",u),[u,f]=Zr(),h=Q(),_=Q(),x=Q(),T=Q(),b=Q(),w=Jr();let A=Q(!1),C=Q(!1),z=Q(!1),F=Q(void 0),re=Q(""),me=Q(""),ue;Aa(()=>{D(),ue=setInterval(D,1e3),Di();const U=setInterval(Di,3e4);return()=>{ue&&clearInterval(ue),U&&clearInterval(U)}});function D(){const U=new Date;p(re,U.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!0})),p(me,U.toLocaleDateString("en-GB",{day:"2-digit",month:"2-digit",year:"numeric"}))}function E(U){const W=Kt.getWindow(U);W&&(W.state==="minimized"||!W.isActive?Kt.activateWindow(U):Kt.minimizeWindow(U))}function he(){p(A,!e(A)),e(A)&&Ul(Kt.windowList).forEach(W=>{W.state!=="minimized"&&Kt.minimizeWindow(W.id)})}function xe(){const U=e(b)==="en"?"ar":"en";qd(U)}function K(U){const W=e(T).find(ee=>ee.code===U);return(W==null?void 0:W.name)||U.toUpperCase()}function q(){console.log("🚪 [Taskbar] Handle logout clicked"),console.log("🚪 [Taskbar] Current user:",e(F)),p(z,!0),p(C,!1),console.log("🚪 [Taskbar] Logout confirmation dialog should show:",e(z))}function ae(){p(C,!1),w("user-switch-request")}function Me(){p(C,!1),w("notification-settings-request")}async function ge(){try{await jr.sendTestNotification(),p(C,!1)}catch(U){console.error("Error sending test notification:",U)}}let Ne=Q(!1);function Be(){console.log("🚪 [Taskbar] Confirming logout..."),console.log("🚪 [Taskbar] Auth store:",s()),console.log("🚪 [Taskbar] Persistent auth user:",a()),p(z,!1),p(C,!1);try{console.log("🚪 [Taskbar] Calling logout methods..."),s()&&(console.log("🚪 [Taskbar] Logging out from auth store..."),qs.logout().catch(U=>console.warn("Auth logout error:",U))),a()&&(console.log("🚪 [Taskbar] Logging out from persistent auth..."),Ls.logout().catch(U=>console.warn("Persistent auth logout error:",U))),typeof window<"u"&&window.localStorage&&(console.log("🚪 [Taskbar] Clearing localStorage..."),localStorage.removeItem("aqura-auth-token"),localStorage.removeItem("aqura-user"),localStorage.removeItem("aqura-session"),localStorage.removeItem("aqura-persistent-sessions")),console.log("🚪 [Taskbar] Logout completed, redirecting to login..."),window.location.href="/login"}catch(U){console.error("🚪 [Taskbar] Logout error:",U),window.location.href="/login"}}function be(){p(z,!1)}function L(U){return`${U}-${Date.now()}-${Math.random().toString(36).substr(2,9)}`}function Te(){const U=L("quick-notifications");Kt.openWindow({id:U,title:"My Notifications",component:Qn,icon:"🔔",size:{width:800,height:500},position:{x:150,y:100},resizable:!0,minimizable:!0,maximizable:!0,closable:!0}),setTimeout(Hl,1e3)}function ye(){const U=L("quick-announcements");Kt.openWindow({id:U,title:"My Announcements",component:null,icon:"📢",size:{width:700,height:500},position:{x:200,y:150},resizable:!0,minimizable:!0,maximizable:!0,closable:!0})}function P(){const U=L("quick-calendar");Kt.openWindow({id:U,title:"My Calendar Events",component:null,icon:"📅",size:{width:800,height:600},position:{x:250,y:200},resizable:!0,minimizable:!0,maximizable:!0,closable:!0})}function pe(){p(C,!e(C))}function B(U){e(C)&&(U.target.closest(".user-info-taskbar")||p(C,!1)),e(z)&&(U.target.closest(".logout-confirm-dialog")||p(z,!1))}Nt(()=>Kt,()=>{Bl(p(h,Kt.taskbarItems),"$taskbarItems",u)}),Nt(()=>Kt,()=>{p(_,Kt.activeWindow)}),Nt(()=>(e(F),a(),s()),()=>{var U;p(F,a()||((U=s())==null?void 0:U.user)),console.log("🔍 [Taskbar] Auth state:",s()),console.log("🔍 [Taskbar] Persistent user:",a()),console.log("🔍 [Taskbar] Final currentUser:",e(F))}),Nt(()=>i(),()=>{p(x,i())}),Nt(()=>Mo,()=>{p(T,Mo())}),Nt(()=>l(),()=>{p(b,l())}),Nt(()=>d(),()=>{d()&&d().users&&p(Ne,d().users.filter(U=>U.isActive).length>1)}),Va(),ha();var j=W0();Z("click",$l,B);var I=Bt(j),Y=o(I);Mt(Y,5,v,U=>U.windowId,(U,W)=>{var ee=P0();let we;var Ae=o(ee);{var He=Ee=>{var et=Ca(),dt=Bt(et);{var ut=qe=>{var tt=R0();R(()=>na(tt,"src",(e(W),m(()=>e(W).icon)))),g(qe,tt)},Pe=qe=>{var tt=N0(),lt=o(tt,!0);n(tt),R(()=>y(lt,(e(W),m(()=>e(W).icon)))),g(qe,tt)};X(dt,qe=>{e(W),m(()=>e(W).icon.startsWith("http")||e(W).icon.startsWith("/")||e(W).icon.includes("."))?qe(ut):qe(Pe,!1)})}g(Ee,et)};X(Ae,Ee=>{e(W),m(()=>e(W).icon)&&Ee(He)})}var Ke=c(Ae,2),Oe=o(Ke,!0);n(Ke),n(ee),R(Ee=>{we=wt(ee,1,"task-button svelte-1jbozvi",null,we,Ee),na(ee,"title",(e(W),m(()=>e(W).title))),y(Oe,(e(W),m(()=>e(W).title)))},[()=>({active:e(W).isActive,minimized:e(W).isMinimized})]),Z("click",ee,()=>E(e(W).windowId)),g(U,ee)}),n(Y);var fe=c(Y,2),ce=o(fe),J=c(o(ce),2);{var le=U=>{var W=L0(),ee=o(W,!0);n(W),R(()=>y(ee,(e(x),m(()=>e(x).unread>99?"99+":e(x).unread)))),g(U,W)};X(J,U=>{e(x),m(()=>e(x).unread>0)&&U(le)})}n(ce);var S=c(ce,2),De=c(S,2);n(fe);var Ue=c(fe,2),We=o(Ue);{var ke=U=>{var W=O0();R(()=>na(W,"title",`Logout (${e(F),m(()=>e(F).username)??""})`)),Z("click",W,ir(q)),g(U,W)};X(We,U=>{e(F)&&U(ke)})}var N=c(We,2);let V;var G=o(N),de=c(o(G),2);{var ve=U=>{var W=z0();g(U,W)};X(de,U=>{e(A)&&U(ve)})}n(G),n(N),n(Ue),n(I);var Ie=c(I,2);{var Ye=U=>{var W=q0(),ee=o(W),we=o(ee),Ae=o(we),He=o(Ae,!0);n(Ae),n(we);var Ke=c(we,2);let Oe;var Ee=o(Ke),et=o(Ee),dt=o(et),ut=o(dt,!0);n(dt),n(et);var Pe=c(et,2),qe=o(Pe),tt=o(qe,!0);n(qe);var lt=c(qe,2),Xe=o(lt,!0);n(lt),n(Pe),Et(2),n(Ee);var at=c(Ee,2);{var Fe=Je=>{var st=U0(),ot=o(st),Le=o(ot),nt=o(Le),vt=o(nt,!0);n(nt),n(Le);var xt=c(Le,2),M=o(xt),H=o(M,!0);n(M);var O=c(M,2),te=o(O,!0);n(O);var ne=c(O,2),ie=o(ne,!0);n(ne),n(xt),n(ot);var Se=c(ot,4),Qe=o(Se),je=c(Qe,2),ze=c(je,2);{var Re=pt=>{var _t=B0();Z("click",_t,ae),g(pt,_t)};X(ze,pt=>{e(Ne)&&pt(Re)})}var it=c(ze,2),ft=c(it,2);{var mt=pt=>{var _t=$0();Z("click",_t,ge),g(pt,_t)};X(ft,pt=>{m(()=>!1)&&pt(mt)})}var ht=c(ft,4);n(Se),n(st),R(pt=>{y(vt,pt),y(H,(e(F),m(()=>{var _t,Ge;return((_t=e(F))==null?void 0:_t.employeeName)||((Ge=e(F))==null?void 0:Ge.username)||"User"}))),y(te,(e(F),m(()=>{var _t;return((_t=e(F))==null?void 0:_t.role)||"Role"}))),y(ie,(e(F),m(()=>{var _t;return((_t=e(F))==null?void 0:_t.branchName)||"Main Branch"})))},[()=>(e(F),m(()=>{var pt,_t,Ge;return((Ge=(_t=(pt=e(F))==null?void 0:pt.username)==null?void 0:_t.charAt(0))==null?void 0:Ge.toUpperCase())||"U"}))]),Z("click",Qe,()=>p(C,!1)),Z("click",je,()=>p(C,!1)),Z("click",it,Me),Z("click",ht,()=>{console.log("🚪 [Taskbar] User menu logout clicked"),p(C,!1),q()}),g(Je,st)};X(at,Je=>{e(C)&&Je(Fe)})}n(Ke);var rt=c(Ke,2),Ce=o(rt,!0);n(rt);var _e=c(rt,2),Ve=o(_e,!0);n(_e),n(ee),n(W),R((Je,st,ot,Le)=>{y(He,Je),Oe=wt(Ke,1,"user-info-taskbar svelte-1jbozvi",null,Oe,st),y(ut,ot),y(tt,(e(F),m(()=>{var nt;return((nt=e(F))==null?void 0:nt.username)||"User"}))),y(Xe,(e(F),m(()=>{var nt;return((nt=e(F))==null?void 0:nt.role)||"Role"}))),na(rt,"title",Le),y(Ce,e(re)),y(Ve,e(me))},[()=>(e(b),m(()=>K(e(b)))),()=>({"has-menu":e(C)}),()=>(e(F),m(()=>{var Je,st,ot;return((ot=(st=(Je=e(F))==null?void 0:Je.username)==null?void 0:st.charAt(0))==null?void 0:ot.toUpperCase())||"U"})),()=>m(()=>new Date().toLocaleDateString())]),Z("click",we,xe),Z("click",Ee,pe),g(U,W)};X(Ie,U=>{e(A)&&U(Ye)})}var oe=c(Ie,2);{var se=U=>{var W=j0(),ee=o(W),we=c(o(ee),2),Ae=c(o(we),2),He=o(Ae),Ke=o(He),Oe=o(Ke,!0);n(Ke),n(He);var Ee=c(He,2),et=o(Ee),dt=o(et,!0);n(et);var ut=c(et,2),Pe=o(ut,!0);n(ut),n(Ee),n(Ae),n(we);var qe=c(we,2),tt=o(qe),lt=c(tt,2);n(qe),n(ee),n(W),R(Xe=>{y(Oe,Xe),y(dt,(e(F),m(()=>{var at;return((at=e(F))==null?void 0:at.username)||"User"}))),y(Pe,(e(F),m(()=>{var at;return((at=e(F))==null?void 0:at.role)||"Role"})))},[()=>(e(F),m(()=>{var Xe,at,Fe;return((Fe=(at=(Xe=e(F))==null?void 0:Xe.username)==null?void 0:at.charAt(0))==null?void 0:Fe.toUpperCase())||"U"}))]),Z("click",tt,be),Z("click",lt,Be),g(U,W)};X(oe,U=>{e(z)&&U(se)})}R(U=>{na(ce,"title",`My Notifications (${e(x),m(()=>e(x).unread)??""} unread)`),V=wt(N,1,"tray-button desktop-button svelte-1jbozvi",null,V,U),na(N,"title",e(A)?"Hide Extended View":"Show Desktop & Extend"),na(N,"aria-label",e(A)?"Hide extended view":"Show desktop and extend taskbar")},[()=>({active:e(A)})]),Z("click",ce,Te),Z("click",S,ye),Z("click",De,P),Z("click",N,he),g(t,j),ma(),f()}var V0=k('<div class="error-message svelte-92ko1i"><strong class="svelte-92ko1i">Error:</strong> <button class="retry-btn svelte-92ko1i">Retry</button></div>'),G0=k('<div class="loading-state svelte-92ko1i"><div class="spinner svelte-92ko1i"></div> <p class="svelte-92ko1i">Loading branches...</p></div>'),X0=k('<span class="main-branch-badge svelte-92ko1i">✓</span>'),Y0=k('<tr><td class="svelte-92ko1i"> </td><td class="svelte-92ko1i"> </td><td class="arabic svelte-92ko1i"> </td><td class="svelte-92ko1i"> </td><td class="arabic svelte-92ko1i"> </td><td class="svelte-92ko1i"><span> </span></td><td class="svelte-92ko1i"><!></td><td class="svelte-92ko1i"> </td><td class="svelte-92ko1i"><div class="actions svelte-92ko1i"><button class="edit-btn svelte-92ko1i">Edit</button> <button class="delete-btn svelte-92ko1i">Delete</button></div></td></tr>'),K0=k('<div class="empty-state svelte-92ko1i"><p class="svelte-92ko1i">No branches available</p> <button class="create-btn svelte-92ko1i"><span class="icon svelte-92ko1i">+</span> Create Your First Branch</button></div>'),Q0=k('<div class="popup-overlay svelte-92ko1i"><div class="popup svelte-92ko1i"><div class="popup-header svelte-92ko1i"><h2 class="svelte-92ko1i">Create Branch</h2> <button class="close-btn svelte-92ko1i">×</button></div> <div class="popup-content svelte-92ko1i"><form class="svelte-92ko1i"><div class="form-row svelte-92ko1i"><div class="form-group svelte-92ko1i"><label for="name-en" class="svelte-92ko1i">Name (English)</label> <input id="name-en" type="text" placeholder="Enter branch name in English" required class="svelte-92ko1i"/></div> <div class="form-group svelte-92ko1i"><label for="name-ar" class="svelte-92ko1i">Name (Arabic)</label> <input id="name-ar" type="text" placeholder="أدخل اسم الفرع بالعربية" class="arabic svelte-92ko1i" dir="rtl" required/></div></div> <div class="form-row svelte-92ko1i"><div class="form-group svelte-92ko1i"><label for="location-en" class="svelte-92ko1i">Location (English)</label> <input id="location-en" type="text" placeholder="Enter location in English" required class="svelte-92ko1i"/></div> <div class="form-group svelte-92ko1i"><label for="location-ar" class="svelte-92ko1i">Location (Arabic)</label> <input id="location-ar" type="text" placeholder="أدخل الموقع بالعربية" class="arabic svelte-92ko1i" dir="rtl" required/></div></div> <div class="form-row svelte-92ko1i"><div class="form-group svelte-92ko1i"><label class="checkbox-label svelte-92ko1i"><input type="checkbox" class="svelte-92ko1i"/> Active</label></div> <div class="form-group svelte-92ko1i"><label class="checkbox-label svelte-92ko1i"><input type="checkbox" class="svelte-92ko1i"/> Main Branch</label></div></div> <div class="form-actions svelte-92ko1i"><button type="button" class="cancel-btn svelte-92ko1i">Cancel</button> <button type="submit" class="save-btn svelte-92ko1i">Save</button></div></form></div></div></div>'),Z0=k('<div class="popup-overlay svelte-92ko1i"><div class="popup svelte-92ko1i"><div class="popup-header svelte-92ko1i"><h2 class="svelte-92ko1i">Edit Branch</h2> <button class="close-btn svelte-92ko1i">×</button></div> <div class="popup-content svelte-92ko1i"><form class="svelte-92ko1i"><div class="form-row svelte-92ko1i"><div class="form-group svelte-92ko1i"><label for="edit-name-en" class="svelte-92ko1i">Name (English)</label> <input id="edit-name-en" type="text" placeholder="Enter branch name in English" required class="svelte-92ko1i"/></div> <div class="form-group svelte-92ko1i"><label for="edit-name-ar" class="svelte-92ko1i">Name (Arabic)</label> <input id="edit-name-ar" type="text" placeholder="أدخل اسم الفرع بالعربية" class="arabic svelte-92ko1i" dir="rtl" required/></div></div> <div class="form-row svelte-92ko1i"><div class="form-group svelte-92ko1i"><label for="edit-location-en" class="svelte-92ko1i">Location (English)</label> <input id="edit-location-en" type="text" placeholder="Enter location in English" required class="svelte-92ko1i"/></div> <div class="form-group svelte-92ko1i"><label for="edit-location-ar" class="svelte-92ko1i">Location (Arabic)</label> <input id="edit-location-ar" type="text" placeholder="أدخل الموقع بالعربية" class="arabic svelte-92ko1i" dir="rtl" required/></div></div> <div class="form-row svelte-92ko1i"><div class="form-group svelte-92ko1i"><label class="checkbox-label svelte-92ko1i"><input type="checkbox" class="svelte-92ko1i"/> Active</label></div> <div class="form-group svelte-92ko1i"><label class="checkbox-label svelte-92ko1i"><input type="checkbox" class="svelte-92ko1i"/> Main Branch</label></div></div> <div class="form-actions svelte-92ko1i"><button type="button" class="cancel-btn svelte-92ko1i">Cancel</button> <button type="submit" class="save-btn svelte-92ko1i">Update</button></div></form></div></div></div>'),J0=k('<div class="branch-master svelte-92ko1i"><div class="header svelte-92ko1i"><h1 class="title svelte-92ko1i">Branches Master</h1> <button class="create-btn svelte-92ko1i"><span class="icon svelte-92ko1i">+</span> Create Branch</button></div> <!> <!> <div class="table-container svelte-92ko1i"><table class="branches-table svelte-92ko1i"><thead class="svelte-92ko1i"><tr class="svelte-92ko1i"><th class="svelte-92ko1i">Branch ID</th><th class="svelte-92ko1i">Name (English)</th><th class="svelte-92ko1i">Name (Arabic)</th><th class="svelte-92ko1i">Location (English)</th><th class="svelte-92ko1i">Location (Arabic)</th><th class="svelte-92ko1i">Status</th><th class="svelte-92ko1i">Main Branch</th><th class="svelte-92ko1i">Created At</th><th class="svelte-92ko1i">Actions</th></tr></thead><tbody class="svelte-92ko1i"></tbody></table> <!></div></div> <!> <!>',1);function eu(t,r){pa(r,!1);let a=Q([]),s=Q(!1),i=Q(!1),l=Q({name_en:"",name_ar:"",location_en:"",location_ar:"",is_active:!0,is_main_branch:!1}),d=null,v=Q(!1),u=Q("");Aa(async()=>{await f()});async function f(){p(v,!0),p(u,"");try{const{data:be,error:L}=await fa.branches.getAll();L?(p(u,L.message||"Failed to load branches"),console.error("Failed to load branches:",L)):be&&p(a,be)}catch(be){p(u,"Failed to connect to server"),console.error("Error loading branches:",be)}finally{p(v,!1)}}function h(){p(l,{name_en:"",name_ar:"",location_en:"",location_ar:"",is_active:!0,is_main_branch:!1}),p(s,!0)}function _(){p(s,!1),p(l,{name_en:"",name_ar:"",location_en:"",location_ar:"",is_active:!0,is_main_branch:!1})}function x(be){d=be,p(l,{...be}),p(i,!0)}function T(){p(i,!1),d=null,p(l,{name_en:"",name_ar:"",location_en:"",location_ar:"",is_active:!0,is_main_branch:!1})}async function b(){if(!e(l).name_en||!e(l).name_ar||!e(l).location_en||!e(l).location_ar){alert("Please fill in all fields");return}p(v,!0),p(u,"");try{if(e(s)){const be={name_en:e(l).name_en,name_ar:e(l).name_ar,location_en:e(l).location_en,location_ar:e(l).location_ar,is_active:e(l).is_active||!0,is_main_branch:e(l).is_main_branch||!1},{data:L,error:Te}=await fa.branches.create(be);Te?(p(u,Te.message||"Failed to create branch"),alert("Error creating branch: "+e(u))):L&&(await f(),_())}else if(e(i)&&d){const be={name_en:e(l).name_en,name_ar:e(l).name_ar,location_en:e(l).location_en,location_ar:e(l).location_ar,is_active:e(l).is_active||!0,is_main_branch:e(l).is_main_branch||!1},{data:L,error:Te}=await fa.branches.update(d.id,be);Te?(p(u,Te.message||"Failed to update branch"),alert("Error updating branch: "+e(u))):L&&(await f(),T())}}catch(be){p(u,"Failed to save branch"),alert("Error saving branch: "+e(u)),console.error("Error saving branch:",be)}finally{p(v,!1)}}async function w(be){if(confirm("Are you sure you want to delete this branch?")){p(v,!0),p(u,"");try{const{error:L}=await fa.branches.delete(be);L?(p(u,L.message||"Failed to delete branch"),alert("Error deleting branch: "+e(u))):await f()}catch(L){p(u,"Failed to delete branch"),alert("Error deleting branch: "+e(u)),console.error("Error deleting branch:",L)}finally{p(v,!1)}}}function A(be){return new Date(be).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}ha();var C=J0(),z=Bt(C),F=o(z),re=c(o(F),2);n(F);var me=c(F,2);{var ue=be=>{var L=V0(),Te=c(o(L)),ye=c(Te);n(L),R(()=>y(Te,` ${e(u)??""} `)),Z("click",ye,f),g(be,L)};X(me,be=>{e(u)&&be(ue)})}var D=c(me,2);{var E=be=>{var L=G0();g(be,L)};X(D,be=>{e(v)&&be(E)})}var he=c(D,2),xe=o(he),K=c(o(xe));Mt(K,5,()=>e(a),be=>be.id,(be,L)=>{var Te=Y0(),ye=o(Te),P=o(ye,!0);n(ye);var pe=c(ye),B=o(pe,!0);n(pe);var j=c(pe),I=o(j,!0);n(j);var Y=c(j),fe=o(Y,!0);n(Y);var ce=c(Y),J=o(ce,!0);n(ce);var le=c(ce),S=o(le),De=o(S,!0);n(S),n(le);var Ue=c(le),We=o(Ue);{var ke=oe=>{var se=X0();g(oe,se)},N=oe=>{var se=Ya("-");g(oe,se)};X(We,oe=>{e(L).is_main_branch?oe(ke):oe(N,!1)})}n(Ue);var V=c(Ue),G=o(V,!0);n(V);var de=c(V),ve=o(de),Ie=o(ve),Ye=c(Ie,2);n(ve),n(de),n(Te),R(oe=>{wt(Te,1,Ld(e(L).is_active?"active":"inactive"),"svelte-92ko1i"),y(P,e(L).id),y(B,e(L).name_en),y(I,e(L).name_ar),y(fe,e(L).location_en),y(J,e(L).location_ar),wt(S,1,`status-badge ${e(L).is_active?"active":"inactive"}`,"svelte-92ko1i"),y(De,e(L).is_active?"Active":"Inactive"),y(G,oe),Ie.disabled=e(v),Ye.disabled=e(v)},[()=>e(L).created_at?A(e(L).created_at):"-"]),Z("click",Ie,()=>x(e(L))),Z("click",Ye,()=>w(e(L).id)),g(be,Te)}),n(K),n(xe);var q=c(xe,2);{var ae=be=>{var L=K0(),Te=c(o(L),2);n(L),Z("click",Te,h),g(be,L)};X(q,be=>{e(a).length===0&&!e(v)&&be(ae)})}n(he),n(z);var Me=c(z,2);{var ge=be=>{var L=Q0(),Te=o(L),ye=o(Te),P=c(o(ye),2);n(ye);var pe=c(ye,2),B=o(pe),j=o(B),I=o(j),Y=c(o(I),2);At(Y),n(I);var fe=c(I,2),ce=c(o(fe),2);At(ce),n(fe),n(j);var J=c(j,2),le=o(J),S=c(o(le),2);At(S),n(le);var De=c(le,2),Ue=c(o(De),2);At(Ue),n(De),n(J);var We=c(J,2),ke=o(We),N=o(ke),V=o(N);At(V),Et(),n(N),n(ke);var G=c(ke,2),de=o(G),ve=o(de);At(ve),Et(),n(de),n(G),n(We);var Ie=c(We,2),Ye=o(Ie);Et(2),n(Ie),n(B),n(pe),n(Te),n(L),R(()=>{ce.dir=ce.dir,Ue.dir=Ue.dir}),Z("click",P,_),zt(Y,()=>e(l).name_en,oe=>$e(l,e(l).name_en=oe)),zt(ce,()=>e(l).name_ar,oe=>$e(l,e(l).name_ar=oe)),zt(S,()=>e(l).location_en,oe=>$e(l,e(l).location_en=oe)),zt(Ue,()=>e(l).location_ar,oe=>$e(l,e(l).location_ar=oe)),tr(V,()=>e(l).is_active,oe=>$e(l,e(l).is_active=oe)),tr(ve,()=>e(l).is_main_branch,oe=>$e(l,e(l).is_main_branch=oe)),Z("click",Ye,_),Z("submit",B,Ur(b)),Z("click",Te,ir(function(oe){Or.call(this,r,oe)})),Z("click",L,_),g(be,L)};X(Me,be=>{e(s)&&be(ge)})}var Ne=c(Me,2);{var Be=be=>{var L=Z0(),Te=o(L),ye=o(Te),P=c(o(ye),2);n(ye);var pe=c(ye,2),B=o(pe),j=o(B),I=o(j),Y=c(o(I),2);At(Y),n(I);var fe=c(I,2),ce=c(o(fe),2);At(ce),n(fe),n(j);var J=c(j,2),le=o(J),S=c(o(le),2);At(S),n(le);var De=c(le,2),Ue=c(o(De),2);At(Ue),n(De),n(J);var We=c(J,2),ke=o(We),N=o(ke),V=o(N);At(V),Et(),n(N),n(ke);var G=c(ke,2),de=o(G),ve=o(de);At(ve),Et(),n(de),n(G),n(We);var Ie=c(We,2),Ye=o(Ie);Et(2),n(Ie),n(B),n(pe),n(Te),n(L),R(()=>{ce.dir=ce.dir,Ue.dir=Ue.dir}),Z("click",P,T),zt(Y,()=>e(l).name_en,oe=>$e(l,e(l).name_en=oe)),zt(ce,()=>e(l).name_ar,oe=>$e(l,e(l).name_ar=oe)),zt(S,()=>e(l).location_en,oe=>$e(l,e(l).location_en=oe)),zt(Ue,()=>e(l).location_ar,oe=>$e(l,e(l).location_ar=oe)),tr(V,()=>e(l).is_active,oe=>$e(l,e(l).is_active=oe)),tr(ve,()=>e(l).is_main_branch,oe=>$e(l,e(l).is_main_branch=oe)),Z("click",Ye,T),Z("submit",B,Ur(b)),Z("click",Te,ir(function(oe){Or.call(this,r,oe)})),Z("click",L,T),g(be,L)};X(Ne,be=>{e(i)&&be(Be)})}R(()=>re.disabled=e(v)),Z("click",re,h),g(t,C),ma()}const Ro={tasks:[],loading:!1,error:null,currentTask:null,completions:[],totalTasks:0,completedTasks:0,pendingTasks:0,inProgressTasks:0};function tu(){const{subscribe:t,set:r,update:a}=Us(Ro),s=i=>({totalTasks:i.length,completedTasks:i.filter(l=>l.status==="completed").length,pendingTasks:i.filter(l=>l.status==="draft").length,inProgressTasks:i.filter(l=>l.status==="active").length});return{subscribe:t,set:r,update:a,async loadTasks(i=50,l=0,d){a(v=>({...v,loading:!0,error:null}));try{const{data:v,error:u,count:f}=await fa.tasks.getAll(i,l,d);if(u)throw new Error(u.message);const h=s(v||[]);return a(_=>({..._,tasks:v||[],...h,loading:!1,error:null})),{success:!0,data:v,total:f}}catch(v){console.error("Failed to load tasks:",v);const u=v instanceof Error?v.message:"Failed to load tasks";return a(f=>({...f,loading:!1,error:u})),{success:!1,error:u}}},async createTask(i){console.log("🎯 [TaskStore] createTask called with data:",i),a(l=>({...l,loading:!0,error:null}));try{console.log("📤 [TaskStore] Calling db.tasks.create...");const{data:l,error:d}=await fa.tasks.create(i);if(console.log("📥 [TaskStore] db.tasks.create result:",{data:l,error:d}),d)throw console.error("❌ [TaskStore] Database error:",d),new Error(d.message);return console.log("✅ [TaskStore] Task created successfully:",l),a(v=>{const u=[l,...v.tasks],f=s(u);return{...v,tasks:u,...f,loading:!1,error:null}}),{success:!0,data:l}}catch(l){console.error("❌ [TaskStore] Failed to create task:",l),console.error("❌ [TaskStore] Error details:",{message:l==null?void 0:l.message,stack:l==null?void 0:l.stack,name:l==null?void 0:l.name,taskData:i});const d=l instanceof Error?l.message:"Failed to create task";return a(v=>({...v,loading:!1,error:d})),{success:!1,error:d}}},async updateTask(i,l){a(d=>({...d,loading:!0,error:null}));try{const{data:d,error:v}=await fa.tasks.update(i,l);if(v)throw new Error(v.message);return a(u=>{const f=u.tasks.map(_=>_.id===i?{..._,...d}:_),h=s(f);return{...u,tasks:f,...h,loading:!1,error:null}}),{success:!0,data:d}}catch(d){console.error("Failed to update task:",d);const v=d instanceof Error?d.message:"Failed to update task";return a(u=>({...u,loading:!1,error:v})),{success:!1,error:v}}},async deleteTask(i,l){try{const{error:d}=await fa.tasks.delete(i,l);if(d)throw new Error(d.message);return a(v=>{var h;const u=v.tasks.filter(_=>_.id!==i),f=s(u);return{...v,tasks:u,...f,currentTask:((h=v.currentTask)==null?void 0:h.id)===i?null:v.currentTask,error:null}}),{success:!0,data:{id:i}}}catch(d){console.error("Failed to delete task:",d);const v=d instanceof Error?d.message:"Failed to delete task";return a(u=>({...u,error:v})),{success:!1,error:v}}},async searchTasks(i,l,d=50,v=0){a(u=>({...u,loading:!0,error:null}));try{const{data:u,error:f}=await fa.tasks.search(i,l,d,v);if(f)throw new Error(f.message);const h=s(u||[]);return a(_=>({..._,tasks:u||[],...h,loading:!1,error:null})),{success:!0,data:u}}catch(u){console.error("Failed to search tasks:",u);const f=u instanceof Error?u.message:"Failed to search tasks";return a(h=>({...h,loading:!1,error:f})),{success:!1,error:f}}},async getStatistics(i){try{const{data:l,error:d}=await fa.tasks.getStatistics(i);if(d)throw new Error(d.message);return{success:!0,data:l}}catch(l){return console.error("Failed to get task statistics:",l),{success:!1,error:l instanceof Error?l.message:"Failed to get statistics"}}},async activateTask(i,l){return this.updateTask(i,{status:"active"})},async pauseTask(i,l){return this.updateTask(i,{status:"paused"})},async resumeTask(i,l){return this.updateTask(i,{status:"active"})},async completeTask(i,l){return this.updateTask(i,{status:"completed"})},async assignTasks(i,l,d,v,u,f,h){try{if(h&&(h.schedule_date||h.deadline_date))for(const _ of i){const{error:x}=await fa.taskAssignments.createScheduledAssignment(_,l,d,u,f,v||"Unknown User",h.schedule_date,h.schedule_time,h.deadline_date,h.deadline_time);if(x)throw new Error(x.message)}else{const{error:_}=await fa.taskAssignments.assignTasks(i,l,d,v,u,f);if(_)throw new Error(_.message)}return{success:!0}}catch(_){return console.error("Failed to assign tasks:",_),{success:!1,error:_ instanceof Error?_.message:"Failed to assign tasks"}}},async getTaskAssignments(i){try{const{data:l,error:d}=await fa.taskAssignments.getByTaskId(i);if(d)throw new Error(d.message);return{success:!0,data:l}}catch(l){return console.error("Failed to get task assignments:",l),{success:!1,error:l instanceof Error?l.message:"Failed to get assignments"}}},async getTaskImages(i){try{const{data:l,error:d}=await fa.taskImages.getByTaskId(i);if(d)throw new Error(d.message);return{success:!0,data:l}}catch(l){return console.error("Failed to get task images:",l),{success:!1,error:l instanceof Error?l.message:"Failed to get images"}}},async addTaskImage(i,l){try{const{data:d,error:v}=await fa.taskImages.create({...l,task_id:i});if(v)throw new Error(v.message);return{success:!0,data:d}}catch(d){return console.error("Failed to add task image:",d),{success:!1,error:d instanceof Error?d.message:"Failed to add image"}}},clearError(){a(i=>({...i,error:null}))},clearTasks(){r(Ro)},setCurrentTask(i){a(l=>({...l,currentTask:i}))}}}const Ba=tu(),Xi=Ba.loadTasks.bind(Ba),au=Ba.createTask.bind(Ba),ru=Ba.updateTask.bind(Ba),su=Ba.deleteTask.bind(Ba),iu=Ba.searchTasks.bind(Ba),nu=Ba.getStatistics.bind(Ba);Ba.activateTask.bind(Ba);Ba.pauseTask.bind(Ba);Ba.resumeTask.bind(Ba);Ba.completeTask.bind(Ba);Ba.assignTasks.bind(Ba);Ba.getTaskAssignments.bind(Ba);Ba.getTaskImages.bind(Ba);Ba.addTaskImage.bind(Ba);Ba.clearError.bind(Ba);Ba.clearTasks.bind(Ba);Ba.setCurrentTask.bind(Ba);var ou=k('<div class="p-4 bg-yellow-50 border border-yellow-200 rounded-md"><div class="flex"><div class="flex-shrink-0"><svg class="h-5 w-5 text-yellow-400" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path></svg></div> <div class="ml-3"><h3 class="text-sm font-medium text-yellow-800">Authentication Required</h3> <div class="mt-2 text-sm text-yellow-700"><p>For testing purposes, enter a valid user ID below:</p></div> <div class="mt-3"><label for="test-user-id" class="block text-sm font-medium text-yellow-800 mb-1">User ID for Testing</label> <input id="test-user-id" type="text" placeholder="Enter user ID (UUID format)" class="w-full px-3 py-2 border border-yellow-300 rounded-md focus:outline-none focus:ring-2 focus:ring-yellow-500 focus:border-transparent"/></div></div></div></div>'),lu=k('<p class="mt-1 text-sm text-red-600"> </p>'),cu=k('<p class="mt-1 text-sm text-red-600"> </p>'),du=k('<div class="relative inline-block"><img alt="Preview" class="w-32 h-32 object-cover rounded-lg"/></div>'),vu=k('<p class="text-sm text-red-600"> </p>'),uu=k('<div class="bg-red-50 border border-red-200 rounded-md p-3"><p class="text-sm text-red-600"> </p></div>'),fu=k('<div class="bg-white h-full flex flex-col overflow-hidden"><div class="flex-1 overflow-y-auto"><div class="p-6"><div class="flex items-center justify-between mb-6"><h2 class="text-xl font-semibold text-gray-900"> </h2></div> <form class="space-y-6"><!> <div><label for="task-title" class="block text-sm font-medium text-gray-700 mb-2">Task Title *</label> <input id="task-title" type="text" placeholder="Enter task title"/> <!></div> <div><label for="task-description" class="block text-sm font-medium text-gray-700 mb-2">Task Description *</label> <textarea id="task-description" rows="4" placeholder="Enter task description"></textarea> <!></div> <div><label for="image-upload" class="block text-sm font-medium text-gray-700 mb-2">Upload Image (optional)</label> <div class="space-y-3"><!> <input id="image-upload" type="file" accept="image/*" class="block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100 svelte-m5ejlc"/> <!></div></div> <!> <div class="flex justify-end space-x-3 pt-4 border-t"><button type="button" class="px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 border border-gray-300 rounded-md hover:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-gray-500 transition-colors">Cancel</button> <button type="submit" class="px-4 py-2 text-sm font-medium text-white bg-blue-600 border border-transparent rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"> </button></div></form></div></div></div>');function nn(t,r){var We,ke;pa(r,!1);const a=()=>sr(qs,"$auth",s),[s,i]=Zr();let l=Ra(r,"editMode",8,!1),d=Ra(r,"taskData",8,null),v=Ra(r,"onTaskUpdated",8,null);const u=Jr();let f=Q({title:l()&&d()?d().title:"",description:l()&&d()?d().description:"",created_by:l()&&d()?d().created_by:((ke=(We=a())==null?void 0:We.user)==null?void 0:ke.id)||""}),h=Q(""),_=Q(!1),x=null,T=Q(null),b=Q({});const w=N=>{const V=N.target.files[0];if(V){if(!V.type.startsWith("image/")){$e(b,e(b).image="Please select a valid image file");return}if(V.size>5*1024*1024){$e(b,e(b).image="Image size must be less than 5MB");return}x=V,$e(b,e(b).image=null);const G=new FileReader;G.onload=de=>{p(T,de.target.result)},G.readAsDataURL(V)}},A=()=>(p(b,{}),e(f).title.trim()||$e(b,e(b).title="Task title is required"),e(f).description.trim()||$e(b,e(b).description="Task description is required"),e(f).created_by||$e(b,e(b).created_by="User authentication required to create tasks"),Object.keys(e(b)).length===0),C=async()=>{var N,V,G,de,ve,Ie,Ye;if(console.log("🚀 [TaskCreate] Form submission started"),console.log("📋 [TaskCreate] Form data:",e(f)),console.log("🔐 [TaskCreate] Auth user:",(N=a())==null?void 0:N.user),!A()){console.log("❌ [TaskCreate] Form validation failed:",e(b));return}p(_,!0);try{let oe=null;if(x&&(console.log("🔍 [TaskCreate] Attempting to upload image:",x.name,x.type,x.size),oe=await jd(x,"task-images"),console.log("📤 [TaskCreate] Upload result:",oe),oe.error)){console.error("❌ [TaskCreate] Upload error details:",oe.error);const U=`Failed to upload image: ${oe.error.message||JSON.stringify(oe.error)}`;La.add({type:"error",message:U,duration:6e3}),$e(b,e(b).image=U);return}console.log("📝 [TaskCreate] Creating/updating task with data:",e(f));let se;if(l()&&((V=d())!=null&&V.id)?se=await ru(d().id,e(f)):se=await au(e(f)),console.log("📊 [TaskCreate] Task creation result:",se),se.success){if(oe&&oe.data&&((G=se.data)!=null&&G.id)){console.log("💾 [TaskCreate] Saving image record to task_images table...");try{const{db:U}=await Yd(async()=>{const{db:we}=await import("../chunks/Dqyum4BN.js").then(Ae=>Ae.h);return{db:we}},__vite__mapDeps([0,1,2]),import.meta.url),W={task_id:se.data.id,file_name:x.name,file_size:x.size,file_type:x.type,file_url:oe.data.publicUrl,image_type:"task_creation",uploaded_by:((ve=(de=a())==null?void 0:de.user)==null?void 0:ve.id)||e(f).created_by,uploaded_by_name:((Ye=(Ie=a())==null?void 0:Ie.user)==null?void 0:Ye.username)||"Unknown User"};console.log("📝 [TaskCreate] Creating image record:",W);const ee=await U.taskImages.create(W);ee.error?(console.error("❌ [TaskCreate] Failed to save image record:",ee.error),La.add({type:"warning",message:"Task created successfully, but failed to save image reference",duration:4e3})):console.log("✅ [TaskCreate] Image record saved successfully")}catch(U){console.error("❌ [TaskCreate] Error saving image record:",U),La.add({type:"warning",message:"Task created successfully, but failed to save image reference",duration:4e3})}}La.add({type:"success",message:`Task "${e(f).title}" ${l()?"updated":"created"} successfully!`,duration:4e3}),l()?(u("taskUpdated",se.data),v()&&typeof v()=="function"&&v()(se.data)):u("taskCreated",se.data),u("close")}else{const U=se.error||`Failed to ${l()?"update":"create"} task`;La.add({type:"error",message:U,duration:6e3}),$e(b,e(b).submit=U)}}catch(oe){console.error(`❌ [TaskCreate] Error ${l()?"updating":"creating"} task:`,oe),console.error("❌ [TaskCreate] Error details:",{message:oe==null?void 0:oe.message,stack:oe==null?void 0:oe.stack,name:oe==null?void 0:oe.name,cause:oe==null?void 0:oe.cause,formData:e(f),editMode:l(),taskData:d()});const se=`An unexpected error occurred: ${(oe==null?void 0:oe.message)||"Unknown error"}`;La.add({type:"error",message:se,duration:6e3}),$e(b,e(b).submit=se)}finally{p(_,!1)}},z=()=>{u("close")};Nt(()=>(kt(l()),kt(d()),a()),()=>{var N,V;l()&&d()&&p(f,{title:d().title||"",description:d().description||"",created_by:d().created_by||((V=(N=a())==null?void 0:N.user)==null?void 0:V.id)||""})}),Nt(()=>(e(f),e(h)),()=>{!e(f).created_by&&e(h)&&$e(f,e(f).created_by=e(h))}),Nt(()=>(a(),kt(l())),()=>{var N,V;(V=(N=a())==null?void 0:N.user)!=null&&V.id&&!l()&&$e(f,e(f).created_by=a().user.id)}),Va(),ha();var F=fu(),re=o(F),me=o(re),ue=o(me),D=o(ue),E=o(D,!0);n(D),n(ue);var he=c(ue,2),xe=o(he);{var K=N=>{var V=ou(),G=o(V),de=c(o(G),2),ve=c(o(de),4),Ie=c(o(ve),2);At(Ie),n(ve),n(de),n(G),n(V),zt(Ie,()=>e(h),Ye=>p(h,Ye)),g(N,V)};X(xe,N=>{a(),m(()=>{var V;return!((V=a())!=null&&V.user)})&&N(K)})}var q=c(xe,2),ae=c(o(q),2);At(ae);let Me;var ge=c(ae,2);{var Ne=N=>{var V=lu(),G=o(V,!0);n(V),R(()=>y(G,(e(b),m(()=>e(b).title)))),g(N,V)};X(ge,N=>{e(b),m(()=>e(b).title)&&N(Ne)})}n(q);var Be=c(q,2),be=c(o(Be),2);ks(be);let L;var Te=c(be,2);{var ye=N=>{var V=cu(),G=o(V,!0);n(V),R(()=>y(G,(e(b),m(()=>e(b).description)))),g(N,V)};X(Te,N=>{e(b),m(()=>e(b).description)&&N(ye)})}n(Be);var P=c(Be,2),pe=c(o(P),2),B=o(pe);{var j=N=>{var V=du(),G=o(V);n(V),R(()=>na(G,"src",e(T))),g(N,V)};X(B,N=>{e(T)&&N(j)})}var I=c(B,2),Y=c(I,2);{var fe=N=>{var V=vu(),G=o(V,!0);n(V),R(()=>y(G,(e(b),m(()=>e(b).image)))),g(N,V)};X(Y,N=>{e(b),m(()=>e(b).image)&&N(fe)})}n(pe),n(P);var ce=c(P,2);{var J=N=>{var V=uu(),G=o(V),de=o(G,!0);n(G),n(V),R(()=>y(de,(e(b),m(()=>e(b).submit)))),g(N,V)};X(ce,N=>{e(b),m(()=>e(b).submit)&&N(J)})}var le=c(ce,2),S=o(le),De=c(S,2),Ue=o(De,!0);n(De),n(le),n(he),n(me),n(re),n(F),R((N,V)=>{y(E,l()?"Edit Task":"Create New Task"),Me=wt(ae,1,"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",null,Me,N),L=wt(be,1,"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none",null,L,V),S.disabled=e(_),De.disabled=e(_),y(Ue,e(_)?l()?"Updating...":"Creating...":l()?"Update Task":"Create Task")},[()=>({"border-red-500":e(b).title}),()=>({"border-red-500":e(b).description})]),zt(ae,()=>e(f).title,N=>$e(f,e(f).title=N)),zt(be,()=>e(f).description,N=>$e(f,e(f).description=N)),Z("change",I,w),Z("click",S,z),Z("submit",he,Ur(C)),g(t,F),ma(),i()}var pu=k("<option> </option>"),hu=k("<option> </option>"),mu=k('<div class="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6"><div class="flex items-center justify-between"><p class="text-sm text-blue-800"> </p> <div class="flex space-x-2"><button class="bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded text-sm">Bulk Edit</button> <button class="bg-red-600 hover:bg-red-700 text-white px-3 py-1 rounded text-sm">Delete Selected</button></div></div></div>'),_u=k('<div class="flex items-center justify-center h-64"><div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"></div></div>'),gu=k('<div class="flex items-center justify-center h-64"><div class="text-center"><svg class="w-16 h-16 mx-auto text-gray-400 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"></path></svg> <p class="text-gray-500 text-lg">No tasks found</p> <p class="text-gray-400 text-sm mt-1">Try adjusting your search or filters</p></div></div>'),xu=hr('<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 15l7-7 7 7"></path>'),bu=hr('<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>'),wu=hr('<svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><!></svg>'),yu=hr('<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 15l7-7 7 7"></path>'),ku=hr('<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>'),Tu=hr('<svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><!></svg>'),Eu=hr('<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 15l7-7 7 7"></path>'),Au=hr('<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>'),Su=hr('<svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><!></svg>'),Cu=k('<p class="text-xs text-gray-500 truncate mt-1"> </p>'),Fu=k('<div class="flex items-center"><button type="button" class="relative group focus:outline-none focus:ring-2 focus:ring-blue-500 rounded-lg" title="Click to view full image"><img class="w-12 h-12 object-cover rounded-lg border border-gray-200 hover:opacity-80 transition-opacity"/> <div class="absolute inset-0 rounded-lg bg-black bg-opacity-0 hover:bg-opacity-10 transition-all flex items-center justify-center opacity-0 hover:opacity-100"><svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg></div></button> <div class="w-12 h-12 bg-gray-100 rounded-lg border border-gray-200 flex items-center justify-center text-gray-400 hidden"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg></div></div>'),Du=k('<div class="w-12 h-12 bg-gray-100 rounded-lg border border-gray-200 flex items-center justify-center text-gray-400"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg></div>'),Mu=k("<option> </option>"),Iu=k('<tr class="hover:bg-gray-50"><td class="px-6 py-4"><input type="checkbox" class="w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500"/></td><td class="px-6 py-4"><div class="max-w-xs"><p class="text-sm font-medium text-gray-900 truncate"> </p> <!></div></td><td class="px-6 py-4"><!></td><td class="px-6 py-4"><select></select></td><td class="px-6 py-4"><span> </span></td><td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500"> </td><td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500"> </td><td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500"><div class="flex items-center space-x-2"><button class="text-blue-600 hover:text-blue-900" title="Edit Task"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path></svg></button> <button class="text-red-600 hover:text-red-900" title="Delete Task"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg></button></div></td></tr>'),Ru=k('<table class="w-full"><thead class="bg-gray-50"><tr><th class="px-6 py-3 text-left"><input type="checkbox" class="w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500"/></th><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"><button class="flex items-center space-x-1 hover:text-gray-700"><span>Title</span> <!></button></th><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Image</th><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Priority</th><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"><button class="flex items-center space-x-1 hover:text-gray-700"><span>Due Date</span> <!></button></th><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"><button class="flex items-center space-x-1 hover:text-gray-700"><span>Created</span> <!></button></th><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th></tr></thead><tbody class="bg-white divide-y divide-gray-200"></tbody></table>'),Nu=k("<button> </button>"),Pu=k('<div class="flex items-center justify-between border-t bg-white px-4 py-3 sm:px-6 mt-6"><div class="flex flex-1 justify-between sm:hidden"><button class="relative inline-flex items-center rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50 disabled:opacity-50">Previous</button> <button class="relative ml-3 inline-flex items-center rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50 disabled:opacity-50">Next</button></div> <div class="hidden sm:flex sm:flex-1 sm:items-center sm:justify-between"><div><p class="text-sm text-gray-700">Showing <span class="font-medium"> </span> to <span class="font-medium"> </span> of <span class="font-medium"> </span> results</p></div> <div><nav class="isolate inline-flex -space-x-px rounded-md shadow-sm"><button class="relative inline-flex items-center rounded-l-md border border-gray-300 bg-white px-2 py-2 text-sm font-medium text-gray-500 hover:bg-gray-50 focus:z-20 disabled:opacity-50"><span class="sr-only">Previous</span> <svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M12.79 5.23a.75.75 0 01-.02 1.06L8.832 10l3.938 3.71a.75.75 0 11-1.04 1.08l-4.5-4.25a.75.75 0 010-1.08l4.5-4.25a.75.75 0 011.06.02z" clip-rule="evenodd"></path></svg></button> <!> <button class="relative inline-flex items-center rounded-r-md border border-gray-300 bg-white px-2 py-2 text-sm font-medium text-gray-500 hover:bg-gray-50 focus:z-20 disabled:opacity-50"><span class="sr-only">Next</span> <svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M7.21 14.77a.75.75 0 01.02-1.06L11.168 10 7.23 6.29a.75.75 0 111.04-1.08l4.5 4.25a.75.75 0 010 1.08l-4.5 4.25a.75.75 0 01-1.06-.02z" clip-rule="evenodd"></path></svg></button></nav></div></div></div>'),Lu=k('<div class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50" role="dialog" aria-modal="true" tabindex="-1"><div class="bg-white rounded-lg p-4 max-w-4xl max-h-[90vh] overflow-auto"><div class="flex justify-between items-center mb-4"><h3 class="text-lg font-medium text-gray-900">Task Image</h3> <button class="text-gray-400 hover:text-gray-600 transition-colors" aria-label="Close image modal"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg></button></div> <div class="flex justify-center"><img alt="Task image" class="max-w-full h-auto rounded-lg shadow-lg"/></div></div></div>'),Ou=k('<div class="task-view-table bg-white rounded-lg shadow-lg p-6 h-full flex flex-col svelte-i2mekx"><div class="flex items-center justify-between border-b pb-4 mb-6"><div class="flex items-center space-x-3"><div class="bg-blue-100 p-2 rounded-lg"><svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"></path></svg></div> <div><h2 class="text-xl font-bold text-gray-900">View Tasks</h2> <p class="text-sm text-gray-500">Manage and monitor all created tasks</p></div></div> <button class="bg-blue-100 hover:bg-blue-200 text-blue-700 px-4 py-2 rounded-lg transition-colors flex items-center space-x-2" title="Refresh Tasks"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg> <span>Refresh</span></button></div> <div class="flex flex-col lg:flex-row gap-4 mb-6"><div class="flex-1"><div class="relative"><input type="text" placeholder="Search tasks by title, description, or tags..." class="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"/> <div class="absolute inset-y-0 left-0 pl-3 flex items-center"><svg class="w-4 h-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg></div></div></div> <div class="flex space-x-4"><select class="px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"><option>All Statuses</option><!></select> <select class="px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"><option>All Priorities</option><!></select> <button class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg transition-colors flex items-center space-x-2"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg> <span>Search</span></button></div></div> <!> <div class="flex-1 overflow-auto"><!></div> <!></div> <!>',1);function zu(t,r){pa(r,!1),Ra(r,"windowId",8,"");let a=[],s=Q([]),i=Q(!0),l=Q(1),d=10,v=Q(0),u=Q(0),f=Q(""),h=Q(""),_=Q(""),x=Q("created_at"),T=Q("desc"),b=Q(new Set),w=Q(!1),A=Q(!1),C=Q("");const z=["draft","active","paused","completed","cancelled"],F=["low","medium","high","urgent"];Aa(()=>{re()});async function re(){try{p(i,!0);const W=(e(l)-1)*d;let ee;if(e(f).trim()?ee=await iu(e(f).trim(),"e1fdaee2-97f0-4fc1-872f-9d99c6bd684b",d,W):ee=await Xi(d,W,e(h)),ee.success){a=ee.data||[];for(let we of a)try{console.log(`Loading images for task: ${we.id} (${we.title})`);const Ae=await fa.taskImages.getByTaskId(we.id);console.log(`Image result for task ${we.id}:`,Ae),Ae.data&&Ae.data.length>0?(we.image_url=Ae.data[0].file_url,console.log(`Found image for task ${we.id}: ${we.image_url}`)):(console.log(`No images found for task ${we.id}`),we.title.toLowerCase().includes("image")&&console.warn(`Task "${we.title}" suggests it has an image but none found in database`))}catch(Ae){console.warn(`Failed to load image for task ${we.id}:`,Ae)}p(v,ee.total||0),p(u,Math.ceil(e(v)/d)),me()}else console.error("Error loading tasks:",ee.error),La.add({type:"error",message:"Failed to load tasks",duration:5e3})}catch(W){console.error("Error loading tasks:",W),La.add({type:"error",message:"Failed to load tasks",duration:5e3})}finally{p(i,!1)}}function me(){p(s,[...a]),ue()}function ue(){e(s).length===0?p(w,!1):p(w,e(s).every(W=>e(b).has(W.id)))}function D(){e(w)?e(s).forEach(W=>e(b).add(W.id)):e(s).forEach(W=>e(b).delete(W.id)),p(b,new Set(e(b)))}function E(W,ee){ee?e(b).add(W):e(b).delete(W),p(b,new Set(e(b))),ue()}function he(){p(l,1),re()}function xe(){p(l,1),re()}function K(W){e(x)===W?p(T,e(T)==="asc"?"desc":"asc"):(p(x,W),p(T,"asc")),re()}function q(W){p(l,W),re()}async function ae(W){if(confirm("Are you sure you want to delete this task?"))try{const ee=await su(W);if(ee.success)La.add({type:"success",message:"Task deleted successfully",duration:3e3}),re();else throw new Error(ee.error||"Failed to delete task")}catch(ee){La.add({type:"error",message:ee.message||"Failed to delete task",duration:5e3})}}function Me(W){Kt.openWindow({id:`edit-task-${W.id}`,title:`Edit Task: ${W.title}`,component:nn,props:{editMode:!0,taskData:W,onTaskUpdated:()=>{re()}},size:{width:800,height:600},resizable:!0,minimizable:!0,maximizable:!0,closable:!0})}async function ge(W,ee){try{const{data:we,error:Ae}=await fa.tasks.update(W,{status:ee});if(Ae)throw Ae;La.add({type:"success",message:`Task status updated to ${ee}`,duration:3e3}),re()}catch(we){console.error("Failed to update task status:",we),La.add({type:"error",message:"Failed to update task status",duration:5e3})}}function Ne(W){if(!W)return"-";const ee=new Date(W);return ee.toLocaleDateString()+" "+ee.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}function Be(W){switch(W){case"draft":return"bg-gray-100 text-gray-800";case"active":return"bg-green-100 text-green-800";case"paused":return"bg-yellow-100 text-yellow-800";case"completed":return"bg-blue-100 text-blue-800";case"cancelled":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}}function be(W){switch(W){case"low":return"bg-gray-100 text-gray-800";case"medium":return"bg-blue-100 text-blue-800";case"high":return"bg-yellow-100 text-yellow-800";case"urgent":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}}function L(W){console.log("Opening image modal with URL:",W),p(C,W),p(A,!0)}function Te(){p(A,!1),p(C,"")}ha();var ye=Ou(),P=Bt(ye),pe=o(P),B=c(o(pe),2);n(pe);var j=c(pe,2),I=o(j),Y=o(I),fe=o(Y);At(fe),Et(2),n(Y),n(I);var ce=c(I,2),J=o(ce);R(()=>{e(h),Xt(()=>{})});var le=o(J);le.value=le.__value="";var S=c(le);Mt(S,1,()=>z,Lt,(W,ee)=>{var we=pu(),Ae=o(we,!0);n(we);var He={};R(Ke=>{y(Ae,Ke),He!==(He=e(ee))&&(we.value=(we.__value=e(ee))??"")},[()=>(e(ee),m(()=>e(ee).charAt(0).toUpperCase()+e(ee).slice(1)))]),g(W,we)}),n(J);var De=c(J,2);R(()=>{e(_),Xt(()=>{})});var Ue=o(De);Ue.value=Ue.__value="";var We=c(Ue);Mt(We,1,()=>F,Lt,(W,ee)=>{var we=hu(),Ae=o(we,!0);n(we);var He={};R(Ke=>{y(Ae,Ke),He!==(He=e(ee))&&(we.value=(we.__value=e(ee))??"")},[()=>(e(ee),m(()=>e(ee).charAt(0).toUpperCase()+e(ee).slice(1)))]),g(W,we)}),n(De);var ke=c(De,2);n(ce),n(j);var N=c(j,2);{var V=W=>{var ee=mu(),we=o(ee),Ae=o(we),He=o(Ae);n(Ae),Et(2),n(we),n(ee),R(()=>y(He,`${e(b),m(()=>e(b).size)??""} task${e(b),m(()=>e(b).size!==1?"s":"")??""} selected`)),g(W,ee)};X(N,W=>{e(b),m(()=>e(b).size>0)&&W(V)})}var G=c(N,2),de=o(G);{var ve=W=>{var ee=_u();g(W,ee)},Ie=W=>{var ee=Ca(),we=Bt(ee);{var Ae=Ke=>{var Oe=gu();g(Ke,Oe)},He=Ke=>{var Oe=Ru(),Ee=o(Oe),et=o(Ee),dt=o(et),ut=o(dt);At(ut),n(dt);var Pe=c(dt),qe=o(Pe),tt=c(o(qe),2);{var lt=ot=>{var Le=wu(),nt=o(Le);{var vt=M=>{var H=xu();g(M,H)},xt=M=>{var H=bu();g(M,H)};X(nt,M=>{e(T)==="asc"?M(vt):M(xt,!1)})}n(Le),g(ot,Le)};X(tt,ot=>{e(x)==="title"&&ot(lt)})}n(qe),n(Pe);var Xe=c(Pe,4),at=o(Xe),Fe=c(o(at),2);{var rt=ot=>{var Le=Tu(),nt=o(Le);{var vt=M=>{var H=yu();g(M,H)},xt=M=>{var H=ku();g(M,H)};X(nt,M=>{e(T)==="asc"?M(vt):M(xt,!1)})}n(Le),g(ot,Le)};X(Fe,ot=>{e(x)==="due_date"&&ot(rt)})}n(at),n(Xe);var Ce=c(Xe),_e=o(Ce),Ve=c(o(_e),2);{var Je=ot=>{var Le=Su(),nt=o(Le);{var vt=M=>{var H=Eu();g(M,H)},xt=M=>{var H=Au();g(M,H)};X(nt,M=>{e(T)==="asc"?M(vt):M(xt,!1)})}n(Le),g(ot,Le)};X(Ve,ot=>{e(x)==="created_at"&&ot(Je)})}n(_e),n(Ce),Et(),n(et),n(Ee);var st=c(Ee);Mt(st,5,()=>e(s),Lt,(ot,Le)=>{var nt=Iu(),vt=o(nt),xt=o(vt);At(xt),n(vt);var M=c(vt),H=o(M),O=o(H),te=o(O,!0);n(O);var ne=c(O,2);{var ie=gt=>{var yt=Cu(),qt=o(yt,!0);n(yt),R(()=>{na(yt,"title",(e(Le),m(()=>e(Le).description))),y(qt,(e(Le),m(()=>e(Le).description)))}),g(gt,yt)};X(ne,gt=>{e(Le),m(()=>e(Le).description)&&gt(ie)})}n(H),n(M);var Se=c(M),Qe=o(Se);{var je=gt=>{var yt=Fu(),qt=o(yt),sa=o(qt);Et(2),n(qt),Et(2),n(yt),R(()=>{na(sa,"src",(e(Le),m(()=>e(Le).image_url))),na(sa,"alt",`Task image for ${e(Le),m(()=>e(Le).title)??""}`)}),Z("error",sa,oa=>{console.error("Failed to load image:",e(Le).image_url),oa.target.style.display="none",oa.target.parentElement.nextElementSibling.style.display="flex"}),Z("click",qt,()=>L(e(Le).image_url)),g(gt,yt)},ze=gt=>{var yt=Du();g(gt,yt)};X(Qe,gt=>{e(Le),m(()=>e(Le).image_url)?gt(je):gt(ze,!1)})}n(Se);var Re=c(Se),it=o(Re);Mt(it,5,()=>z,Lt,(gt,yt)=>{var qt=Mu(),sa=o(qt,!0);n(qt);var oa={};R(Ia=>{y(sa,Ia),oa!==(oa=e(yt))&&(qt.value=(qt.__value=e(yt))??"")},[()=>(e(yt),m(()=>e(yt).charAt(0).toUpperCase()+e(yt).slice(1)))]),g(gt,qt)}),n(it);var ft;Od(it),n(Re);var mt=c(Re),ht=o(mt),pt=o(ht,!0);n(ht),n(mt);var _t=c(mt),Ge=o(_t,!0);n(_t);var ct=c(_t),Ze=o(ct,!0);n(ct);var bt=c(ct),It=o(bt),Ot=o(It),Pt=c(Ot,2);n(It),n(bt),n(nt),R((gt,yt,qt,sa,oa,Ia)=>{vs(xt,gt),na(O,"title",(e(Le),m(()=>e(Le).title))),y(te,(e(Le),m(()=>e(Le).title))),wt(it,1,`text-xs px-2 py-1 rounded-full ${yt??""}`,"svelte-i2mekx"),ft!==(ft=(e(Le),m(()=>e(Le).status)))&&(it.value=(it.__value=(e(Le),m(()=>e(Le).status)))??"",zd(it,(e(Le),m(()=>e(Le).status)))),wt(ht,1,`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${qt??""}`,"svelte-i2mekx"),y(pt,sa),y(Ge,oa),y(Ze,Ia)},[()=>(e(b),e(Le),m(()=>e(b).has(e(Le).id))),()=>(e(Le),m(()=>Be(e(Le).status))),()=>(e(Le),m(()=>be(e(Le).priority))),()=>(e(Le),m(()=>e(Le).priority.charAt(0).toUpperCase()+e(Le).priority.slice(1))),()=>(e(Le),m(()=>Ne(e(Le).due_date))),()=>(e(Le),m(()=>Ne(e(Le).created_at)))]),Z("change",xt,gt=>{var yt;return E(e(Le).id,((yt=gt.target)==null?void 0:yt.checked)||!1)}),Z("change",it,gt=>{var yt;return ge(e(Le).id,((yt=gt.target)==null?void 0:yt.value)||e(Le).status)}),Z("click",Ot,()=>Me(e(Le))),Z("click",Pt,()=>ae(e(Le).id)),g(ot,nt)}),n(st),n(Oe),tr(ut,()=>e(w),ot=>p(w,ot)),Z("change",ut,D),Z("click",qe,()=>K("title")),Z("click",at,()=>K("due_date")),Z("click",_e,()=>K("created_at")),g(Ke,Oe)};X(we,Ke=>{e(s),m(()=>e(s).length===0)?Ke(Ae):Ke(He,!1)},!0)}g(W,ee)};X(de,W=>{e(i)?W(ve):W(Ie,!1)})}n(G);var Ye=c(G,2);{var oe=W=>{var ee=Pu(),we=o(ee),Ae=o(we),He=c(Ae,2);n(we);var Ke=c(we,2),Oe=o(Ke),Ee=o(Oe),et=c(o(Ee)),dt=o(et,!0);n(et);var ut=c(et,2),Pe=o(ut,!0);n(ut);var qe=c(ut,2),tt=o(qe,!0);n(qe),Et(),n(Ee),n(Oe);var lt=c(Oe,2),Xe=o(lt),at=o(Xe),Fe=c(at,2);Mt(Fe,1,()=>(e(u),e(l),m(()=>Array.from({length:Math.min(5,e(u))},(Ce,_e)=>Math.max(1,Math.min(e(l)-2+_e,e(u)-4+_e+1))))),Lt,(Ce,_e)=>{var Ve=Nu(),Je=o(Ve,!0);n(Ve),R(()=>{wt(Ve,1,`relative inline-flex items-center border border-gray-300 px-4 py-2 text-sm font-medium ${e(l)===e(_e)?"bg-blue-50 text-blue-600 border-blue-500 z-10":"bg-white text-gray-500 hover:bg-gray-50"}`),y(Je,e(_e))}),Z("click",Ve,()=>q(e(_e))),g(Ce,Ve)});var rt=c(Fe,2);n(Xe),n(lt),n(Ke),n(ee),R(Ce=>{Ae.disabled=e(l)<=1,He.disabled=e(l)>=e(u),y(dt,(e(l)-1)*d+1),y(Pe,Ce),y(tt,e(v)),at.disabled=e(l)<=1,rt.disabled=e(l)>=e(u)},[()=>(e(l),e(v),m(()=>Math.min(e(l)*d,e(v))))]),Z("click",Ae,()=>q(e(l)-1)),Z("click",He,()=>q(e(l)+1)),Z("click",at,()=>q(e(l)-1)),Z("click",rt,()=>q(e(l)+1)),g(W,ee)};X(Ye,W=>{e(u)>1&&W(oe)})}n(P);var se=c(P,2);{var U=W=>{var ee=Lu(),we=o(ee),Ae=o(we),He=c(o(Ae),2);n(Ae);var Ke=c(Ae,2),Oe=o(Ke);n(Ke),n(we),n(ee),R(()=>na(Oe,"src",e(C))),Z("click",He,Te),Z("error",Oe,()=>{La.add({type:"error",message:"Failed to load image",duration:3e3}),Te()}),Z("click",we,ir(function(Ee){Or.call(this,r,Ee)})),Z("click",ee,Te),Z("keydown",ee,Ee=>Ee.key==="Escape"&&Te()),g(W,ee)};X(se,W=>{e(A)&&W(U)})}Z("click",B,function(...W){Xi==null||Xi.apply(this,W)}),zt(fe,()=>e(f),W=>p(f,W)),Z("keydown",fe,W=>W.key==="Enter"&&he()),ra(J,()=>e(h),W=>p(h,W)),Z("change",J,xe),ra(De,()=>e(_),W=>p(_,W)),Z("change",De,xe),Z("click",ke,he),g(t,ye),ma()}const No={tasks:[],loading:!1,error:null,currentTask:null,completions:[],totalTasks:0,completedTasks:0,pendingTasks:0,inProgressTasks:0};function Bu(){const{subscribe:t,set:r,update:a}=Us(No),s=i=>({totalTasks:i.length,completedTasks:i.filter(l=>l.status==="completed").length,pendingTasks:i.filter(l=>l.status==="draft").length,inProgressTasks:i.filter(l=>l.status==="active").length});return{subscribe:t,set:r,update:a,async loadTasks(i=50,l=0,d){a(v=>({...v,loading:!0,error:null}));try{const{data:v,error:u,count:f}=await fa.tasks.getAll(i,l,d);if(u)throw new Error(u.message);const h=s(v||[]);return a(_=>({..._,tasks:v||[],...h,loading:!1,error:null})),{success:!0,data:v,total:f}}catch(v){console.error("Failed to load tasks:",v);const u=v instanceof Error?v.message:"Failed to load tasks";return a(f=>({...f,loading:!1,error:u})),{success:!1,error:u}}},async createTask(i){a(l=>({...l,loading:!0,error:null}));try{const{data:l,error:d}=await fa.tasks.create(i);if(d)throw new Error(d.message);return a(v=>{const u=[l,...v.tasks],f=s(u);return{...v,tasks:u,...f,loading:!1,error:null}}),{success:!0,data:l}}catch(l){console.error("Failed to create task:",l);const d=l instanceof Error?l.message:"Failed to create task";return a(v=>({...v,loading:!1,error:d})),{success:!1,error:d}}},async updateTask(i,l){a(d=>({...d,loading:!0,error:null}));try{const{data:d,error:v}=await fa.tasks.update(i,l);if(v)throw new Error(v.message);return a(u=>{const f=u.tasks.map(_=>_.id===i?{..._,...d}:_),h=s(f);return{...u,tasks:f,...h,loading:!1,error:null}}),{success:!0,data:d}}catch(d){console.error("Failed to update task:",d);const v=d instanceof Error?d.message:"Failed to update task";return a(u=>({...u,loading:!1,error:v})),{success:!1,error:v}}},async deleteTask(i,l){try{const{error:d}=await fa.tasks.delete(i,l);if(d)throw new Error(d.message);return a(v=>{var h;const u=v.tasks.filter(_=>_.id!==i),f=s(u);return{...v,tasks:u,...f,currentTask:((h=v.currentTask)==null?void 0:h.id)===i?null:v.currentTask,error:null}}),{success:!0,data:{id:i}}}catch(d){console.error("Failed to delete task:",d);const v=d instanceof Error?d.message:"Failed to delete task";return a(u=>({...u,error:v})),{success:!1,error:v}}},async searchTasks(i,l,d=50,v=0){a(u=>({...u,loading:!0,error:null}));try{const{data:u,error:f}=await fa.tasks.search(i,l,d,v);if(f)throw new Error(f.message);const h=s(u||[]);return a(_=>({..._,tasks:u||[],...h,loading:!1,error:null})),{success:!0,data:u}}catch(u){console.error("Failed to search tasks:",u);const f=u instanceof Error?u.message:"Failed to search tasks";return a(h=>({...h,loading:!1,error:f})),{success:!1,error:f}}},async getStatistics(i){try{const{data:l,error:d}=await fa.tasks.getStatistics(i);if(d)throw new Error(d.message);return{success:!0,data:l}}catch(l){return console.error("Failed to get task statistics:",l),{success:!1,error:l instanceof Error?l.message:"Failed to get statistics"}}},async activateTask(i,l){return this.updateTask(i,{status:"active"})},async pauseTask(i,l){return this.updateTask(i,{status:"paused"})},async resumeTask(i,l){return this.updateTask(i,{status:"active"})},async completeTask(i,l){return this.updateTask(i,{status:"completed"})},async assignTasks(i,l,d,v,u,f,h){try{const{data:_,error:x}=await fa.taskAssignments.assignTasks(i,l,d,v,u,f,h);if(x)throw new Error(x.message);return{success:!0,data:_}}catch(_){return console.error("Failed to assign tasks:",_),{success:!1,error:_ instanceof Error?_.message:"Failed to assign tasks"}}},async getTaskAssignments(i){try{const{data:l,error:d}=await fa.taskAssignments.getByTaskId(i);if(d)throw new Error(d.message);return{success:!0,data:l}}catch(l){return console.error("Failed to get task assignments:",l),{success:!1,error:l instanceof Error?l.message:"Failed to get assignments"}}},async getTaskImages(i){try{const{data:l,error:d}=await fa.taskImages.getByTaskId(i);if(d)throw new Error(d.message);return{success:!0,data:l}}catch(l){return console.error("Failed to get task images:",l),{success:!1,error:l instanceof Error?l.message:"Failed to get images"}}},async addTaskImage(i,l){try{const{data:d,error:v}=await fa.taskImages.create({...l,task_id:i});if(v)throw new Error(v.message);return{success:!0,data:d}}catch(d){return console.error("Failed to add task image:",d),{success:!1,error:d instanceof Error?d.message:"Failed to add image"}}},clearError(){a(i=>({...i,error:null}))},clearTasks(){r(No)},setCurrentTask(i){a(l=>({...l,currentTask:i}))}}}const $a=Bu(),$u=$a.loadTasks.bind($a);$a.createTask.bind($a);$a.updateTask.bind($a);$a.deleteTask.bind($a);$a.searchTasks.bind($a);$a.getStatistics.bind($a);$a.activateTask.bind($a);$a.pauseTask.bind($a);$a.resumeTask.bind($a);$a.completeTask.bind($a);const Uu=$a.assignTasks.bind($a);$a.getTaskAssignments.bind($a);$a.getTaskImages.bind($a);$a.addTaskImage.bind($a);$a.clearError.bind($a);$a.clearTasks.bind($a);$a.setCurrentTask.bind($a);var qu=k('<span class="bg-purple-100 text-purple-800 text-xs font-medium px-2 py-1 rounded-full"> </span>'),ju=k('<span class="bg-purple-100 text-purple-800 text-xs font-medium px-2 py-1 rounded-full"> </span>'),Wu=k('<div class="flex items-center justify-center flex-1"><div class="animate-spin rounded-full h-12 w-12 border-b-2 border-purple-600"></div></div>'),Hu=k("<option> </option>"),Vu=k("<option> </option>"),Gu=k('<p class="text-xs text-gray-500 truncate"> </p>'),Xu=k('<div class="flex items-center space-x-2"><div class="w-6 h-6 bg-purple-100 rounded-full flex items-center justify-center flex-shrink-0"><span class="text-xs font-medium text-purple-600"> </span></div> <div class="min-w-0 flex-1"><p class="text-sm font-medium text-gray-900 truncate"> </p> <!></div></div>'),Yu=k('<span class="text-sm text-gray-400 italic">Employee not assigned</span>'),Ku=k('<span class="inline-flex items-center px-1 py-0.5 rounded text-xs bg-blue-100 text-blue-600">Emp</span>'),Qu=k('<label class="block hover:bg-gray-50 cursor-pointer border-b last:border-b-0"><div class="grid grid-cols-9 gap-3 items-center px-4 py-3"><div class="col-span-1 flex justify-center"><input type="checkbox" class="w-4 h-4 text-purple-600 bg-gray-100 border-gray-300 rounded focus:ring-purple-500"/></div> <div class="col-span-1"><div class="flex items-center space-x-2"><div class="w-6 h-6 bg-blue-100 rounded-full flex items-center justify-center flex-shrink-0"><span class="text-xs font-medium text-blue-600"> </span></div> <div class="min-w-0 flex-1"><p class="text-sm font-medium text-gray-900 truncate"> </p> <p class="text-xs text-gray-500 truncate"> </p></div></div></div> <div class="col-span-1"><!></div> <div class="w-32"><p class="text-sm text-gray-900 truncate"> </p></div> <div class="w-28"><p class="text-sm text-gray-900 truncate"> </p></div> <div class="w-28"><p class="text-sm text-gray-900 truncate"> </p></div> <div class="w-32"><p class="text-sm text-gray-900 truncate"> </p></div> <div class="w-24"><p class="text-sm text-gray-900 truncate"> </p></div> <div class="w-20"><div class="flex flex-col space-y-1"><span> </span> <!></div></div></div></label>'),Zu=k('<div class="p-8 text-center text-gray-500"><svg class="w-12 h-12 mx-auto mb-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path></svg> <p>No users found matching your criteria</p></div>'),Ju=k('<div class="p-6 h-full flex flex-col"><div class="flex items-center justify-between mb-4"><h3 class="text-lg font-medium text-gray-900">Select Users</h3> <span class="text-sm text-gray-500"> </span></div> <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-4"><input type="text" placeholder="Search by name, username, email, phone, position..." class="px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500"/> <select class="px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500"><option>All Branches</option><!></select> <select class="px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500"><option>All Roles</option><!></select> <label class="flex items-center space-x-2 px-3 py-2"><input type="checkbox" class="w-4 h-4 text-purple-600 bg-gray-100 border-gray-300 rounded focus:ring-purple-500"/> <span class="text-sm text-gray-700">Select All</span></label></div> <div class="flex-1 border rounded-lg overflow-hidden"><div class="bg-gray-50 px-4 py-3 border-b text-sm font-medium text-gray-700"><div class="grid grid-cols-9 gap-3 items-center"><div class="col-span-1 text-center">Select</div> <div class="col-span-1">User</div> <div class="col-span-1">Employee</div> <div class="col-span-1">Email</div> <div class="col-span-1">Contact</div> <div class="col-span-1">WhatsApp</div> <div class="col-span-1">Position</div> <div class="col-span-1">Branch</div> <div class="col-span-1">Status</div></div></div> <div class="overflow-y-auto max-h-96"><!> <!></div></div> <div class="flex justify-between pt-4"><button class="px-6 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50">Cancel</button> <button class="px-6 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center space-x-2"><span>Next: Choose Tasks</span> <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10.293 3.293a1 1 0 011.414 0l6 6a1 1 0 010 1.414l-6 6a1 1 0 01-1.414-1.414L14.586 11H3a1 1 0 110-2h11.586l-4.293-4.293a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg></button></div></div>'),ef=k("<option> </option>"),tf=k("<option> </option>"),af=k('<span class="text-sm text-purple-600 font-medium"> </span>'),rf=k('<span class="text-sm text-gray-500"> </span>'),sf=k('<div class="flex flex-col items-center justify-center h-full text-gray-500"><svg class="w-16 h-16 mb-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path></svg> <h3 class="text-lg font-medium text-gray-900 mb-2">No tasks found</h3> <p class="text-gray-500 text-center mb-4"> </p> <button class="bg-purple-600 text-white px-6 py-2 rounded-lg hover:bg-purple-700 transition-colors">Create New Task</button></div>'),nf=k('<button class="w-10 h-10 rounded overflow-hidden hover:shadow-lg transition-shadow duration-200 flex-shrink-0 border border-gray-200"><img alt="Task image" class="w-full h-full object-cover" loading="lazy"/></button>'),of=k('<div class="w-10 h-10 bg-gray-100 rounded flex items-center justify-center border border-gray-200"><svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg></div>'),lf=k('<div class="text-xs text-gray-500"> </div>'),cf=k('<div class="block hover:bg-gray-50 border-b last:border-b-0 transition-colors"><div class="grid grid-cols-12 gap-4 items-center px-6 py-4"><div class="col-span-1 flex items-center justify-center"><input type="checkbox" class="w-4 h-4 text-purple-600 bg-gray-100 border-gray-300 rounded focus:ring-purple-500"/></div> <div class="col-span-1 flex items-center justify-center"><!></div> <div class="col-span-3"><div><h4 class="text-sm font-semibold text-gray-900 line-clamp-1 svelte-15s9ayu"> </h4> <p class="text-xs text-gray-500 line-clamp-2 mt-1 svelte-15s9ayu"> </p> <p class="text-xs text-gray-400 mt-1"> </p></div></div> <div class="col-span-2"><span> </span></div> <div class="col-span-2"><span> </span></div> <div class="col-span-2"><div class="text-sm text-gray-900"> </div> <!></div> <div class="col-span-1"><button class="text-purple-600 hover:text-purple-800 text-xs font-medium transition-colors" title="Edit Task">Edit</button></div></div></div>'),df=k('<div class="border rounded-lg overflow-hidden bg-white"><div class="bg-gray-50 px-6 py-3 border-b text-sm font-medium text-gray-700"><div class="grid grid-cols-12 gap-4 items-center"><div class="col-span-1 flex items-center justify-center"><input type="checkbox" class="w-4 h-4 text-purple-600 bg-gray-100 border-gray-300 rounded focus:ring-purple-500"/></div> <div class="col-span-1">Image</div> <div class="col-span-3">Task Details</div> <div class="col-span-2">Priority</div> <div class="col-span-2">Status</div> <div class="col-span-2">Due Date</div> <div class="col-span-1">Actions</div></div></div> <div class="overflow-y-auto max-h-96"></div></div>'),vf=k('<div class="p-6 h-full flex flex-col"><div class="flex items-center justify-between mb-6"><div><h3 class="text-lg font-medium text-gray-900">Select Tasks</h3> <p class="text-sm text-gray-500 mt-1"> </p></div> <div class="flex items-center space-x-3"><button class="bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg transition-colors flex items-center space-x-2"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path></svg> <span>New Task</span></button> <button class="bg-gray-100 hover:bg-gray-200 text-gray-700 px-4 py-2 rounded-lg transition-colors flex items-center space-x-2"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg> <span>Refresh</span></button></div></div> <div class="bg-white border rounded-lg p-4 mb-6"><div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4"><div class="col-span-full md:col-span-2"><div class="relative"><div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"><svg class="h-5 w-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg></div> <input type="text" placeholder="Search by title or description..." class="block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500"/></div></div> <div><select class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500"><option>All Statuses</option><!></select></div> <div><select class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500"><option>All Priorities</option><!></select></div></div> <div class="flex items-center justify-between mt-4 pt-4 border-t"><div class="flex items-center space-x-4"><!></div> <button class="text-sm text-gray-500 hover:text-gray-700 underline">Clear Filters</button></div></div> <div class="flex-1 overflow-hidden"><!></div> <div class="flex items-center justify-between pt-6 border-t"><button class="px-6 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors flex items-center space-x-2"><svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path></svg> <span>Back to Users</span></button> <button class="px-6 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center space-x-2"><span>Next: Settings</span> <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10.293 3.293a1 1 0 011.414 0l6 6a1 1 0 010 1.414l-6 6a1 1 0 01-1.414-1.414L14.586 11H3a1 1 0 110-2h11.586l-4.293-4.293a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg></button></div></div>'),uf=k('<div class="w-2 h-2 rounded-full bg-white m-0.5"></div>'),ff=k('<div class="w-2 h-2 rounded-full bg-white m-0.5"></div>'),pf=k("<option> </option>"),hf=k('<div class="bg-blue-50 border border-blue-200 rounded-lg p-6"><h4 class="text-lg font-medium text-gray-900 mb-4">Deadline Settings</h4> <div class="grid grid-cols-1 md:grid-cols-2 gap-6"><div><label for="assignment-date" class="block text-sm font-medium text-gray-700 mb-2">Deadline Date *</label> <input id="assignment-date" type="date" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500" required/></div> <div><label for="assignment-time" class="block text-sm font-medium text-gray-700 mb-2">Deadline Time *</label> <select id="assignment-time" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500" required><option>Select time</option><!></select></div></div> <div class="mt-4"><label for="priority-override-one-time" class="block text-sm font-medium text-gray-700 mb-2">Priority Override</label> <select id="priority-override-one-time" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500"><option>Keep original priority</option><option>Low</option><option>Medium</option><option>High</option><option>Urgent</option></select></div></div>'),mf=k("<option> </option>"),_f=k('<label class="flex items-center space-x-2"><input type="checkbox" class="w-4 h-4 text-purple-600 bg-gray-100 border-gray-300 rounded focus:ring-purple-500"/> <span class="text-sm capitalize"> </span></label>'),gf=k('<div class="mb-4"><div class="block text-sm font-medium text-gray-700 mb-2">Select Days</div> <div class="grid grid-cols-2 gap-2"></div></div>'),xf=k('<div class="mb-4"><label for="repeat-interval" class="block text-sm font-medium text-gray-700 mb-2"> </label> <input id="repeat-interval" type="number" min="1" max="365" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500"/></div>'),bf=k('<div class="mb-4"><label for="monthly-date" class="block text-sm font-medium text-gray-700 mb-2">Monthly Date</label> <input id="monthly-date" type="number" min="1" max="31" placeholder="Day of month (1-31)" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500"/></div>'),wf=k("<option> </option>"),yf=k('<div class="bg-purple-50 border border-purple-200 rounded-lg p-6"><h4 class="text-lg font-medium text-gray-900 mb-4">Repeat Schedule</h4> <div class="mb-4"><label for="repeat-type" class="block text-sm font-medium text-gray-700 mb-2">Repeat Type</label> <select id="repeat-type" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500"></select></div> <!> <!> <!> <div class="mb-4"><label for="repeat-time" class="block text-sm font-medium text-gray-700 mb-2">Time *</label> <select id="repeat-time" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500" required><option>Select time</option><!></select></div> <div class="mb-4"><div class="block text-sm font-medium text-gray-700 mb-2">End Repeat</div> <div class="space-y-3"><label class="flex items-center space-x-2"><input type="radio" class="w-4 h-4 text-purple-600 border-gray-300 focus:ring-purple-500"/> <span class="text-sm">Never</span></label> <label class="flex items-center space-x-2"><input type="radio" class="w-4 h-4 text-purple-600 border-gray-300 focus:ring-purple-500"/> <span class="text-sm">After</span> <input type="number" min="1" max="100" class="w-16 px-2 py-1 border border-gray-300 rounded text-xs focus:ring-2 focus:ring-purple-500 focus:border-purple-500 disabled:bg-gray-100"/> <span class="text-sm">times</span></label> <label class="flex items-center space-x-2"><input type="radio" class="w-4 h-4 text-purple-600 border-gray-300 focus:ring-purple-500"/> <span class="text-sm">On date</span> <input type="date" class="px-2 py-1 border border-gray-300 rounded text-xs focus:ring-2 focus:ring-purple-500 focus:border-purple-500 disabled:bg-gray-100"/></label></div></div> <div><label for="priority-override-repeat" class="block text-sm font-medium text-gray-700 mb-2">Priority Override</label> <select id="priority-override-repeat" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500"><option>Keep original priority</option><option>Low</option><option>Medium</option><option>High</option><option>Urgent</option></select></div></div>'),kf=k('<div class="mt-2 text-sm text-blue-700"><span class="font-medium">Repeat:</span> <!></div>'),Tf=k('<div class="mt-2 text-sm text-blue-700"><span class="font-medium">Deadline:</span> </div>'),Ef=k('<div class="flex flex-col h-full"><div class="flex-1 overflow-y-auto p-6 space-y-6"><h3 class="text-lg font-medium text-gray-900">Assignment Settings</h3> <div class="bg-white border border-gray-200 rounded-lg p-6"><h4 class="text-lg font-medium text-gray-900 mb-4">Assignment Type</h4> <div class="grid grid-cols-2 gap-4"><label class="relative cursor-pointer"><input type="radio" class="sr-only"/> <div><div class="flex items-center space-x-3"><div><!></div> <div><div class="font-medium text-gray-900">One Time Assignment</div> <div class="text-sm text-gray-600">Assign tasks once with a specific deadline</div></div></div></div></label> <label class="relative cursor-pointer"><input type="radio" class="sr-only"/> <div><div class="flex items-center space-x-3"><div><!></div> <div><div class="font-medium text-gray-900">Recurring Assignment</div> <div class="text-sm text-gray-600">Set up recurring tasks with schedule</div></div></div></div></label></div></div> <!> <div class="bg-blue-50 border border-blue-200 rounded-lg p-6"><h4 class="text-lg font-medium text-gray-900 mb-4">Task Reassignment</h4> <div><label class="flex items-center space-x-3 mb-2"><input type="checkbox" class="w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500"/> <span class="text-sm font-weight-medium text-gray-700">Enable Reassigning</span></label> <p class="text-xs text-gray-600 ml-7">When enabled, users can reassign this task to other users from their "My Tasks" view</p></div></div> <div class="bg-gray-50 border border-gray-200 rounded-lg p-6"><h4 class="text-lg font-medium text-gray-900 mb-4">Assignment Notes</h4> <div><label class="flex items-center space-x-3 mb-3"><input type="checkbox" class="w-4 h-4 text-purple-600 bg-gray-100 border-gray-300 rounded focus:ring-purple-500"/> <span class="text-sm text-gray-700">Send email notifications to assignees</span></label> <label for="assignment-notes" class="block text-sm font-medium text-gray-700 mb-2">Instructions for Assignees</label> <textarea id="assignment-notes" rows="3" placeholder="Add instructions or notes for assignees..." class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500"></textarea></div></div> <div class="bg-blue-50 border border-blue-200 rounded-lg p-4"><h4 class="text-sm font-medium text-blue-900 mb-2">Assignment Summary</h4> <div class="grid grid-cols-1 md:grid-cols-3 gap-4 text-sm"><div><span class="text-blue-700">Selected Users:</span> <span class="font-medium text-blue-900 ml-1"> </span></div> <div><span class="text-blue-700">Selected Tasks:</span> <span class="font-medium text-blue-900 ml-1"> </span></div> <div><span class="text-blue-700">Total Assignments:</span> <span class="font-medium text-blue-900 ml-1"> </span></div></div> <!></div></div> <div class="border-t border-gray-200 bg-white p-6"><div class="flex justify-between"><button class="px-6 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 flex items-center space-x-2"><svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path></svg> <span>Back to Tasks</span></button> <div class="flex space-x-3"><button class="px-6 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50">Cancel</button> <button class="px-6 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 focus:outline-none focus:ring-2 focus:ring-purple-500 disabled:opacity-50 disabled:cursor-not-allowed flex items-center space-x-2"><span>Next: Completion Criteria</span> <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10.293 3.293a1 1 0 011.414 0l6 6a1 1 0 010 1.414l-6 6a1 1 0 01-1.414-1.414L14.586 11H3a1 1 0 110-2h11.586l-4.293-4.293a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg></button></div></div></div></div>'),Af=k('<div class="flex items-center space-x-2"><svg class="w-4 h-4 text-green-500" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path></svg> <span>Photo upload: Required</span></div>'),Sf=k('<div class="flex items-center space-x-2"><svg class="w-4 h-4 text-green-500" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path></svg> <span>ERP reference: Required</span></div>'),Cf=k('<div class="flex items-center space-x-2"><svg class="w-4 h-4 text-green-500" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path></svg> <span>Only task finished confirmation required</span></div>'),Ff=k('<svg class="w-4 h-4 animate-spin" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg> <span>Assigning Tasks...</span>',1),Df=k('<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path></svg> <span> </span>',1),Mf=k('<div class="flex flex-col h-full"><div class="flex-1 overflow-y-auto p-6 space-y-6"><h3 class="text-lg font-medium text-gray-900">Completion Criteria</h3> <p class="text-gray-600">Specify what must be completed when users finish these assigned tasks.</p> <div class="bg-green-50 border border-green-200 rounded-lg p-6"><h4 class="text-lg font-medium text-gray-900 mb-4">Required for Task Completion</h4> <div class="space-y-4"><label class="flex items-start space-x-3 cursor-not-allowed opacity-75"><input type="checkbox" class="w-4 h-4 text-green-600 border-gray-300 rounded focus:ring-green-500 mt-1"/> <div><span class="text-sm font-medium text-gray-700">Task finished (Required)</span> <p class="text-xs text-gray-600 mt-1">Users must mark the task as finished. This is always mandatory and cannot be disabled.</p></div></label> <label class="flex items-start space-x-3 cursor-pointer"><input type="checkbox" class="w-4 h-4 text-green-600 border-gray-300 rounded focus:ring-green-500 mt-1"/> <div><span class="text-sm font-medium text-gray-700">Upload photo or take photo</span> <p class="text-xs text-gray-600 mt-1">Users must upload or take a photo as proof of completion</p></div></label> <label class="flex items-start space-x-3 cursor-pointer"><input type="checkbox" class="w-4 h-4 text-green-600 border-gray-300 rounded focus:ring-green-500 mt-1"/> <div><span class="text-sm font-medium text-gray-700">ERP reference number</span> <p class="text-xs text-gray-600 mt-1">Users must provide an ERP reference number for audit trail</p></div></label></div></div> <div class="bg-green-50 border border-green-200 rounded-lg p-4"><h4 class="text-sm font-medium text-green-900 mb-2">Completion Requirements Summary</h4> <div class="space-y-1 text-sm text-green-700"><div class="flex items-center space-x-2"><svg class="w-4 h-4 text-green-500" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path></svg> <span>Task finished: Always required</span></div> <!> <!> <!></div></div></div> <div class="border-t border-gray-200 bg-white p-6"><div class="flex justify-between"><button class="px-6 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 flex items-center space-x-2"><svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path></svg> <span>Back to Settings</span></button> <div class="flex space-x-3"><button class="px-6 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50">Cancel</button> <button class="px-6 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500 disabled:opacity-50 disabled:cursor-not-allowed flex items-center space-x-2"><!></button></div></div></div></div>'),If=k('<div class="flex-1 overflow-hidden"><!> <!></div>'),Rf=k('<div class="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-75"><div class="relative max-w-4xl max-h-4xl p-4"><button class="absolute top-2 right-2 z-10 bg-white bg-opacity-80 hover:bg-opacity-100 rounded-full p-2 transition-all duration-200"><svg class="w-6 h-6 text-gray-800" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg></button> <img alt="Task image full size" class="max-w-full max-h-full object-contain rounded-lg"/></div></div>'),Nf=k('<div class="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-75"><div class="relative max-w-4xl max-h-screen p-4"><button class="absolute top-2 right-2 z-10 bg-black bg-opacity-50 text-white rounded-full p-2 hover:bg-opacity-75 transition-colors"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg></button> <img alt="Task image full size" class="max-w-full max-h-full object-contain rounded-lg"/></div></div>'),Pf=k('<div class="task-assignment-view bg-white rounded-lg shadow-lg h-full flex flex-col svelte-15s9ayu"><div class="flex items-center justify-between border-b pb-4 p-6"><div class="flex items-center space-x-3"><div class="bg-purple-100 p-2 rounded-lg"><svg class="w-6 h-6 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"></path></svg></div> <div><h2 class="text-xl font-bold text-gray-900">Assign Tasks</h2> <p class="text-sm text-gray-500">Select users and tasks to create assignments with advanced scheduling</p></div></div> <div class="flex items-center space-x-3"><button class="bg-green-100 hover:bg-green-200 text-green-700 px-4 py-2 rounded-lg transition-colors flex items-center space-x-2" title="Create New Task"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path></svg> <span>New Task</span></button> <button class="bg-blue-100 hover:bg-blue-200 text-blue-700 px-4 py-2 rounded-lg transition-colors flex items-center space-x-2" title="View Statistics"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path></svg> <span>Stats</span></button> <button class="bg-purple-100 hover:bg-purple-200 text-purple-700 px-4 py-2 rounded-lg transition-colors flex items-center space-x-2" title="Refresh Data"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg> <span>Refresh</span></button></div></div> <div class="px-6 py-4 bg-gray-50 border-b"><div class="flex items-center space-x-8"><button><div><span class="text-sm font-medium">1</span></div> <span class="font-medium">Choose Users</span> <!></button> <svg class="w-4 h-4 text-gray-400" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10.293 3.293a1 1 0 011.414 0l6 6a1 1 0 010 1.414l-6 6a1 1 0 01-1.414-1.414L14.586 11H3a1 1 0 110-2h11.586l-4.293-4.293a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg> <button><div><span class="text-sm font-medium">2</span></div> <span class="font-medium">Choose Tasks</span> <!></button> <svg class="w-4 h-4 text-gray-400" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10.293 3.293a1 1 0 011.414 0l6 6a1 1 0 010 1.414l-6 6a1 1 0 01-1.414-1.414L14.586 11H3a1 1 0 110-2h11.586l-4.293-4.293a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg> <button><div><span class="text-sm font-medium">3</span></div> <span class="font-medium">Assignment Settings</span></button> <svg class="w-4 h-4 text-gray-400" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10.293 3.293a1 1 0 011.414 0l6 6a1 1 0 010 1.414l-6 6a1 1 0 01-1.414-1.414L14.586 11H3a1 1 0 110-2h11.586l-4.293-4.293a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg> <div><div><span class="text-sm font-medium">4</span></div> <span class="font-medium">Completion Criteria</span></div></div></div> <!> <!></div> <!>',1);function Lf(t,r){pa(r,!1);const a=[],s=[];let i=Ra(r,"windowId",8,""),l=[],d=Q([]),v=[],u=Q([]),f=Q([]),h=Q(!0),_=Q(!1),x=Q(""),T=Q(""),b=Q(""),w=Q(""),A=Q(""),C=Q(""),z=Q(new Set),F=Q(new Set),re=Q(!1),me=Q(!1),ue=Q(!1),D=Q(""),E=Q({assignment_type:"one_time",notify_assignees:!0,set_deadline:!1,deadline:"",time:"",time_12h:"",add_note:"",priority_override:"",enable_reassigning:!1,enable_repeat:!1,repeat_type:"daily",repeat_days:[],repeat_interval:1,repeat_date:"",repeat_end_type:"never",repeat_end_count:10,repeat_end_date:"",require_task_finished:!0,require_photo_upload:!1,require_erp_reference:!1});const he=(()=>{const Fe=[];for(let rt=1;rt<=12;rt++)for(let Ce of["00","15","30","45"])Fe.push(`${rt}:${Ce} AM`);for(let rt=1;rt<=12;rt++)for(let Ce of["00","15","30","45"])Fe.push(`${rt}:${Ce} PM`);return Fe})(),xe=["Master Admin","Admin","User","Manager"],K=["draft","active","paused"],q=["low","medium","high","urgent"],ae=["monday","tuesday","wednesday","thursday","friday","saturday","sunday"],Me=[{value:"daily",label:"Daily"},{value:"weekly",label:"Weekly (specific days)"},{value:"every_n_days",label:"Every N Days"},{value:"every_n_weeks",label:"Every N Weeks"},{value:"monthly",label:"Monthly (specific date)"},{value:"custom",label:"Custom Schedule"}];let ge=Q("users");Aa(async()=>{await Ne();const Fe=new Date;Fe.setDate(Fe.getDate()+3),$e(E,e(E).deadline=Fe.toISOString().slice(0,10)),$e(E,e(E).time="09:00"),$e(E,e(E).time_12h="9:00 AM");const rt=new Date;rt.setMonth(rt.getMonth()+1),$e(E,e(E).repeat_end_date=rt.toISOString().slice(0,10))});async function Ne(){try{p(h,!0),console.log("Starting data load...");const Fe=await $u(100,0,void 0);if(Fe.success){l=(Fe.data||[]).filter(st=>st.status==="active"||st.status==="draft");for(let st of l)try{console.log(`Loading images for task: ${st.id} (${st.title})`);const ot=await fa.taskImages.getByTaskId(st.id);console.log(`Image result for task ${st.id}:`,ot),ot.data&&ot.data.length>0?(st.image_url=ot.data[0].file_url,console.log(`Found image for task ${st.id}: ${st.image_url}`)):(console.log(`No images found for task ${st.id}`),st.title.toLowerCase().includes("image")&&console.warn(`Task "${st.title}" suggests it has an image but none found in database`))}catch(ot){console.warn(`Failed to load image for task ${st.id}:`,ot)}console.log("Loaded tasks:",l.length)}else console.error("Failed to load tasks:",Fe.error);console.log("Loading branches...");const{data:rt,error:Ce}=await fa.branches.getAll();!Ce&&rt?(p(d,rt),console.log("Loaded branches:",e(d).length)):(console.error("Branch error:",Ce),p(d,[{id:"test-branch-1",name_en:"Main Branch",name_ar:"الفرع الرئيسي"},{id:"test-branch-2",name_en:"Secondary Branch",name_ar:"الفرع الثانوي"}])),console.log("Loading users with employee details...");const{data:_e,error:Ve}=await fa.users.getAllWithEmployeeDetailsFlat();console.log("Users query result:",_e,"Error:",Ve);let Je=[];!Ve&&_e&&_e.length>0&&(Je=_e.map(st=>{console.log("Processing user:",st.username,"Data:",st);const ot=st.emp_id&&st.emp_name,Le=st.emp_name||st.username||"Unknown User",nt=st.email||"No email",vt=st.contact_number||"No phone",xt=st.whatsapp_number||"No WhatsApp",M=st.position_title_en||(ot?"No position assigned":"Employee not assigned");return{id:st.user_id,name:Le,email:nt,phone:vt,whatsapp:xt,position:M,role:st.role_type||"User",branch_id:st.branch_id,branch_name:st.branch_name_en||"Unknown Branch",status:st.status||"active",has_employee_data:ot,employee_name:st.emp_name,username:st.username,user_type:st.user_type,employee_id:st.emp_id,hire_date:null,contact_info:{email:st.email||null,contact_number:st.contact_number||null,whatsapp_number:st.whatsapp_number||null},avatar_url:st.avatar||st.avatar_medium_url,is_active:st.status==="active"}}),console.log("Loaded users with employee details:",Je.length)),v=Je,console.log("Final users array:",v.length,"users loaded"),Be()}catch(Fe){console.error("Error loading data:",Fe),La.add({type:"error",message:"Failed to load assignment data",duration:5e3})}finally{p(h,!1)}}function Be(){console.log("🔍 [TaskAssignment] Applying filters to",l.length,"tasks"),console.log("🔍 [TaskAssignment] Filters:",{taskSearchTerm:e(x),taskStatusFilter:e(A),taskPriorityFilter:e(C)}),p(u,l.filter(Fe=>{const rt=!e(x)||Fe.title.toLowerCase().includes(e(x).toLowerCase())||Fe.description.toLowerCase().includes(e(x).toLowerCase()),Ce=!e(A)||Fe.status===e(A),_e=!e(C)||Fe.priority===e(C),Ve=rt&&Ce&&_e;return Ve||console.log("🚫 [TaskAssignment] Task filtered out:",Fe.title,{matchesSearch:rt,matchesStatus:Ce,matchesPriority:_e}),Ve})),console.log("✅ [TaskAssignment] Filtered tasks count:",e(u).length),console.log("✅ [TaskAssignment] Filtered tasks:",e(u).map(Fe=>({id:Fe.id,title:Fe.title,status:Fe.status}))),p(f,v.filter(Fe=>{const rt=!e(T)||Fe.name&&Fe.name.toLowerCase().includes(e(T).toLowerCase())||Fe.username&&Fe.username.toLowerCase().includes(e(T).toLowerCase())||Fe.email&&Fe.email.toLowerCase().includes(e(T).toLowerCase())||Fe.phone&&Fe.phone.toLowerCase().includes(e(T).toLowerCase())||Fe.whatsapp&&Fe.whatsapp.toLowerCase().includes(e(T).toLowerCase())||Fe.position&&Fe.position.toLowerCase().includes(e(T).toLowerCase()),Ce=!e(b)||Fe.branch_id===e(b),_e=!e(w)||Fe.role===e(w),Ve=Fe.is_active!==!1;return rt&&Ce&&_e&&Ve})),be()}function be(){p(re,e(u).length>0&&e(u).every(Fe=>e(z).has(Fe.id))),p(me,e(f).length>0&&e(f).every(Fe=>e(F).has(Fe.id)))}function L(){e(re)?e(u).forEach(Fe=>e(z).add(Fe.id)):e(u).forEach(Fe=>e(z).delete(Fe.id)),p(z,new Set(e(z)))}function Te(){e(me)?e(f).forEach(Fe=>e(F).add(Fe.id)):e(f).forEach(Fe=>e(F).delete(Fe.id)),p(F,new Set(e(F)))}function ye(Fe,rt){rt?e(z).add(Fe):e(z).delete(Fe),p(z,new Set(e(z))),be()}function P(Fe,rt){rt?e(F).add(Fe):e(F).delete(Fe),p(F,new Set(e(F))),be()}function pe(Fe){const[rt,Ce]=Fe.split(" ");let[_e,Ve]=rt.split(":");return _e==="12"&&(_e="00"),Ce==="PM"&&(_e=parseInt(_e,10)+12),`${_e.toString().padStart(2,"0")}:${Ve}`}async function B(){if(e(z).size===0){La.add({type:"warning",message:"Please select at least one task to assign",duration:3e3});return}if(e(F).size===0){La.add({type:"warning",message:"Please select at least one user to assign tasks to",duration:3e3});return}if(!e(E).assignment_type){La.add({type:"warning",message:"Please select an assignment type (One Time or Repeat)",duration:3e3});return}if(!e(E).time_12h){La.add({type:"warning",message:"Please select a time for the assignment",duration:3e3});return}if(e(E).assignment_type==="one_time"&&!e(E).deadline){La.add({type:"warning",message:"Please set a date for the one-time assignment",duration:3e3});return}if(e(E).assignment_type==="repeat"){if(e(E).repeat_type==="weekly"&&e(E).repeat_days.length===0){La.add({type:"warning",message:"Please select at least one day for weekly repeat",duration:3e3});return}if(e(E).repeat_type==="monthly"&&!e(E).repeat_date){La.add({type:"warning",message:"Please set a date for monthly repeat",duration:3e3});return}if(e(E).repeat_type==="every_n_days"&&(!e(E).repeat_interval||e(E).repeat_interval<1)){La.add({type:"warning",message:"Please set a valid interval for repeat every N days",duration:3e3});return}if(e(E).repeat_type==="every_n_weeks"&&(!e(E).repeat_interval||e(E).repeat_interval<1)){La.add({type:"warning",message:"Please set a valid interval for repeat every N weeks",duration:3e3});return}if(e(E).repeat_end_type==="after"&&e(E).repeat_end_count<1){La.add({type:"warning",message:"Please set a valid number of repetitions",duration:3e3});return}if(e(E).repeat_end_type==="on_date"&&!e(E).repeat_end_date){La.add({type:"warning",message:"Please set an end date for repetitions",duration:3e3});return}}p(_,!0);try{let Fe=null;e(E).time_12h&&(Fe=pe(e(E).time_12h));let rt=null;e(E).assignment_type==="one_time"&&e(E).deadline&&Fe&&(rt=`${e(E).deadline}T${Fe}:00`);const Ce=e(E).assignment_type==="one_time"&&e(E).deadline&&Fe?{deadline_date:e(E).deadline,deadline_time:Fe,notes:e(E).add_note||void 0,priority_override:e(E).priority_override||void 0,require_task_finished:e(E).require_task_finished,require_photo_upload:e(E).require_photo_upload,require_erp_reference:e(E).require_erp_reference}:{notes:e(E).add_note||void 0,priority_override:e(E).priority_override||void 0,require_task_finished:e(E).require_task_finished,require_photo_upload:e(E).require_photo_upload,require_erp_reference:e(E).require_erp_reference},_e={task_ids:Array.from(e(z)),user_ids:Array.from(e(F)),deadline:rt,priority_override:e(E).priority_override||null,note:e(E).add_note||null,notify_assignees:e(E).notify_assignees,repeat_settings:e(E).assignment_type==="repeat"?{type:e(E).repeat_type,interval:e(E).repeat_interval,days:e(E).repeat_days,date:e(E).repeat_date,time:Fe,end_type:e(E).repeat_end_type,end_count:e(E).repeat_end_count,end_date:e(E).repeat_end_date}:null},Ve=Array.from(e(z)),Je=[];for(const Le of e(F)){const nt=await Uu(Ve,"user","e1fdaee2-97f0-4fc1-872f-9d99c6bd684b","Admin User",Le,void 0,Ce);if(nt.error)throw new Error(nt.error.message||"Failed to assign tasks");nt.data&&Je.push(...nt.data)}const st=e(z).size*e(F).size;let ot=`Successfully created ${st} task assignment${st!==1?"s":""}`;if(e(E).enable_repeat&&(ot+=" with repeat scheduling"),La.add({type:"success",message:ot,duration:5e3}),e(E).notify_assignees)try{const Le=[];for(const nt of e(z)){const vt=l.find(O=>O.id===nt);if(!vt)continue;const xt=Je.find(O=>O.task_id===nt),M=xt?xt.id:null,H=Wr.createTaskAssignmentNotification(nt,vt.title,Array.from(e(F)),"e1fdaee2-97f0-4fc1-872f-9d99c6bd684b","Admin User",rt,e(E).add_note,{assignmentId:M,require_task_finished:e(E).require_task_finished,require_photo_upload:e(E).require_photo_upload,require_erp_reference:e(E).require_erp_reference,description:vt.description});Le.push(H)}await Promise.all(Le),La.add({type:"success",message:`Notifications sent to ${e(F).size} user${e(F).size!==1?"s":""} via Notification Center`,duration:3e3})}catch(Le){console.error("Error creating notifications:",Le),La.add({type:"warning",message:"Tasks assigned successfully, but failed to send some notifications",duration:4e3})}e(z).clear(),e(F).clear(),p(z,new Set(e(z))),p(F,new Set(e(F))),$e(E,e(E).add_note=""),$e(E,e(E).priority_override=""),$e(E,e(E).enable_repeat=!1),$e(E,e(E).repeat_days=[]),$e(E,e(E).require_task_finished=!0),$e(E,e(E).require_photo_upload=!1),$e(E,e(E).require_erp_reference=!1),be()}catch(Fe){console.error("Error assigning tasks:",Fe),La.add({type:"error",message:Fe instanceof Error?Fe.message:"Failed to assign tasks",duration:5e3})}finally{p(_,!1)}}function j(Fe){return Fe?new Date(Fe).toLocaleDateString():"-"}function I(Fe){switch(Fe){case"draft":return"bg-gray-100 text-gray-800";case"active":return"bg-green-100 text-green-800";case"paused":return"bg-yellow-100 text-yellow-800";default:return"bg-gray-100 text-gray-800"}}function Y(Fe){switch(Fe){case"low":return"bg-gray-100 text-gray-800";case"medium":return"bg-blue-100 text-blue-800";case"high":return"bg-yellow-100 text-yellow-800";case"urgent":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}}function fe(){i()&&Kt.closeWindow(i())}function ce(Fe){p(D,Fe),p(ue,!0)}function J(){p(ue,!1),p(D,"")}function le(Fe){p(ge,Fe)}function S(Fe){const rt=e(E).repeat_days.indexOf(Fe);rt>-1?e(E).repeat_days.splice(rt,1):e(E).repeat_days.push(Fe),$e(E,e(E).repeat_days=[...e(E).repeat_days])}function De(){Kt.openWindow({component:nn,title:"Create New Task",props:{editMode:!1,taskData:null,onTaskUpdated:Fe=>{Ne(),La.add({type:"success",message:`Task "${Fe.title}" created successfully!`,duration:3e3})}}})}function Ue(Fe){Kt.openWindow({component:nn,title:`Edit Task: ${Fe.title}`,props:{editMode:!0,taskData:Fe,onTaskUpdated:rt=>{Ne(),La.add({type:"success",message:`Task "${rt.title}" updated successfully!`,duration:3e3})}}})}function We(){La.add({type:"info",message:"Task statistics view coming soon!",duration:3e3})}Nt(()=>{},()=>{Be()}),Va(),ha();var ke=Pf(),N=Bt(ke),V=o(N),G=c(o(V),2),de=o(G),ve=c(de,2),Ie=c(ve,2);n(G),n(V);var Ye=c(V,2),oe=o(Ye),se=o(oe),U=o(se),W=c(U,4);{var ee=Fe=>{var rt=qu(),Ce=o(rt);n(rt),R(()=>y(Ce,`${e(F),m(()=>e(F).size)??""} selected`)),g(Fe,rt)};X(W,Fe=>{e(F),m(()=>e(F).size>0)&&Fe(ee)})}n(se);var we=c(se,4),Ae=o(we),He=c(Ae,4);{var Ke=Fe=>{var rt=ju(),Ce=o(rt);n(rt),R(()=>y(Ce,`${e(z),m(()=>e(z).size)??""} selected`)),g(Fe,rt)};X(He,Fe=>{e(z),m(()=>e(z).size>0)&&Fe(Ke)})}n(we);var Oe=c(we,4),Ee=o(Oe);Et(2),n(Oe);var et=c(Oe,4),dt=o(et);Et(2),n(et),n(oe),n(Ye);var ut=c(Ye,2);{var Pe=Fe=>{var rt=Wu();g(Fe,rt)},qe=Fe=>{var rt=If(),Ce=o(rt);{var _e=ot=>{var Le=Ju(),nt=o(Le),vt=c(o(nt),2),xt=o(vt);n(vt),n(nt);var M=c(nt,2),H=o(M);At(H);var O=c(H,2);R(()=>{e(b),Xt(()=>{e(d)})});var te=o(O);te.value=te.__value="";var ne=c(te);Mt(ne,1,()=>e(d),Lt,(ct,Ze)=>{var bt=Hu(),It=o(bt,!0);n(bt);var Ot={};R(()=>{y(It,(e(Ze),m(()=>e(Ze).name_en||e(Ze).name))),Ot!==(Ot=(e(Ze),m(()=>e(Ze).id)))&&(bt.value=(bt.__value=(e(Ze),m(()=>e(Ze).id)))??"")}),g(ct,bt)}),n(O);var ie=c(O,2);R(()=>{e(w),Xt(()=>{})});var Se=o(ie);Se.value=Se.__value="";var Qe=c(Se);Mt(Qe,1,()=>xe,Lt,(ct,Ze)=>{var bt=Vu(),It=o(bt,!0);n(bt);var Ot={};R(()=>{y(It,e(Ze)),Ot!==(Ot=e(Ze))&&(bt.value=(bt.__value=e(Ze))??"")}),g(ct,bt)}),n(ie);var je=c(ie,2),ze=o(je);At(ze),Et(2),n(je),n(M);var Re=c(M,2),it=c(o(Re),2),ft=o(it);Mt(ft,1,()=>e(f),Lt,(ct,Ze)=>{var bt=Qu(),It=o(bt),Ot=o(It),Pt=o(Ot);At(Pt),n(Ot);var gt=c(Ot,2),yt=o(gt),qt=o(yt),sa=o(qt),oa=o(sa,!0);n(sa),n(qt);var Ia=c(qt,2),ka=o(Ia),St=o(ka,!0);n(ka);var Dt=c(ka,2),Wt=o(Dt,!0);n(Dt),n(Ia),n(yt),n(gt);var ea=c(gt,2),Ht=o(ea);{var Qt=Vt=>{var ca=Xu(),ya=o(ca),ua=o(ya),va=o(ua,!0);n(ua),n(ya);var Ta=c(ya,2),Ha=o(Ta),xa=o(Ha,!0);n(Ha);var wa=c(Ha,2);{var Pa=Xa=>{var Za=Gu(),Ja=o(Za);n(Za),R(nr=>y(Ja,`Since: ${nr??""}`),[()=>(e(Ze),m(()=>new Date(e(Ze).hire_date).toLocaleDateString()))]),g(Xa,Za)};X(wa,Xa=>{e(Ze),m(()=>e(Ze).hire_date)&&Xa(Pa)})}n(Ta),n(ca),R(Xa=>{y(va,Xa),y(xa,(e(Ze),m(()=>e(Ze).name)))},[()=>(e(Ze),m(()=>{var Xa,Za;return((Za=(Xa=e(Ze).name)==null?void 0:Xa.charAt(0))==null?void 0:Za.toUpperCase())||"E"}))]),g(Vt,ca)},la=Vt=>{var ca=Yu();g(Vt,ca)};X(Ht,Vt=>{e(Ze),m(()=>e(Ze).has_employee_data)?Vt(Qt):Vt(la,!1)})}n(ea);var Ft=c(ea,2),Ct=o(Ft),$t=o(Ct,!0);n(Ct),n(Ft);var Zt=c(Ft,2),Da=o(Zt),ta=o(Da,!0);n(Da),n(Zt);var Rt=c(Zt,2),Ut=o(Rt),Jt=o(Ut,!0);n(Ut),n(Rt);var Ma=c(Rt,2),qa=o(Ma),ar=o(qa,!0);n(qa),n(Ma);var Ga=c(Ma,2),Qa=o(Ga),_a=o(Qa,!0);n(Qa),n(Ga);var Gt=c(Ga,2),Yt=o(Gt),ia=o(Yt),ga=o(ia,!0);n(ia);var aa=c(ia,2);{var jt=Vt=>{var ca=Ku();g(Vt,ca)};X(aa,Vt=>{e(Ze),m(()=>e(Ze).has_employee_data)&&Vt(jt)})}n(Yt),n(Gt),n(It),n(bt),R((Vt,ca)=>{vs(Pt,Vt),y(oa,ca),y(St,(e(Ze),m(()=>e(Ze).username))),y(Wt,(e(Ze),m(()=>e(Ze).user_type||"User"))),y($t,(e(Ze),m(()=>e(Ze).email))),y(ta,(e(Ze),m(()=>e(Ze).phone))),y(Jt,(e(Ze),m(()=>e(Ze).whatsapp))),y(ar,(e(Ze),m(()=>e(Ze).position))),y(_a,(e(Ze),m(()=>e(Ze).branch_name||"No branch"))),wt(ia,1,`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${e(Ze),m(()=>e(Ze).status==="active"?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800")??""}`),y(ga,(e(Ze),m(()=>e(Ze).status||"Active")))},[()=>(e(F),e(Ze),m(()=>e(F).has(e(Ze).id))),()=>(e(Ze),m(()=>{var Vt,ca;return((ca=(Vt=e(Ze).username)==null?void 0:Vt.charAt(0))==null?void 0:ca.toUpperCase())||"U"}))]),Z("change",Pt,Vt=>{var ca;return P(e(Ze).id,((ca=Vt.target)==null?void 0:ca.checked)||!1)}),g(ct,bt)});var mt=c(ft,2);{var ht=ct=>{var Ze=Zu();g(ct,Ze)};X(mt,ct=>{e(f),m(()=>e(f).length===0)&&ct(ht)})}n(it),n(Re);var pt=c(Re,2),_t=o(pt),Ge=c(_t,2);n(pt),n(Le),R(()=>{y(xt,`${e(F),m(()=>e(F).size)??""} of ${e(f),m(()=>e(f).length)??""} selected`),Ge.disabled=(e(F),m(()=>e(F).size===0))}),zt(H,()=>e(T),ct=>p(T,ct)),ra(O,()=>e(b),ct=>p(b,ct)),ra(ie,()=>e(w),ct=>p(w,ct)),tr(ze,()=>e(me),ct=>p(me,ct)),Z("change",ze,Te),Z("click",_t,fe),Z("click",Ge,()=>le("tasks")),g(ot,Le)},Ve=ot=>{var Le=Ca(),nt=Bt(Le);{var vt=M=>{var H=vf(),O=o(H),te=o(O),ne=c(o(te),2),ie=o(ne);n(ne),n(te);var Se=c(te,2),Qe=o(Se),je=c(Qe,2);n(Se),n(O);var ze=c(O,2),Re=o(ze),it=o(Re),ft=o(it),mt=c(o(ft),2);At(mt),n(ft),n(it);var ht=c(it,2),pt=o(ht);R(()=>{e(A),Xt(()=>{})});var _t=o(pt);_t.value=_t.__value="";var Ge=c(_t);Mt(Ge,1,()=>K,Lt,(Ht,Qt)=>{var la=ef(),Ft=o(la,!0);n(la);var Ct={};R($t=>{y(Ft,$t),Ct!==(Ct=e(Qt))&&(la.value=(la.__value=e(Qt))??"")},[()=>(e(Qt),m(()=>e(Qt).charAt(0).toUpperCase()+e(Qt).slice(1)))]),g(Ht,la)}),n(pt),n(ht);var ct=c(ht,2),Ze=o(ct);R(()=>{e(C),Xt(()=>{})});var bt=o(Ze);bt.value=bt.__value="";var It=c(bt);Mt(It,1,()=>q,Lt,(Ht,Qt)=>{var la=tf(),Ft=o(la,!0);n(la);var Ct={};R($t=>{y(Ft,$t),Ct!==(Ct=e(Qt))&&(la.value=(la.__value=e(Qt))??"")},[()=>(e(Qt),m(()=>e(Qt).charAt(0).toUpperCase()+e(Qt).slice(1)))]),g(Ht,la)}),n(Ze),n(ct),n(Re);var Ot=c(Re,2),Pt=o(Ot),gt=o(Pt);{var yt=Ht=>{var Qt=af(),la=o(Qt);n(Qt),R(()=>y(la,`${e(z),m(()=>e(z).size)??""} task${e(z),m(()=>e(z).size!==1?"s":"")??""} selected`)),g(Ht,Qt)},qt=Ht=>{var Qt=rf(),la=o(Qt);n(Qt),R(()=>y(la,`${e(u),m(()=>e(u).length)??""} task${e(u),m(()=>e(u).length!==1?"s":"")??""} available`)),g(Ht,Qt)};X(gt,Ht=>{e(z),m(()=>e(z).size>0)?Ht(yt):Ht(qt,!1)})}n(Pt);var sa=c(Pt,2);n(Ot),n(ze);var oa=c(ze,2),Ia=o(oa);{var ka=Ht=>{var Qt=sf(),la=c(o(Qt),4),Ft=o(la,!0);n(la);var Ct=c(la,2);n(Qt),R(()=>y(Ft,e(x)||e(A)||e(C)?"No tasks match your current filters.":"No active tasks available for assignment.")),Z("click",Ct,De),g(Ht,Qt)},St=Ht=>{var Qt=df(),la=o(Qt),Ft=o(la),Ct=o(Ft),$t=o(Ct);At($t),n(Ct),Et(12),n(Ft),n(la);var Zt=c(la,2);Mt(Zt,5,()=>e(u),Lt,(Da,ta)=>{var Rt=cf(),Ut=o(Rt),Jt=o(Ut),Ma=o(Jt);At(Ma),n(Jt);var qa=c(Jt,2),ar=o(qa);{var Ga=Wa=>{var rr=nf(),Ir=o(rr);n(rr),R(()=>na(Ir,"src",(e(ta),m(()=>e(ta).image_url)))),Z("error",Ir,Es=>{console.warn(`Failed to load image: ${e(ta).image_url}`),Es.target.parentElement.style.display="none"}),Z("click",rr,ir(()=>ce(e(ta).image_url))),g(Wa,rr)},Qa=Wa=>{var rr=of();g(Wa,rr)};X(ar,Wa=>{e(ta),m(()=>e(ta).image_url)?Wa(Ga):Wa(Qa,!1)})}n(qa);var _a=c(qa,2),Gt=o(_a),Yt=o(Gt),ia=o(Yt,!0);n(Yt);var ga=c(Yt,2),aa=o(ga,!0);n(ga);var jt=c(ga,2),Vt=o(jt);n(jt),n(Gt),n(_a);var ca=c(_a,2),ya=o(ca),ua=o(ya,!0);n(ya),n(ca);var va=c(ca,2),Ta=o(va),Ha=o(Ta,!0);n(Ta),n(va);var xa=c(va,2),wa=o(xa),Pa=o(wa,!0);n(wa);var Xa=c(wa,2);{var Za=Wa=>{var rr=lf(),Ir=o(rr);n(rr),R(()=>y(Ir,`at ${e(ta),m(()=>e(ta).due_time)??""}`)),g(Wa,rr)};X(Xa,Wa=>{e(ta),m(()=>e(ta).due_time)&&Wa(Za)})}n(xa);var Ja=c(xa,2),nr=o(Ja);n(Ja),n(Ut),n(Rt),R((Wa,rr,Ir,Es,di,Ps,vi)=>{vs(Ma,Wa),y(ia,(e(ta),m(()=>e(ta).title))),y(aa,(e(ta),m(()=>e(ta).description||"No description"))),y(Vt,`ID: ${rr??""}...`),wt(ya,1,`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${Ir??""}`,"svelte-15s9ayu"),y(ua,Es),wt(Ta,1,`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${di??""}`,"svelte-15s9ayu"),y(Ha,Ps),y(Pa,vi)},[()=>(e(z),e(ta),m(()=>e(z).has(e(ta).id))),()=>(e(ta),m(()=>e(ta).id.slice(0,8))),()=>(e(ta),m(()=>Y(e(ta).priority))),()=>(e(ta),m(()=>e(ta).priority.charAt(0).toUpperCase()+e(ta).priority.slice(1))),()=>(e(ta),m(()=>I(e(ta).status))),()=>(e(ta),m(()=>e(ta).status.charAt(0).toUpperCase()+e(ta).status.slice(1))),()=>(e(ta),m(()=>e(ta).due_date?j(e(ta).due_date):"Not set"))]),Z("change",Ma,Wa=>{var rr;return ye(e(ta).id,((rr=Wa.target)==null?void 0:rr.checked)||!1)}),Z("click",nr,ir(()=>Ue(e(ta)))),g(Da,Rt)}),n(Zt),n(Qt),tr($t,()=>e(re),Da=>p(re,Da)),Z("change",$t,L),g(Ht,Qt)};X(Ia,Ht=>{e(u),m(()=>e(u).length===0)?Ht(ka):Ht(St,!1)})}n(oa);var Dt=c(oa,2),Wt=o(Dt),ea=c(Wt,2);n(Dt),n(H),R(()=>{y(ie,`${e(z),m(()=>e(z).size)??""} of ${e(u),m(()=>e(u).length)??""} selected`),ea.disabled=(e(z),m(()=>e(z).size===0))}),Z("click",Qe,De),Z("click",je,Ne),zt(mt,()=>e(x),Ht=>p(x,Ht)),ra(pt,()=>e(A),Ht=>p(A,Ht)),ra(Ze,()=>e(C),Ht=>p(C,Ht)),Z("click",sa,()=>{p(x,""),p(A,""),p(C,"")}),Z("click",Wt,()=>le("users")),Z("click",ea,()=>{e(z).size>0&&p(ge,"settings")}),g(M,H)},xt=M=>{var H=Ca(),O=Bt(H);{var te=ne=>{var ie=Ef(),Se=o(ie),Qe=c(o(Se),2),je=c(o(Qe),2),ze=o(je),Re=o(ze);At(Re),Re.value=Re.__value="one_time";var it=c(Re,2),ft=o(it),mt=o(ft),ht=o(mt);{var pt=ia=>{var ga=uf();g(ia,ga)};X(ht,ia=>{e(E),m(()=>e(E).assignment_type==="one_time")&&ia(pt)})}n(mt),Et(2),n(ft),n(it),n(ze);var _t=c(ze,2),Ge=o(_t);At(Ge),Ge.value=Ge.__value="repeat";var ct=c(Ge,2),Ze=o(ct),bt=o(Ze),It=o(bt);{var Ot=ia=>{var ga=ff();g(ia,ga)};X(It,ia=>{e(E),m(()=>e(E).assignment_type==="repeat")&&ia(Ot)})}n(bt),Et(2),n(Ze),n(ct),n(_t),n(je),n(Qe);var Pt=c(Qe,2);{var gt=ia=>{var ga=hf(),aa=c(o(ga),2),jt=o(aa),Vt=c(o(jt),2);At(Vt),n(jt);var ca=c(jt,2),ya=c(o(ca),2);R(()=>{e(E),Xt(()=>{})});var ua=o(ya);ua.value=ua.__value="";var va=c(ua);Mt(va,1,()=>he,Lt,(Ja,nr)=>{var Wa=pf(),rr=o(Wa,!0);n(Wa);var Ir={};R(()=>{y(rr,e(nr)),Ir!==(Ir=e(nr))&&(Wa.value=(Wa.__value=e(nr))??"")}),g(Ja,Wa)}),n(ya),n(ca),n(aa);var Ta=c(aa,2),Ha=c(o(Ta),2);R(()=>{e(E),Xt(()=>{})});var xa=o(Ha);xa.value=xa.__value="";var wa=c(xa);wa.value=wa.__value="low";var Pa=c(wa);Pa.value=Pa.__value="medium";var Xa=c(Pa);Xa.value=Xa.__value="high";var Za=c(Xa);Za.value=Za.__value="urgent",n(Ha),n(Ta),n(ga),R(Ja=>na(Vt,"min",Ja),[()=>m(()=>new Date().toISOString().split("T")[0])]),zt(Vt,()=>e(E).deadline,Ja=>$e(E,e(E).deadline=Ja)),ra(ya,()=>e(E).time_12h,Ja=>$e(E,e(E).time_12h=Ja)),ra(Ha,()=>e(E).priority_override,Ja=>$e(E,e(E).priority_override=Ja)),g(ia,ga)},yt=ia=>{var ga=Ca(),aa=Bt(ga);{var jt=Vt=>{var ca=yf(),ya=c(o(ca),2),ua=c(o(ya),2);R(()=>{e(E),Xt(()=>{})}),Mt(ua,5,()=>Me,Lt,(ja,or)=>{var dr=mf(),ms=o(dr,!0);n(dr);var qr={};R(()=>{y(ms,(e(or),m(()=>e(or).label))),qr!==(qr=(e(or),m(()=>e(or).value)))&&(dr.value=(dr.__value=(e(or),m(()=>e(or).value)))??"")}),g(ja,dr)}),n(ua),n(ya);var va=c(ya,2);{var Ta=ja=>{var or=gf(),dr=c(o(or),2);Mt(dr,5,()=>ae,Lt,(ms,qr)=>{var fi=_f(),Gi=o(fi);At(Gi);var Fo=c(Gi,2),Dd=o(Fo,!0);n(Fo),n(fi),R(Md=>{vs(Gi,Md),y(Dd,e(qr))},[()=>(e(E),e(qr),m(()=>e(E).repeat_days.includes(e(qr))))]),Z("change",Gi,()=>S(e(qr))),g(ms,fi)}),n(dr),n(or),g(ja,or)};X(va,ja=>{e(E),m(()=>e(E).repeat_type==="weekly")&&ja(Ta)})}var Ha=c(va,2);{var xa=ja=>{var or=xf(),dr=o(or),ms=o(dr);n(dr);var qr=c(dr,2);At(qr),n(or),R(()=>y(ms,`Every ${e(E),m(()=>e(E).repeat_type==="every_n_days"?"Days":"Weeks")??""}`)),zt(qr,()=>e(E).repeat_interval,fi=>$e(E,e(E).repeat_interval=fi)),g(ja,or)};X(Ha,ja=>{e(E),m(()=>e(E).repeat_type==="every_n_days"||e(E).repeat_type==="every_n_weeks")&&ja(xa)})}var wa=c(Ha,2);{var Pa=ja=>{var or=bf(),dr=c(o(or),2);At(dr),n(or),zt(dr,()=>e(E).repeat_date,ms=>$e(E,e(E).repeat_date=ms)),g(ja,or)};X(wa,ja=>{e(E),m(()=>e(E).repeat_type==="monthly")&&ja(Pa)})}var Xa=c(wa,2),Za=c(o(Xa),2);R(()=>{e(E),Xt(()=>{})});var Ja=o(Za);Ja.value=Ja.__value="";var nr=c(Ja);Mt(nr,1,()=>he,Lt,(ja,or)=>{var dr=wf(),ms=o(dr,!0);n(dr);var qr={};R(()=>{y(ms,e(or)),qr!==(qr=e(or))&&(dr.value=(dr.__value=e(or))??"")}),g(ja,dr)}),n(Za),n(Xa);var Wa=c(Xa,2),rr=c(o(Wa),2),Ir=o(rr),Es=o(Ir);At(Es),Es.value=Es.__value="never",Et(2),n(Ir);var di=c(Ir,2),Ps=o(di);At(Ps),Ps.value=Ps.__value="after";var vi=c(Ps,4);At(vi),Et(2),n(di);var Ao=c(di,2),ui=o(Ao);At(ui),ui.value=ui.__value="on_date";var kn=c(ui,4);At(kn),n(Ao),n(rr),n(Wa);var So=c(Wa,2),Tn=c(o(So),2);R(()=>{e(E),Xt(()=>{})});var En=o(Tn);En.value=En.__value="";var An=c(En);An.value=An.__value="low";var Sn=c(An);Sn.value=Sn.__value="medium";var Cn=c(Sn);Cn.value=Cn.__value="high";var Co=c(Cn);Co.value=Co.__value="urgent",n(Tn),n(So),n(ca),R(()=>{vi.disabled=(e(E),m(()=>e(E).repeat_end_type!=="after")),kn.disabled=(e(E),m(()=>e(E).repeat_end_type!=="on_date"))}),ra(ua,()=>e(E).repeat_type,ja=>$e(E,e(E).repeat_type=ja)),ra(Za,()=>e(E).time_12h,ja=>$e(E,e(E).time_12h=ja)),gs(s,[],Es,()=>e(E).repeat_end_type,ja=>$e(E,e(E).repeat_end_type=ja)),gs(s,[],Ps,()=>e(E).repeat_end_type,ja=>$e(E,e(E).repeat_end_type=ja)),zt(vi,()=>e(E).repeat_end_count,ja=>$e(E,e(E).repeat_end_count=ja)),gs(s,[],ui,()=>e(E).repeat_end_type,ja=>$e(E,e(E).repeat_end_type=ja)),zt(kn,()=>e(E).repeat_end_date,ja=>$e(E,e(E).repeat_end_date=ja)),ra(Tn,()=>e(E).priority_override,ja=>$e(E,e(E).priority_override=ja)),g(Vt,ca)};X(aa,Vt=>{e(E),m(()=>e(E).assignment_type==="repeat")&&Vt(jt)},!0)}g(ia,ga)};X(Pt,ia=>{e(E),m(()=>e(E).assignment_type==="one_time")?ia(gt):ia(yt,!1)})}var qt=c(Pt,2),sa=c(o(qt),2),oa=o(sa),Ia=o(oa);At(Ia),Et(2),n(oa),Et(2),n(sa),n(qt);var ka=c(qt,2),St=c(o(ka),2),Dt=o(St),Wt=o(Dt);At(Wt),Et(2),n(Dt);var ea=c(Dt,4);ks(ea),n(St),n(ka);var Ht=c(ka,2),Qt=c(o(Ht),2),la=o(Qt),Ft=c(o(la),2),Ct=o(Ft,!0);n(Ft),n(la);var $t=c(la,2),Zt=c(o($t),2),Da=o(Zt,!0);n(Zt),n($t);var ta=c($t,2),Rt=c(o(ta),2),Ut=o(Rt,!0);n(Rt),n(ta),n(Qt);var Jt=c(Qt,2);{var Ma=ia=>{var ga=kf(),aa=c(o(ga)),jt=c(aa);{var Vt=ya=>{var ua=Ya();R(()=>y(ua,`(for ${e(E),m(()=>e(E).repeat_end_count)??""} times)`)),g(ya,ua)},ca=ya=>{var ua=Ca(),va=Bt(ua);{var Ta=xa=>{var wa=Ya();R(()=>y(wa,`(until ${e(E),m(()=>e(E).repeat_end_date)??""})`)),g(xa,wa)},Ha=xa=>{var wa=Ya("(indefinitely)");g(xa,wa)};X(va,xa=>{e(E),m(()=>e(E).repeat_end_type==="on_date")?xa(Ta):xa(Ha,!1)},!0)}g(ya,ua)};X(jt,ya=>{e(E),m(()=>e(E).repeat_end_type==="after")?ya(Vt):ya(ca,!1)})}n(ga),R(ya=>y(aa,` ${ya??""}
							 at ${e(E),m(()=>e(E).time_12h||"specified time")??""} `),[()=>(e(E),m(()=>e(E).repeat_type==="daily"?"Daily":e(E).repeat_type==="weekly"?`Weekly on ${e(E).repeat_days.join(", ")}`:e(E).repeat_type==="every_n_days"?`Every ${e(E).repeat_interval} days`:e(E).repeat_type==="every_n_weeks"?`Every ${e(E).repeat_interval} weeks`:e(E).repeat_type==="monthly"?`Monthly on day ${e(E).repeat_date}`:"Custom schedule"))]),g(ia,ga)},qa=ia=>{var ga=Ca(),aa=Bt(ga);{var jt=Vt=>{var ca=Tf(),ya=c(o(ca));n(ca),R(()=>y(ya,` ${e(E),m(()=>e(E).deadline||"Date not set")??""} at ${e(E),m(()=>e(E).time_12h||"Time not set")??""}`)),g(Vt,ca)};X(aa,Vt=>{e(E),m(()=>e(E).assignment_type==="one_time")&&Vt(jt)},!0)}g(ia,ga)};X(Jt,ia=>{e(E),m(()=>e(E).assignment_type==="repeat")?ia(Ma):ia(qa,!1)})}n(Ht),n(Se);var ar=c(Se,2),Ga=o(ar),Qa=o(Ga),_a=c(Qa,2),Gt=o(_a),Yt=c(Gt,2);n(_a),n(Ga),n(ar),n(ie),R(()=>{wt(it,1,`p-4 border-2 rounded-lg transition-all ${e(E),m(()=>e(E).assignment_type==="one_time"?"border-purple-500 bg-purple-50":"border-gray-200 hover:border-gray-300")??""}`),wt(mt,1,`w-4 h-4 rounded-full border-2 ${e(E),m(()=>e(E).assignment_type==="one_time"?"border-purple-500 bg-purple-500":"border-gray-300")??""}`),wt(ct,1,`p-4 border-2 rounded-lg transition-all ${e(E),m(()=>e(E).assignment_type==="repeat"?"border-purple-500 bg-purple-50":"border-gray-200 hover:border-gray-300")??""}`),wt(bt,1,`w-4 h-4 rounded-full border-2 ${e(E),m(()=>e(E).assignment_type==="repeat"?"border-purple-500 bg-purple-500":"border-gray-300")??""}`),y(Ct,(e(F),m(()=>e(F).size))),y(Da,(e(z),m(()=>e(z).size))),y(Ut,(e(z),e(F),m(()=>e(z).size*e(F).size))),Gt.disabled=e(_),Yt.disabled=(e(z),e(F),m(()=>e(z).size===0||e(F).size===0))}),gs(a,[],Re,()=>e(E).assignment_type,ia=>$e(E,e(E).assignment_type=ia)),gs(a,[],Ge,()=>e(E).assignment_type,ia=>$e(E,e(E).assignment_type=ia)),tr(Ia,()=>e(E).enable_reassigning,ia=>$e(E,e(E).enable_reassigning=ia)),tr(Wt,()=>e(E).notify_assignees,ia=>$e(E,e(E).notify_assignees=ia)),zt(ea,()=>e(E).add_note,ia=>$e(E,e(E).add_note=ia)),Z("click",Qa,()=>le("tasks")),Z("click",Gt,fe),Z("click",Yt,()=>p(ge,"criteria")),g(ne,ie)};X(O,ne=>{e(ge)==="settings"&&ne(te)},!0)}g(M,H)};X(nt,M=>{e(ge)==="tasks"?M(vt):M(xt,!1)},!0)}g(ot,Le)};X(Ce,ot=>{e(ge)==="users"?ot(_e):ot(Ve,!1)})}var Je=c(Ce,2);{var st=ot=>{var Le=Mf(),nt=o(Le),vt=c(o(nt),4),xt=c(o(vt),2),M=o(xt),H=o(M);At(H),H.disabled=!0,Et(2),n(M);var O=c(M,2),te=o(O);At(te),Et(2),n(O);var ne=c(O,2),ie=o(ne);At(ie),Et(2),n(ne),n(xt),n(vt);var Se=c(vt,2),Qe=c(o(Se),2),je=c(o(Qe),2);{var ze=Pt=>{var gt=Af();g(Pt,gt)};X(je,Pt=>{e(E),m(()=>e(E).require_photo_upload)&&Pt(ze)})}var Re=c(je,2);{var it=Pt=>{var gt=Sf();g(Pt,gt)};X(Re,Pt=>{e(E),m(()=>e(E).require_erp_reference)&&Pt(it)})}var ft=c(Re,2);{var mt=Pt=>{var gt=Cf();g(Pt,gt)};X(ft,Pt=>{e(E),m(()=>!e(E).require_photo_upload&&!e(E).require_erp_reference)&&Pt(mt)})}n(Qe),n(Se),n(nt);var ht=c(nt,2),pt=o(ht),_t=o(pt),Ge=c(_t,2),ct=o(Ge),Ze=c(ct,2),bt=o(Ze);{var It=Pt=>{var gt=Ff();Et(2),g(Pt,gt)},Ot=Pt=>{var gt=Df(),yt=c(Bt(gt),2),qt=o(yt);n(yt),R(()=>y(qt,`Assign Tasks (${e(z),m(()=>e(z).size)??""} tasks, ${e(F),m(()=>e(F).size)??""} users)`)),g(Pt,gt)};X(bt,Pt=>{e(_)?Pt(It):Pt(Ot,!1)})}n(Ze),n(Ge),n(pt),n(ht),n(Le),R(()=>{ct.disabled=e(_),Ze.disabled=(e(z),e(F),e(_),m(()=>e(z).size===0||e(F).size===0||e(_))),na(Ze,"title",`Selected Tasks: ${e(z),m(()=>e(z).size)??""}, Selected Users: ${e(F),m(()=>e(F).size)??""}`)}),tr(H,()=>e(E).require_task_finished,Pt=>$e(E,e(E).require_task_finished=Pt)),tr(te,()=>e(E).require_photo_upload,Pt=>$e(E,e(E).require_photo_upload=Pt)),tr(ie,()=>e(E).require_erp_reference,Pt=>$e(E,e(E).require_erp_reference=Pt)),Z("click",_t,()=>p(ge,"settings")),Z("click",ct,fe),Z("click",Ze,B),g(ot,Le)};X(Je,ot=>{e(ge)==="criteria"&&ot(st)})}n(rt),g(Fe,rt)};X(ut,Fe=>{e(h)?Fe(Pe):Fe(qe,!1)})}var tt=c(ut,2);{var lt=Fe=>{var rt=Rf(),Ce=o(rt),_e=o(Ce),Ve=c(_e,2);n(Ce),n(rt),R(()=>na(Ve,"src",e(D))),Z("click",_e,J),Z("click",Ve,ir(function(Je){Or.call(this,r,Je)})),Z("click",rt,J),g(Fe,rt)};X(tt,Fe=>{e(ue)&&Fe(lt)})}n(N);var Xe=c(N,2);{var at=Fe=>{var rt=Nf(),Ce=o(rt),_e=o(Ce),Ve=c(_e,2);n(Ce),n(rt),R(()=>na(Ve,"src",e(D))),Z("click",_e,J),Z("error",Ve,()=>{console.error("Failed to load full-size image:",e(D)),J()}),Z("click",Ce,ir(function(Je){Or.call(this,r,Je)})),Z("click",rt,J),g(Fe,rt)};X(Xe,Fe=>{e(ue)&&e(D)&&Fe(at)})}R(()=>{wt(se,1,`flex items-center space-x-3 ${e(ge)==="users"?"text-purple-600":"text-gray-500"}`),wt(U,1,`w-8 h-8 rounded-full border-2 ${e(ge)==="users"?"border-purple-600 bg-purple-100":"border-gray-300"} flex items-center justify-center`),wt(we,1,`flex items-center space-x-3 ${e(ge)==="tasks"?"text-purple-600":"text-gray-500"}`),wt(Ae,1,`w-8 h-8 rounded-full border-2 ${e(ge)==="tasks"?"border-purple-600 bg-purple-100":"border-gray-300"} flex items-center justify-center`),wt(Oe,1,`flex items-center space-x-3 ${e(ge)==="settings"?"text-purple-600":"text-gray-500"}`),wt(Ee,1,`w-8 h-8 rounded-full border-2 ${e(ge)==="settings"?"border-purple-600 bg-purple-100":"border-gray-300"} flex items-center justify-center`),wt(et,1,`flex items-center space-x-3 ${e(ge)==="criteria"?"text-purple-600":"text-gray-500"}`),wt(dt,1,`w-8 h-8 rounded-full border-2 ${e(ge)==="criteria"?"border-purple-600 bg-purple-100":"border-gray-300"} flex items-center justify-center`)}),Z("click",de,De),Z("click",ve,We),Z("click",Ie,Ne),Z("click",se,()=>le("users")),Z("click",we,()=>le("tasks")),Z("click",Oe,()=>le("settings")),g(t,ke),ma()}var Of=k('<div class="flex items-center justify-center py-8"><div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"></div> <span class="ml-3 text-gray-600">Loading task details...</span></div>'),zf=k('<div class="bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded"> </div>'),Bf=k('<div><span class="font-medium text-gray-700">Scheduled:</span> <div class="ml-2"> </div></div>'),$f=k('<span class="ml-2 px-2 py-1 bg-red-100 text-red-600 text-xs rounded font-medium">OVERDUE</span>'),Uf=k('<div><span class="font-medium text-gray-700">Deadline:</span> <div class="ml-2"> <!></div></div>'),qf=k('<div><span class="font-medium text-gray-700">Priority Override:</span> <span> </span></div>'),jf=k('<div><span class="font-medium text-gray-700">Assignment Notes:</span> <div class="ml-2 text-sm text-gray-600 bg-gray-50 p-2 rounded"> </div></div>'),Wf=k('<div><span class="font-medium text-gray-700">Recurring:</span> <span class="ml-2 px-2 py-1 bg-blue-100 text-blue-600 text-xs rounded font-medium">YES</span></div>'),Hf=k('<div><span class="font-medium text-gray-700">Reassignable:</span> <span class="ml-2 px-2 py-1 bg-green-100 text-green-600 text-xs rounded font-medium">YES</span></div>'),Vf=k('<div class="space-y-3"><!> <!> <!> <!> <!> <!></div>'),Gf=k('<div class="text-gray-500 text-sm">No assignment details available</div>'),Xf=k('<div class="bg-blue-50 border border-blue-200 p-3 rounded"><div class="flex items-center text-blue-700"><svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path></svg> Task Completion Required</div></div>'),Yf=k('<div class="bg-yellow-50 border border-yellow-200 p-3 rounded"><div class="flex items-center text-yellow-700"><svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M4 3a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V5a2 2 0 00-2-2H4zm12 12H4l4-8 3 6 2-4 3 6z" clip-rule="evenodd"></path></svg> Photo Upload Required</div></div>'),Kf=k('<div class="bg-green-50 border border-green-200 p-3 rounded"><div class="flex items-center text-green-700"><svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M3 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd"></path></svg> ERP Reference Required</div></div>'),Qf=k('<div class="space-y-4"><h3 class="text-lg font-semibold text-gray-900 border-b pb-2">Requirements</h3> <div class="grid grid-cols-1 md:grid-cols-3 gap-4"><!> <!> <!></div></div>'),Zf=k('<div class="border border-gray-200 rounded-lg overflow-hidden bg-white shadow-sm hover:shadow-md transition-shadow"><div class="relative aspect-video bg-gray-50 svelte-dgy2i7"><img class="w-full h-full object-contain cursor-pointer hover:opacity-90 transition-opacity svelte-dgy2i7"/> <div class="absolute inset-0 bg-red-100 border-2 border-red-300 border-dashed rounded flex items-center justify-center text-red-600 text-sm" style="display: none;"><div class="text-center"><svg class="w-8 h-8 mx-auto mb-2" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path></svg> <p>Image unavailable</p></div></div></div> <div class="p-2 bg-gray-50 border-t"><p class="text-xs text-gray-600 truncate"> </p></div></div>'),Jf=k('<div class="space-y-4"><h3 class="text-lg font-semibold text-gray-900 border-b pb-2"> </h3> <div class="grid grid-cols-1 md:grid-cols-2 gap-4"></div></div>'),ep=k('<div class="space-y-4"><h3 class="text-lg font-semibold text-gray-900 border-b pb-2">Task Images</h3> <div class="text-center py-8 text-gray-500"><svg class="w-12 h-12 mx-auto text-gray-300 mb-2" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M4 3a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V5a2 2 0 00-2-2H4zm12 12H4l4-8 3 6 2-4 3 6z" clip-rule="evenodd"></path></svg> <p>No images attached to this task</p></div></div>'),tp=k('<button class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg text-sm font-medium transition-colors flex items-center space-x-2"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg> <span>Complete Task</span></button>'),ap=k('<div class="px-4 py-2 bg-gray-100 text-gray-600 rounded-lg text-sm font-medium"> </div>'),rp=k('<div class="border-b pb-4"><div class="flex items-start justify-between"><div class="flex-1"><h2 class="text-xl font-bold text-gray-900"> </h2> <p class="text-gray-600 mt-2"> </p></div> <div class="ml-4 flex space-x-2"><span> </span> <span> </span></div></div></div> <div class="grid grid-cols-1 lg:grid-cols-2 gap-6"><div class="space-y-4"><h3 class="text-lg font-semibold text-gray-900 border-b pb-2">Task Information</h3> <div class="space-y-3"><div><span class="font-medium text-gray-700">Created by:</span> <div class="ml-2"> </div></div> <div><span class="font-medium text-gray-700">Assigned:</span> <div class="ml-2"> </div></div></div></div> <div class="space-y-4"><h3 class="text-lg font-semibold text-gray-900 border-b pb-2">Assignment Details</h3> <!></div></div> <!> <!> <div class="pt-4 border-t flex space-x-3"><!> <button class="bg-gray-100 hover:bg-gray-200 text-gray-700 px-4 py-2 rounded-lg text-sm font-medium transition-colors flex items-center space-x-2"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg> <span>Close</span></button></div>',1),sp=k('<div class="task-details-modal p-6 space-y-6 bg-white svelte-dgy2i7"><!></div>');function ip(t,r){pa(r,!1);let a=Ra(r,"task",8),s=Ra(r,"windowId",8),i=Ra(r,"onTaskCompleted",8,()=>{}),l=Q([]),d=Q(null),v=Q(""),u=Q(!0),f=Q("");Aa(async()=>{await h()});async function h(){try{p(u,!0),p(f,""),console.log("🔍 [TaskDetails] Task data:",a());const D=await fa.taskImages.getByTaskId(a().id);if(D.error?console.error("❌ [TaskDetails] Error loading task images:",D.error):(p(l,D.data||[]),console.log("✅ [TaskDetails] Loaded",e(l).length,"images")),a().assignment_id){const E=await fa.taskAssignments.getById(a().assignment_id);E.error?console.error("❌ [TaskDetails] Error loading assignment details:",E.error):p(d,E.data)}if(a().created_by&&a().created_by.length>30)try{const E=await fa.users.getById(a().created_by);!E.error&&E.data&&p(v,E.data.username||E.data.name||"Unknown User")}catch(E){console.error("Error loading user:",E)}}catch(D){console.error("💥 [TaskDetails] Error loading task details:",D),p(f,"Failed to load task details")}finally{p(u,!1)}}function _(D){return D?new Date(D).toLocaleDateString():"No due date"}function x(D){return D?D.slice(0,5):""}function T(D,E=null){if(!D)return"Not set";let xe=new Date(D).toLocaleDateString();return E&&(xe+=` at ${x(E)}`),xe}function b(D,E=null){if(!D)return!1;const he=new Date,xe=new Date(D);if(E){const[K,q]=E.split(":");xe.setHours(parseInt(K),parseInt(q))}return he>xe}function w(D){switch(D){case"high":return"text-red-600 bg-red-100";case"medium":return"text-yellow-600 bg-yellow-100";case"low":return"text-green-600 bg-green-100";default:return"text-gray-600 bg-gray-100"}}function A(D){switch(D){case"pending":return"text-blue-600 bg-blue-100";case"in_progress":return"text-yellow-600 bg-yellow-100";case"completed":return"text-green-600 bg-green-100";case"cancelled":return"text-red-600 bg-red-100";default:return"text-gray-600 bg-gray-100"}}function C(){const D=`task-completion-${a().id}`;Kt.openWindow({id:D,title:`Complete Task: ${a().title}`,component:Kn,props:{task:a(),assignmentId:a().assignment_id,onTaskCompleted:()=>{i()(),Kt.closeWindow(D),Kt.closeWindow(s())}},icon:"✅",size:{width:600,height:700},position:{x:120+Math.random()*200,y:70+Math.random()*100},resizable:!0,minimizable:!0,maximizable:!0,closable:!0})}function z(){Kt.closeWindow(s())}ha();var F=sp(),re=o(F);{var me=D=>{var E=Of();g(D,E)},ue=D=>{var E=Ca(),he=Bt(E);{var xe=q=>{var ae=zf(),Me=o(ae,!0);n(ae),R(()=>y(Me,e(f))),g(q,ae)},K=q=>{var ae=rp(),Me=Bt(ae),ge=o(Me),Ne=o(ge),Be=o(Ne),be=o(Be,!0);n(Be);var L=c(Be,2),Te=o(L,!0);n(L),n(Ne);var ye=c(Ne,2),P=o(ye),pe=o(P,!0);n(P);var B=c(P,2),j=o(B,!0);n(B),n(ye),n(ge),n(Me);var I=c(Me,2),Y=o(I),fe=c(o(Y),2),ce=o(fe),J=c(o(ce),2),le=o(J,!0);n(J),n(ce);var S=c(ce,2),De=c(o(S),2),Ue=o(De,!0);n(De),n(S),n(fe),n(Y);var We=c(Y,2),ke=c(o(We),2);{var N=we=>{var Ae=Vf(),He=o(Ae);{var Ke=at=>{var Fe=Bf(),rt=c(o(Fe),2),Ce=o(rt,!0);n(rt),n(Fe),R(_e=>y(Ce,_e),[()=>(e(d),m(()=>T(e(d).schedule_date,e(d).schedule_time)))]),g(at,Fe)};X(He,at=>{e(d),m(()=>e(d).schedule_date||e(d).schedule_time)&&at(Ke)})}var Oe=c(He,2);{var Ee=at=>{var Fe=Uf(),rt=c(o(Fe),2),Ce=o(rt),_e=c(Ce);{var Ve=Je=>{var st=$f();g(Je,st)};X(_e,Je=>{e(d),m(()=>b(e(d).deadline_date,e(d).deadline_time))&&Je(Ve)})}n(rt),n(Fe),R(Je=>y(Ce,`${Je??""} `),[()=>(e(d),m(()=>T(e(d).deadline_date,e(d).deadline_time)))]),g(at,Fe)};X(Oe,at=>{e(d),m(()=>e(d).deadline_date||e(d).deadline_time)&&at(Ee)})}var et=c(Oe,2);{var dt=at=>{var Fe=qf(),rt=c(o(Fe),2),Ce=o(rt,!0);n(rt),n(Fe),R((_e,Ve)=>{wt(rt,1,`ml-2 px-2 py-1 rounded text-xs font-medium ${_e??""}`,"svelte-dgy2i7"),y(Ce,Ve)},[()=>(e(d),m(()=>w(e(d).priority_override))),()=>(e(d),m(()=>e(d).priority_override.toUpperCase()))]),g(at,Fe)};X(et,at=>{e(d),m(()=>e(d).priority_override)&&at(dt)})}var ut=c(et,2);{var Pe=at=>{var Fe=jf(),rt=c(o(Fe),2),Ce=o(rt,!0);n(rt),n(Fe),R(()=>y(Ce,(e(d),m(()=>e(d).notes)))),g(at,Fe)};X(ut,at=>{e(d),m(()=>e(d).notes)&&at(Pe)})}var qe=c(ut,2);{var tt=at=>{var Fe=Wf();g(at,Fe)};X(qe,at=>{e(d),m(()=>e(d).is_recurring)&&at(tt)})}var lt=c(qe,2);{var Xe=at=>{var Fe=Hf();g(at,Fe)};X(lt,at=>{e(d),m(()=>e(d).is_reassignable)&&at(Xe)})}n(Ae),g(we,Ae)},V=we=>{var Ae=Gf();g(we,Ae)};X(ke,we=>{e(d)?we(N):we(V,!1)})}n(We),n(I);var G=c(I,2);{var de=we=>{var Ae=Qf(),He=c(o(Ae),2),Ke=o(He);{var Oe=Pe=>{var qe=Xf();g(Pe,qe)};X(Ke,Pe=>{e(d),m(()=>e(d).require_task_finished)&&Pe(Oe)})}var Ee=c(Ke,2);{var et=Pe=>{var qe=Yf();g(Pe,qe)};X(Ee,Pe=>{e(d),m(()=>e(d).require_photo_upload)&&Pe(et)})}var dt=c(Ee,2);{var ut=Pe=>{var qe=Kf();g(Pe,qe)};X(dt,Pe=>{e(d),m(()=>e(d).require_erp_reference)&&Pe(ut)})}n(He),n(Ae),g(we,Ae)};X(G,we=>{e(d),m(()=>e(d)&&(e(d).require_task_finished||e(d).require_photo_upload||e(d).require_erp_reference))&&we(de)})}var ve=c(G,2);{var Ie=we=>{var Ae=Jf(),He=o(Ae),Ke=o(He);n(He);var Oe=c(He,2);Mt(Oe,5,()=>e(l),Lt,(Ee,et)=>{var dt=Zf(),ut=o(dt),Pe=o(ut);Et(2),n(ut);var qe=c(ut,2),tt=o(qe),lt=o(tt,!0);n(tt),n(qe),n(dt),R(()=>{na(Pe,"src",(e(et),m(()=>e(et).file_url))),na(Pe,"alt",(e(et),m(()=>e(et).file_name||"Task image"))),na(tt,"title",(e(et),m(()=>e(et).file_name))),y(lt,(e(et),m(()=>e(et).file_name||"Untitled")))}),Z("click",Pe,()=>window.open(e(et).file_url,"_blank")),Z("error",Pe,Xe=>{console.error("🖼️ Image failed to load"),Xe.target.style.display="none",Xe.target.nextElementSibling.style.display="flex"}),Z("load",Pe,()=>{console.log("✅ Image loaded successfully")}),g(Ee,dt)}),n(Oe),n(Ae),R(()=>y(Ke,`Task Images (${e(l),m(()=>e(l).length)??""})`)),g(we,Ae)},Ye=we=>{var Ae=ep();g(we,Ae)};X(ve,we=>{e(l),m(()=>e(l)&&e(l).length>0)?we(Ie):we(Ye,!1)})}var oe=c(ve,2),se=o(oe);{var U=we=>{var Ae=tp();Z("click",Ae,C),g(we,Ae)},W=we=>{var Ae=ap(),He=o(Ae);n(Ae),R(()=>y(He,`Task ${kt(a()),m(()=>a().assignment_status==="completed"?"Completed":"Cancelled")??""}`)),g(we,Ae)};X(se,we=>{kt(a()),m(()=>a().assignment_status!=="completed"&&a().assignment_status!=="cancelled")?we(U):we(W,!1)})}var ee=c(se,2);n(oe),R((we,Ae,He,Ke,Oe)=>{y(be,(kt(a()),m(()=>a().title))),y(Te,(kt(a()),m(()=>a().description||"No description provided"))),wt(P,1,`px-2 py-1 rounded text-xs font-medium ${we??""}`,"svelte-dgy2i7"),y(pe,Ae),wt(B,1,`px-2 py-1 rounded text-xs font-medium ${He??""}`,"svelte-dgy2i7"),y(j,Ke),y(le,(e(v),kt(a()),m(()=>e(v)||a().created_by_name||a().created_by_username||a().assigned_by_name||a().assigned_by_username||"Unknown User"))),y(Ue,Oe)},[()=>(kt(a()),m(()=>w(a().priority))),()=>(kt(a()),m(()=>(a().priority||"Not set").toUpperCase())),()=>(kt(a()),m(()=>A(a().assignment_status))),()=>(kt(a()),m(()=>(a().assignment_status||"Unknown").replace("_"," ").toUpperCase())),()=>(kt(a()),m(()=>_(a().assigned_at)))]),Z("click",ee,z),g(q,ae)};X(he,q=>{e(f)?q(xe):q(K,!1)},!0)}g(D,E)};X(re,D=>{e(u)?D(me):D(ue,!1)})}n(F),g(t,F),ma()}var np=k('<div class="flex items-center justify-center h-64"><div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"></div></div>'),op=k('<div class="text-center py-12"><svg class="w-16 h-16 text-gray-400 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"></path></svg> <h3 class="text-lg font-medium text-gray-900 mb-2">No tasks found</h3> <p class="text-gray-600">No tasks match your current filters.</p></div>'),lp=k('<div class="absolute -top-1 -right-1 bg-blue-500 text-white text-xs px-1 py-0.5 rounded-full text-[10px] font-medium"> </div>'),cp=k('<div class="relative group"><button class="relative w-20 h-20 rounded-lg overflow-hidden border-2 border-gray-200 hover:border-blue-400 transition-colors group-hover:shadow-md"><img class="w-full h-full object-cover" loading="lazy"/> <div class="absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-20 transition-all flex items-center justify-center"><svg class="w-5 h-5 text-white opacity-0 group-hover:opacity-100 transition-opacity" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg></div></button> <!></div>'),dp=k('<div class="text-xs text-gray-500 mt-1"> </div>'),vp=k('<div class="mb-4"><div class="flex items-center space-x-2 mb-2"><svg class="w-4 h-4 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg> <span class="text-sm font-medium text-gray-700"> </span></div> <div class="flex flex-wrap gap-2 max-h-32 overflow-y-auto"></div> <!></div>'),up=k('<span class="inline-flex items-center px-2 py-0.5 ml-2 text-xs font-medium bg-red-100 text-red-800 rounded-full">⚠️ OVERDUE</span>'),fp=k('<div class="col-span-2"><span class="font-medium">Deadline:</span> <span> <!></span></div>'),pp=k('<div class="col-span-2"><span class="font-medium">Deadline:</span> <span class="text-gray-500">No deadline set</span></div>'),hp=k('<div><span class="font-medium">Scheduled:</span> <!></div>'),mp=k('<button class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg text-sm font-medium transition-colors flex items-center space-x-2"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg> <span>Complete</span></button>'),_p=k('<div class="bg-white rounded-lg shadow-sm border hover:shadow-md transition-shadow"><div class="p-6"><div class="flex items-start justify-between"><div class="flex-1"><div class="flex items-center space-x-3 mb-2"><h3 class="text-lg font-semibold text-gray-900"> </h3> <span> </span> <span> </span></div> <p class="text-gray-600 mb-3"> </p> <!> <div class="grid grid-cols-2 gap-4 text-sm text-gray-500"><div><span class="font-medium">Priority:</span> </div> <div><span class="font-medium">Task Status:</span> </div> <!> <!> <div><span class="font-medium">Assignment Status:</span> <span> </span></div> <div><span class="font-medium">Assigned by:</span> </div> <div><span class="font-medium">Assigned to:</span> </div> <div><span class="font-medium">Assigned on:</span> </div> <div><span class="font-medium">Created by:</span> </div></div></div> <div class="ml-4 flex flex-col space-y-2"><!> <button class="bg-gray-100 hover:bg-gray-200 text-gray-700 px-4 py-2 rounded-lg text-sm font-medium transition-colors flex items-center space-x-2"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path></svg> <span>View Details</span></button></div></div></div></div>'),gp=k('<div class="grid gap-4"></div>'),xp=k('<div class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50"><div class="relative max-w-6xl max-h-screen p-4 w-full"><button class="absolute top-4 right-4 bg-black bg-opacity-60 text-white rounded-full p-3 hover:bg-opacity-80 transition-all z-10 backdrop-blur-sm" title="Close image viewer"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg></button> <div class="flex items-center justify-center h-full"><div class="relative"><img alt="Task image full size" class="max-w-full max-h-[90vh] object-contain rounded-lg shadow-2xl" loading="lazy"/> <div class="absolute inset-0 flex items-center justify-center bg-gray-100 rounded-lg" style="display: none;" id="image-loading"><div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"></div></div></div></div> <div class="absolute bottom-4 left-4 bg-black bg-opacity-60 text-white px-4 py-2 rounded-lg backdrop-blur-sm"><div class="text-sm"><div class="font-medium">Task Image</div> <div class="text-gray-300 text-xs">Click outside to close</div></div></div></div></div>'),bp=k('<div class="my-tasks-view h-full flex flex-col bg-gray-50 svelte-1v2t6qk"><div class="bg-white shadow-sm border-b p-6"><div class="flex items-center justify-between"><div><h1 class="text-2xl font-bold text-gray-900">My Tasks</h1> <p class="text-gray-600 mt-1">Tasks assigned to you</p></div> <div class="flex items-center space-x-2"><span class="text-sm text-gray-500"> </span> <button class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg text-sm font-medium transition-colors">Refresh</button></div></div></div> <div class="bg-white border-b p-4 space-y-4"><div class="grid grid-cols-1 md:grid-cols-3 gap-4"><div><label class="block text-sm font-medium text-gray-700 mb-1">Search</label> <input type="text" placeholder="Search tasks..." class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"/></div> <div><label class="block text-sm font-medium text-gray-700 mb-1">Status</label> <select class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"><option>All Status</option><option>Pending</option><option>In Progress</option><option>Completed</option><option>Cancelled</option></select></div> <div><label class="block text-sm font-medium text-gray-700 mb-1">Priority</label> <select class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"><option>All Priorities</option><option>High</option><option>Medium</option><option>Low</option></select></div></div></div> <div class="flex-1 overflow-y-auto p-6"><!></div></div> <!>',1);function wp(t,r){pa(r,!1);const a=()=>sr(us,"$currentUser",i),s=()=>sr(jl,"$isAuthenticated",i),[i,l]=Zr(),d=Q(),v=Q();let u=[],f=Q([]),h=Q(!0),_=Q(""),x=Q("all"),T=Q("all"),b=null,w=Q(!1),A=Q("");Aa(()=>{var U;return e(v)&&((U=e(d))!=null&&U.id)&&C(),K(),()=>{q()}});async function C(){var W;let U=(W=e(d))==null?void 0:W.id;if(console.log("🔍 [MyTasks] Attempting to get user ID:",{currentUserData:e(d),authenticated:e(v),userId:U}),!e(v)||!U){console.warn("❌ [MyTasks] No current user ID available or not authenticated"),p(h,!1);return}console.log("🔄 [MyTasks] Loading tasks for user:",U),p(h,!0);try{const{data:ee,error:we}=await Tt.from("task_assignments").select(`
					*,
					task:tasks!inner(
						id,
						title,
						description,
						priority,
						due_date,
						due_time,
						status,
						created_at,
						created_by,
						created_by_name,
						created_by_role
					)
				`).eq("assigned_to_user_id",U).order("assigned_at",{ascending:!1});if(console.log("📊 [MyTasks] Query result:",{data:ee,error:we,userID:U}),we)throw we;u=await Promise.all(ee.map(async He=>{const{data:Ke,error:Oe}=await Tt.from("task_images").select("*").eq("task_id",He.task.id);Oe&&console.error("Error loading task images:",Oe);let Ee="Unknown User";if(He.assigned_by)if(He.assigned_by.includes("-")&&He.assigned_by.length===36)try{const{data:et,error:dt}=await Tt.from("users").select(`
										id,
										username,
										hr_employees!employee_id(
											name
										)
									`).eq("id",He.assigned_by).single();!dt&&et&&(et.hr_employees&&et.hr_employees.length>0?Ee=et.hr_employees[0].name:Ee=et.username)}catch(et){console.error("Error fetching assigned_by user:",et)}else Ee=He.assigned_by;return Ee==="Unknown User"&&He.assigned_by_name&&(Ee=He.assigned_by_name),{...He.task,assignment_id:He.id,assignment_status:He.status,assigned_at:He.assigned_at,assigned_by:He.assigned_by,assigned_by_name:Ee,assigned_to_user_id:He.assigned_to_user_id,schedule_date:He.schedule_date,schedule_time:He.schedule_time,deadline_date:He.deadline_date,deadline_time:He.deadline_time,deadline_datetime:He.deadline_datetime,require_task_finished:He.require_task_finished??!1,require_photo_upload:He.require_photo_upload??!1,require_erp_reference:He.require_erp_reference??!1,images:Ke||[]}})),z(),console.log("✅ [MyTasks] Successfully loaded tasks:",u.length)}catch(ee){console.error("❌ [MyTasks] Error loading my tasks:",ee)}finally{p(h,!1)}}function z(){p(f,u.filter(U=>{const W=U.title.toLowerCase().includes(e(_).toLowerCase())||U.description.toLowerCase().includes(e(_).toLowerCase()),ee=e(x)==="all"||U.assignment_status===e(x),we=e(T)==="all"||U.priority===e(T);return W&&ee&&we}))}function F(U){const W=`task-completion-${U.id}`;Kt.openWindow({id:W,title:`Complete Task: ${U.title}`,component:Kn,props:{task:U,assignmentId:U.assignment_id,requireTaskFinished:U.require_task_finished??!1,requirePhotoUpload:U.require_photo_upload??!1,requireErpReference:U.require_erp_reference??!1,onTaskCompleted:()=>{C(),Kt.closeWindow(W)}},icon:"✅",size:{width:600,height:700},position:{x:100+Math.random()*200,y:50+Math.random()*100},resizable:!0,minimizable:!0,maximizable:!0,closable:!0})}function re(U){const W=`task-details-${U.id}`;Kt.openWindow({id:W,title:`Task Details: ${U.title}`,component:ip,props:{task:U,windowId:W,onTaskCompleted:()=>{C()}},icon:"📋",size:{width:800,height:600},position:{x:150+Math.random()*100,y:100+Math.random()*50},resizable:!0,minimizable:!0,maximizable:!0,closable:!0})}function me(U){return U?new Date(U).toLocaleDateString():""}function ue(U){return U?U.slice(0,5):""}function D(U){switch(U){case"high":return"text-red-600 bg-red-100";case"medium":return"text-yellow-600 bg-yellow-100";case"low":return"text-green-600 bg-green-100";default:return"text-gray-600 bg-gray-100"}}function E(U){switch(U){case"pending":return"text-blue-600 bg-blue-100";case"in_progress":return"text-yellow-600 bg-yellow-100";case"completed":return"text-green-600 bg-green-100";case"cancelled":return"text-red-600 bg-red-100";default:return"text-gray-600 bg-gray-100"}}function he(U,W){if(!U)return!1;const ee=new Date,we=new Date(U);if(W){const[Ae,He]=W.split(":");we.setHours(parseInt(Ae),parseInt(He))}return ee>we}function xe(U,W){if(!U)return{text:"No deadline set",class:"text-gray-500"};if(he(U,W)){const dt=me(U),ut=W?` at ${ue(W)}`:"";return{text:`${dt}${ut}`,class:"text-red-600 font-semibold",isOverdue:!0}}const we=new Date,Ae=new Date(U);if(W){const[dt,ut]=W.split(":");Ae.setHours(parseInt(dt),parseInt(ut))}const He=Ae.getTime()-we.getTime();if(He<=0)return{text:"Overdue",class:"text-red-600 font-semibold",isOverdue:!0};const Ke=Math.floor(He/(1e3*60*60*24)),Oe=Math.floor(He%(1e3*60*60*24)/(1e3*60*60)),Ee=Math.floor(He%(1e3*60*60)/(1e3*60));let et="";return Ke>0&&(et+=`${Ke} day${Ke!==1?"s":""}`),Oe>0&&(et&&(et+=", "),et+=`${Oe} hour${Oe!==1?"s":""}`),(Ee>0||et==="")&&(et&&(et+=", "),et+=`${Ee} minute${Ee!==1?"s":""}`),et+=" remaining",{text:et,class:Ke>1?"text-gray-700":Ke>=1?"text-yellow-600 font-medium":"text-red-600 font-semibold",isOverdue:!1}}function K(){b&&clearInterval(b),b=setInterval(()=>{u=[...u]},6e4)}function q(){b&&(clearInterval(b),b=null)}function ae(U){p(A,U),p(w,!0)}function Me(){p(w,!1),p(A,"")}Nt(()=>a(),()=>{p(d,a())}),Nt(()=>s(),()=>{p(v,s())}),Nt(()=>(e(v),e(d)),()=>{console.log("🔍 [MyTasks] Auth state:",{authenticated:e(v),currentUserData:e(d)})}),Nt(()=>(e(v),e(d)),()=>{var U;e(v)&&((U=e(d))!=null&&U.id)&&C()}),Nt(()=>{},()=>{z()}),Va(),ha();var ge=bp(),Ne=Bt(ge),Be=o(Ne),be=o(Be),L=c(o(be),2),Te=o(L),ye=o(Te);n(Te);var P=c(Te,2);n(L),n(be),n(Be);var pe=c(Be,2),B=o(pe),j=o(B),I=c(o(j),2);At(I),n(j);var Y=c(j,2),fe=c(o(Y),2);R(()=>{e(x),Xt(()=>{})});var ce=o(fe);ce.value=ce.__value="all";var J=c(ce);J.value=J.__value="pending";var le=c(J);le.value=le.__value="in_progress";var S=c(le);S.value=S.__value="completed";var De=c(S);De.value=De.__value="cancelled",n(fe),n(Y);var Ue=c(Y,2),We=c(o(Ue),2);R(()=>{e(T),Xt(()=>{})});var ke=o(We);ke.value=ke.__value="all";var N=c(ke);N.value=N.__value="high";var V=c(N);V.value=V.__value="medium";var G=c(V);G.value=G.__value="low",n(We),n(Ue),n(B),n(pe);var de=c(pe,2),ve=o(de);{var Ie=U=>{var W=np();g(U,W)},Ye=U=>{var W=Ca(),ee=Bt(W);{var we=He=>{var Ke=op();g(He,Ke)},Ae=He=>{var Ke=gp();Mt(Ke,5,()=>e(f),Oe=>Oe.assignment_id,(Oe,Ee)=>{var et=_p(),dt=o(et),ut=o(dt),Pe=o(ut),qe=o(Pe),tt=o(qe),lt=o(tt,!0);n(tt);var Xe=c(tt,2),at=o(Xe,!0);n(Xe);var Fe=c(Xe,2),rt=o(Fe,!0);n(Fe),n(qe);var Ce=c(qe,2),_e=o(Ce,!0);n(Ce);var Ve=c(Ce,2);{var Je=Ze=>{var bt=vp(),It=o(bt),Ot=c(o(It),2),Pt=o(Ot);n(Ot),n(It);var gt=c(It,2);Mt(gt,5,()=>(e(Ee),m(()=>e(Ee).images)),sa=>sa.id,(sa,oa)=>{var Ia=cp(),ka=o(Ia),St=o(ka);Et(2),n(ka);var Dt=c(ka,2);{var Wt=ea=>{var Ht=lp(),Qt=o(Ht,!0);n(Ht),R(la=>y(Qt,la),[()=>(e(oa),m(()=>e(oa).image_type.toUpperCase()))]),g(ea,Ht)};X(Dt,ea=>{e(oa),m(()=>e(oa).image_type)&&ea(Wt)})}n(Ia),R(()=>{na(ka,"title",`Click to view full size - ${e(oa),m(()=>e(oa).file_name||"Image")??""}`),na(St,"src",(e(oa),m(()=>e(oa).file_url))),na(St,"alt",(e(oa),m(()=>e(oa).file_name||"Task image")))}),Z("error",St,ea=>{ea.target.src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZD0iTTEyIDJMMTMuMDkgOC4yNkwyMCA5TDEzLjA5IDE1Ljc0TDEyIDIyTDEwLjkxIDE1Ljc0TDQgOUwxMC45MSA4LjI2TDEyIDJaIiBmaWxsPSIjOUNBM0FGIi8+Cjwvc3ZnPgo=",ea.target.classList.add("bg-gray-100")}),Z("click",ka,()=>ae(e(oa).file_url)),g(sa,Ia)}),n(gt);var yt=c(gt,2);{var qt=sa=>{var oa=dp(),Ia=o(oa);n(oa),R(ka=>y(Ia,`Showing ${ka??""} of ${e(Ee),m(()=>e(Ee).images.length)??""} images`),[()=>(e(Ee),m(()=>Math.min(8,e(Ee).images.length)))]),g(sa,oa)};X(yt,sa=>{e(Ee),m(()=>e(Ee).images.length>8)&&sa(qt)})}n(bt),R(()=>y(Pt,`Task Images (${e(Ee),m(()=>e(Ee).images.length)??""})`)),g(Ze,bt)};X(Ve,Ze=>{e(Ee),m(()=>e(Ee).images&&e(Ee).images.length>0)&&Ze(Je)})}var st=c(Ve,2),ot=o(st),Le=c(o(ot));n(ot);var nt=c(ot,2),vt=c(o(nt));n(nt);var xt=c(nt,2);{var M=Ze=>{const bt=$i(()=>(e(Ee),m(()=>xe(e(Ee).deadline_date,e(Ee).deadline_time))));var It=fp(),Ot=c(o(It),2),Pt=o(Ot),gt=c(Pt);{var yt=qt=>{var sa=up();g(qt,sa)};X(gt,qt=>{kt(e(bt)),m(()=>e(bt).isOverdue)&&qt(yt)})}n(Ot),n(It),R(()=>{wt(Ot,1,(kt(e(bt)),m(()=>e(bt).class)),"svelte-1v2t6qk"),y(Pt,`${kt(e(bt)),m(()=>e(bt).text)??""} `)}),g(Ze,It)},H=Ze=>{var bt=pp();g(Ze,bt)};X(xt,Ze=>{e(Ee),m(()=>e(Ee).deadline_date)?Ze(M):Ze(H,!1)})}var O=c(xt,2);{var te=Ze=>{var bt=hp(),It=c(o(bt)),Ot=c(It);{var Pt=gt=>{var yt=Ya();R(qt=>y(yt,`at ${qt??""}`),[()=>(e(Ee),m(()=>ue(e(Ee).schedule_time)))]),g(gt,yt)};X(Ot,gt=>{e(Ee),m(()=>e(Ee).schedule_time)&&gt(Pt)})}n(bt),R(gt=>y(It,` ${gt??""} `),[()=>(e(Ee),m(()=>me(e(Ee).schedule_date)))]),g(Ze,bt)};X(O,Ze=>{e(Ee),m(()=>e(Ee).schedule_date)&&Ze(te)})}var ne=c(O,2),ie=c(o(ne),2),Se=o(ie,!0);n(ie),n(ne);var Qe=c(ne,2),je=c(o(Qe));n(Qe);var ze=c(Qe,2),Re=c(o(ze));n(ze);var it=c(ze,2),ft=c(o(it));n(it);var mt=c(it,2),ht=c(o(mt));n(mt),n(st),n(Pe);var pt=c(Pe,2),_t=o(pt);{var Ge=Ze=>{var bt=mp();Z("click",bt,()=>F(e(Ee))),g(Ze,bt)};X(_t,Ze=>{e(Ee),m(()=>e(Ee).assignment_status!=="completed"&&e(Ee).assignment_status!=="cancelled")&&Ze(Ge)})}var ct=c(_t,2);n(pt),n(ut),n(dt),n(et),R((Ze,bt,It,Ot,Pt,gt,yt)=>{y(lt,(e(Ee),m(()=>e(Ee).title))),wt(Xe,1,`px-2 py-1 rounded-full text-xs font-medium ${Ze??""}`,"svelte-1v2t6qk"),y(at,bt),wt(Fe,1,`px-2 py-1 rounded-full text-xs font-medium ${It??""}`,"svelte-1v2t6qk"),y(rt,Ot),y(_e,(e(Ee),m(()=>e(Ee).description))),y(Le,` ${e(Ee),m(()=>e(Ee).priority||"Not set")??""}`),y(vt,` ${e(Ee),m(()=>e(Ee).status||"Unknown")??""}`),wt(ie,1,`px-2 py-1 rounded-full text-xs font-medium ${Pt??""}`,"svelte-1v2t6qk"),y(Se,gt),y(je,` ${e(Ee),m(()=>e(Ee).assigned_by_name||"Unknown")??""}`),y(Re,` ${e(d),m(()=>{var qt,sa;return((qt=e(d))==null?void 0:qt.name)||((sa=e(d))==null?void 0:sa.username)||"You"})??""}`),y(ft,` ${yt??""}`),y(ht,` ${e(Ee),m(()=>e(Ee).created_by_name||e(Ee).created_by||"Unknown")??""}`)},[()=>(e(Ee),m(()=>D(e(Ee).priority))),()=>(e(Ee),m(()=>{var Ze;return(Ze=e(Ee).priority)==null?void 0:Ze.toUpperCase()})),()=>(e(Ee),m(()=>E(e(Ee).assignment_status))),()=>(e(Ee),m(()=>{var Ze;return(Ze=e(Ee).assignment_status)==null?void 0:Ze.replace("_"," ").toUpperCase()})),()=>(e(Ee),m(()=>E(e(Ee).assignment_status))),()=>(e(Ee),m(()=>{var Ze;return(Ze=e(Ee).assignment_status)==null?void 0:Ze.replace("_"," ").toUpperCase()})),()=>(e(Ee),m(()=>me(e(Ee).assigned_at)))]),Z("click",ct,()=>re(e(Ee))),g(Oe,et)}),n(Ke),g(He,Ke)};X(ee,He=>{e(f),m(()=>e(f).length===0)?He(we):He(Ae,!1)},!0)}g(U,W)};X(ve,U=>{e(h)?U(Ie):U(Ye,!1)})}n(de),n(Ne);var oe=c(Ne,2);{var se=U=>{var W=xp(),ee=o(W),we=o(ee),Ae=c(we,2),He=o(Ae),Ke=o(He);Et(2),n(He),n(Ae),Et(2),n(ee),n(W),R(()=>na(Ke,"src",e(A))),Z("click",we,Me),Z("error",Ke,Oe=>{Oe.target.src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZD0iTTEyIDJMMTMuMDkgOC4yNkwyMCA5TDEzLjA5IDE1Ljc0TDEyIDIyTDEwLjkxIDE1Ljc0TDQgOUwxMC45MSA4LjI2TDEyIDJaIiBmaWxsPSIjOUNBM0FGIi8+Cjwvc3ZnPgo="}),Z("click",ee,ir(function(Oe){Or.call(this,r,Oe)})),Z("click",W,Me),g(U,W)};X(oe,U=>{e(w)&&U(se)})}R(()=>y(ye,`Total: ${e(f),m(()=>e(f).length)??""}`)),Z("click",P,C),zt(I,()=>e(_),U=>p(_,U)),ra(fe,()=>e(x),U=>p(x,U)),ra(We,()=>e(T),U=>p(T,U)),g(t,ge),ma(),l()}var yp=hr('<svg class="w-4 h-4 svelte-aaur0b" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" class="svelte-aaur0b"></path></svg> Save',1),kp=hr('<svg class="w-4 h-4 svelte-aaur0b" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z" class="svelte-aaur0b"></path></svg> ',1),Tp=k('<textarea class="warning-textarea svelte-aaur0b" rows="8" placeholder="Enter warning text..."></textarea>'),Ep=k('<p class="svelte-aaur0b"> </p>'),Ap=k('<div class="warning-text svelte-aaur0b"></div>'),Sp=k('<div class="error-message svelte-aaur0b"> </div>'),Cp=k('<div class="loading-spinner svelte-aaur0b"></div>'),Fp=hr('<svg class="w-4 h-4 svelte-aaur0b" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4" class="svelte-aaur0b"></path></svg>'),Dp=k('<div class="loading-spinner svelte-aaur0b"></div>'),Mp=hr('<svg class="w-4 h-4 svelte-aaur0b" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-5 5v-5z" class="svelte-aaur0b"></path></svg>'),Ip=k('<button class="action-btn whatsapp-btn svelte-aaur0b"><svg class="w-4 h-4 svelte-aaur0b" fill="currentColor" viewBox="0 0 24 24"><path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893A11.821 11.821 0 0020.885 3.106" class="svelte-aaur0b"></path></svg> </button>'),Rp=k('<div class="template-overlay svelte-aaur0b"><div class="template-content svelte-aaur0b"><div class="template-header svelte-aaur0b"><div class="header-left svelte-aaur0b"><h2 class="template-title svelte-aaur0b">Warning Template</h2> <span class="language-badge svelte-aaur0b"> </span></div> <div class="header-right svelte-aaur0b"><button class="edit-btn svelte-aaur0b"><!></button> <button class="print-btn svelte-aaur0b"><svg class="w-4 h-4 svelte-aaur0b" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z" class="svelte-aaur0b"></path></svg> </button> <button class="close-btn svelte-aaur0b"><svg class="w-5 h-5 svelte-aaur0b" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" class="svelte-aaur0b"></path></svg></button></div></div> <div class="template-body svelte-aaur0b"><div class="document-header svelte-aaur0b"><div class="logo-section svelte-aaur0b"><div class="logo-container svelte-aaur0b"><img src="/icons/logo.png" alt="Company Logo" class="company-logo svelte-aaur0b"/></div> <h3 class="company-name svelte-aaur0b"> </h3></div> <h2 class="document-title svelte-aaur0b"> </h2></div> <div class="document-details svelte-aaur0b"><div class="detail-row svelte-aaur0b"><span class="detail-label svelte-aaur0b"> </span> <span class="detail-value svelte-aaur0b"> </span></div> <div class="detail-row svelte-aaur0b"><span class="detail-label svelte-aaur0b"> </span> <span class="detail-value svelte-aaur0b"> </span></div> <div class="detail-row svelte-aaur0b"><span class="detail-label svelte-aaur0b"> </span> <span class="detail-value svelte-aaur0b"> </span></div> <div class="detail-row svelte-aaur0b"><span class="detail-label svelte-aaur0b"> </span> <span class="detail-value svelte-aaur0b"> </span></div></div> <div class="statistics-section svelte-aaur0b"><h4 class="section-title svelte-aaur0b"> </h4> <div class="stats-grid svelte-aaur0b"><div class="stat-item svelte-aaur0b"><span class="stat-label svelte-aaur0b"> </span> <span class="stat-value svelte-aaur0b"> </span></div> <div class="stat-item svelte-aaur0b"><span class="stat-label svelte-aaur0b"> </span> <span class="stat-value stat-completed svelte-aaur0b"> </span></div> <div class="stat-item svelte-aaur0b"><span class="stat-label svelte-aaur0b"> </span> <span class="stat-value stat-overdue svelte-aaur0b"> </span></div> <div class="stat-item svelte-aaur0b"><span class="stat-label svelte-aaur0b"> </span> <span class="stat-value svelte-aaur0b"> </span></div></div></div> <div class="warning-section svelte-aaur0b"><h4 class="section-title svelte-aaur0b"> </h4> <!></div> <div class="signature-section svelte-aaur0b"><div class="signature-grid svelte-aaur0b"><div class="signature-box svelte-aaur0b"><h5 class="signature-title svelte-aaur0b"> </h5> <div class="signature-line svelte-aaur0b"><span class="svelte-aaur0b">Name: ________________</span></div> <div class="signature-line svelte-aaur0b"><span class="svelte-aaur0b"> </span></div> <div class="signature-line svelte-aaur0b"><span class="svelte-aaur0b">Signature: ________________</span></div></div> <div class="signature-box svelte-aaur0b"><h5 class="signature-title svelte-aaur0b"> </h5> <div class="signature-line svelte-aaur0b"><span class="svelte-aaur0b"> </span></div> <div class="signature-line svelte-aaur0b"><span class="svelte-aaur0b"> </span></div> <div class="signature-line svelte-aaur0b"><span class="svelte-aaur0b">Signature: ________________</span></div></div></div></div></div> <!> <div class="template-footer svelte-aaur0b"><div class="action-buttons svelte-aaur0b"><button class="action-btn save-btn svelte-aaur0b"><!> </button> <button class="action-btn notification-btn svelte-aaur0b"><!> </button> <!></div></div></div></div>');function Np(t,r){pa(r,!1);const a=Q();let s=Ra(r,"data",12);const i=Jr();let l=Q(!1),d=Q(s().warningText),v=Q(!1),u=Q(!1),f=Q(null),h=Q(!1),_="",x=!1;const T={en:{companyName:"AQURA MANAGEMENT SYSTEM",documentTitle:"PERFORMANCE WARNING NOTICE",date:"Date:",to:"To:",from:"From:",subject:"Subject:",subjectText:"Performance Improvement Required",performanceSummary:"Performance Summary",totalTasksAssigned:"Total Tasks Assigned:",tasksCompleted:"Tasks Completed:",overdueTasks:"Overdue Tasks:",completionRate:"Completion Rate:",warningDetails:"Warning Details",employeeSignature:"Employee Signature",managerSignature:"Manager Signature",edit:"Edit",print:"Print",save:"Save Warning",sendNotification:"Send Notification",sendWhatsApp:"Send WhatsApp",notificationSent:"Notification sent successfully!",whatsappSent:"WhatsApp message sent!",warningSaved:"Warning saved successfully!",datePlaceholder:"Date: ________________",improvementRequired:"Immediate improvement is required to avoid further disciplinary action.",documentFooter:"This document is generated by Aqura Management System"},hi:{companyName:"अक्वरा प्रबंधन प्रणाली",documentTitle:"प्रदर्शन चेतावनी सूचना",date:"दिनांक:",to:"को:",from:"से:",subject:"विषय:",subjectText:"प्रदर्शन सुधार आवश्यक",performanceSummary:"प्रदर्शन सारांश",totalTasksAssigned:"कुल सौंपे गए कार्य:",tasksCompleted:"पूर्ण किए गए कार्य:",overdueTasks:"विलंबित कार्य:",completionRate:"पूर्णता दर:",warningDetails:"चेतावनी विवरण",employeeSignature:"कर्मचारी हस्ताक्षर",managerSignature:"प्रबंधक हस्ताक्षर",edit:"संपादित करें",print:"प्रिंट",save:"चेतावनी सहेजें",sendNotification:"सूचना भेजें",sendWhatsApp:"व्हाट्सएप भेजें",notificationSent:"सूचना सफलतापूर्वक भेजी गई!",whatsappSent:"व्हाट्सएप संदेश भेजा गया!",datePlaceholder:"दिनांक: ________________",improvementRequired:"अनुशासनात्मक कार्रवाई से बचने के लिए तत्काल सुधार आवश्यक है।",documentFooter:"यह दस्तावेज अक्वरा प्रबंधन प्रणाली द्वारा उत्पन्न किया गया है"},ar:{companyName:"نظام إدارة أكورا",documentTitle:"إشعار تحذير الأداء",date:"التاريخ:",to:"إلى:",from:"من:",subject:"الموضوع:",subjectText:"تحسين الأداء مطلوب",performanceSummary:"ملخص الأداء",totalTasksAssigned:"إجمالي المهام المكلفة:",tasksCompleted:"المهام المكتملة:",overdueTasks:"المهام المتأخرة:",completionRate:"معدل الإنجاز:",warningDetails:"تفاصيل التحذير",employeeSignature:"توقيع الموظف",managerSignature:"توقيع المدير",edit:"تعديل",print:"طباعة",save:"حفظ التحذير",sendNotification:"إرسال إشعار",sendWhatsApp:"إرسال واتساب",notificationSent:"تم إرسال الإشعار بنجاح!",whatsappSent:"تم إرسال رسالة واتساب!",datePlaceholder:"التاريخ: ________________",improvementRequired:"التحسن الفوري مطلوب لتجنب اتخاذ إجراءات تأديبية إضافية.",documentFooter:"تم إنشاء هذا المستند بواسطة نظام إدارة أكورا"},ur:{companyName:"اکورا منیجمنٹ سسٹم",documentTitle:"کارکردگی انتباہی نوٹس",date:"تاریخ:",to:"کو:",from:"سے:",subject:"موضوع:",subjectText:"کارکردگی میں بہتری درکار",performanceSummary:"کارکردگی کا خلاصہ",totalTasksAssigned:"کل تفویض شدہ کام:",tasksCompleted:"مکمل شدہ کام:",overdueTasks:"تاخیر سے کام:",completionRate:"تکمیل کی شرح:",warningDetails:"انتباہ کی تفصیلات",employeeSignature:"ملازم کے دستخط",managerSignature:"منیجر کے دستخط",edit:"ترمیم",print:"پرنٹ",sendNotification:"اطلاع بھیجیں",sendWhatsApp:"واٹس ایپ بھیجیں",notificationSent:"اطلاع کامیابی سے بھیج دی گئی!",whatsappSent:"واٹس ایپ پیغام بھیج دیا گیا!",datePlaceholder:"تاریخ: ________________",improvementRequired:"مزید تادیبی کارروائی سے بچنے کے لیے فوری بہتری درکار ہے۔",documentFooter:"یہ دستاویز اکورا منیجمنٹ سسٹم کے ذریعے تیار کی گئی ہے"},ta:{companyName:"அக்வரா மேலாண்மை அமைப்பு",documentTitle:"செயல்திறன் எச்சரிக்கை அறிவிப்பு",date:"தேதி:",to:"பெறுநர்:",from:"அனுப்புநர்:",subject:"விषயம்:",subjectText:"செயல்திறன் மேம்பாடு தேவை",performanceSummary:"செயல்திறன் சுருக்கம்",totalTasksAssigned:"மொத்த ஒதுக்கப்பட்ட பணிகள்:",tasksCompleted:"நிறைவேற்றப்பட்ட பணிகள்:",overdueTasks:"தாமதமான பணிகள்:",completionRate:"நிறைவேற்றல் விகிதம்:",warningDetails:"எச்சரிக்கை விவரங்கள்",employeeSignature:"ஊழியர் கையொப்பம்",managerSignature:"மேலாளர் கையொப்பம்",edit:"திருத்து",print:"அச்சிடு",sendNotification:"அறிவிப்பு அனுப்பு",sendWhatsApp:"வாட்ஸ்அப் அனுப்பு",notificationSent:"அறிவிப்பு வெற்றிகரமாக அனுப்பப்பட்டது!",whatsappSent:"வாட்ஸ்அப் செய்தி அனுப்பப்பட்டது!",datePlaceholder:"தேதி: ________________",improvementRequired:"மேலும் ஒழுங்குமுறை நடவடிக்கையைத் தவிர்க்க உடனடி முன்னேற்றம் தேவை.",documentFooter:"இந்த ஆவணம் அக்வரா மேலாண்மை அமைப்பால் உருவாக்கப்பட்டது"},ml:{companyName:"അക്വാറ മാനേജ്‌മെന്റ് സിസ്റ്റം",documentTitle:"പ്രകടന മുന്നറിയിപ്പ് അറിയിപ്പ്",date:"തീയതി:",to:"വേണ്ടി:",from:"നിന്ന്:",subject:"വിഷയം:",subjectText:"പ്രകടന മെച്ചപ്പെടുത്തൽ ആവശ്യം",performanceSummary:"പ്രകടന സംഗ്രഹം",totalTasksAssigned:"മൊത്തം നിയോഗിച്ച ജോലികൾ:",tasksCompleted:"പൂർത്തീകരിച്ച ജോലികൾ:",overdueTasks:"കാലഹരണപ്പെട്ട ജോലികൾ:",completionRate:"പൂർത്തീകരണ നിരക്ക്:",warningDetails:"മുന്നറിയിപ്പ് വിശദാംശങ്ങൾ",employeeSignature:"ജീവനക്കാരന്റെ ഒപ്പ്",managerSignature:"മാനേജറുടെ ഒപ്പ്",edit:"എഡിറ്റ്",print:"പ്രിന്റ്",sendNotification:"അറിയിപ്പ് അയയ്ക്കുക",sendWhatsApp:"വാട്സ്ആപ്പ് അയയ്ക്കുക",notificationSent:"അറിയിപ്പ് വിജയകരമായി അയച്ചു!",whatsappSent:"വാട്സ്ആപ്പ് സന്ദേശം അയച്ചു!",datePlaceholder:"തീയതി: ________________",improvementRequired:"കൂടുതൽ അച്ചടക്ക നടപടികൾ ഒഴിവാക്കാൻ ഉടനടി മെച്ചപ്പെടുത്തൽ ആവശ്യമാണ്.",documentFooter:"ഈ ഡോക്യുമെന്റ് അക്വാറ മാനേജ്‌മെന്റ് സിസ്റ്റം സൃഷ്ടിച്ചതാണ്"},bn:{companyName:"আকুরা ম্যানেজমেন্ট সিস্টেম",documentTitle:"কর্মক্ষমতা সতর্কতা নোটিশ",date:"তারিখ:",to:"প্রতি:",from:"হতে:",subject:"বিষয়:",subjectText:"কর্মক্ষমতা উন্নতি প্রয়োজন",performanceSummary:"কর্মক্ষমতা সারসংক্ষেপ",totalTasksAssigned:"মোট নিযুক্ত কাজ:",tasksCompleted:"সম্পন্ন কাজ:",overdueTasks:"বিলম্বিত কাজ:",completionRate:"সমাপ্তির হার:",warningDetails:"সতর্কতার বিশদ",employeeSignature:"কর্মচারীর স্বাক্ষর",managerSignature:"ম্যানেজারের স্বাক্ষর",edit:"সম্পাদনা",print:"মুদ্রণ",sendNotification:"বিজ্ঞপ্তি পাঠান",sendWhatsApp:"হোয়াটসঅ্যাপ পাঠান",notificationSent:"বিজ্ঞপ্তি সফলভাবে পাঠানো হয়েছে!",whatsappSent:"হোয়াটসঅ্যাপ বার্তা পাঠানো হয়েছে!",datePlaceholder:"তারিখ: ________________",improvementRequired:"আরও শাস্তিমূলক ব্যবস্থা এড়াতে তাৎক্ষণিক উন্নতি প্রয়োজন।",documentFooter:"এই নথিটি আকুরা ম্যানেজমেন্ট সিস্টেম দ্বারা তৈরি"}};Aa(async()=>{await b()});async function b(){try{const{data:Ft,error:Ct}=await Tt.from("hr_employee_contacts").select("whatsapp_number").eq("employee_username",s().recipientUsername).single();Ft&&Ft.whatsapp_number&&(p(h,!0),_=Ft.whatsapp_number)}catch(Ft){console.error("Error checking WhatsApp contact:",Ft)}}function w(){e(l)&&s(s().warningText=e(d),!0),p(l,!e(l))}async function A(){p(v,!0),p(f,null);try{x||await C();const{error:Ft}=await Tt.from("notifications").insert({title:"Performance Warning",message:`Warning: Performance Review Required - ${e(d)}`,type:"warning",priority:"high",target_type:"specific_users",target_users:JSON.stringify([s().assignmentData.assignedToUserId]),created_by:s().assignmentData.assignedByUserId,created_by_name:s().assignedBy,created_by_role:"Manager",status:"published",has_attachments:!1,read_count:0,total_recipients:1});if(Ft)throw Ft;alert("Warning notification sent successfully through internal notification center!"),i("close")}catch(Ft){console.error("Error sending notification:",Ft),p(f,"Failed to send notification: "+Ft.message)}finally{p(v,!1)}}async function C(){if(x){console.log("Warning already saved, skipping duplicate save");return}try{const Ft=Ul(qs);if(!(Ft!=null&&Ft.user))throw new Error("User not authenticated");const Ct=Ft.user;let $t=null,Zt=null;if(s().assignmentData.assignedToUserId)try{const{data:Rt,error:Ut}=await Io.from("users").select(`
							id,
							username,
							employee_id,
							hr_employees(id, name, employee_id)
						`).eq("id",s().assignmentData.assignedToUserId).single();!Ut&&Rt?(Zt=Rt.username,$t=Rt.employee_id,console.log("Found user details:",{userId:Rt.id,username:Rt.username,employeeId:Rt.employee_id,employeeData:Rt.hr_employees})):console.warn("Could not find user details for ID:",s().assignmentData.assignedToUserId)}catch(Rt){console.error("Error fetching user details:",Rt)}const Da={user_id:s().assignmentData.assignedToUserId,employee_id:$t,username:Zt||s().assignmentData.assignedTo||s().recipientUsername,warning_type:s().warningType,has_fine:s().hasFine||!1,fine_amount:s().fineAmount||null,fine_currency:s().fineCurrency||"USD",fine_status:s().hasFine?"pending":null,warning_text:e(d),language_code:s().language||"en",task_id:s().assignmentData.taskId||null,task_title:s().assignmentData.taskTitle||null,task_description:s().assignmentData.taskDescription||null,assignment_id:s().assignmentData.assignmentId||null,total_tasks_assigned:s().totalAssigned||0,total_tasks_completed:s().totalCompleted||0,total_tasks_overdue:s().totalOverdue||0,completion_rate:s().completionRate||0,issued_by:Ct.id,issued_by_username:Ct.username||"system",warning_status:"active",branch_id:s().assignmentData.branchId||null,severity_level:z(),follow_up_required:s().hasFine||s().completionRate<50,follow_up_date:s().hasFine?new Date(Date.now()+7*24*60*60*1e3).toISOString().split("T")[0]:null};console.log("Saving warning record:",Da);const{error:ta}=await Io.from("employee_warnings").insert([Da]);if(ta)throw console.error("Database error:",ta),new Error(`Failed to save warning record: ${ta.message}`);console.log("Warning record saved successfully"),x=!0}catch(Ft){throw console.error("Error saving warning record:",Ft),Ft}}function z(){const Ft=s().completionRate||0,Ct=s().hasFine||!1;return Ct&&Ft<30?"critical":Ct||Ft<40?"high":Ft<60?"medium":"low"}async function F(){p(u,!0);try{x?alert("Warning already saved!"):(await C(),alert(e(a).warningSaved||"Warning saved successfully!"))}catch(Ft){console.error("Error saving warning:",Ft),""+Ft.message}finally{p(u,!1)}}function re(){if(!e(h)||!_){alert("WhatsApp number not available for this employee");return}(x?Promise.resolve():C()).then(()=>{const Ct=me(),$t=encodeURIComponent(Ct),Zt=`https://web.whatsapp.com/send?phone=${_}&text=${$t}`;window.open(Zt,"_blank")}).catch(Ct=>{console.error("Error saving warning before WhatsApp:",Ct),alert("Warning could not be saved to database, but proceeding with WhatsApp");const $t=me(),Zt=encodeURIComponent($t),Da=`https://web.whatsapp.com/send?phone=${_}&text=${Zt}`;window.open(Da,"_blank")})}function me(){return`*${e(a).documentTitle}*

${e(a).to} ${s().recipientName},

*${e(a).performanceSummary}:*
• ${e(a).totalTasksAssigned} ${s().totalAssigned}
• ${e(a).tasksCompleted} ${s().totalCompleted}
• ${e(a).overdueTasks} ${s().totalOverdue}
• ${e(a).completionRate} ${s().completionRate}%

*${e(a).warningDetails}:*
${e(d)}

---
${e(a).from} ${s().assignedBy}
${e(a).date} ${new Date().toLocaleDateString()}

${e(a).companyName}`}function ue(){(x?Promise.resolve():C()).then(()=>{const Ct=window.open("","_blank"),$t=D();Ct.document.write($t),Ct.document.close(),Ct.print()}).catch(Ct=>{console.error("Error saving warning before printing:",Ct),alert("Warning could not be saved to database, but proceeding with print");const $t=window.open("","_blank"),Zt=D();$t.document.write(Zt),$t.document.close(),$t.print()})}function D(){const Ft=new Date().toLocaleDateString();return`
		<!DOCTYPE html>
		<html>
		<head>
			<title>${e(a).documentTitle}</title>
			<style>
				@page {
					size: A4;
					margin: 20mm;
				}
				body {
					font-family: Arial, sans-serif;
					margin: 0;
					padding: 0;
					line-height: 1.4;
					color: #333;
					font-size: 12px;
				}
				.header {
					text-align: center;
					margin-bottom: 25px;
					border-bottom: 2px solid #333;
					padding-bottom: 15px;
				}
				.logo-container {
					width: 80px;
					height: 40px;
					margin: 0 auto 12px;
					display: flex;
					align-items: center;
					justify-content: center;
				}
				.company-logo {
					max-width: 100%;
					max-height: 100%;
					-o-object-fit: contain;
					   object-fit: contain;
				}
				.company-name {
					font-size: 18px;
					font-weight: 700;
					color: #111827;
					margin: 0;
				}
				.document-title {
					font-size: 16px;
					font-weight: 700;
					color: #dc2626;
					margin: 12px 0 0 0;
					letter-spacing: 0.5px;
				}
				.logo-container {
					width: 80px;
					height: 40px;
					margin: 0 auto 10px;
					display: flex;
					align-items: center;
					justify-content: center;
				}
				.company-logo {
					max-width: 100%;
					max-height: 100%;
					-o-object-fit: contain;
					   object-fit: contain;
				}
				.company-name {
					font-size: 16px;
					font-weight: bold;
					margin: 5px 0;
				}
				.document-title {
					font-size: 14px;
					font-weight: bold;
					color: #d32f2f;
					margin: 10px 0;
				}
				.content {
					margin: 20px 0;
				}
				.warning-content {
					background: #fff3cd;
					border: 1px solid #ffeaa7;
					padding: 15px;
					margin: 15px 0;
					border-radius: 4px;
					font-size: 11px;
				}
				.statistics {
					display: grid;
					grid-template-columns: repeat(2, 1fr);
					gap: 8px;
					margin: 15px 0;
					padding: 12px;
					background: #f8f9fa;
					border-radius: 4px;
					font-size: 11px;
				}
				.stat-item {
					display: flex;
					justify-content: space-between;
				}
				.signatures {
					margin-top: 30px;
					display: grid;
					grid-template-columns: 1fr 1fr;
					gap: 20px;
					font-size: 11px;
				}
				.signature-section {
					text-align: center;
				}
				.signature-line {
					border-top: 1px solid #333;
					margin-top: 25px;
					padding-top: 5px;
				}
				.footer {
					margin-top: 20px;
					text-align: center;
					font-size: 10px;
					color: #666;
				}
				@media print {
					body { 
						margin: 0; 
						font-size: 11px;
					}
					.header {
						margin-bottom: 20px;
						padding-bottom: 10px;
					}
				}
			</style>
		</head>
		<body>
			<div class="header">
				<div class="logo-container">
					<img src="/icons/logo.png" alt="Company Logo" class="company-logo" />
				</div>
				<div class="company-name">{t.companyName}</div>
				<div class="document-title">{t.documentTitle}</div>
			</div>
			
			<div class="content">
				<p><strong>${e(a).date}</strong> ${Ft}</p>
				<p><strong>${e(a).to}</strong> ${s().recipientName}</p>
				<p><strong>${e(a).from}</strong> ${s().assignedBy}</p>
				<p><strong>${e(a).subject}</strong> ${e(a).subjectText}</p>
				
				<div class="statistics">
					<div class="stat-item">
						<span>${e(a).totalTasksAssigned}</span>
						<span><strong>${s().totalAssigned}</strong></span>
					</div>
					<div class="stat-item">
						<span>${e(a).tasksCompleted}</span>
						<span><strong>${s().totalCompleted}</strong></span>
					</div>
					<div class="stat-item">
						<span>${e(a).overdueTasks}</span>
						<span><strong style="color: #d32f2f">${s().totalOverdue}</strong></span>
					</div>
					<div class="stat-item">
						<span>${e(a).completionRate}</span>
						<span><strong>${s().completionRate}%</strong></span>
					</div>
				</div>
				
				<div class="warning-content">
					${e(d).split(`
`).slice(0,10).map(Ct=>`<p style="margin: 5px 0;">${Ct}</p>`).join("")}
				</div>
				
				<p style="margin-top: 15px; font-size: 11px;">${e(a).improvementRequired}</p>
			</div>
			
			<div class="signatures">
				<div class="signature-section">
					<div class="signature-line">
						<strong>${e(a).managerSignature}</strong><br>
						${e(a).datePlaceholder}<br>
						Signature: ________________
					</div>
				</div>
				<div class="signature-section">
					<div class="signature-line">
						<strong>${e(a).employeeSignature}</strong><br>
						${e(a).datePlaceholder}<br>
						Signature: ________________
					</div>
				</div>
			</div>
			
			<div class="footer">
				<p>${e(a).documentFooter}</p>
			</div>
		</body>
		</html>`}function E(){i("close")}Nt(()=>kt(s()),()=>{p(a,T[s().language]||T.en)}),Va(),ha();var he=Rp(),xe=o(he),K=o(xe),q=o(K),ae=c(o(q),2),Me=o(ae,!0);n(ae),n(q);var ge=c(q,2),Ne=o(ge),Be=o(Ne);{var be=Ft=>{var Ct=yp();Et(),g(Ft,Ct)},L=Ft=>{var Ct=kp(),$t=c(Bt(Ct),1,!0);R(()=>y($t,(e(a),m(()=>e(a).edit)))),g(Ft,Ct)};X(Be,Ft=>{e(l)?Ft(be):Ft(L,!1)})}n(Ne);var Te=c(Ne,2),ye=c(o(Te));n(Te);var P=c(Te,2);n(ge),n(K);var pe=c(K,2),B=o(pe),j=o(B),I=c(o(j),2),Y=o(I,!0);n(I),n(j);var fe=c(j,2),ce=o(fe,!0);n(fe),n(B);var J=c(B,2),le=o(J),S=o(le),De=o(S,!0);n(S);var Ue=c(S,2),We=o(Ue,!0);n(Ue),n(le);var ke=c(le,2),N=o(ke),V=o(N,!0);n(N);var G=c(N,2),de=o(G);n(G),n(ke);var ve=c(ke,2),Ie=o(ve),Ye=o(Ie,!0);n(Ie);var oe=c(Ie,2),se=o(oe,!0);n(oe),n(ve);var U=c(ve,2),W=o(U),ee=o(W,!0);n(W);var we=c(W,2),Ae=o(we,!0);n(we),n(U),n(J);var He=c(J,2),Ke=o(He),Oe=o(Ke,!0);n(Ke);var Ee=c(Ke,2),et=o(Ee),dt=o(et),ut=o(dt,!0);n(dt);var Pe=c(dt,2),qe=o(Pe,!0);n(Pe),n(et);var tt=c(et,2),lt=o(tt),Xe=o(lt,!0);n(lt);var at=c(lt,2),Fe=o(at,!0);n(at),n(tt);var rt=c(tt,2),Ce=o(rt),_e=o(Ce,!0);n(Ce);var Ve=c(Ce,2),Je=o(Ve,!0);n(Ve),n(rt);var st=c(rt,2),ot=o(st),Le=o(ot,!0);n(ot);var nt=c(ot,2),vt=o(nt);n(nt),n(st),n(Ee),n(He);var xt=c(He,2),M=o(xt),H=o(M,!0);n(M);var O=c(M,2);{var te=Ft=>{var Ct=Tp();ks(Ct),zt(Ct,()=>e(d),$t=>p(d,$t)),g(Ft,Ct)},ne=Ft=>{var Ct=Ap();Mt(Ct,5,()=>(e(d),m(()=>e(d).split(`
`))),Lt,($t,Zt)=>{var Da=Ep(),ta=o(Da,!0);n(Da),R(()=>y(ta,e(Zt))),g($t,Da)}),n(Ct),g(Ft,Ct)};X(O,Ft=>{e(l)?Ft(te):Ft(ne,!1)})}n(xt);var ie=c(xt,2),Se=o(ie),Qe=o(Se),je=o(Qe),ze=o(je,!0);n(je);var Re=c(je,4),it=o(Re),ft=o(it,!0);n(it),n(Re),Et(2),n(Qe);var mt=c(Qe,2),ht=o(mt),pt=o(ht,!0);n(ht);var _t=c(ht,2),Ge=o(_t),ct=o(Ge);n(Ge),n(_t);var Ze=c(_t,2),bt=o(Ze),It=o(bt,!0);n(bt),n(Ze),Et(2),n(mt),n(Se),n(ie),n(pe);var Ot=c(pe,2);{var Pt=Ft=>{var Ct=Sp(),$t=o(Ct,!0);n(Ct),R(()=>y($t,e(f))),g(Ft,Ct)};X(Ot,Ft=>{e(f)&&Ft(Pt)})}var gt=c(Ot,2),yt=o(gt),qt=o(yt),sa=o(qt);{var oa=Ft=>{var Ct=Cp();g(Ft,Ct)},Ia=Ft=>{var Ct=Fp();g(Ft,Ct)};X(sa,Ft=>{e(u)?Ft(oa):Ft(Ia,!1)})}var ka=c(sa);n(qt);var St=c(qt,2),Dt=o(St);{var Wt=Ft=>{var Ct=Dp();g(Ft,Ct)},ea=Ft=>{var Ct=Mp();g(Ft,Ct)};X(Dt,Ft=>{e(v)?Ft(Wt):Ft(ea,!1)})}var Ht=c(Dt);n(St);var Qt=c(St,2);{var la=Ft=>{var Ct=Ip(),$t=c(o(Ct));n(Ct),R(()=>y($t,` ${e(a),m(()=>e(a).sendWhatsApp)??""}`)),Z("click",Ct,re),g(Ft,Ct)};X(Qt,Ft=>{e(h)&&Ft(la)})}n(yt),n(gt),n(xe),n(he),R((Ft,Ct)=>{y(Me,Ft),y(ye,` ${e(a),m(()=>e(a).print)??""}`),y(Y,(e(a),m(()=>e(a).companyName))),y(ce,(e(a),m(()=>e(a).documentTitle))),y(De,(e(a),m(()=>e(a).date))),y(We,Ct),y(V,(e(a),m(()=>e(a).to))),y(de,`${kt(s()),m(()=>s().recipientName)??""} (${kt(s()),m(()=>s().recipientUsername)??""})`),y(Ye,(e(a),m(()=>e(a).from))),y(se,(kt(s()),m(()=>s().assignedBy))),y(ee,(e(a),m(()=>e(a).subject))),y(Ae,(e(a),m(()=>e(a).subjectText))),y(Oe,(e(a),m(()=>e(a).performanceSummary))),y(ut,(e(a),m(()=>e(a).totalTasksAssigned))),y(qe,(kt(s()),m(()=>s().totalAssigned))),y(Xe,(e(a),m(()=>e(a).tasksCompleted))),y(Fe,(kt(s()),m(()=>s().totalCompleted))),y(_e,(e(a),m(()=>e(a).overdueTasks))),y(Je,(kt(s()),m(()=>s().totalOverdue))),y(Le,(e(a),m(()=>e(a).completionRate))),y(vt,`${kt(s()),m(()=>s().completionRate)??""}%`),y(H,(e(a),m(()=>e(a).warningDetails))),y(ze,(e(a),m(()=>e(a).managerSignature))),y(ft,(e(a),m(()=>e(a).datePlaceholder))),y(pt,(e(a),m(()=>e(a).employeeSignature))),y(ct,`Name: ${kt(s()),m(()=>s().recipientName)??""}`),y(It,(e(a),m(()=>e(a).datePlaceholder))),qt.disabled=e(u),y(ka,` ${e(a),m(()=>e(a).save)??""}`),St.disabled=e(v),y(Ht,` ${e(a),m(()=>e(a).sendNotification)??""}`)},[()=>(kt(s()),m(()=>s().language.toUpperCase())),()=>m(()=>new Date().toLocaleDateString())]),Z("click",Ne,w),Z("click",Te,ue),Z("click",P,E),Z("click",qt,F),Z("click",St,A),Z("click",xe,ir(function(Ft){Or.call(this,r,Ft)})),Z("click",he,E),g(t,he),ma()}async function Pp(t,r="en"){try{const a=await fetch("/api/generate-warning",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({assignment:t,language:r})});if(!a.ok){const i=await a.json();throw new Error(i.error||`HTTP ${a.status}: ${a.statusText}`)}return await a.json()}catch(a){throw console.error("Server-side warning generation failed:",a),a}}async function Lp(t,r="en"){try{return await Pp(t,r)}catch(a){throw a.message.includes("404")||a.message.includes("not found")?(console.warn("Server-side API not available, falling back to alternative method"),new Error("Warning generation service not available. Please contact administrator.")):a}}var Op=k('<option class="svelte-1m1txfo"> </option>'),zp=k('<div class="warning-type-option svelte-1m1txfo"><label class="warning-type-radio-label svelte-1m1txfo"><input type="radio" class="warning-type-radio svelte-1m1txfo"/> <div class="warning-type-content svelte-1m1txfo"><div class="warning-type-name svelte-1m1txfo"> </div> <div class="warning-type-description svelte-1m1txfo"> </div></div></label></div>'),Bp=k('<option class="svelte-1m1txfo"> </option>'),$p=k('<span class="fine-immediate svelte-1m1txfo">⚠️ This fine will be applied immediately upon warning issuance.</span>'),Up=k('<span class="fine-threat svelte-1m1txfo">📋 This amount will be mentioned as a potential fine for repeated violations.</span>'),qp=k('<div class="fine-section svelte-1m1txfo"><h4 class="fine-section-title svelte-1m1txfo"> </h4> <div class="fine-input-group svelte-1m1txfo"><div class="fine-amount-input svelte-1m1txfo"><label class="fine-label svelte-1m1txfo">Amount:</label> <input type="number" placeholder="Enter amount" min="0" step="0.01" class="fine-input svelte-1m1txfo"/></div> <div class="fine-currency-select svelte-1m1txfo"><label class="currency-label svelte-1m1txfo">Currency:</label> <select class="currency-select svelte-1m1txfo"></select></div></div> <div class="fine-info svelte-1m1txfo"><!></div></div>'),jp=k('<div class="error-message svelte-1m1txfo"> </div>'),Wp=k('<div class="warning-preview svelte-1m1txfo"><h4 class="preview-title svelte-1m1txfo">Generated Warning:</h4> <div class="preview-content svelte-1m1txfo"> </div></div>'),Hp=k('<div class="loading-spinner svelte-1m1txfo"></div> Generating...',1),Vp=k('<div class="window-header svelte-1m1txfo"><h2 class="window-title svelte-1m1txfo">Generate Warning</h2> <button class="close-btn svelte-1m1txfo"><svg class="w-5 h-5 svelte-1m1txfo" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" class="svelte-1m1txfo"></path></svg></button></div> <div class="window-body svelte-1m1txfo"><div class="assignment-summary svelte-1m1txfo"><h3 class="summary-title svelte-1m1txfo">Assignment Summary</h3> <div class="summary-grid svelte-1m1txfo"><div class="summary-item svelte-1m1txfo"><span class="summary-label svelte-1m1txfo">Assigned To:</span> <span class="summary-value svelte-1m1txfo"> </span></div> <div class="summary-item svelte-1m1txfo"><span class="summary-label svelte-1m1txfo">Assigned By:</span> <span class="summary-value svelte-1m1txfo"> </span></div> <div class="summary-item svelte-1m1txfo"><span class="summary-label svelte-1m1txfo">Assignment Type:</span> <span class="summary-value svelte-1m1txfo"> </span></div> <div class="summary-item svelte-1m1txfo"><span class="summary-label svelte-1m1txfo">Branch:</span> <span class="summary-value svelte-1m1txfo"> </span></div> <div class="summary-item svelte-1m1txfo"><span class="summary-label svelte-1m1txfo">Total Tasks:</span> <span class="summary-value svelte-1m1txfo"> </span></div> <div class="summary-item svelte-1m1txfo"><span class="summary-label svelte-1m1txfo">Completed:</span> <span class="summary-value text-green-600 svelte-1m1txfo"> </span></div> <div class="summary-item svelte-1m1txfo"><span class="summary-label svelte-1m1txfo">Overdue:</span> <span class="summary-value text-red-600 svelte-1m1txfo"> </span></div> <div class="summary-item svelte-1m1txfo"><span class="summary-label svelte-1m1txfo">Completion Rate:</span> <span class="summary-value svelte-1m1txfo"> </span></div></div></div> <div class="language-section svelte-1m1txfo"><label class="language-label svelte-1m1txfo">Select Language:</label> <select class="language-select svelte-1m1txfo"></select></div> <div class="warning-type-section svelte-1m1txfo"><label class="warning-type-label svelte-1m1txfo">Select Warning Type:</label> <div class="warning-types-grid svelte-1m1txfo"></div></div> <!> <!> <!></div> <div class="window-footer svelte-1m1txfo"><button class="cancel-btn svelte-1m1txfo">Cancel</button> <button class="generate-btn svelte-1m1txfo"><!></button></div>',1),Gp=k('<div class="warning-window svelte-1m1txfo"><!></div> <!>',1);function Xp(t,r){pa(r,!1);const a=Q(),s=Q(),i=[];let l=Ra(r,"assignment",8),d=Ra(r,"onClose",8,()=>{}),v=Q("en"),u=Q(""),f=Q(""),h=Q("USD"),_=Q(!1),x=Q(""),T=Q(!1),b=Q(null),w=Q(null);const A=[{code:"en",name:"English"},{code:"hi",name:"Hindi"},{code:"ar",name:"Arabic"},{code:"ur",name:"Urdu"},{code:"ta",name:"Tamil"},{code:"ml",name:"Malayalam"},{code:"bn",name:"Bengali"}],C=[{code:"overall_performance_no_fine",name:"Overall Performance Warning (No Fine)",description:"General performance warning without financial penalty",requiresFine:!1,fineType:"none"},{code:"overall_performance_fine_threat",name:"Overall Performance Warning (Fine Threat)",description:"Performance warning with threat of future fine if repeated",requiresFine:!0,fineType:"threat"},{code:"overall_performance_with_fine",name:"Overall Performance Warning (With Fine)",description:"Performance warning with immediate financial penalty",requiresFine:!0,fineType:"immediate"}],z=[{code:"USD",name:"US Dollar ($)"},{code:"EUR",name:"Euro (€)"},{code:"GBP",name:"British Pound (£)"},{code:"SAR",name:"Saudi Riyal (ر.س)"},{code:"AED",name:"UAE Dirham (د.إ)"},{code:"INR",name:"Indian Rupee (₹)"},{code:"PKR",name:"Pakistani Rupee (₨)"}];async function F(){var K,q,ae,Me,ge;if(!e(v)){p(w,"Please select a language");return}if(!e(u)){p(w,"Please select a warning type");return}if(e(s)&&((K=e(a))==null?void 0:K.fineType)!=="none"&&!e(f)){p(w,"Please enter a fine amount");return}if(e(s)&&e(f)&&(isNaN(parseFloat(e(f)))||parseFloat(e(f))<=0)){p(w,"Please enter a valid fine amount");return}p(_,!0),p(w,null);try{console.log("Starting warning generation..."),console.log("Assignment data:",l()),console.log("Selected language:",e(v)),console.log("Selected warning type:",e(u)),console.log("Fine amount:",e(f));const Ne={...l(),warningType:e(u),warningTypeData:e(a),fineAmount:e(s)?parseFloat(e(f)):null,fineCurrency:e(s)?e(h):null,hasFine:e(s)&&((q=e(a))==null?void 0:q.fineType)!=="none",fineType:((ae=e(a))==null?void 0:ae.fineType)||"none"},Be=await Lp(Ne,e(v));if(!Be.warning)throw new Error("No warning content received from the server");p(x,Be.warning),p(b,{recipientName:l().assignedToEmployee||l().assignedTo,recipientUsername:l().assignedTo,assignedBy:l().assignedBy,totalAssigned:l().totalAssigned,totalCompleted:l().totalCompleted,totalOverdue:l().totalOverdue,completionRate:l().totalAssigned>0?Math.round(l().totalCompleted/l().totalAssigned*100):0,overdueRate:l().totalAssigned>0?Math.round(l().totalOverdue/l().totalAssigned*100):0,warningText:e(x),language:e(v),warningType:e(u),warningTypeData:e(a),fineAmount:e(s)?parseFloat(e(f)):null,fineCurrency:e(s)?e(h):null,hasFine:e(s)&&((Me=e(a))==null?void 0:Me.fineType)!=="none",fineType:((ge=e(a))==null?void 0:ge.fineType)||"none",generatedAt:new Date().toISOString(),assignmentData:Ne}),p(T,!0),console.log("Warning generated successfully")}catch(Ne){console.error("Error generating warning:",Ne),p(w,`Failed to generate warning: ${Ne.message}`),Ne.message.includes("404")||Ne.message.includes("not found")?p(w,"Warning generation service is not available. Please contact your administrator."):Ne.message.includes("500")?p(w,"Server error occurred. Please try again later or contact support."):(Ne.message.includes("network")||Ne.message.includes("fetch"))&&p(w,"Network error. Please check your internet connection and try again.")}finally{p(_,!1)}}function re(){p(T,!1)}Nt(()=>e(u),()=>{p(a,C.find(K=>K.code===e(u)))}),Nt(()=>e(a),()=>{var K;p(s,((K=e(a))==null?void 0:K.requiresFine)||!1)}),Va(),ha();var me=Gp(),ue=Bt(me),D=o(ue);{var E=K=>{var q=Vp(),ae=Bt(q),Me=c(o(ae),2);n(ae);var ge=c(ae,2),Ne=o(ge),Be=c(o(Ne),2),be=o(Be),L=c(o(be),2),Te=o(L,!0);n(L),n(be);var ye=c(be,2),P=c(o(ye),2),pe=o(P,!0);n(P),n(ye);var B=c(ye,2),j=c(o(B),2),I=o(j,!0);n(j),n(B);var Y=c(B,2),fe=c(o(Y),2),ce=o(fe,!0);n(fe),n(Y);var J=c(Y,2),le=c(o(J),2),S=o(le,!0);n(le),n(J);var De=c(J,2),Ue=c(o(De),2),We=o(Ue,!0);n(Ue),n(De);var ke=c(De,2),N=c(o(ke),2),V=o(N,!0);n(N),n(ke);var G=c(ke,2),de=c(o(G),2),ve=o(de);n(de),n(G),n(Be),n(Ne);var Ie=c(Ne,2),Ye=c(o(Ie),2);R(()=>{e(v),Xt(()=>{})}),Mt(Ye,5,()=>A,Lt,(Pe,qe)=>{var tt=Op(),lt=o(tt,!0);n(tt);var Xe={};R(()=>{y(lt,(e(qe),m(()=>e(qe).name))),Xe!==(Xe=(e(qe),m(()=>e(qe).code)))&&(tt.value=(tt.__value=(e(qe),m(()=>e(qe).code)))??"")}),g(Pe,tt)}),n(Ye),n(Ie);var oe=c(Ie,2),se=c(o(oe),2);Mt(se,5,()=>C,Lt,(Pe,qe)=>{var tt=zp(),lt=o(tt),Xe=o(lt);At(Xe);var at,Fe=c(Xe,2),rt=o(Fe),Ce=o(rt,!0);n(rt);var _e=c(rt,2),Ve=o(_e,!0);n(_e),n(Fe),n(lt),n(tt),R(()=>{at!==(at=(e(qe),m(()=>e(qe).code)))&&(Xe.value=(Xe.__value=(e(qe),m(()=>e(qe).code)))??""),y(Ce,(e(qe),m(()=>e(qe).name))),y(Ve,(e(qe),m(()=>e(qe).description)))}),gs(i,[],Xe,()=>(e(qe),m(()=>e(qe).code),e(u)),Je=>p(u,Je)),g(Pe,tt)}),n(se),n(oe);var U=c(oe,2);{var W=Pe=>{var qe=qp(),tt=o(qe),lt=o(tt,!0);n(tt);var Xe=c(tt,2),at=o(Xe),Fe=c(o(at),2);At(Fe),n(at);var rt=c(at,2),Ce=c(o(rt),2);R(()=>{e(h),Xt(()=>{})}),Mt(Ce,5,()=>z,Lt,(ot,Le)=>{var nt=Bp(),vt=o(nt,!0);n(nt);var xt={};R(()=>{y(vt,(e(Le),m(()=>e(Le).name))),xt!==(xt=(e(Le),m(()=>e(Le).code)))&&(nt.value=(nt.__value=(e(Le),m(()=>e(Le).code)))??"")}),g(ot,nt)}),n(Ce),n(rt),n(Xe);var _e=c(Xe,2),Ve=o(_e);{var Je=ot=>{var Le=$p();g(ot,Le)},st=ot=>{var Le=Ca(),nt=Bt(Le);{var vt=xt=>{var M=Up();g(xt,M)};X(nt,xt=>{e(a),m(()=>{var M;return((M=e(a))==null?void 0:M.fineType)==="threat"})&&xt(vt)},!0)}g(ot,Le)};X(Ve,ot=>{e(a),m(()=>{var Le;return((Le=e(a))==null?void 0:Le.fineType)==="immediate"})?ot(Je):ot(st,!1)})}n(_e),n(qe),R(()=>y(lt,(e(a),m(()=>{var ot;return((ot=e(a))==null?void 0:ot.fineType)==="immediate"?"Fine Amount":"Potential Fine Amount"})))),zt(Fe,()=>e(f),ot=>p(f,ot)),ra(Ce,()=>e(h),ot=>p(h,ot)),g(Pe,qe)};X(U,Pe=>{e(s)&&Pe(W)})}var ee=c(U,2);{var we=Pe=>{var qe=jp(),tt=o(qe,!0);n(qe),R(()=>y(tt,e(w))),g(Pe,qe)};X(ee,Pe=>{e(w)&&Pe(we)})}var Ae=c(ee,2);{var He=Pe=>{var qe=Wp(),tt=c(o(qe),2),lt=o(tt,!0);n(tt),n(qe),R(()=>y(lt,e(x))),g(Pe,qe)};X(Ae,Pe=>{e(x)&&Pe(He)})}n(ge);var Ke=c(ge,2),Oe=o(Ke),Ee=c(Oe,2),et=o(Ee);{var dt=Pe=>{var qe=Hp();Et(),g(Pe,qe)},ut=Pe=>{var qe=Ya("Generate Warning");g(Pe,qe)};X(et,Pe=>{e(_)?Pe(dt):Pe(ut,!1)})}n(Ee),n(Ke),R(Pe=>{y(Te,(kt(l()),m(()=>l().assignedToEmployee||l().assignedTo))),y(pe,(kt(l()),m(()=>l().assignedBy))),y(I,(kt(l()),m(()=>l().assignmentType||"Individual"))),y(ce,(kt(l()),m(()=>l().branch||"Not specified"))),y(S,(kt(l()),m(()=>l().totalAssigned))),y(We,(kt(l()),m(()=>l().totalCompleted))),y(V,(kt(l()),m(()=>l().totalOverdue))),y(ve,`${Pe??""}%`),Ee.disabled=e(_)||!e(v)||!e(u)||e(s)&&!e(f)},[()=>(kt(l()),m(()=>l().totalAssigned>0?Math.round(l().totalCompleted/l().totalAssigned*100):0))]),Z("click",Me,function(...Pe){var qe;(qe=d())==null||qe.apply(this,Pe)}),ra(Ye,()=>e(v),Pe=>p(v,Pe)),Z("click",Oe,function(...Pe){var qe;(qe=d())==null||qe.apply(this,Pe)}),Z("click",Ee,F),g(K,q)};X(D,K=>{e(T)||K(E)})}n(ue);var he=c(ue,2);{var xe=K=>{Np(K,{get data(){return e(b)},$$events:{close:re}})};X(he,K=>{e(T)&&e(b)&&K(xe)})}g(t,me),ma()}var Yp=k('<div class="error-message svelte-1tgo1f7"> </div>'),Kp=k('<div class="loading-section svelte-1tgo1f7"><div class="loading-spinner svelte-1tgo1f7"></div> <p class="svelte-1tgo1f7">Loading task status data...</p></div>'),Qp=k('<option class="svelte-1tgo1f7"> </option>'),Zp=k('<select class="branch-select svelte-1tgo1f7"><option class="svelte-1tgo1f7">All Branches</option><!></select>'),Jp=k('<div class="empty-state svelte-1tgo1f7"><svg class="w-16 h-16 text-gray-400 svelte-1tgo1f7" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2" class="svelte-1tgo1f7"></path></svg> <h3 class="svelte-1tgo1f7">No Task Assignments Found</h3> <p class="svelte-1tgo1f7">No task assignments match the current filter criteria.</p></div>'),e1=k('<span class="employee-name svelte-1tgo1f7"> </span>'),t1=k('<tr class="svelte-1tgo1f7"><td class="font-medium svelte-1tgo1f7"> </td><td class="svelte-1tgo1f7"><div class="user-info svelte-1tgo1f7"><span class="username svelte-1tgo1f7"> </span> <!></div></td><td class="svelte-1tgo1f7"> </td><td class="svelte-1tgo1f7"><span class="count-badge count-total svelte-1tgo1f7"> </span></td><td class="svelte-1tgo1f7"><span class="count-badge count-completed svelte-1tgo1f7"> </span></td><td class="svelte-1tgo1f7"><span class="count-badge count-overdue svelte-1tgo1f7"> </span></td><td class="svelte-1tgo1f7"><span class="count-badge count-reassigned svelte-1tgo1f7"> </span></td><td class="svelte-1tgo1f7"><div class="action-buttons svelte-1tgo1f7"><button class="action-btn reminder-btn svelte-1tgo1f7" title="Send Reminder Notification"><svg class="w-4 h-4 svelte-1tgo1f7" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-5 5v-5z" class="svelte-1tgo1f7"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 7h6l2 2H9V7z" class="svelte-1tgo1f7"></path></svg> Reminder</button> <button class="action-btn warning-btn svelte-1tgo1f7" title="Send Warning"><svg class="w-4 h-4 svelte-1tgo1f7" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4.5c-.77-.833-2.694-.833-3.464 0L3.34 16.5c-.77.833.192 2.5 1.732 2.5z" class="svelte-1tgo1f7"></path></svg> Warning</button></div></td></tr>'),a1=k('<table class="assignments-table svelte-1tgo1f7"><thead class="svelte-1tgo1f7"><tr class="svelte-1tgo1f7"><th class="svelte-1tgo1f7">Assigned By</th><th class="svelte-1tgo1f7">Assigned To</th><th class="svelte-1tgo1f7">Branch</th><th class="svelte-1tgo1f7">Assigned</th><th class="svelte-1tgo1f7">Completed</th><th class="svelte-1tgo1f7">Overdue</th><th class="svelte-1tgo1f7">Reassigned</th><th class="svelte-1tgo1f7">Actions</th></tr></thead><tbody class="svelte-1tgo1f7"></tbody></table>'),r1=k('<div class="stats-section svelte-1tgo1f7"><h2 class="section-title svelte-1tgo1f7">Task Overview</h2> <div class="stats-grid svelte-1tgo1f7"><div class="stat-card svelte-1tgo1f7"><div class="stat-icon bg-blue-100 svelte-1tgo1f7"><svg class="w-6 h-6 text-blue-600 svelte-1tgo1f7" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2" class="svelte-1tgo1f7"></path></svg></div> <div class="stat-content svelte-1tgo1f7"><h3 class="stat-label svelte-1tgo1f7">Total Assigned Tasks</h3> <p class="stat-value svelte-1tgo1f7"> </p></div></div> <div class="stat-card svelte-1tgo1f7"><div class="stat-icon bg-green-100 svelte-1tgo1f7"><svg class="w-6 h-6 text-green-600 svelte-1tgo1f7" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" class="svelte-1tgo1f7"></path></svg></div> <div class="stat-content svelte-1tgo1f7"><h3 class="stat-label svelte-1tgo1f7">Total Completed Tasks</h3> <p class="stat-value svelte-1tgo1f7"> </p> <span class="stat-percentage text-green-600 svelte-1tgo1f7"> </span></div></div> <div class="stat-card svelte-1tgo1f7"><div class="stat-icon bg-red-100 svelte-1tgo1f7"><svg class="w-6 h-6 text-red-600 svelte-1tgo1f7" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" class="svelte-1tgo1f7"></path></svg></div> <div class="stat-content svelte-1tgo1f7"><h3 class="stat-label svelte-1tgo1f7">Total Overdue Tasks</h3> <p class="stat-value svelte-1tgo1f7"> </p> <span class="stat-percentage text-red-600 svelte-1tgo1f7"> </span></div></div></div></div> <div class="assignments-section svelte-1tgo1f7"><div class="section-header svelte-1tgo1f7"><h2 class="section-title svelte-1tgo1f7">Task Assignments</h2> <div class="branch-filter svelte-1tgo1f7"><button>All Branches</button> <button>Choose Branch</button> <!></div></div> <div class="table-container svelte-1tgo1f7"><!></div></div>',1),s1=k('<div class="task-status-view svelte-1tgo1f7"><div class="header svelte-1tgo1f7"><div class="title-section svelte-1tgo1f7"><h1 class="title svelte-1tgo1f7">Task Status Dashboard</h1> <p class="subtitle svelte-1tgo1f7">Monitor task progress and send notifications</p></div> <button class="refresh-btn svelte-1tgo1f7"><svg class="w-5 h-5 svelte-1tgo1f7" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" class="svelte-1tgo1f7"></path></svg> <span class="svelte-1tgo1f7">Refresh</span></button></div> <!> <!></div>');function Xl(t,r){pa(r,!1);let a=Q(!0),s=Q(null),i=Q({totalAssigned:0,totalCompleted:0,totalOverdue:0,completionPercentage:0,overduePercentage:0}),l=Q([]),d=Q("all"),v=Q("all"),u=[],f=Q([]);Aa(()=>{h()});async function h(){p(a,!0),p(s,null);try{await Promise.all([_(),x(),T()])}catch(K){p(s,"Failed to load task status data: "+K.message),console.error("Error loading task status data:",K)}finally{p(a,!1)}}async function _(){try{const{data:K,error:q}=await Tt.from("task_assignments").select(`
					id,
					status,
					deadline_datetime,
					assigned_at
				`);if(q)throw q;const ae=new Date,Me=K.length,ge=K.filter(Be=>Be.status==="completed").length,Ne=K.filter(Be=>Be.deadline_datetime&&new Date(Be.deadline_datetime)<ae&&Be.status!=="completed").length;p(i,{totalAssigned:Me,totalCompleted:ge,totalOverdue:Ne,completionPercentage:Me>0?Math.round(ge/Me*100):0,overduePercentage:Me>0?Math.round(Ne/Me*100):0})}catch(K){throw console.error("Error loading task statistics:",K),K}}async function x(){try{const{data:K,error:q}=await Tt.from("branches").select("id, name_en").order("name_en");if(q)throw q;p(l,(K||[]).map(ae=>({id:ae.id,name:ae.name_en})))}catch(K){throw console.error("Error loading branches:",K),K}}async function T(){try{const{data:K,error:q}=await Tt.from("task_assignments").select(`
					id,
					assigned_by,
					assigned_by_name,
					assigned_to_user_id,
					assigned_to_branch_id,
					assignment_type,
					status,
					deadline_datetime,
					reassigned_from,
					assigned_at
				`);if(q)throw q;const ae=[...new Set([...K.map(ye=>ye.assigned_by).filter(Boolean),...K.map(ye=>ye.assigned_to_user_id).filter(Boolean)])];let Me=[];if(ae.length>0){const{data:ye,error:P}=await Tt.from("users").select(`
						id,
						username,
						employee_id,
						branch_id,
						hr_employees(id, name),
						branches(id, name_en)
					`).in("id",ae);P||(Me=ye||[])}const ge=[...new Set(K.map(ye=>ye.assigned_to_branch_id).filter(Boolean))];let Ne=[];if(ge.length>0){const{data:ye,error:P}=await Tt.from("branches").select("id, name_en as name").in("id",ge);P||(Ne=ye||[])}const Be={},be=new Date,L={};Me.forEach(ye=>{L[ye.id]=ye});const Te={};Ne.forEach(ye=>{Te[ye.id]=ye}),K.forEach(ye=>{var ce,J,le,S;const P=L[ye.assigned_by],pe=L[ye.assigned_to_user_id],B=Te[ye.assigned_to_branch_id];let j,I,Y;if(I=((ce=P==null?void 0:P.hr_employees)==null?void 0:ce.name)||(P==null?void 0:P.username)||ye.assigned_by,ye.assignment_type==="user"&&ye.assigned_to_user_id)j=`${ye.assigned_by}-${ye.assigned_to_user_id}`,Y=((J=pe==null?void 0:pe.hr_employees)==null?void 0:J.name)||(pe==null?void 0:pe.username)||`User ${ye.assigned_to_user_id}`;else if(ye.assignment_type==="branch"&&ye.assigned_to_branch_id)j=`${ye.assigned_by}-branch-${ye.assigned_to_branch_id}`,Y=`Branch: ${(B==null?void 0:B.name)||ye.assigned_to_branch_id}`;else if(ye.assignment_type==="all")j=`${ye.assigned_by}-all`,Y="All Users";else return;Be[j]||(Be[j]={assignedBy:I,assignedTo:Y,assignedToEmployee:((le=pe==null?void 0:pe.hr_employees)==null?void 0:le.name)||"",branch:(B==null?void 0:B.name)||((S=pe==null?void 0:pe.branches)==null?void 0:S.name_en)||"",totalAssigned:0,totalCompleted:0,totalOverdue:0,totalReassigned:0,assignedToUserId:ye.assigned_to_user_id,assignedByUserId:ye.assigned_by,assignmentType:ye.assignment_type,assignedToBranchId:ye.assigned_to_branch_id});const fe=Be[j];fe.totalAssigned++,ye.status==="completed"&&fe.totalCompleted++,ye.deadline_datetime&&new Date(ye.deadline_datetime)<be&&ye.status!=="completed"&&fe.totalOverdue++,ye.reassigned_from&&fe.totalReassigned++}),u=Object.values(Be),b()}catch(K){throw console.error("Error loading assignment data:",K),K}}function b(){e(v)==="all"||e(d)==="all"?p(f,[...u]):p(f,u.filter(K=>!0))}function w(K){p(v,K),K==="all"&&p(d,"all"),b()}function A(){b()}async function C(K){try{const{error:q}=await Tt.from("notifications").insert({title:"Task Reminder",message:`Reminder: You have pending tasks assigned by ${K.assignedBy}`,type:"info",priority:"medium",target_type:"specific_users",target_users:JSON.stringify([K.assignedToUserId]),created_by:K.assignedByUserId,created_by_name:K.assignedBy,created_by_role:"Manager",status:"published",has_attachments:!1,read_count:0,total_recipients:1});if(q)throw q;alert("Reminder notification sent successfully!")}catch(q){console.error("Error sending reminder:",q),alert("Failed to send reminder notification: "+q.message)}}function z(K){Kt.openWindow({component:Xp,title:"Generate Warning",props:{assignment:K,onClose:()=>{loadDataFromSupabase()}},width:600,height:700,resizable:!0})}ha();var F=s1(),re=o(F),me=c(o(re),2);n(re);var ue=c(re,2);{var D=K=>{var q=Yp(),ae=o(q,!0);n(q),R(()=>y(ae,e(s))),g(K,q)};X(ue,K=>{e(s)&&K(D)})}var E=c(ue,2);{var he=K=>{var q=Kp();g(K,q)},xe=K=>{var q=r1(),ae=Bt(q),Me=c(o(ae),2),ge=o(Me),Ne=c(o(ge),2),Be=c(o(Ne),2),be=o(Be,!0);n(Be),n(Ne),n(ge);var L=c(ge,2),Te=c(o(L),2),ye=c(o(Te),2),P=o(ye,!0);n(ye);var pe=c(ye,2),B=o(pe);n(pe),n(Te),n(L);var j=c(L,2),I=c(o(j),2),Y=c(o(I),2),fe=o(Y,!0);n(Y);var ce=c(Y,2),J=o(ce);n(ce),n(I),n(j),n(Me),n(ae);var le=c(ae,2),S=o(le),De=c(o(S),2),Ue=o(De),We=c(Ue,2),ke=c(We,2);{var N=Ie=>{var Ye=Zp();R(()=>{e(d),Xt(()=>{e(l)})});var oe=o(Ye);oe.value=oe.__value="all";var se=c(oe);Mt(se,1,()=>e(l),Lt,(U,W)=>{var ee=Qp(),we=o(ee,!0);n(ee);var Ae={};R(()=>{y(we,e(W).name),Ae!==(Ae=e(W).id)&&(ee.value=(ee.__value=e(W).id)??"")}),g(U,ee)}),n(Ye),ra(Ye,()=>e(d),U=>p(d,U)),Z("change",Ye,A),g(Ie,Ye)};X(ke,Ie=>{e(v)==="choose"&&Ie(N)})}n(De),n(S);var V=c(S,2),G=o(V);{var de=Ie=>{var Ye=Jp();g(Ie,Ye)},ve=Ie=>{var Ye=a1(),oe=c(o(Ye));Mt(oe,5,()=>e(f),Lt,(se,U)=>{var W=t1(),ee=o(W),we=o(ee,!0);n(ee);var Ae=c(ee),He=o(Ae),Ke=o(He),Oe=o(Ke,!0);n(Ke);var Ee=c(Ke,2);{var et=vt=>{var xt=e1(),M=o(xt,!0);n(xt),R(()=>y(M,e(U).assignedToEmployee)),g(vt,xt)};X(Ee,vt=>{e(U).assignedToEmployee&&vt(et)})}n(He),n(Ae);var dt=c(Ae),ut=o(dt,!0);n(dt);var Pe=c(dt),qe=o(Pe),tt=o(qe,!0);n(qe),n(Pe);var lt=c(Pe),Xe=o(lt),at=o(Xe,!0);n(Xe),n(lt);var Fe=c(lt),rt=o(Fe),Ce=o(rt,!0);n(rt),n(Fe);var _e=c(Fe),Ve=o(_e),Je=o(Ve,!0);n(Ve),n(_e);var st=c(_e),ot=o(st),Le=o(ot),nt=c(Le,2);n(ot),n(st),n(W),R(()=>{y(we,e(U).assignedBy),y(Oe,e(U).assignedTo),y(ut,e(U).branch),y(tt,e(U).totalAssigned),y(at,e(U).totalCompleted),y(Ce,e(U).totalOverdue),y(Je,e(U).totalReassigned)}),Z("click",Le,()=>C(e(U))),Z("click",nt,()=>z(e(U))),g(se,W)}),n(oe),n(Ye),g(Ie,Ye)};X(G,Ie=>{e(f).length===0?Ie(de):Ie(ve,!1)})}n(V),n(le),R(()=>{y(be,e(i).totalAssigned),y(P,e(i).totalCompleted),y(B,`${e(i).completionPercentage??""}%`),y(fe,e(i).totalOverdue),y(J,`${e(i).overduePercentage??""}%`),wt(Ue,1,`filter-btn ${e(v)==="all"?"active":""}`,"svelte-1tgo1f7"),wt(We,1,`filter-btn ${e(v)==="choose"?"active":""}`,"svelte-1tgo1f7")}),Z("click",Ue,()=>w("all")),Z("click",We,()=>w("choose")),g(K,q)};X(E,K=>{e(a)?K(he):K(xe,!1)})}n(F),R(()=>me.disabled=e(a)),Z("click",me,h),g(t,F),ma()}var i1=k('<div class="stat-card loading svelte-1u9uxg5"><div class="loading-bar svelte-1u9uxg5"></div> <div class="loading-number svelte-1u9uxg5"></div></div>'),n1=k('<div class="stat-card svelte-1u9uxg5"><div class="stat-content svelte-1u9uxg5"><div class="stat-icon bg-blue-100 svelte-1u9uxg5"><svg class="w-6 h-6 text-blue-600 svelte-1u9uxg5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2" class="svelte-1u9uxg5"></path></svg></div> <div class="stat-info svelte-1u9uxg5"><p class="stat-label svelte-1u9uxg5">Total Tasks</p> <p class="stat-value svelte-1u9uxg5"> </p></div></div></div> <div class="stat-card svelte-1u9uxg5"><div class="stat-content svelte-1u9uxg5"><div class="stat-icon bg-green-100 svelte-1u9uxg5"><svg class="w-6 h-6 text-green-600 svelte-1u9uxg5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" class="svelte-1u9uxg5"></path></svg></div> <div class="stat-info svelte-1u9uxg5"><p class="stat-label svelte-1u9uxg5">Active Tasks</p> <p class="stat-value svelte-1u9uxg5"> </p></div></div></div> <div class="stat-card svelte-1u9uxg5"><div class="stat-content svelte-1u9uxg5"><div class="stat-icon bg-purple-100 svelte-1u9uxg5"><svg class="w-6 h-6 text-purple-600 svelte-1u9uxg5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" class="svelte-1u9uxg5"></path></svg></div> <div class="stat-info svelte-1u9uxg5"><p class="stat-label svelte-1u9uxg5">Completed Tasks</p> <p class="stat-value svelte-1u9uxg5"> </p></div></div></div> <div class="stat-card svelte-1u9uxg5"><div class="stat-content svelte-1u9uxg5"><div class="stat-icon bg-orange-100 svelte-1u9uxg5"><svg class="w-6 h-6 text-orange-600 svelte-1u9uxg5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" class="svelte-1u9uxg5"></path></svg></div> <div class="stat-info svelte-1u9uxg5"><p class="stat-label svelte-1u9uxg5">My Assigned</p> <p class="stat-value svelte-1u9uxg5"> </p></div></div></div> <div class="stat-card svelte-1u9uxg5"><div class="stat-content svelte-1u9uxg5"><div class="stat-icon bg-teal-100 svelte-1u9uxg5"><svg class="w-6 h-6 text-teal-600 svelte-1u9uxg5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" class="svelte-1u9uxg5"></path></svg></div> <div class="stat-info svelte-1u9uxg5"><p class="stat-label svelte-1u9uxg5">My Completed</p> <p class="stat-value svelte-1u9uxg5"> </p></div></div></div>',1),o1=k('<div class="task-master-dashboard svelte-1u9uxg5"><div class="header svelte-1u9uxg5"><div class="title-section svelte-1u9uxg5"><div class="flex items-center justify-center space-x-3 mb-4 svelte-1u9uxg5"><div class="bg-blue-100 p-3 rounded-lg svelte-1u9uxg5"><svg class="w-8 h-8 text-blue-600 svelte-1u9uxg5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01" class="svelte-1u9uxg5"></path></svg></div></div> <h1 class="title svelte-1u9uxg5">Task Master Dashboard</h1> <p class="subtitle svelte-1u9uxg5">Comprehensive Task Management System</p> <button class="refresh-btn svelte-1u9uxg5" title="Refresh Data"><svg class="w-5 h-5 svelte-1u9uxg5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" class="svelte-1u9uxg5"></path></svg> <span class="svelte-1u9uxg5">Refresh</span></button></div></div> <div class="stats-grid svelte-1u9uxg5"><!></div> <div class="dashboard-grid svelte-1u9uxg5"><div class="dashboard-card svelte-1u9uxg5"><div class="card-icon bg-green-100 svelte-1u9uxg5"><span class="icon text-green-600 svelte-1u9uxg5">✨</span></div> <div class="card-content svelte-1u9uxg5"><h3 class="card-title svelte-1u9uxg5">Create Task Template</h3> <p class="card-description svelte-1u9uxg5">Add new task templates with details, criteria, and assignments</p></div> <div class="card-arrow svelte-1u9uxg5"><span class="svelte-1u9uxg5">→</span></div></div> <div class="dashboard-card svelte-1u9uxg5"><div class="card-icon bg-blue-100 svelte-1u9uxg5"><span class="icon text-blue-600 svelte-1u9uxg5">📋</span></div> <div class="card-content svelte-1u9uxg5"><h3 class="card-title svelte-1u9uxg5">View Task Templates</h3> <p class="card-description svelte-1u9uxg5">Browse, search, and manage all created task templates</p></div> <div class="card-arrow svelte-1u9uxg5"><span class="svelte-1u9uxg5">→</span></div></div> <div class="dashboard-card svelte-1u9uxg5"><div class="card-icon bg-orange-100 svelte-1u9uxg5"><span class="icon text-orange-600 svelte-1u9uxg5">📝</span></div> <div class="card-content svelte-1u9uxg5"><h3 class="card-title svelte-1u9uxg5">View My Tasks</h3> <p class="card-description svelte-1u9uxg5">View and complete tasks assigned to you</p></div> <div class="card-arrow svelte-1u9uxg5"><span class="svelte-1u9uxg5">→</span></div></div> <div class="dashboard-card svelte-1u9uxg5"><div class="card-icon bg-purple-100 svelte-1u9uxg5"><span class="icon text-purple-600 svelte-1u9uxg5">👥</span></div> <div class="card-content svelte-1u9uxg5"><h3 class="card-title svelte-1u9uxg5">Assign Tasks</h3> <p class="card-description svelte-1u9uxg5">Assign tasks to users with advanced filtering</p></div> <div class="card-arrow svelte-1u9uxg5"><span class="svelte-1u9uxg5">→</span></div></div> <div class="dashboard-card svelte-1u9uxg5"><div class="card-icon bg-indigo-100 svelte-1u9uxg5"><span class="icon text-indigo-600 svelte-1u9uxg5">📊</span></div> <div class="card-content svelte-1u9uxg5"><h3 class="card-title svelte-1u9uxg5">Task Status</h3> <p class="card-description svelte-1u9uxg5">Monitor task progress, send reminders, and generate warnings</p></div> <div class="card-arrow svelte-1u9uxg5"><span class="svelte-1u9uxg5">→</span></div></div></div> <div class="features-section svelte-1u9uxg5"><div class="features-header svelte-1u9uxg5"><div class="features-icon svelte-1u9uxg5"><svg class="w-6 h-6 text-blue-600 svelte-1u9uxg5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" class="svelte-1u9uxg5"></path></svg></div> <h3 class="features-title svelte-1u9uxg5">Task Master Features</h3></div> <div class="features-grid svelte-1u9uxg5"><div class="feature-item svelte-1u9uxg5"><svg class="w-4 h-4 text-green-500 svelte-1u9uxg5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" class="svelte-1u9uxg5"></path></svg> <span class="svelte-1u9uxg5">Create task templates with detailed criteria and attachments</span></div> <div class="feature-item svelte-1u9uxg5"><svg class="w-4 h-4 text-green-500 svelte-1u9uxg5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" class="svelte-1u9uxg5"></path></svg> <span class="svelte-1u9uxg5">Advanced search and filtering capabilities</span></div> <div class="feature-item svelte-1u9uxg5"><svg class="w-4 h-4 text-green-500 svelte-1u9uxg5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" class="svelte-1u9uxg5"></path></svg> <span class="svelte-1u9uxg5">View and complete assigned tasks</span></div> <div class="feature-item svelte-1u9uxg5"><svg class="w-4 h-4 text-green-500 svelte-1u9uxg5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" class="svelte-1u9uxg5"></path></svg> <span class="svelte-1u9uxg5">Bulk task assignment with role-based access</span></div> <div class="feature-item svelte-1u9uxg5"><svg class="w-4 h-4 text-green-500 svelte-1u9uxg5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" class="svelte-1u9uxg5"></path></svg> <span class="svelte-1u9uxg5">Real-time task status tracking and notifications</span></div></div></div></div>');function l1(t,r){pa(r,!1);let a=Q({total_tasks:0,active_tasks:0,completed_tasks:0,my_assigned_tasks:0,my_completed_tasks:0}),s=Q(!0);function i(xe){return`${xe}-${Date.now()}-${Math.random().toString(36).substr(2,9)}`}async function l(){try{p(s,!0);const xe=await nu("e1fdaee2-97f0-4fc1-872f-9d99c6bd684b");xe.success&&xe.data?p(a,xe.data):console.error("Error fetching task statistics:",xe.error)}catch(xe){console.error("Error fetching task statistics:",xe)}finally{p(s,!1)}}Aa(()=>{l();const xe=setInterval(l,6e4);return()=>clearInterval(xe)});function d(){const xe=i("create-task");Kt.openWindow({id:xe,title:"Create New Task Template",component:nn,icon:"📝",size:{width:600,height:500},position:{x:100+Math.random()*100,y:100+Math.random()*100},resizable:!0,minimizable:!0,maximizable:!0,closable:!0})}function v(){const xe=i("view-tasks"),K=Math.floor(Math.random()*1e3)+1;Kt.openWindow({id:xe,title:`View Task Templates #${K}`,component:zu,icon:"📋",size:{width:1e3,height:700},position:{x:50+Math.random()*50,y:50+Math.random()*50},resizable:!0,minimizable:!0,maximizable:!0,closable:!0})}function u(){const xe=i("assign-tasks"),K=Math.floor(Math.random()*1e3)+1;Kt.openWindow({id:xe,title:`Assign Tasks #${K}`,component:Lf,icon:"👥",size:{width:900,height:600},position:{x:100+Math.random()*100,y:100+Math.random()*100},resizable:!0,minimizable:!0,maximizable:!0,closable:!0})}function f(){const xe=i("task-status"),K=Math.floor(Math.random()*1e3)+1;Kt.openWindow({id:xe,title:`Task Status #${K}`,component:Xl,icon:"📊",size:{width:1200,height:800},position:{x:50+Math.random()*100,y:50+Math.random()*100},resizable:!0,minimizable:!0,maximizable:!0,closable:!0})}function h(){const xe=i("my-tasks"),K=Math.floor(Math.random()*1e3)+1;Kt.openWindow({id:xe,title:`My Tasks #${K}`,component:wp,icon:"📋",size:{width:1e3,height:700},position:{x:50+Math.random()*100,y:50+Math.random()*100},resizable:!0,minimizable:!0,maximizable:!0,closable:!0})}function _(){l()}ha();var x=o1(),T=o(x),b=o(T),w=c(o(b),6);n(b),n(T);var A=c(T,2),C=o(A);{var z=xe=>{var K=Ca(),q=Bt(K);Mt(q,0,()=>Array(5),Lt,(ae,Me)=>{var ge=i1();g(ae,ge)}),g(xe,K)},F=xe=>{var K=n1(),q=Bt(K),ae=o(q),Me=c(o(ae),2),ge=c(o(Me),2),Ne=o(ge,!0);n(ge),n(Me),n(ae),n(q);var Be=c(q,2),be=o(Be),L=c(o(be),2),Te=c(o(L),2),ye=o(Te,!0);n(Te),n(L),n(be),n(Be);var P=c(Be,2),pe=o(P),B=c(o(pe),2),j=c(o(B),2),I=o(j,!0);n(j),n(B),n(pe),n(P);var Y=c(P,2),fe=o(Y),ce=c(o(fe),2),J=c(o(ce),2),le=o(J,!0);n(J),n(ce),n(fe),n(Y);var S=c(Y,2),De=o(S),Ue=c(o(De),2),We=c(o(Ue),2),ke=o(We,!0);n(We),n(Ue),n(De),n(S),R(()=>{y(Ne,e(a).total_tasks),y(ye,e(a).active_tasks),y(I,e(a).completed_tasks),y(le,e(a).my_assigned_tasks),y(ke,e(a).my_completed_tasks)}),g(xe,K)};X(C,xe=>{e(s)?xe(z):xe(F,!1)})}n(A);var re=c(A,2),me=o(re),ue=c(me,2),D=c(ue,2),E=c(D,2),he=c(E,2);n(re),Et(2),n(x),Z("click",w,_),Z("click",me,d),Z("click",ue,v),Z("click",D,h),Z("click",E,u),Z("click",he,f),g(t,x),ma()}class c1{constructor(){Zs(this,"dbName","aqura-offline-db");Zs(this,"dbVersion",1);Zs(this,"db",null)}async init(){return new Promise((r,a)=>{const s=indexedDB.open(this.dbName,this.dbVersion);s.onerror=()=>a(s.error),s.onsuccess=()=>{this.db=s.result,r()},s.onupgradeneeded=i=>{const l=i.target.result;l.objectStoreNames.contains("cachedData")||l.createObjectStore("cachedData",{keyPath:"type"}),l.objectStoreNames.contains("pendingOperations")||l.createObjectStore("pendingOperations",{keyPath:"id"}).createIndex("type","type",{unique:!1}),l.objectStoreNames.contains("settings")||l.createObjectStore("settings",{keyPath:"key"})}})}async cacheData(r,a){return this.db||await this.init(),new Promise((s,i)=>{const v=this.db.transaction(["cachedData"],"readwrite").objectStore("cachedData").put({type:r,data:a,lastUpdated:Date.now()});v.onsuccess=()=>s(),v.onerror=()=>i(v.error)})}async getCachedData(r){return this.db||await this.init(),new Promise((a,s)=>{const d=this.db.transaction(["cachedData"],"readonly").objectStore("cachedData").get(r);d.onsuccess=()=>{const v=d.result;a(v?v.data:[])},d.onerror=()=>s(d.error)})}async addPendingOperation(r){this.db||await this.init();const a={...r,id:crypto.randomUUID(),timestamp:Date.now()};return new Promise((s,i)=>{const v=this.db.transaction(["pendingOperations"],"readwrite").objectStore("pendingOperations").add(a);v.onsuccess=()=>{this.registerBackgroundSync(r.type),s()},v.onerror=()=>i(v.error)})}async getPendingOperations(r){return this.db||await this.init(),new Promise((a,s)=>{const v=this.db.transaction(["pendingOperations"],"readonly").objectStore("pendingOperations").index("type").getAll(r);v.onsuccess=()=>a(v.result),v.onerror=()=>s(v.error)})}async removePendingOperation(r){return this.db||await this.init(),new Promise((a,s)=>{const d=this.db.transaction(["pendingOperations"],"readwrite").objectStore("pendingOperations").delete(r);d.onsuccess=()=>a(),d.onerror=()=>s(d.error)})}async registerBackgroundSync(r){if("serviceWorker"in navigator&&"sync"in window.ServiceWorkerRegistration.prototype)try{const a=await navigator.serviceWorker.ready;a.sync&&(await a.sync.register(`background-sync-${r}`),console.log(`Background sync registered for ${r}`))}catch(a){console.error("Background sync registration failed:",a)}}isOnline(){return navigator.onLine}async syncData(r){if(!this.isOnline())return console.log("Cannot sync - offline"),!1;try{const a=await this.getPendingOperations(r);for(const s of a)try{const i=await fetch(`/api/${r}`,{method:s.method,headers:{"Content-Type":"application/json"},body:JSON.stringify(s.data)});i.ok?(await this.removePendingOperation(s.id),console.log(`Synced ${r} operation:`,s.id)):console.error(`Failed to sync ${r} operation:`,i.statusText)}catch(i){console.error(`Error syncing ${r} operation:`,i);break}return(a.length===0||this.isOnline())&&await this.refreshCachedData(r),!0}catch(a){return console.error(`Sync failed for ${r}:`,a),!1}}async refreshCachedData(r){try{const a=await fetch(`/api/${r}`);if(a.ok){const s=await a.json();await this.cacheData(r,s)}}catch(a){console.error(`Failed to refresh ${r} data:`,a)}}async syncAllData(){const r=["employees","branches","vendors","users"];for(const a of r)await this.syncData(a)}setupNetworkListeners(){window.addEventListener("online",()=>{console.log("Connection restored - starting sync"),this.syncAllData()}),window.addEventListener("offline",()=>{console.log("Connection lost - switching to offline mode")})}async needsRefresh(r){return this.db||await this.init(),new Promise((a,s)=>{const d=this.db.transaction(["cachedData"],"readonly").objectStore("cachedData").get(r);d.onsuccess=()=>{const v=d.result;if(!v){a(!0);return}const u=5*60*1e3,f=Date.now()-v.lastUpdated>u;a(f)},d.onerror=()=>s(d.error)})}async getData(r){if(this.isOnline())try{await this.needsRefresh(r)&&await this.refreshCachedData(r)}catch(a){console.warn(`Failed to refresh ${r}, using cached data:`,a)}return this.getCachedData(r)}}const rs=new c1,d1=[{id:"1",name:"أحمد محمد الأحمد",email:"ahmed.mohamed@aqura.sa",phone:"+966-50-123-4567",position:"Senior Developer",department:"IT",salary:12e3,hire_date:"2022-01-15",status:"active",avatar_url:"https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?w=150&h=150&fit=crop&crop=face",branch_id:"1",created_at:"2022-01-15T00:00:00Z",updated_at:"2024-01-15T00:00:00Z"},{id:"2",name:"فاطمة علي السالم",email:"fatima.ali@aqura.sa",phone:"+966-50-234-5678",position:"Marketing Manager",department:"Marketing",salary:9500,hire_date:"2021-06-20",status:"active",avatar_url:"https://images.unsplash.com/photo-1494790108755-2616b612b786?w=150&h=150&fit=crop&crop=face",branch_id:"1",created_at:"2021-06-20T00:00:00Z",updated_at:"2024-01-15T00:00:00Z"},{id:"3",name:"خالد عبدالله النصر",email:"khalid.abdullah@aqura.sa",phone:"+966-50-345-6789",position:"Sales Representative",department:"Sales",salary:7e3,hire_date:"2023-03-10",status:"on_leave",avatar_url:"https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=150&h=150&fit=crop&crop=face",branch_id:"2",created_at:"2023-03-10T00:00:00Z",updated_at:"2024-01-15T00:00:00Z"}],v1=[{id:"1",name_en:"Central Riyadh",name_ar:"الرياض المركزي",location_en:"King Fahd Road, Riyadh 12345",location_ar:"شارع الملك فهد، الرياض 12345",is_active:!0,is_main_branch:!0,created_at:"2020-01-15T00:00:00Z",updated_at:"2024-01-15T00:00:00Z"},{id:"2",name_en:"West Jeddah",name_ar:"جدة الغربي",location_en:"Prince Abdulaziz Road, Jeddah 21589",location_ar:"طريق الأمير عبدالعزيز، جدة 21589",is_active:!0,is_main_branch:!1,created_at:"2020-03-20T00:00:00Z",updated_at:"2024-01-15T00:00:00Z"},{id:"3",name_en:"East Dammam",name_ar:"الدمام الشرقي",location_en:"King Saud Road, Dammam 34217",location_ar:"شارع الملك سعود، الدمام 34217",is_active:!0,is_main_branch:!1,created_at:"2020-06-10T00:00:00Z",updated_at:"2024-01-15T00:00:00Z"}],u1=[{id:"1",name:"محمد أحمد التجاري",company:"شركة التقنية المتقدمة",email:"mohammed@techadvanced.sa",phone:"+966-50-111-2222",category:"Technology",status:"active",payment_terms:"30 days",tax_id:"1234567890",registration_number:"CR-12345678",address:"الرياض، المملكة العربية السعودية",total_orders:45,created_at:"2021-01-10T00:00:00Z",updated_at:"2024-01-15T00:00:00Z"},{id:"2",name:"سارة علي المكتبي",company:"مؤسسة اللوازم المكتبية",email:"sara@officesupplies.sa",phone:"+966-50-222-3333",category:"Office Supplies",status:"active",payment_terms:"15 days",tax_id:"2345678901",registration_number:"CR-23456789",address:"جدة، المملكة العربية السعودية",total_orders:28,created_at:"2021-03-15T00:00:00Z",updated_at:"2024-01-15T00:00:00Z"},{id:"3",name:"عبدالرحمن صالح الصناعي",company:"الشركة الصناعية الحديثة",email:"abdulrahman@modernindustrial.sa",phone:"+966-50-333-4444",category:"Manufacturing",status:"pending",payment_terms:"45 days",tax_id:"3456789012",registration_number:"CR-34567890",address:"الدمام، المملكة العربية السعودية",total_orders:12,created_at:"2023-11-20T00:00:00Z",updated_at:"2024-01-15T00:00:00Z"}],Fa={employees:{async getAll(){try{const t=await fa.employees.getAll();return t.data&&await rs.cacheData("employees",t.data),t}catch(t){console.warn("Supabase failed, using cached data:",t);const r=await rs.getCachedData("employees");return{data:r.length>0?r:d1,error:null}}},async getById(t){return await fa.employees.getById(t)},async create(t){{const r=await fa.employees.create(t);return!navigator.onLine&&!r.data&&await rs.addPendingOperation({type:"employees",method:"POST",data:t}),r}},async update(t,r){{const a=await fa.employees.update(t,r);return!navigator.onLine&&!a.data&&await rs.addPendingOperation({type:"employees",method:"PUT",data:{id:t,...r}}),a}},async delete(t){{const r=await fa.employees.delete(t);return!navigator.onLine&&r.error&&await rs.addPendingOperation({type:"employees",method:"DELETE",data:{id:t}}),r}}},hrDepartments:{async getAll(){try{const{data:t,error:r}=await Tt.from("hr_departments").select("*").order("created_at",{ascending:!1});return{data:t,error:r}}catch(t){return console.error("Failed to fetch HR departments:",t),{data:null,error:t.message}}},async create(t){try{const{data:r,error:a}=await Tt.from("hr_departments").insert([t]).select().single();return{data:r,error:a}}catch(r){return console.error("Failed to create HR department:",r),{data:null,error:r.message}}},async update(t,r){try{const{data:a,error:s}=await Tt.from("hr_departments").update(r).eq("id",t).select().single();return{data:a,error:s}}catch(a){return console.error("Failed to update HR department:",a),{data:null,error:a.message}}},async delete(t){try{const{error:r}=await Tt.from("hr_departments").delete().eq("id",t);return{error:r}}catch(r){return console.error("Failed to delete HR department:",r),{error:r.message}}}},hrLevels:{async getAll(){try{const{data:t,error:r}=await Tt.from("hr_levels").select("*").order("level_order",{ascending:!0});return{data:t,error:r}}catch(t){return console.error("Failed to fetch HR levels:",t),{data:null,error:t.message}}},async create(t){try{const{data:r,error:a}=await Tt.from("hr_levels").insert([t]).select().single();return{data:r,error:a}}catch(r){return console.error("Failed to create HR level:",r),{data:null,error:r.message}}},async update(t,r){try{const{data:a,error:s}=await Tt.from("hr_levels").update(r).eq("id",t).select().single();return{data:a,error:s}}catch(a){return console.error("Failed to update HR level:",a),{data:null,error:a.message}}},async delete(t){try{const{error:r}=await Tt.from("hr_levels").delete().eq("id",t);return{error:r}}catch(r){return console.error("Failed to delete HR level:",r),{error:r.message}}}},hrPositions:{async getAll(){try{const{data:t,error:r}=await Tt.from("hr_positions").select(`
							*,
							hr_departments:department_id (
								id,
								department_name_en,
								department_name_ar
							),
							hr_levels:level_id (
								id,
								level_name_en,
								level_name_ar,
								level_order
							)
						`).order("created_at",{ascending:!1});return{data:t,error:r}}catch(t){return console.error("Failed to fetch HR positions:",t),{data:null,error:t.message}}},async create(t){try{const{data:r,error:a}=await Tt.from("hr_positions").insert([t]).select(`
							*,
							hr_departments:department_id (
								id,
								department_name_en,
								department_name_ar
							),
							hr_levels:level_id (
								id,
								level_name_en,
								level_name_ar,
								level_order
							)
						`).single();return{data:r,error:a}}catch(r){return console.error("Failed to create HR position:",r),{data:null,error:r.message}}},async update(t,r){try{const{data:a,error:s}=await Tt.from("hr_positions").update(r).eq("id",t).select(`
							*,
							hr_departments:department_id (
								id,
								department_name_en,
								department_name_ar
							),
							hr_levels:level_id (
								id,
								level_name_en,
								level_name_ar,
								level_order
							)
						`).single();return{data:a,error:s}}catch(a){return console.error("Failed to update HR position:",a),{data:null,error:a.message}}},async delete(t){try{const{error:r}=await Tt.from("hr_positions").delete().eq("id",t);return{error:r}}catch(r){return console.error("Failed to delete HR position:",r),{error:r.message}}}},hrEmployees:{async getAll(){try{const{data:t,error:r}=await Tt.from("hr_employees").select(`
							*,
							branch:branch_id (
								id,
								name_en,
								name_ar,
								location_en,
								location_ar
							)
						`).order("employee_id",{ascending:!0});return{data:t,error:r}}catch(t){return console.error("Failed to fetch HR employees:",t),{data:null,error:t.message}}},async getByBranch(t){try{const{data:r,error:a}=await Tt.from("hr_employees").select(`
							*,
							branch:branch_id (
								id,
								name_en,
								name_ar,
								location_en,
								location_ar
							)
						`).eq("branch_id",t).order("employee_id",{ascending:!0});if(a)throw console.error("Employee query error:",a),a;if(!r||r.length===0)return{data:[],error:null};const s=r.map(f=>f.id);console.log("Looking for assignments for employee IDs:",s);const{data:i,error:l}=await Tt.from("hr_position_assignments").select("*").in("employee_id",s).eq("is_current",!0);console.log("Assignment query result:",{assignments:i,assignmentError:l}),l&&console.error("Assignment query error:",l);let d=[],v=[];if(i&&i.length>0){const f=[...new Set(i.map(w=>w.position_id))],h=[...new Set(i.map(w=>w.department_id))];console.log("Position IDs:",f),console.log("Department IDs:",h);const{data:_,error:x}=await Tt.from("hr_positions").select("*").in("id",f);console.log("Positions query result:",{positionsData:_,positionsError:x}),d=_||[];const{data:T,error:b}=await Tt.from("hr_departments").select("*").in("id",h);console.log("Departments query result:",{departmentsData:T,departmentsError:b}),v=T||[]}return{data:r.map(f=>{const h=i==null?void 0:i.find(T=>T.employee_id===f.id),_=h?d.find(T=>T.id===h.position_id):null,x=h?v.find(T=>T.id===h.department_id):null;return console.log(`Employee ${f.name}:`,{assignment:h,position:_,department:x}),{...f,department:(x==null?void 0:x.department_name_en)||(x==null?void 0:x.department_name_ar)||null,position:(_==null?void 0:_.position_title_en)||(_==null?void 0:_.position_title_ar)||null,department_code:(x==null?void 0:x.department_code)||null,position_code:(_==null?void 0:_.position_code)||null,assignment_data:h}}),error:null}}catch(r){return console.error("Failed to fetch HR employees by branch:",r),{data:null,error:r.message}}},async create(t){try{const{data:r,error:a}=await Tt.from("hr_employees").insert([{employee_id:t.employee_id,name:t.name,branch_id:t.branch_id,hire_date:t.hire_date,status:t.status||"active",created_at:new Date().toISOString()}]).select().single();return{data:r,error:a}}catch(r){return console.error("Failed to create HR employee:",r),{data:null,error:r.message}}},async syncEmployee(t,r,a,s,i){try{const{data:l,error:d}=await Tt.rpc("sync_employee_with_hr",{p_employee_id:t,p_employee_code:r,p_employee_name:a,p_branch_id:s||null,p_position_title:i||null});return{data:l,error:d}}catch(l){return console.error("Failed to sync employee with HR:",l),{data:null,error:l.message}}}},organizationalChart:{async getChart(){try{const{data:t,error:r}=await Tt.from("v_organizational_chart_real").select("*").order("level_order",{ascending:!0});return{data:t,error:r}}catch(t){return console.error("Failed to fetch organizational chart:",t),{data:null,error:t.message}}}},branches:{async getAll(){try{const{data:t,error:r}=await Tt.from("branches").select("*").eq("is_active",!0).order("name_en",{ascending:!0});return r?(console.error("Failed to fetch branches:",r),{data:null,error:r.message}):(t&&await rs.cacheData("branches",t),{data:t,error:null})}catch(t){console.error("Error fetching branches:",t);const r=await rs.getCachedData("branches");return{data:r.length>0?r:v1,error:null}}},async create(t){try{const{data:r,error:a}=await Tt.from("branches").insert([{name_en:t.name_en,name_ar:t.name_ar,location_en:t.location_en,location_ar:t.location_ar,is_active:t.is_active!==void 0?t.is_active:!0,is_main_branch:t.is_main_branch||!1,created_at:new Date().toISOString(),updated_at:new Date().toISOString()}]).select().single();return{data:r,error:a}}catch(r){return console.error("Failed to create branch:",r),{data:null,error:r.message}}},async update(t,r){try{const{data:a,error:s}=await Tt.from("branches").update({...r,updated_at:new Date().toISOString()}).eq("id",t).select().single();return{data:a,error:s}}catch(a){return console.error("Failed to update branch:",a),{data:null,error:a.message}}},async delete(t){try{const{error:r}=await Tt.from("branches").update({is_active:!1}).eq("id",t);return{error:r}}catch(r){return console.error("Failed to delete branch:",r),{error:r.message}}}},vendors:{async getAll(){try{const t=await fa.vendors.getAll();return t.data&&await rs.cacheData("vendors",t.data),t}catch{const r=await rs.getCachedData("vendors");return{data:r.length>0?r:u1,error:null}}},async create(t){return await fa.vendors.create(t)},async update(t,r){return await fa.vendors.update(t,r)},async delete(t){return await fa.vendors.delete(t)}},hrReporting:{async getAll(){try{const{data:t,error:r}=await Tt.from("hr_position_reporting_template").select(`
							*,
							subordinate_position:subordinate_position_id (
								id,
								position_title_en,
								position_title_ar,
								hr_departments:department_id (
									id,
									department_name_en,
									department_name_ar
								),
								hr_levels:level_id (
									id,
									level_name_en,
									level_name_ar,
									level_order
								)
							),
							manager_1:manager_position_1 (
								id,
								position_title_en,
								position_title_ar
							),
							manager_2:manager_position_2 (
								id,
								position_title_en,
								position_title_ar
							),
							manager_3:manager_position_3 (
								id,
								position_title_en,
								position_title_ar
							),
							manager_4:manager_position_4 (
								id,
								position_title_en,
								position_title_ar
							),
							manager_5:manager_position_5 (
								id,
								position_title_en,
								position_title_ar
							)
						`).eq("is_active",!0).order("created_at",{ascending:!1});return{data:t,error:r}}catch(t){return console.error("Failed to fetch HR reporting maps:",t),{data:null,error:t.message}}},async create(t){try{const r={subordinate_position_id:t.subordinate_position_id,is_active:!0,created_at:new Date().toISOString()};t.manager_positions[0]&&(r.manager_position_1=t.manager_positions[0]),t.manager_positions[1]&&(r.manager_position_2=t.manager_positions[1]),t.manager_positions[2]&&(r.manager_position_3=t.manager_positions[2]),t.manager_positions[3]&&(r.manager_position_4=t.manager_positions[3]),t.manager_positions[4]&&(r.manager_position_5=t.manager_positions[4]);const{data:a,error:s}=await Tt.from("hr_position_reporting_template").insert([r]).select(`
							*,
							subordinate_position:subordinate_position_id (
								id,
								position_title_en,
								position_title_ar
							)
						`).single();return{data:a,error:s}}catch(r){return console.error("Failed to create HR reporting map:",r),{data:null,error:r.message}}},async update(t,r){try{const a={};a.manager_position_1=null,a.manager_position_2=null,a.manager_position_3=null,a.manager_position_4=null,a.manager_position_5=null,r.manager_positions[0]&&(a.manager_position_1=r.manager_positions[0]),r.manager_positions[1]&&(a.manager_position_2=r.manager_positions[1]),r.manager_positions[2]&&(a.manager_position_3=r.manager_positions[2]),r.manager_positions[3]&&(a.manager_position_4=r.manager_positions[3]),r.manager_positions[4]&&(a.manager_position_5=r.manager_positions[4]);const{data:s,error:i}=await Tt.from("hr_position_reporting_template").update(a).eq("id",t).select(`
							*,
							subordinate_position:subordinate_position_id (
								id,
								position_title_en,
								position_title_ar
							)
						`).single();return{data:s,error:i}}catch(a){return console.error("Failed to update HR reporting map:",a),{data:null,error:a.message}}},async delete(t){try{const{error:r}=await Tt.from("hr_position_reporting_template").delete().eq("id",t);return{error:r}}catch(r){return console.error("Failed to delete HR reporting map:",r),{error:r.message}}}},hrAssignments:{async getAll(){try{const{data:t,error:r}=await Tt.from("hr_position_assignments").select(`
							*,
							employee:employee_id (
								id,
								employee_id,
								name
							),
							position:position_id (
								id,
								position_title_en,
								position_title_ar
							),
							department:department_id (
								id,
								department_name_en,
								department_name_ar
							),
							level:level_id (
								id,
								level_name_en,
								level_name_ar,
								level_order
							),
							branch:branch_id (
								id,
								name_en,
								name_ar,
								location_en,
								location_ar
							)
						`).eq("is_current",!0).order("created_at",{ascending:!1});return{data:t,error:r}}catch(t){return console.error("Failed to fetch HR assignments:",t),{data:null,error:t.message}}},async getByBranch(t){try{const{data:r,error:a}=await Tt.from("hr_position_assignments").select(`
							*,
							employee:employee_id (
								id,
								employee_id,
								name
							),
							position:position_id (
								id,
								position_title_en,
								position_title_ar
							),
							department:department_id (
								id,
								department_name_en,
								department_name_ar
							),
							level:level_id (
								id,
								level_name_en,
								level_name_ar,
								level_order
							),
							branch:branch_id (
								id,
								name_en,
								name_ar,
								location_en,
								location_ar
							)
						`).eq("branch_id",t).eq("is_current",!0).order("created_at",{ascending:!1});return{data:r,error:a}}catch(r){return console.error("Failed to fetch HR assignments by branch:",r),{data:null,error:r.message}}},async create(t){try{await Tt.from("hr_position_assignments").update({is_current:!1}).eq("employee_id",t.employee_id).eq("is_current",!0);const{data:r,error:a}=await Tt.from("hr_position_assignments").insert([{employee_id:t.employee_id,position_id:t.position_id,department_id:t.department_id,level_id:t.level_id,branch_id:t.branch_id,effective_date:t.effective_date||new Date().toISOString().split("T")[0],is_current:!0,created_at:new Date().toISOString()}]).select(`
							*,
							employee:employee_id (
								id,
								employee_id,
								name
							),
							position:position_id (
								id,
								position_title_en,
								position_title_ar
							),
							department:department_id (
								id,
								department_name_en,
								department_name_ar
							),
							level:level_id (
								id,
								level_name_en,
								level_name_ar,
								level_order
							),
							branch:branch_id (
								id,
								name_en,
								name_ar,
								location_en,
								location_ar
							)
							)
						`).single();return{data:r,error:a}}catch(r){return console.error("Failed to create HR assignment:",r),{data:null,error:r.message}}},async update(t,r){try{const{data:a,error:s}=await Tt.from("hr_position_assignments").update(r).eq("id",t).select(`
							*,
							employee:employee_id (
								id,
								employee_id,
								name
							),
							position:position_id (
								id,
								position_title_en,
								position_title_ar
							),
							department:department_id (
								id,
								department_name_en,
								department_name_ar
							),
							level:level_id (
								id,
								level_name_en,
								level_name_ar,
								level_order
							),
							branch:branch_id (
								id,
								name_en,
								name_ar,
								location_en,
								location_ar
							)
							)
						`).single();return{data:a,error:s}}catch(a){return console.error("Failed to update HR assignment:",a),{data:null,error:a.message}}},async delete(t){try{const{error:r}=await Tt.from("hr_position_assignments").update({is_current:!1}).eq("id",t);return{error:r}}catch(r){return console.error("Failed to delete HR assignment:",r),{error:r.message}}}},hrFingerprint:{async getAll(){try{const{data:t,error:r}=await Tt.from("hr_fingerprint_transactions").select("*").order("transaction_date",{ascending:!1}).order("transaction_time",{ascending:!1});return{data:t,error:r}}catch(t){return console.error("Failed to fetch HR fingerprint transactions:",t),{data:null,error:t.message}}},async getByBranch(t){try{const{data:r,error:a}=await Tt.from("hr_fingerprint_transactions").select("*").eq("branch_id",t).order("transaction_date",{ascending:!1}).order("transaction_time",{ascending:!1});return{data:r,error:a}}catch(r){return console.error("Failed to fetch HR fingerprint transactions by branch:",r),{data:null,error:r.message}}},async create(t){try{const{data:r,error:a}=await Tt.from("hr_fingerprint_transactions").insert([{employee_id:t.employee_id,name:t.name,branch_id:String(t.branch_id),transaction_date:t.transaction_date,transaction_time:t.transaction_time,punch_state:t.punch_state,device_id:t.device_id,created_at:new Date().toISOString()}]).select().single();return{data:r,error:a}}catch(r){return console.error("Failed to create HR fingerprint transaction:",r),{data:null,error:r.message}}},async createMany(t){{let r=0,a=0;const s=[],i=[];for(const[l,d]of t.entries())try{const{data:v,error:u}=await this.create(d);u?(s.push(`Row ${l+1}: ${u.message}`),a++):(i.push(v),r++)}catch(v){s.push(`Row ${l+1}: ${v.message}`),a++}return{data:i,error:a>0?`${a} transactions failed`:null,successCount:r,errorCount:a,errors:s}}}},hrContacts:{async getAll(){try{const{data:t,error:r}=await Tt.from("hr_employee_contacts").select(`
							*,
							employee:employee_id (
								id,
								employee_id,
								name
							)
						`).eq("is_active",!0).order("created_at",{ascending:!1});return{data:t,error:r}}catch(t){return console.error("Failed to fetch HR employee contacts:",t),{data:null,error:t.message}}},async getByBranch(t){try{const{data:r,error:a}=await Tt.from("hr_employees").select("id").eq("branch_id",t);if(a)return{data:null,error:a};const s=r.map(d=>d.id);if(s.length===0)return{data:[],error:null};const{data:i,error:l}=await Tt.from("hr_employee_contacts").select(`
							*,
							employee:employee_id (
								id,
								employee_id,
								name
							)
						`).in("employee_id",s).eq("is_active",!0).order("created_at",{ascending:!1});return{data:i,error:l}}catch(r){return console.error("Failed to fetch HR employee contacts by branch:",r),{data:null,error:r.message}}},async create(t){try{const{data:r,error:a}=await Tt.from("hr_employee_contacts").insert([{employee_id:t.employee_id,whatsapp_number:t.whatsapp_number,contact_number:t.contact_number,email:t.email,is_active:!0,created_at:new Date().toISOString()}]).select(`
							*,
							employee:employee_id (
								id,
								employee_id,
								name
							)
						`).single();return{data:r,error:a}}catch(r){return console.error("Failed to create HR employee contact:",r),{data:null,error:r.message}}},async update(t,r){try{const{data:a,error:s}=await Tt.from("hr_employee_contacts").update({...r,updated_at:new Date().toISOString()}).eq("id",t).select(`
							*,
							employee:employee_id (
								id,
								employee_id,
								name
							)
						`).single();return{data:a,error:s}}catch(a){return console.error("Failed to update HR employee contact:",a),{data:null,error:a.message}}},async delete(t){try{const{error:r}=await Tt.from("hr_employee_contacts").update({is_active:!1}).eq("id",t);return{error:r}}catch(r){return console.error("Failed to delete HR employee contact:",r),{error:r.message}}}},hrDocuments:{async getAll(){try{const{data:t,error:r}=await Tt.from("hr_employee_documents").select(`
							*,
							employee:employee_id (
								id,
								employee_id,
								name
							)
						`).eq("is_active",!0).order("created_at",{ascending:!1});return{data:t,error:r}}catch(t){return console.error("Failed to fetch HR documents:",t),{data:null,error:t.message}}},async getByEmployeeId(t){try{const{data:r,error:a}=await Tt.from("hr_employee_documents").select(`
							*,
							employee:employee_id (
								id,
								employee_id,
								name
							)
						`).eq("employee_id",t).eq("is_active",!0).order("created_at",{ascending:!1});return{data:r,error:a}}catch(r){return console.error("Failed to fetch employee documents:",r),{data:null,error:r.message}}},async getByBranch(t){try{const{data:r,error:a}=await Tt.from("hr_employee_documents").select(`
							*,
							employee:employee_id (
								id,
								employee_id,
								name,
								branch_id
							)
						`).eq("is_active",!0).order("created_at",{ascending:!1});return{data:(r==null?void 0:r.filter(i=>{var l;return((l=i.employee)==null?void 0:l.branch_id)===t}))||[],error:a}}catch(r){return console.error("Failed to fetch branch documents:",r),{data:null,error:r.message}}},async create(t){try{const{data:r,error:a}=await Tt.from("hr_employee_documents").insert([{...t,upload_date:new Date().toISOString().split("T")[0],created_at:new Date().toISOString()}]).select(`
							*,
							employee:employee_id (
								id,
								employee_id,
								name
							)
						`).single();return{data:r,error:a}}catch(r){return console.error("Failed to create HR document:",r),{data:null,error:r.message}}},async update(t,r){try{const{data:a,error:s}=await Tt.from("hr_employee_documents").update({...r,updated_at:new Date().toISOString()}).eq("id",t).select(`
							*,
							employee:employee_id (
								id,
								employee_id,
								name
							)
						`).single();return{data:a,error:s}}catch(a){return console.error("Failed to update HR document:",a),{data:null,error:a.message}}},async delete(t){try{const{error:r}=await Tt.from("hr_employee_documents").update({is_active:!1,updated_at:new Date().toISOString()}).eq("id",t);return{error:r}}catch(r){return console.error("Failed to delete HR document:",r),{error:r.message}}},async getExpiringSoon(t=30){try{const r=new Date;r.setDate(r.getDate()+t);const{data:a,error:s}=await Tt.from("hr_employee_documents").select(`
							*,
							employee:employee_id (
								id,
								employee_id,
								name
							)
						`).eq("is_active",!0).not("expiry_date","is",null).lte("expiry_date",r.toISOString().split("T")[0]).gte("expiry_date",new Date().toISOString().split("T")[0]).order("expiry_date",{ascending:!0});return{data:a,error:s}}catch(r){return console.error("Failed to fetch expiring documents:",r),{data:null,error:r.message}}},async getExpired(){try{const t=new Date().toISOString().split("T")[0],{data:r,error:a}=await Tt.from("hr_employee_documents").select(`
							*,
							employee:employee_id (
								id,
								employee_id,
								name
							)
						`).eq("is_active",!0).not("expiry_date","is",null).lt("expiry_date",t).order("expiry_date",{ascending:!1});return{data:r,error:a}}catch(t){return console.error("Failed to fetch expired documents:",t),{data:null,error:t.message}}}}};typeof window<"u"&&rs.init().then(()=>{rs.setupNetworkListeners()});var f1=k('<option class="svelte-ws40n2"> </option>'),p1=k('<div class="error-message svelte-ws40n2"> </div>'),h1=k('<div class="success-message svelte-ws40n2"> </div>'),m1=k('<div class="loading-section svelte-ws40n2"><div class="loading-spinner svelte-ws40n2"></div> <p class="svelte-ws40n2">Loading employees...</p></div>'),_1=k('<div class="contact-info svelte-ws40n2"><div class="contact-item svelte-ws40n2"><span class="contact-label svelte-ws40n2">📧</span> <span class="contact-value svelte-ws40n2"> </span></div> <div class="contact-item svelte-ws40n2"><span class="contact-label svelte-ws40n2">📱</span> <span class="contact-value svelte-ws40n2"> </span></div> <div class="contact-item svelte-ws40n2"><span class="contact-label svelte-ws40n2">📞</span> <span class="contact-value svelte-ws40n2"> </span></div></div>'),g1=k('<span class="no-contact svelte-ws40n2">No contact information</span>'),x1=k('<button class="whatsapp-btn svelte-ws40n2"><span class="whatsapp-icon svelte-ws40n2">💬</span> WhatsApp</button>'),b1=k('<tr class="table-row svelte-ws40n2"><td class="employee-cell svelte-ws40n2"><div class="employee-info svelte-ws40n2"><div class="employee-id svelte-ws40n2"> </div> <div class="employee-names svelte-ws40n2"><div class="name-en svelte-ws40n2"> </div></div></div></td><td class="department-cell svelte-ws40n2"> </td><td class="position-cell svelte-ws40n2"> </td><td class="contact-cell svelte-ws40n2"><!></td><td class="date-cell svelte-ws40n2"> </td><td class="status-cell svelte-ws40n2"><span> </span></td><td class="actions-cell svelte-ws40n2"><div class="action-buttons svelte-ws40n2"><button class="edit-btn svelte-ws40n2"> </button> <!></div></td></tr>'),w1=k('<div class="employees-section svelte-ws40n2"><div class="section-header svelte-ws40n2"><h3 class="svelte-ws40n2">Employees</h3> <div class="employee-count svelte-ws40n2"> </div></div> <div class="search-section svelte-ws40n2"><h4 class="svelte-ws40n2">Search Employees</h4> <p class="search-description svelte-ws40n2">Search for employees by name, ID, department, position, or email</p> <div class="search-controls svelte-ws40n2"><div class="search-input-group svelte-ws40n2"><select class="search-criteria svelte-ws40n2"><option class="svelte-ws40n2">All Fields</option><option class="svelte-ws40n2">Name Only</option><option class="svelte-ws40n2">Employee ID Only</option></select> <input type="text" placeholder="Search employees..." class="search-input svelte-ws40n2"/></div></div></div> <div class="table-container svelte-ws40n2"><table class="employees-table svelte-ws40n2"><thead class="svelte-ws40n2"><tr class="svelte-ws40n2"><th class="svelte-ws40n2">Employee</th><th class="svelte-ws40n2">Department</th><th class="svelte-ws40n2">Position</th><th class="svelte-ws40n2">Contact Information</th><th class="svelte-ws40n2">Hire Date</th><th class="svelte-ws40n2">Status</th><th class="svelte-ws40n2">Contact Actions</th></tr></thead><tbody class="svelte-ws40n2"></tbody></table></div></div>'),y1=k('<div class="empty-state svelte-ws40n2"><div class="empty-icon svelte-ws40n2">👥</div> <h4 class="svelte-ws40n2">No Employees Found</h4> <p class="svelte-ws40n2">No employees found for the selected branch</p></div>'),k1=k('<div class="form-error svelte-ws40n2"> </div>'),T1=k('<div class="modal-overlay svelte-ws40n2"><div class="modal-content svelte-ws40n2"><div class="modal-header svelte-ws40n2"><h3 class="svelte-ws40n2"> </h3> <button class="close-btn svelte-ws40n2">✕</button></div> <div class="modal-body svelte-ws40n2"><div class="employee-info-display svelte-ws40n2"><h4 class="svelte-ws40n2"> </h4> <p class="svelte-ws40n2"> </p></div> <form class="svelte-ws40n2"><div class="form-group svelte-ws40n2"><label for="email" class="svelte-ws40n2">Email Address *</label> <input type="email" id="email" placeholder="employee@company.com" required class="svelte-ws40n2"/></div> <div class="form-group svelte-ws40n2"><label for="whatsapp" class="svelte-ws40n2">WhatsApp Number</label> <input type="tel" id="whatsapp" placeholder="+966501234567" class="svelte-ws40n2"/></div> <div class="form-group svelte-ws40n2"><label for="contact" class="svelte-ws40n2">Contact Number</label> <input type="tel" id="contact" placeholder="+966112345678" class="svelte-ws40n2"/></div> <!> <div class="form-actions svelte-ws40n2"><button type="button" class="cancel-btn svelte-ws40n2">Cancel</button> <button type="submit" class="save-btn svelte-ws40n2"> </button></div></form></div></div></div>'),E1=k('<div class="contact-management svelte-ws40n2"><div class="header svelte-ws40n2"><h2 class="title svelte-ws40n2">Contact Management</h2> <p class="subtitle svelte-ws40n2">Manage employee contact information and communication details</p></div> <div class="content svelte-ws40n2"><div class="branch-section svelte-ws40n2"><h3 class="svelte-ws40n2">Select Branch</h3> <p class="section-description svelte-ws40n2">Choose a branch to view and manage employee contact information</p> <select class="branch-select svelte-ws40n2"><option class="svelte-ws40n2">Choose a branch...</option><!></select></div> <!> <!> <!> <!></div> <!></div>');function A1(t,r){pa(r,!1);let a=Q([]),s=Q([]),i=Q([]),l=Q(""),d=Q(""),v=Q("all"),u=Q(!1),f=Q(""),h=Q(""),_=Q(!1),x=Q(null),T=Q({whatsappNumber:"",contactNumber:"",email:""});Aa(async()=>{await b()});async function b(){p(u,!0),p(f,"");try{const{data:B,error:j}=await Fa.branches.getAll();if(j){console.error("Error loading branches:",j),p(f,"Failed to load branches: "+(j.message||j));return}p(a,B||[])}catch{p(f,"Failed to load branches")}finally{p(u,!1)}}async function w(B){if(!B){p(s,[]);return}p(u,!0),p(f,"");try{const[j,I]=await Promise.all([Fa.hrEmployees.getByBranch(B),Fa.hrContacts.getByBranch(B)]);if(j.error){console.error("Error loading employees:",j.error),p(f,"Failed to load employees: "+(j.error.message||j.error));return}const Y=j.data||[],fe=I.data||[];p(s,Y.map(ce=>{const J=fe.find(le=>le.employee_id===ce.id);return{...ce,contact:J?{id:J.id,whatsappNumber:J.whatsapp_number,contactNumber:J.contact_number,email:J.email}:null}}))}catch{p(f,"Failed to load employees")}finally{p(u,!1)}}function A(B){var j,I,Y;p(x,B),p(T,{whatsappNumber:((j=B.contact)==null?void 0:j.whatsappNumber)||"",contactNumber:((I=B.contact)==null?void 0:I.contactNumber)||"",email:((Y=B.contact)==null?void 0:Y.email)||""}),p(_,!0),p(f,""),p(h,"")}function C(){p(_,!1),p(x,null),p(T,{whatsappNumber:"",contactNumber:"",email:""}),p(f,""),p(h,"")}async function z(){if(!e(x))return;if(!e(T).email){p(f,"Email is required");return}if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e(T).email)){p(f,"Please enter a valid email address");return}if(e(T).whatsappNumber&&!e(T).whatsappNumber.startsWith("+966")){p(f,"WhatsApp number should start with +966");return}if(e(T).contactNumber&&!e(T).contactNumber.startsWith("+966")){p(f,"Contact number should start with +966");return}p(u,!0),p(f,"");try{let j;if(e(x).contact&&e(x).contact.id?j=await Fa.hrContacts.update(e(x).contact.id,{whatsapp_number:e(T).whatsappNumber,contact_number:e(T).contactNumber,email:e(T).email}):j=await Fa.hrContacts.create({employee_id:e(x).id,whatsapp_number:e(T).whatsappNumber,contact_number:e(T).contactNumber,email:e(T).email}),j.error){p(f,"Failed to save contact information: "+(j.error.message||j.error));return}const I=e(s).findIndex(Y=>Y.id===e(x).id);I!==-1&&($e(s,e(s)[I]={...e(s)[I],contact:{id:j.data.id,whatsappNumber:e(T).whatsappNumber,contactNumber:e(T).contactNumber,email:e(T).email}}),p(s,[...e(s)])),p(h,"Contact information saved successfully"),C(),setTimeout(()=>{p(h,"")},3e3)}catch{p(f,"Failed to save contact information")}finally{p(u,!1)}}function F(B){return B?new Date(B).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):"N/A"}function re(B){return B?B.replace(/(\+966)(\d{2})(\d{3})(\d{4})/,"$1 $2 $3 $4"):"N/A"}function me(B){switch(B==null?void 0:B.toLowerCase()){case"active":return"text-green-600";case"inactive":return"text-red-600";default:return"text-gray-600"}}function ue(B){var fe;if(!((fe=B.contact)!=null&&fe.whatsappNumber))return;let j=B.contact.whatsappNumber.replace(/\s/g,"");j.startsWith("+")||(j="+"+j);const I=encodeURIComponent(`Hello ${B.name}, this is a message from the company HR team.`),Y=`https://wa.me/${j.replace("+","")}?text=${I}`;window.open(Y,"_blank")}Nt(()=>e(l),()=>{e(l)&&w(e(l))}),Nt(()=>(e(s),e(d),e(v)),()=>{if(!e(s).length)p(i,[]);else if(!e(d).trim())p(i,e(s));else{const B=e(d).toLowerCase().trim();p(i,e(s).filter(j=>{var I,Y,fe,ce,J,le,S,De;switch(e(v)){case"name":return(I=j.name)==null?void 0:I.toLowerCase().includes(B);case"employee_id":return(Y=j.employee_id)==null?void 0:Y.toLowerCase().includes(B);case"all":default:return((fe=j.name)==null?void 0:fe.toLowerCase().includes(B))||((ce=j.employee_id)==null?void 0:ce.toLowerCase().includes(B))||((J=j.department)==null?void 0:J.toLowerCase().includes(B))||((le=j.position)==null?void 0:le.toLowerCase().includes(B))||((De=(S=j.contact)==null?void 0:S.email)==null?void 0:De.toLowerCase().includes(B))}}))}}),Va(),ha();var D=E1(),E=c(o(D),2),he=o(E),xe=c(o(he),4);R(()=>{e(l),Xt(()=>{e(u),e(a)})});var K=o(xe);K.value=K.__value="";var q=c(K);Mt(q,1,()=>e(a),Lt,(B,j)=>{var I=f1(),Y=o(I);n(I);var fe={};R(()=>{y(Y,`${e(j),m(()=>e(j).name_en)??""} (${e(j),m(()=>e(j).name_ar)??""}) - ${e(j),m(()=>e(j).location_en)??""}`),fe!==(fe=(e(j),m(()=>e(j).id)))&&(I.value=(I.__value=(e(j),m(()=>e(j).id)))??"")}),g(B,I)}),n(xe),n(he);var ae=c(he,2);{var Me=B=>{var j=p1(),I=o(j,!0);n(j),R(()=>y(I,e(f))),g(B,j)};X(ae,B=>{e(f)&&B(Me)})}var ge=c(ae,2);{var Ne=B=>{var j=h1(),I=o(j,!0);n(j),R(()=>y(I,e(h))),g(B,j)};X(ge,B=>{e(h)&&B(Ne)})}var Be=c(ge,2);{var be=B=>{var j=m1();g(B,j)};X(Be,B=>{e(u)&&B(be)})}var L=c(Be,2);{var Te=B=>{var j=w1(),I=o(j),Y=c(o(I),2),fe=o(Y);n(Y),n(I);var ce=c(I,2),J=c(o(ce),4),le=o(J),S=o(le);R(()=>{e(v),Xt(()=>{})});var De=o(S);De.value=De.__value="all";var Ue=c(De);Ue.value=Ue.__value="name";var We=c(Ue);We.value=We.__value="employee_id",n(S);var ke=c(S,2);At(ke),n(le),n(J),n(ce);var N=c(ce,2),V=o(N),G=c(o(V));Mt(G,5,()=>e(i),de=>de.id,(de,ve)=>{var Ie=b1(),Ye=o(Ie),oe=o(Ye),se=o(oe),U=o(se,!0);n(se);var W=c(se,2),ee=o(W),we=o(ee,!0);n(ee),n(W),n(oe),n(Ye);var Ae=c(Ye),He=o(Ae,!0);n(Ae);var Ke=c(Ae),Oe=o(Ke,!0);n(Ke);var Ee=c(Ke),et=o(Ee);{var dt=Je=>{var st=_1(),ot=o(st),Le=c(o(ot),2),nt=o(Le,!0);n(Le),n(ot);var vt=c(ot,2),xt=c(o(vt),2),M=o(xt,!0);n(xt),n(vt);var H=c(vt,2),O=c(o(H),2),te=o(O,!0);n(O),n(H),n(st),R((ne,ie)=>{y(nt,(e(ve),m(()=>e(ve).contact.email||"N/A"))),y(M,ne),y(te,ie)},[()=>(e(ve),m(()=>re(e(ve).contact.whatsappNumber))),()=>(e(ve),m(()=>re(e(ve).contact.contactNumber)))]),g(Je,st)},ut=Je=>{var st=g1();g(Je,st)};X(et,Je=>{e(ve),m(()=>e(ve).contact)?Je(dt):Je(ut,!1)})}n(Ee);var Pe=c(Ee),qe=o(Pe,!0);n(Pe);var tt=c(Pe),lt=o(tt),Xe=o(lt,!0);n(lt),n(tt);var at=c(tt),Fe=o(at),rt=o(Fe),Ce=o(rt);n(rt);var _e=c(rt,2);{var Ve=Je=>{var st=x1();R(()=>{st.disabled=e(u),na(st,"title",`Send WhatsApp message to ${e(ve),m(()=>e(ve).name)??""}`)}),Z("click",st,()=>ue(e(ve))),g(Je,st)};X(_e,Je=>{e(ve),m(()=>{var st;return(st=e(ve).contact)==null?void 0:st.whatsappNumber})&&Je(Ve)})}n(Fe),n(at),n(Ie),R((Je,st)=>{y(U,(e(ve),m(()=>e(ve).employee_id))),y(we,(e(ve),m(()=>e(ve).name))),y(He,(e(ve),m(()=>e(ve).department||"N/A"))),y(Oe,(e(ve),m(()=>e(ve).position||"N/A"))),y(qe,Je),wt(lt,1,`status-badge ${st??""}`,"svelte-ws40n2"),y(Xe,(e(ve),m(()=>e(ve).status||"Active"))),rt.disabled=e(u),y(Ce,`${e(ve),m(()=>e(ve).contact?"Edit":"Add")??""} Contact`)},[()=>(e(ve),m(()=>F(e(ve).created_at))),()=>(e(ve),m(()=>me(e(ve).status||"Active")))]),Z("click",rt,()=>A(e(ve))),g(de,Ie)}),n(G),n(V),n(N),n(j),R(()=>y(fe,`${e(i),m(()=>e(i).length)??""} of ${e(s),m(()=>e(s).length)??""} employee${e(s),m(()=>e(s).length!==1?"s":"")??""}`)),ra(S,()=>e(v),de=>p(v,de)),zt(ke,()=>e(d),de=>p(d,de)),g(B,j)},ye=B=>{var j=Ca(),I=Bt(j);{var Y=fe=>{var ce=y1();g(fe,ce)};X(I,fe=>{e(l),e(u),e(s),m(()=>e(l)&&!e(u)&&e(s).length===0)&&fe(Y)},!0)}g(B,j)};X(L,B=>{e(l),e(u),e(s),m(()=>e(l)&&!e(u)&&e(s).length>0)?B(Te):B(ye,!1)})}n(E);var P=c(E,2);{var pe=B=>{var j=T1(),I=o(j),Y=o(I),fe=o(Y),ce=o(fe);n(fe);var J=c(fe,2);n(Y);var le=c(Y,2),S=o(le),De=o(S),Ue=o(De,!0);n(De);var We=c(De,2),ke=o(We);n(We),n(S);var N=c(S,2),V=o(N),G=c(o(V),2);At(G),n(V);var de=c(V,2),ve=c(o(de),2);At(ve),n(de);var Ie=c(de,2),Ye=c(o(Ie),2);At(Ye),n(Ie);var oe=c(Ie,2);{var se=Ae=>{var He=k1(),Ke=o(He,!0);n(He),R(()=>y(Ke,e(f))),g(Ae,He)};X(oe,Ae=>{e(f)&&Ae(se)})}var U=c(oe,2),W=o(U),ee=c(W,2),we=o(ee,!0);n(ee),n(U),n(N),n(le),n(I),n(j),R(()=>{y(ce,`${e(x),m(()=>e(x).contact?"Edit":"Add")??""} Contact Information`),y(Ue,(e(x),m(()=>e(x).name))),y(ke,`${e(x),m(()=>e(x).employee_id)??""} • ${e(x),m(()=>e(x).position||"N/A")??""}`),G.disabled=e(u),ve.disabled=e(u),Ye.disabled=e(u),W.disabled=e(u),ee.disabled=e(u),y(we,e(u)?"Saving...":"Save Contact")}),Z("click",J,C),zt(G,()=>e(T).email,Ae=>$e(T,e(T).email=Ae)),zt(ve,()=>e(T).whatsappNumber,Ae=>$e(T,e(T).whatsappNumber=Ae)),zt(Ye,()=>e(T).contactNumber,Ae=>$e(T,e(T).contactNumber=Ae)),Z("click",W,C),Z("submit",N,Ur(z)),Z("click",I,ir(function(Ae){Or.call(this,r,Ae)})),Z("click",j,C),g(B,j)};X(P,B=>{e(_)&&e(x)&&B(pe)})}n(D),R(()=>xe.disabled=e(u)),ra(xe,()=>e(l),B=>p(l,B)),g(t,D),ma()}var S1=k('<option class="svelte-1vzyzy9"> </option>'),C1=k('<div class="error-message svelte-1vzyzy9"><strong class="svelte-1vzyzy9">Error:</strong> </div>'),F1=k('<div class="success-message svelte-1vzyzy9"><strong class="svelte-1vzyzy9">Success:</strong> </div>'),D1=k('<div class="loading-state svelte-1vzyzy9"><div class="spinner large svelte-1vzyzy9"></div> <p class="svelte-1vzyzy9">Loading employees...</p></div>'),M1=k('<div class="empty-state svelte-1vzyzy9"><div class="empty-icon svelte-1vzyzy9">👥</div> <h4 class="svelte-1vzyzy9">No Employees Found</h4> <p class="svelte-1vzyzy9">No employees found in the selected branch</p></div>'),I1=k('<span class="expiring-badge warning svelte-1vzyzy9"> </span>'),R1=k('<span class="expiring-badge good svelte-1vzyzy9">All current</span>'),N1=k('<tr class="table-row svelte-1vzyzy9"><td class="employee-id svelte-1vzyzy9"> </td><td class="employee-name svelte-1vzyzy9"><div class="name-container svelte-1vzyzy9"><div class="name-en svelte-1vzyzy9"> </div></div></td><td class="department svelte-1vzyzy9"> </td><td class="position svelte-1vzyzy9"> </td><td class="document-count svelte-1vzyzy9"><span class="count-badge svelte-1vzyzy9"> </span></td><td class="expiring-docs svelte-1vzyzy9"><!></td><td class="status svelte-1vzyzy9"><span> </span></td><td class="actions svelte-1vzyzy9"><button class="manage-btn svelte-1vzyzy9" title="Manage Documents"><span class="icon svelte-1vzyzy9">📄</span> Manage Documents</button></td></tr>'),P1=k('<div class="table-container svelte-1vzyzy9"><table class="employees-table svelte-1vzyzy9"><thead class="svelte-1vzyzy9"><tr class="svelte-1vzyzy9"><th class="svelte-1vzyzy9">Employee ID</th><th class="svelte-1vzyzy9">Name</th><th class="svelte-1vzyzy9">Department</th><th class="svelte-1vzyzy9">Position</th><th class="svelte-1vzyzy9">Documents Count</th><th class="svelte-1vzyzy9">Expiring Soon</th><th class="svelte-1vzyzy9">Status</th><th class="svelte-1vzyzy9">Actions</th></tr></thead><tbody class="svelte-1vzyzy9"></tbody></table></div>'),L1=k('<div class="employees-section svelte-1vzyzy9"><div class="section-header svelte-1vzyzy9"><h3 class="svelte-1vzyzy9"> </h3> <div class="employee-count svelte-1vzyzy9"> </div></div> <!></div>'),O1=k('<div class="error-message svelte-1vzyzy9"><strong class="svelte-1vzyzy9">Error:</strong> </div>'),z1=k('<div class="success-message svelte-1vzyzy9"><strong class="svelte-1vzyzy9">Success:</strong> </div>'),B1=k('<span class="existing-badge svelte-1vzyzy9">✓ Uploaded</span>'),$1=k('<div class="existing-document svelte-1vzyzy9"><div class="doc-info svelte-1vzyzy9"><span class="doc-name svelte-1vzyzy9"> </span> <span class="doc-meta svelte-1vzyzy9"> <!></span></div> <button class="delete-doc-btn svelte-1vzyzy9">🗑️ Delete</button></div>'),U1=k('<span class="format-tag svelte-1vzyzy9"> </span>'),q1=k('<div class="requirement-item svelte-1vzyzy9"><strong class="svelte-1vzyzy9">📅 Expiry Date:</strong> <span class="expiry-required svelte-1vzyzy9">Required</span></div>'),j1=k('<div class="form-group svelte-1vzyzy9"><label class="svelte-1vzyzy9">Document Name *</label> <input type="text" placeholder="Enter document name (e.g., Driving License, Certificate)" class="form-input svelte-1vzyzy9" required/></div>'),W1=k('<div class="file-selected svelte-1vzyzy9"><span class="file-icon svelte-1vzyzy9">📄</span> <div class="file-details svelte-1vzyzy9"><div class="file-name svelte-1vzyzy9"> </div> <div class="file-size svelte-1vzyzy9"> </div></div></div>'),H1=k('<div class="form-group svelte-1vzyzy9"><label class="svelte-1vzyzy9">Expiry Date *</label> <input type="date" class="form-input svelte-1vzyzy9" required/></div>'),V1=k('<div class="form-group svelte-1vzyzy9"><label class="svelte-1vzyzy9">Expiry Date (Optional)</label> <input type="date" class="form-input svelte-1vzyzy9"/></div>'),G1=k('<span class="spinner svelte-1vzyzy9"></span> Uploading...',1),X1=k('<div class="upload-form svelte-1vzyzy9"><div class="document-info svelte-1vzyzy9"><p class="doc-description svelte-1vzyzy9"> </p> <div class="file-requirements svelte-1vzyzy9"><div class="requirement-item svelte-1vzyzy9"><strong class="svelte-1vzyzy9">📎 Supported Formats:</strong> <span class="format-tags svelte-1vzyzy9"></span></div> <div class="requirement-item svelte-1vzyzy9"><strong class="svelte-1vzyzy9">📏 Max File Size:</strong> <span class="size-limit svelte-1vzyzy9"> </span></div> <!></div></div> <!> <div class="form-group svelte-1vzyzy9"><label class="svelte-1vzyzy9">Select File *</label> <input type="file" class="form-input file-input svelte-1vzyzy9" required/> <div class="file-help-text svelte-1vzyzy9"> </div> <!></div> <!> <button class="upload-doc-btn svelte-1vzyzy9"><!></button></div>'),Y1=k('<div class="document-section svelte-1vzyzy9"><div class="section-title svelte-1vzyzy9"><span class="doc-icon svelte-1vzyzy9"> </span> <h4 class="svelte-1vzyzy9"> </h4> <!></div> <!></div>'),K1=k('<div class="modal-overlay svelte-1vzyzy9"><div class="modal-content svelte-1vzyzy9"><div class="modal-header svelte-1vzyzy9"><div class="employee-info svelte-1vzyzy9"><h2 class="svelte-1vzyzy9">📄 Document Management</h2> <p class="svelte-1vzyzy9"> </p></div> <button class="close-btn svelte-1vzyzy9">✕</button></div> <div class="modal-body svelte-1vzyzy9"><!> <!> <div class="document-sections svelte-1vzyzy9"></div></div></div></div>'),Q1=k('<div class="document-management svelte-1vzyzy9"><div class="header svelte-1vzyzy9"><h2 class="title svelte-1vzyzy9">Document Management</h2> <p class="subtitle svelte-1vzyzy9">Manage employee documents, certificates, and file uploads</p></div> <div class="content svelte-1vzyzy9"><div class="branch-selection svelte-1vzyzy9"><div class="selection-header svelte-1vzyzy9"><h3 class="svelte-1vzyzy9">Select Branch</h3> <p class="svelte-1vzyzy9">Choose a branch to view and manage employee documents</p></div> <select class="branch-select svelte-1vzyzy9"><option class="svelte-1vzyzy9">Choose a branch...</option><!></select></div> <!> <!> <!></div></div> <!>',1);function Z1(t,r){pa(r,!1);let a=Q([]),s=Q([]),i=[],l=Q(""),d=Q(null),v=Q(!1),u=Q(!1),f=Q(""),h=Q(""),_=Q(!1),x=[],T=Q({}),b=Q({}),w=Q({1:"",2:"",3:"",4:""});const A=[{key:"health_card",label:"Health Card",icon:"🏥",accepts:".jpg,.jpeg,.png,.webp",requiresExpiry:!0,description:"Upload a clear photo/scan of the health card",maxSize:"5MB",formats:["JPG","JPEG","PNG","WebP"]},{key:"resident_id",label:"Resident ID",icon:"🆔",accepts:".jpg,.jpeg,.png,.webp",requiresExpiry:!0,description:"Upload both front and back sides if applicable",maxSize:"5MB",formats:["JPG","JPEG","PNG","WebP"]},{key:"passport",label:"Passport",icon:"📘",accepts:".jpg,.jpeg,.png,.webp",requiresExpiry:!0,description:"Upload the main page with photo and details",maxSize:"5MB",formats:["JPG","JPEG","PNG","WebP"]},{key:"resume",label:"Résumé",icon:"📄",accepts:".pdf,.doc,.docx",requiresExpiry:!1,description:"Upload latest CV/Resume document",maxSize:"10MB",formats:["PDF","DOC","DOCX"]},{key:"other_1",label:"Other Document 1",icon:"📋",accepts:".pdf,.doc,.docx,.jpg,.jpeg,.png,.webp",requiresExpiry:!1,description:"Upload any additional document (specify name below)",maxSize:"10MB",formats:["PDF","DOC","DOCX","JPG","PNG","WebP"]},{key:"other_2",label:"Other Document 2",icon:"📋",accepts:".pdf,.doc,.docx,.jpg,.jpeg,.png,.webp",requiresExpiry:!1,description:"Upload any additional document (specify name below)",maxSize:"10MB",formats:["PDF","DOC","DOCX","JPG","PNG","WebP"]},{key:"other_3",label:"Other Document 3",icon:"📋",accepts:".pdf,.doc,.docx,.jpg,.jpeg,.png,.webp",requiresExpiry:!1,description:"Upload any additional document (specify name below)",maxSize:"10MB",formats:["PDF","DOC","DOCX","JPG","PNG","WebP"]},{key:"other_4",label:"Other Document 4",icon:"📋",accepts:".pdf,.doc,.docx,.jpg,.jpeg,.png,.webp",requiresExpiry:!1,description:"Upload any additional document (specify name below)",maxSize:"10MB",formats:["PDF","DOC","DOCX","JPG","PNG","WebP"]}];Aa(async()=>{await C()});async function C(){p(v,!0),p(f,"");try{const J=await Fa.branches.getAll();if(J.error)throw new Error(J.error);p(a,J.data||[])}catch(J){console.error("Failed to load branches:",J),p(f,"Failed to load branches"),p(a,[])}finally{p(v,!1)}}async function z(J){if(!J){p(s,[]),i=[];return}p(v,!0),p(f,"");try{const le=await Fa.hrEmployees.getByBranch(parseInt(J));if(le.error)throw new Error(le.error);const S=await Fa.hrDocuments.getByBranch(parseInt(J));if(S.error)throw new Error(S.error);if(p(s,le.data||[]),i=S.data||[],e(s).length>0){console.log("Employee data structure:",e(s)[0]),console.log("Available fields:",Object.keys(e(s)[0]));const De=Object.keys(e(s)[0]).filter(We=>We.toLowerCase().includes("dept")||We.toLowerCase().includes("department"));console.log("Department-related fields:",De);const Ue=Object.keys(e(s)[0]).filter(We=>We.toLowerCase().includes("pos")||We.toLowerCase().includes("title")||We.toLowerCase().includes("job"));console.log("Position-related fields:",Ue)}p(s,e(s).map(De=>({...De,documentCount:i.filter(Ue=>Ue.employee_id===De.id).length,expiring_documents:i.filter(Ue=>Ue.employee_id===De.id&&Ue.expiry_date&&ae(Ue.expiry_date)).length})))}catch(le){console.error("Failed to load employees and documents:",le),p(f,"Failed to load employees and documents"),p(s,[]),i=[]}finally{p(v,!1)}}async function F(J){p(d,J),p(_,!0),p(T,{}),p(b,{}),p(w,{1:"",2:"",3:"",4:""}),await re(J.id),p(f,""),p(h,"")}async function re(J){try{const le=await Fa.hrDocuments.getByEmployeeId(J);if(le.error)throw new Error(le.error);x=le.data||[]}catch(le){console.error("Failed to load employee documents:",le),x=[]}}function me(){p(_,!1),p(d,null),x=[],e(l)&&z(e(l))}function ue(J,le){const S=le.target.files[0];S&&p(T,{...e(T),[J]:S})}async function D(J){const le=e(T)[J];if(!le){p(f,"Please select a file to upload");return}const S=A.find(De=>De.key===J);if(!S){p(f,"Invalid document type");return}if(S.requiresExpiry&&!e(b)[J]){p(f,`Expiry date is required for ${S.label}`);return}if(J.startsWith("other_")&&!e(w)[J.split("_")[1]]){p(f,"Please enter a document name");return}p(u,!0),p(f,""),p(h,"");try{const De=le.name.split(".").pop(),Ue=`${e(d).employee_id}_${J}_${Date.now()}.${De}`,We=`employees/${e(d).employee_id}/${Ue}`;console.log("Uploading file to storage:",{fileName:Ue,storagePath:We,fileSize:le.size});const{data:ke,error:N}=await Tt.storage.from("employee-documents").upload(We,le,{cacheControl:"3600",upsert:!1});if(N)throw console.error("Storage upload error:",N),new Error(`File upload failed: ${N.message}`);console.log("File uploaded successfully:",ke);const{data:{publicUrl:V}}=Tt.storage.from("employee-documents").getPublicUrl(We);console.log("Public URL:",V);let G=S.label;if(J.startsWith("other_")){const Ye=J.split("_")[1];G=e(w)[Ye]||`Other Document ${Ye}`}const de={employee_id:e(d).id,document_type:J,document_name:G,file_path:V,file_type:le.type,expiry_date:e(b)[J]||null};console.log("Saving document metadata to database:",de);const ve=await Fa.hrDocuments.create(de);if(console.log("Database save result:",ve),ve.error){try{await Tt.storage.from("employee-documents").remove([We])}catch(Ye){console.error("Failed to cleanup uploaded file:",Ye)}throw new Error(typeof ve.error=="string"?ve.error:JSON.stringify(ve.error))}if(delete e(T)[J],delete e(b)[J],J.startsWith("other_")){const Ye=J.split("_")[1];$e(w,e(w)[Ye]="")}const Ie=document.querySelector(`input[data-document="${J}"]`);Ie&&(Ie.value=""),p(h,`${S.label} uploaded successfully!`),await re(e(d).id)}catch(De){console.error("Failed to upload document:",De),p(f,De.message||"Failed to upload document")}finally{p(u,!1)}}async function E(J){if(confirm("Are you sure you want to delete this document?"))try{const le=await Fa.hrDocuments.delete(J);if(le.error)throw new Error(le.error);p(h,"Document deleted successfully!"),await re(e(d).id)}catch(le){console.error("Failed to delete document:",le),p(f,le.message||"Failed to delete document")}}function he(J){return x.find(le=>le.document_type===J)}function xe(J){const le=e(a).find(S=>S.id===parseInt(J));return le?`${le.name_en||le.name_ar||"Unknown"} - ${le.location_en||le.location_ar||"Unknown Location"}`:"Unknown Branch"}function K(J){return J==="active"?"text-green-600 bg-green-50":"text-red-600 bg-red-50"}function q(J){return J?new Date(J).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):"N/A"}function ae(J){if(!J)return!1;const De=new Date(J)-new Date,Ue=Math.ceil(De/(1e3*60*60*24));return Ue<=30&&Ue>0}function Me(J){if(!J)return"Unknown";const le=["Bytes","KB","MB","GB"],S=Math.floor(Math.log(J)/Math.log(1024));return Math.round(J/Math.pow(1024,S)*100)/100+" "+le[S]}Nt(()=>e(l),()=>{e(l)&&z(e(l))}),Va(),ha();var ge=Q1(),Ne=Bt(ge),Be=c(o(Ne),2),be=o(Be),L=c(o(be),2);R(()=>{e(l),Xt(()=>{e(v),e(a)})});var Te=o(L);Te.value=Te.__value="";var ye=c(Te);Mt(ye,1,()=>e(a),Lt,(J,le)=>{var S=S1(),De=o(S);n(S);var Ue={};R(()=>{y(De,`${e(le),m(()=>e(le).name_en||e(le).name_ar||"Unknown")??""} - ${e(le),m(()=>e(le).location_en||e(le).location_ar||"Unknown Location")??""}`),Ue!==(Ue=(e(le),m(()=>e(le).id)))&&(S.value=(S.__value=(e(le),m(()=>e(le).id)))??"")}),g(J,S)}),n(L),n(be);var P=c(be,2);{var pe=J=>{var le=C1(),S=c(o(le));n(le),R(()=>y(S,` ${e(f)??""}`)),g(J,le)};X(P,J=>{e(f)&&J(pe)})}var B=c(P,2);{var j=J=>{var le=F1(),S=c(o(le));n(le),R(()=>y(S,` ${e(h)??""}`)),g(J,le)};X(B,J=>{e(h)&&J(j)})}var I=c(B,2);{var Y=J=>{var le=L1(),S=o(le),De=o(S),Ue=o(De);n(De);var We=c(De,2),ke=o(We);n(We),n(S);var N=c(S,2);{var V=de=>{var ve=D1();g(de,ve)},G=de=>{var ve=Ca(),Ie=Bt(ve);{var Ye=se=>{var U=M1();g(se,U)},oe=se=>{var U=P1(),W=o(U),ee=c(o(W));Mt(ee,5,()=>e(s),we=>we.id,(we,Ae)=>{var He=N1(),Ke=o(He),Oe=o(Ke,!0);n(Ke);var Ee=c(Ke),et=o(Ee),dt=o(et),ut=o(dt,!0);n(dt),n(et),n(Ee);var Pe=c(Ee),qe=o(Pe,!0);n(Pe);var tt=c(Pe),lt=o(tt,!0);n(tt);var Xe=c(tt),at=o(Xe),Fe=o(at);n(at),n(Xe);var rt=c(Xe),Ce=o(rt);{var _e=vt=>{var xt=I1(),M=o(xt);n(xt),R(()=>y(M,`${e(Ae),m(()=>e(Ae).expiring_documents)??""} expiring`)),g(vt,xt)},Ve=vt=>{var xt=R1();g(vt,xt)};X(Ce,vt=>{e(Ae),m(()=>e(Ae).expiring_documents&&e(Ae).expiring_documents>0)?vt(_e):vt(Ve,!1)})}n(rt);var Je=c(rt),st=o(Je),ot=o(st,!0);n(st),n(Je);var Le=c(Je),nt=o(Le);n(Le),n(He),R(vt=>{y(Oe,(e(Ae),m(()=>e(Ae).employee_id))),y(ut,(e(Ae),m(()=>e(Ae).name))),y(qe,(e(Ae),m(()=>e(Ae).department||e(Ae).department_name||e(Ae).dept||"N/A"))),y(lt,(e(Ae),m(()=>e(Ae).position||e(Ae).position_title||e(Ae).job_title||"N/A"))),y(Fe,`${e(Ae),m(()=>e(Ae).documentCount||0)??""} documents`),wt(st,1,`status-badge ${vt??""}`,"svelte-1vzyzy9"),y(ot,(e(Ae),m(()=>e(Ae).status==="active"?"Active":"Inactive"))),nt.disabled=e(v)},[()=>(e(Ae),m(()=>K(e(Ae).status)))]),Z("click",nt,()=>F(e(Ae))),g(we,He)}),n(ee),n(W),n(U),g(se,U)};X(Ie,se=>{e(s),m(()=>e(s).length===0)?se(Ye):se(oe,!1)},!0)}g(de,ve)};X(N,de=>{e(v),e(s),m(()=>e(v)&&e(s).length===0)?de(V):de(G,!1)})}n(le),R(de=>{y(Ue,`Employees in ${de??""}`),y(ke,`${e(s),m(()=>e(s).length)??""} employee${e(s),m(()=>e(s).length!==1?"s":"")??""}`)},[()=>(e(l),m(()=>xe(parseInt(e(l)))))]),g(J,le)};X(I,J=>{e(l)&&J(Y)})}n(Be),n(Ne);var fe=c(Ne,2);{var ce=J=>{var le=K1(),S=o(le),De=o(S),Ue=o(De),We=c(o(Ue),2),ke=o(We);n(We),n(Ue);var N=c(Ue,2);n(De);var V=c(De,2),G=o(V);{var de=oe=>{var se=O1(),U=c(o(se));n(se),R(()=>y(U,` ${e(f)??""}`)),g(oe,se)};X(G,oe=>{e(f)&&oe(de)})}var ve=c(G,2);{var Ie=oe=>{var se=z1(),U=c(o(se));n(se),R(()=>y(U,` ${e(h)??""}`)),g(oe,se)};X(ve,oe=>{e(h)&&oe(Ie)})}var Ye=c(ve,2);Mt(Ye,5,()=>A,oe=>oe.key,(oe,se)=>{const U=$i(()=>(e(se),m(()=>he(e(se).key))));var W=Y1(),ee=o(W),we=o(ee),Ae=o(we,!0);n(we);var He=c(we,2),Ke=o(He,!0);n(He);var Oe=c(He,2);{var Ee=Pe=>{var qe=B1();g(Pe,qe)};X(Oe,Pe=>{e(U)&&Pe(Ee)})}n(ee);var et=c(ee,2);{var dt=Pe=>{var qe=$1(),tt=o(qe),lt=o(tt),Xe=o(lt,!0);n(lt);var at=c(lt,2),Fe=o(at),rt=c(Fe);{var Ce=Ve=>{var Je=Ya();R(st=>y(Je,`• Expires: ${st??""}`),[()=>(kt(e(U)),m(()=>q(e(U).expiry_date)))]),g(Ve,Je)};X(rt,Ve=>{kt(e(U)),m(()=>e(U).expiry_date)&&Ve(Ce)})}n(at),n(tt);var _e=c(tt,2);n(qe),R((Ve,Je)=>{y(Xe,(kt(e(U)),m(()=>e(U).document_name))),y(Fe,`${Ve??""} • 
											${Je??""} `)},[()=>(kt(e(U)),m(()=>Me(e(U).file_size))),()=>(kt(e(U)),m(()=>q(e(U).upload_date)))]),Z("click",_e,()=>E(e(U).id)),g(Pe,qe)},ut=Pe=>{var qe=X1(),tt=o(qe),lt=o(tt),Xe=o(lt,!0);n(lt);var at=c(lt,2),Fe=o(at),rt=c(o(Fe),2);Mt(rt,5,()=>(e(se),m(()=>e(se).formats)),Lt,(Re,it)=>{var ft=U1(),mt=o(ft,!0);n(ft),R(()=>y(mt,e(it))),g(Re,ft)}),n(rt),n(Fe);var Ce=c(Fe,2),_e=c(o(Ce),2),Ve=o(_e,!0);n(_e),n(Ce);var Je=c(Ce,2);{var st=Re=>{var it=q1();g(Re,it)};X(Je,Re=>{e(se),m(()=>e(se).requiresExpiry)&&Re(st)})}n(at),n(tt);var ot=c(tt,2);{var Le=Re=>{var it=j1(),ft=c(o(it),2);At(ft),n(it),zt(ft,()=>e(w)[e(se).key.split("_")[1]],mt=>$e(w,e(w)[e(se).key.split("_")[1]]=mt)),g(Re,it)};X(ot,Re=>{e(se),m(()=>e(se).key.startsWith("other_"))&&Re(Le)})}var nt=c(ot,2),vt=c(o(nt),2),xt=c(vt,2),M=o(xt);n(xt);var H=c(xt,2);{var O=Re=>{var it=W1(),ft=c(o(it),2),mt=o(ft),ht=o(mt,!0);n(mt);var pt=c(mt,2),_t=o(pt);n(pt),n(ft),n(it),R(Ge=>{y(ht,(e(T),e(se),m(()=>e(T)[e(se).key].name))),y(_t,`(${Ge??""})`)},[()=>(e(T),e(se),m(()=>Me(e(T)[e(se).key].size)))]),g(Re,it)};X(H,Re=>{e(T),e(se),m(()=>e(T)[e(se).key])&&Re(O)})}n(nt);var te=c(nt,2);{var ne=Re=>{var it=H1(),ft=c(o(it),2);At(ft),n(it),zt(ft,()=>e(b)[e(se).key],mt=>$e(b,e(b)[e(se).key]=mt)),g(Re,it)},ie=Re=>{var it=Ca(),ft=Bt(it);{var mt=ht=>{var pt=V1(),_t=c(o(pt),2);At(_t),n(pt),zt(_t,()=>e(b)[e(se).key],Ge=>$e(b,e(b)[e(se).key]=Ge)),g(ht,pt)};X(ft,ht=>{e(se),m(()=>!e(se).requiresExpiry&&e(se).key!=="resume")&&ht(mt)},!0)}g(Re,it)};X(te,Re=>{e(se),m(()=>e(se).requiresExpiry)?Re(ne):Re(ie,!1)})}var Se=c(te,2),Qe=o(Se);{var je=Re=>{var it=G1();Et(),g(Re,it)},ze=Re=>{var it=Ya();R(()=>y(it,`📤 Upload ${e(se),m(()=>e(se).label)??""}`)),g(Re,it)};X(Qe,Re=>{e(u)?Re(je):Re(ze,!1)})}n(Se),n(qe),R(Re=>{y(Xe,(e(se),m(()=>e(se).description))),y(Ve,(e(se),m(()=>e(se).maxSize))),na(vt,"accept",(e(se),m(()=>e(se).accepts))),na(vt,"data-document",(e(se),m(()=>e(se).key))),y(M,`Accepted formats: ${Re??""} • Max size: ${e(se),m(()=>e(se).maxSize)??""}`),Se.disabled=(e(u),e(T),e(se),m(()=>e(u)||!e(T)[e(se).key]))},[()=>(e(se),m(()=>e(se).formats.join(", ")))]),Z("change",vt,Re=>ue(e(se).key,Re)),Z("click",Se,()=>D(e(se).key)),g(Pe,qe)};X(et,Pe=>{e(U)?Pe(dt):Pe(ut,!1)})}n(W),R(()=>{y(Ae,(e(se),m(()=>e(se).icon))),y(Ke,(e(se),m(()=>e(se).label)))}),g(oe,W)}),n(Ye),n(V),n(S),n(le),R(()=>y(ke,`${e(d),m(()=>e(d).name)??""} (${e(d),m(()=>e(d).employee_id)??""})`)),Z("click",N,me),Z("click",S,ir(function(oe){Or.call(this,r,oe)})),Z("click",le,me),g(J,le)};X(fe,J=>{e(_)&&e(d)&&J(ce)})}R(()=>L.disabled=e(v)),ra(L,()=>e(l),J=>p(l,J)),g(t,ge),ma()}var J1=k('<div class="allowance-row svelte-1xirhk9"><div class="row-number svelte-1xirhk9"></div> <div class="allowance-name svelte-1xirhk9"><label class="input-label svelte-1xirhk9">Allowance Name</label> <input type="text" class="text-input svelte-1xirhk9" placeholder="Enter allowance name"/></div> <div class="allowance-amount svelte-1xirhk9"><label class="input-label svelte-1xirhk9">Amount</label> <div><span class="currency-symbol svelte-1xirhk9">SAR</span> <input type="number" min="0" step="0.01" class="salary-input svelte-1xirhk9" placeholder="0.00"/></div></div> <div class="allowance-toggle svelte-1xirhk9"><label class="input-label svelte-1xirhk9">Enable</label> <label class="toggle-container svelte-1xirhk9"><input type="checkbox" class="toggle-checkbox svelte-1xirhk9"/> <span class="toggle-slider small svelte-1xirhk9"></span></label></div></div>'),eh=k('<div class="single-month svelte-1xirhk9"><label class="input-label svelte-1xirhk9">Month (MM-YYYY)</label> <input type="text" class="month-input svelte-1xirhk9" placeholder="09-2025"/></div>'),th=k('<div class="multiple-months svelte-1xirhk9"><div class="month-range svelte-1xirhk9"><div class="start-month svelte-1xirhk9"><label class="input-label svelte-1xirhk9">Start Month (MM-YYYY)</label> <input type="text" class="month-input svelte-1xirhk9" placeholder="01-2025"/></div> <div class="end-month svelte-1xirhk9"><label class="input-label svelte-1xirhk9">End Month (MM-YYYY)</label> <input type="text" class="month-input svelte-1xirhk9" placeholder="12-2025"/></div></div></div>'),ah=k('<div class="cutting-period svelte-1xirhk9"><h5 class="period-title svelte-1xirhk9"><span class="period-icon svelte-1xirhk9">📅</span> </h5> <div class="period-selection svelte-1xirhk9"><div class="selection-type svelte-1xirhk9"><label class="radio-container svelte-1xirhk9"><input type="radio" class="radio-input svelte-1xirhk9"/> <span class="radio-mark svelte-1xirhk9"></span> <span class="radio-label svelte-1xirhk9">Single Month</span></label> <label class="radio-container svelte-1xirhk9"><input type="radio" class="radio-input svelte-1xirhk9"/> <span class="radio-mark svelte-1xirhk9"></span> <span class="radio-label svelte-1xirhk9">Multiple Months</span></label></div> <!></div></div>'),rh=k('<div class="cutting-row-container svelte-1xirhk9"><div class="cutting-row svelte-1xirhk9"><div class="row-number svelte-1xirhk9"></div> <div class="cutting-name svelte-1xirhk9"><label class="input-label svelte-1xirhk9">Cutting Name / For</label> <input type="text" class="text-input svelte-1xirhk9" placeholder="Enter cutting name"/></div> <div class="cutting-amount svelte-1xirhk9"><label class="input-label svelte-1xirhk9">Amount</label> <div><span class="currency-symbol svelte-1xirhk9">SAR</span> <input type="number" min="0" step="0.01" class="salary-input svelte-1xirhk9" placeholder="0.00"/></div></div> <div class="cutting-toggle svelte-1xirhk9"><label class="input-label svelte-1xirhk9">Enable</label> <label class="toggle-container svelte-1xirhk9"><input type="checkbox" class="toggle-checkbox svelte-1xirhk9"/> <span class="toggle-slider small svelte-1xirhk9"></span></label></div></div> <!></div>'),sh=k('<div class="error-message svelte-1xirhk9"><strong class="svelte-1xirhk9">Error:</strong> </div>'),ih=k('<div class="success-message svelte-1xirhk9"><strong class="svelte-1xirhk9">Success:</strong> </div>'),nh=k('<span class="spinner svelte-1xirhk9"></span> Saving...',1),oh=k('<span class="icon svelte-1xirhk9">💾</span> Save Salary',1),lh=k('<div class="employee-salary svelte-1xirhk9"><div class="salary-header svelte-1xirhk9"><div class="employee-info svelte-1xirhk9"><h3 class="svelte-1xirhk9">Salary & Wage Management</h3> <div class="employee-details svelte-1xirhk9"><span class="employee-id-badge svelte-1xirhk9"> </span> <span class="employee-name svelte-1xirhk9"> </span> <span class="employee-position svelte-1xirhk9"> </span></div></div></div> <div class="salary-content svelte-1xirhk9"><div class="salary-section svelte-1xirhk9"><h4 class="section-title svelte-1xirhk9"><span class="section-icon svelte-1xirhk9">💰</span> Salary & Allowances</h4> <div class="salary-grid svelte-1xirhk9"><div class="salary-item basic-salary svelte-1xirhk9"><label class="salary-label svelte-1xirhk9">Basic Salary <span class="required svelte-1xirhk9">*</span></label> <div class="input-group svelte-1xirhk9"><span class="currency-symbol svelte-1xirhk9">SAR</span> <input type="number" min="0" step="0.01" class="salary-input svelte-1xirhk9" placeholder="0.00"/></div></div> <div class="salary-item svelte-1xirhk9"><div class="allowance-header svelte-1xirhk9"><label class="salary-label svelte-1xirhk9">Bonus</label> <label class="toggle-container svelte-1xirhk9"><input type="checkbox" class="toggle-checkbox svelte-1xirhk9"/> <span class="toggle-slider svelte-1xirhk9"></span></label></div> <div><span class="currency-symbol svelte-1xirhk9">SAR</span> <input type="number" min="0" step="0.01" class="salary-input svelte-1xirhk9" placeholder="0.00"/></div></div> <div class="salary-item svelte-1xirhk9"><div class="allowance-header svelte-1xirhk9"><label class="salary-label svelte-1xirhk9">Food Allowance</label> <label class="toggle-container svelte-1xirhk9"><input type="checkbox" class="toggle-checkbox svelte-1xirhk9"/> <span class="toggle-slider svelte-1xirhk9"></span></label></div> <div><span class="currency-symbol svelte-1xirhk9">SAR</span> <input type="number" min="0" step="0.01" class="salary-input svelte-1xirhk9" placeholder="0.00"/></div></div> <div class="salary-item svelte-1xirhk9"><div class="allowance-header svelte-1xirhk9"><label class="salary-label svelte-1xirhk9">Accommodation Allowance</label> <label class="toggle-container svelte-1xirhk9"><input type="checkbox" class="toggle-checkbox svelte-1xirhk9"/> <span class="toggle-slider svelte-1xirhk9"></span></label></div> <div><span class="currency-symbol svelte-1xirhk9">SAR</span> <input type="number" min="0" step="0.01" class="salary-input svelte-1xirhk9" placeholder="0.00"/></div></div> <div class="salary-item svelte-1xirhk9"><div class="allowance-header svelte-1xirhk9"><label class="salary-label svelte-1xirhk9">Travel Allowance</label> <label class="toggle-container svelte-1xirhk9"><input type="checkbox" class="toggle-checkbox svelte-1xirhk9"/> <span class="toggle-slider svelte-1xirhk9"></span></label></div> <div><span class="currency-symbol svelte-1xirhk9">SAR</span> <input type="number" min="0" step="0.01" class="salary-input svelte-1xirhk9" placeholder="0.00"/></div></div></div> <div class="other-allowances svelte-1xirhk9"><h5 class="subsection-title svelte-1xirhk9">Other Allowances</h5> <div class="allowance-rows svelte-1xirhk9"></div></div></div> <div class="cuttings-section svelte-1xirhk9"><h4 class="section-title svelte-1xirhk9"><span class="section-icon svelte-1xirhk9">✂️</span> Cuttings (Deductions)</h4> <div class="cutting-rows svelte-1xirhk9"></div></div> <div class="salary-summary svelte-1xirhk9"><h4 class="section-title svelte-1xirhk9"><span class="section-icon svelte-1xirhk9">📊</span> Salary Summary</h4> <div class="summary-grid svelte-1xirhk9"><div class="summary-item svelte-1xirhk9"><span class="summary-label svelte-1xirhk9">Total Allowances:</span> <span class="summary-value positive svelte-1xirhk9"> </span></div> <div class="summary-item svelte-1xirhk9"><span class="summary-label svelte-1xirhk9">Total Cuttings:</span> <span class="summary-value negative svelte-1xirhk9"> </span></div> <div class="summary-item total svelte-1xirhk9"><span class="summary-label svelte-1xirhk9">Net Salary:</span> <span class="summary-value net svelte-1xirhk9"> </span></div></div></div> <!> <!> <div class="salary-actions svelte-1xirhk9"><button type="button" class="cancel-btn svelte-1xirhk9">Cancel</button> <button class="save-btn svelte-1xirhk9"><!></button></div></div></div>'),ch=k('<div class="no-employee svelte-1xirhk9"><p class="svelte-1xirhk9">No employee selected</p></div>');function dh(t,r){pa(r,!1);const a=[];let s=Ra(r,"employee",12,null),i=Ra(r,"onClose",8,()=>{}),l=Ra(r,"mockEmployeesData",28,()=>[]),d=Q(!1),v=Q(""),u=Q(""),f=Q({basicSalary:0,bonus:{amount:0,enabled:!1},foodAllowance:{amount:0,enabled:!1},accommodationAllowance:{amount:0,enabled:!1},travelAllowance:{amount:0,enabled:!1},otherAllowances:[{name:"",amount:0,enabled:!1},{name:"",amount:0,enabled:!1},{name:"",amount:0,enabled:!1},{name:"",amount:0,enabled:!1}],cuttings:[{name:"",amount:0,enabled:!1,applicationType:"single",singleMonth:"",startMonth:"",endMonth:""},{name:"",amount:0,enabled:!1,applicationType:"single",singleMonth:"",startMonth:"",endMonth:""},{name:"",amount:0,enabled:!1,applicationType:"single",singleMonth:"",startMonth:"",endMonth:""},{name:"",amount:0,enabled:!1,applicationType:"single",singleMonth:"",startMonth:"",endMonth:""}]});Aa(()=>{s()&&h()});function h(){var E,he,xe,K,q,ae,Me,ge,Ne,Be,be,L,Te,ye,P,pe,B,j,I,Y,fe,ce,J,le,S,De,Ue,We,ke,N,V,G,de,ve,Ie,Ye,oe,se,U,W,ee,we,Ae,He,Ke,Oe,Ee,et,dt,ut,Pe,qe,tt,lt,Xe,at,Fe,rt,Ce,_e,Ve,Je,st,ot,Le,nt,vt,xt,M,H,O,te,ne,ie,Se,Qe,je,ze,Re,it,ft,mt,ht,pt,_t,Ge,ct,Ze;const D=s().salary||{};p(f,{basicSalary:D.basicSalary||0,bonus:{amount:((E=D.bonus)==null?void 0:E.amount)||0,enabled:((he=D.bonus)==null?void 0:he.enabled)||!1},foodAllowance:{amount:((xe=D.foodAllowance)==null?void 0:xe.amount)||0,enabled:((K=D.foodAllowance)==null?void 0:K.enabled)||!1},accommodationAllowance:{amount:((q=D.accommodationAllowance)==null?void 0:q.amount)||0,enabled:((ae=D.accommodationAllowance)==null?void 0:ae.enabled)||!1},travelAllowance:{amount:((Me=D.travelAllowance)==null?void 0:Me.amount)||0,enabled:((ge=D.travelAllowance)==null?void 0:ge.enabled)||!1},otherAllowances:[{name:((Be=(Ne=D.otherAllowances)==null?void 0:Ne[0])==null?void 0:Be.name)||"",amount:((L=(be=D.otherAllowances)==null?void 0:be[0])==null?void 0:L.amount)||0,enabled:((ye=(Te=D.otherAllowances)==null?void 0:Te[0])==null?void 0:ye.enabled)||!1},{name:((pe=(P=D.otherAllowances)==null?void 0:P[1])==null?void 0:pe.name)||"",amount:((j=(B=D.otherAllowances)==null?void 0:B[1])==null?void 0:j.amount)||0,enabled:((Y=(I=D.otherAllowances)==null?void 0:I[1])==null?void 0:Y.enabled)||!1},{name:((ce=(fe=D.otherAllowances)==null?void 0:fe[2])==null?void 0:ce.name)||"",amount:((le=(J=D.otherAllowances)==null?void 0:J[2])==null?void 0:le.amount)||0,enabled:((De=(S=D.otherAllowances)==null?void 0:S[2])==null?void 0:De.enabled)||!1},{name:((We=(Ue=D.otherAllowances)==null?void 0:Ue[3])==null?void 0:We.name)||"",amount:((N=(ke=D.otherAllowances)==null?void 0:ke[3])==null?void 0:N.amount)||0,enabled:((G=(V=D.otherAllowances)==null?void 0:V[3])==null?void 0:G.enabled)||!1}],cuttings:[{name:((ve=(de=D.cuttings)==null?void 0:de[0])==null?void 0:ve.name)||"",amount:((Ye=(Ie=D.cuttings)==null?void 0:Ie[0])==null?void 0:Ye.amount)||0,enabled:((se=(oe=D.cuttings)==null?void 0:oe[0])==null?void 0:se.enabled)||!1,applicationType:((W=(U=D.cuttings)==null?void 0:U[0])==null?void 0:W.applicationType)||"single",singleMonth:((we=(ee=D.cuttings)==null?void 0:ee[0])==null?void 0:we.singleMonth)||_(),startMonth:((He=(Ae=D.cuttings)==null?void 0:Ae[0])==null?void 0:He.startMonth)||"",endMonth:((Oe=(Ke=D.cuttings)==null?void 0:Ke[0])==null?void 0:Oe.endMonth)||""},{name:((et=(Ee=D.cuttings)==null?void 0:Ee[1])==null?void 0:et.name)||"",amount:((ut=(dt=D.cuttings)==null?void 0:dt[1])==null?void 0:ut.amount)||0,enabled:((qe=(Pe=D.cuttings)==null?void 0:Pe[1])==null?void 0:qe.enabled)||!1,applicationType:((lt=(tt=D.cuttings)==null?void 0:tt[1])==null?void 0:lt.applicationType)||"single",singleMonth:((at=(Xe=D.cuttings)==null?void 0:Xe[1])==null?void 0:at.singleMonth)||_(),startMonth:((rt=(Fe=D.cuttings)==null?void 0:Fe[1])==null?void 0:rt.startMonth)||"",endMonth:((_e=(Ce=D.cuttings)==null?void 0:Ce[1])==null?void 0:_e.endMonth)||""},{name:((Je=(Ve=D.cuttings)==null?void 0:Ve[2])==null?void 0:Je.name)||"",amount:((ot=(st=D.cuttings)==null?void 0:st[2])==null?void 0:ot.amount)||0,enabled:((nt=(Le=D.cuttings)==null?void 0:Le[2])==null?void 0:nt.enabled)||!1,applicationType:((xt=(vt=D.cuttings)==null?void 0:vt[2])==null?void 0:xt.applicationType)||"single",singleMonth:((H=(M=D.cuttings)==null?void 0:M[2])==null?void 0:H.singleMonth)||_(),startMonth:((te=(O=D.cuttings)==null?void 0:O[2])==null?void 0:te.startMonth)||"",endMonth:((ie=(ne=D.cuttings)==null?void 0:ne[2])==null?void 0:ie.endMonth)||""},{name:((Qe=(Se=D.cuttings)==null?void 0:Se[3])==null?void 0:Qe.name)||"",amount:((ze=(je=D.cuttings)==null?void 0:je[3])==null?void 0:ze.amount)||0,enabled:((it=(Re=D.cuttings)==null?void 0:Re[3])==null?void 0:it.enabled)||!1,applicationType:((mt=(ft=D.cuttings)==null?void 0:ft[3])==null?void 0:mt.applicationType)||"single",singleMonth:((pt=(ht=D.cuttings)==null?void 0:ht[3])==null?void 0:pt.singleMonth)||_(),startMonth:((Ge=(_t=D.cuttings)==null?void 0:_t[3])==null?void 0:Ge.startMonth)||"",endMonth:((Ze=(ct=D.cuttings)==null?void 0:ct[3])==null?void 0:Ze.endMonth)||""}]})}function _(){const D=new Date,E=D.getFullYear();return`${String(D.getMonth()+1).padStart(2,"0")}-${E}`}function x(){let D=e(f).basicSalary;return e(f).bonus.enabled&&(D+=e(f).bonus.amount),e(f).foodAllowance.enabled&&(D+=e(f).foodAllowance.amount),e(f).accommodationAllowance.enabled&&(D+=e(f).accommodationAllowance.amount),e(f).travelAllowance.enabled&&(D+=e(f).travelAllowance.amount),e(f).otherAllowances.forEach(E=>{E.enabled&&E.name&&(D+=E.amount)}),D}function T(){let D=0;return e(f).cuttings.forEach(E=>{E.enabled&&E.name&&(D+=E.amount)}),D}function b(){return x()-T()}function w(D){return new Intl.NumberFormat("en-SA",{style:"currency",currency:"SAR",minimumFractionDigits:2}).format(D)}function A(D){return D?/^\d{2}-\d{4}$/.test(D):!0}function C(D){if(D.applicationType==="single")return!0;if(!D.startMonth||!D.endMonth)return!1;const[E,he]=D.startMonth.split("-").map(Number),[xe,K]=D.endMonth.split("-").map(Number),q=new Date(he,E-1);return new Date(K,xe-1)>=q}async function z(){if(s()){if(e(f).basicSalary<=0){p(v,"Basic salary must be greater than 0");return}for(let D=0;D<e(f).cuttings.length;D++){const E=e(f).cuttings[D];if(E.enabled&&E.name)if(E.applicationType==="single"){if(!E.singleMonth||!A(E.singleMonth)){p(v,`Please enter a valid month for cutting "${E.name}" in MM-YYYY format`);return}}else{if(!E.startMonth||!E.endMonth){p(v,`Please enter both start and end months for cutting "${E.name}"`);return}if(!A(E.startMonth)||!A(E.endMonth)){p(v,`Please enter valid months for cutting "${E.name}" in MM-YYYY format`);return}if(!C(E)){p(v,`End month must be equal to or after start month for cutting "${E.name}"`);return}}}p(d,!0),p(v,"");try{await new Promise(E=>setTimeout(E,1500));const D={...e(f),lastUpdated:new Date().toISOString(),updatedBy:"Current User"};if(s(s().salary=D,!0),l()&&Array.isArray(l())){const E=l().findIndex(he=>he.id===s().id);E!==-1&&l(l()[E]={...l()[E],salary:D},!0)}p(u,`Salary updated successfully for ${s().name_en}`),setTimeout(()=>{i()()},2e3)}catch{p(v,"Failed to save salary information")}finally{p(d,!1)}}}ha();var F=Ca(),re=Bt(F);{var me=D=>{var E=lh(),he=o(E),xe=o(he),K=c(o(xe),2),q=o(K),ae=o(q,!0);n(q);var Me=c(q,2),ge=o(Me,!0);n(Me);var Ne=c(Me,2),Be=o(Ne);n(Ne),n(K),n(xe),n(he);var be=c(he,2),L=o(be),Te=c(o(L),2),ye=o(Te),P=c(o(ye),2),pe=c(o(P),2);At(pe),n(P),n(ye);var B=c(ye,2),j=o(B),I=c(o(j),2),Y=o(I);At(Y),Et(2),n(I),n(j);var fe=c(j,2);let ce;var J=c(o(fe),2);At(J),n(fe),n(B);var le=c(B,2),S=o(le),De=c(o(S),2),Ue=o(De);At(Ue),Et(2),n(De),n(S);var We=c(S,2);let ke;var N=c(o(We),2);At(N),n(We),n(le);var V=c(le,2),G=o(V),de=c(o(G),2),ve=o(de);At(ve),Et(2),n(de),n(G);var Ie=c(G,2);let Ye;var oe=c(o(Ie),2);At(oe),n(Ie),n(V);var se=c(V,2),U=o(se),W=c(o(U),2),ee=o(W);At(ee),Et(2),n(W),n(U);var we=c(U,2);let Ae;var He=c(o(we),2);At(He),n(we),n(se),n(Te);var Ke=c(Te,2),Oe=c(o(Ke),2);Mt(Oe,5,()=>(e(f),m(()=>e(f).otherAllowances)),Lt,(H,O,te)=>{var ne=J1(),ie=o(ne);ie.textContent=te+1;var Se=c(ie,2),Qe=c(o(Se),2);At(Qe),n(Se);var je=c(Se,2),ze=c(o(je),2);let Re;var it=c(o(ze),2);At(it),n(ze),n(je);var ft=c(je,2),mt=c(o(ft),2),ht=o(mt);At(ht),Et(2),n(mt),n(ft),n(ne),R(pt=>{Qe.disabled=e(d),Re=wt(ze,1,"input-group svelte-1xirhk9",null,Re,pt),it.disabled=(e(d),e(O),m(()=>e(d)||!e(O).enabled)),ht.disabled=e(d)},[()=>({disabled:!e(O).enabled})]),zt(Qe,()=>e(O).name,pt=>(e(O).name=pt,Xt(()=>e(f)))),zt(it,()=>e(O).amount,pt=>(e(O).amount=pt,Xt(()=>e(f)))),tr(ht,()=>e(O).enabled,pt=>(e(O).enabled=pt,Xt(()=>e(f)))),g(H,ne)}),n(Oe),n(Ke),n(L);var Ee=c(L,2),et=c(o(Ee),2);Mt(et,5,()=>(e(f),m(()=>e(f).cuttings)),Lt,(H,O,te)=>{let ne=te;var ie=rh(),Se=o(ie),Qe=o(Se);Qe.textContent=ne+1;var je=c(Qe,2),ze=c(o(je),2);At(ze),n(je);var Re=c(je,2),it=c(o(Re),2);let ft;var mt=c(o(it),2);At(mt),n(it),n(Re);var ht=c(Re,2),pt=c(o(ht),2),_t=o(pt);At(_t),Et(2),n(pt),n(ht),n(Se);var Ge=c(Se,2);{var ct=Ze=>{var bt=ah(),It=o(bt),Ot=c(o(It));n(It);var Pt=c(It,2),gt=o(Pt),yt=o(gt),qt=o(yt);At(qt),qt.value=qt.__value="single",Et(4),n(yt);var sa=c(yt,2),oa=o(sa);At(oa),oa.value=oa.__value="multiple",Et(4),n(sa),n(gt);var Ia=c(gt,2);{var ka=Dt=>{var Wt=eh(),ea=c(o(Wt),2);At(ea),na(ea,"pattern","\\d2-\\d4"),n(Wt),R(()=>ea.disabled=e(d)),zt(ea,()=>e(O).singleMonth,Ht=>(e(O).singleMonth=Ht,Xt(()=>e(f)))),g(Dt,Wt)},St=Dt=>{var Wt=th(),ea=o(Wt),Ht=o(ea),Qt=c(o(Ht),2);At(Qt),na(Qt,"pattern","\\d2-\\d4"),n(Ht);var la=c(Ht,2),Ft=c(o(la),2);At(Ft),na(Ft,"pattern","\\d2-\\d4"),n(la),n(ea),n(Wt),R(()=>{Qt.disabled=e(d),Ft.disabled=e(d)}),zt(Qt,()=>e(O).startMonth,Ct=>(e(O).startMonth=Ct,Xt(()=>e(f)))),zt(Ft,()=>e(O).endMonth,Ct=>(e(O).endMonth=Ct,Xt(()=>e(f)))),g(Dt,Wt)};X(Ia,Dt=>{e(O),m(()=>e(O).applicationType==="single")?Dt(ka):Dt(St,!1)})}n(Pt),n(bt),R(()=>{y(Ot,` Application Period for "${e(O),m(()=>e(O).name)??""}"`),qt.disabled=e(d),oa.disabled=e(d)}),gs(a,[te],qt,()=>e(O).applicationType,Dt=>(e(O).applicationType=Dt,Xt(()=>e(f)))),gs(a,[te],oa,()=>e(O).applicationType,Dt=>(e(O).applicationType=Dt,Xt(()=>e(f)))),g(Ze,bt)};X(Ge,Ze=>{e(O),m(()=>e(O).enabled&&e(O).name)&&Ze(ct)})}n(ie),R(Ze=>{ze.disabled=e(d),ft=wt(it,1,"input-group svelte-1xirhk9",null,ft,Ze),mt.disabled=(e(d),e(O),m(()=>e(d)||!e(O).enabled)),_t.disabled=e(d)},[()=>({disabled:!e(O).enabled})]),zt(ze,()=>e(O).name,Ze=>(e(O).name=Ze,Xt(()=>e(f)))),zt(mt,()=>e(O).amount,Ze=>(e(O).amount=Ze,Xt(()=>e(f)))),tr(_t,()=>e(O).enabled,Ze=>(e(O).enabled=Ze,Xt(()=>e(f)))),g(H,ie)}),n(et),n(Ee);var dt=c(Ee,2),ut=c(o(dt),2),Pe=o(ut),qe=c(o(Pe),2),tt=o(qe,!0);n(qe),n(Pe);var lt=c(Pe,2),Xe=c(o(lt),2),at=o(Xe);n(Xe),n(lt);var Fe=c(lt,2),rt=c(o(Fe),2),Ce=o(rt,!0);n(rt),n(Fe),n(ut),n(dt);var _e=c(dt,2);{var Ve=H=>{var O=sh(),te=c(o(O));n(O),R(()=>y(te,` ${e(v)??""}`)),g(H,O)};X(_e,H=>{e(v)&&H(Ve)})}var Je=c(_e,2);{var st=H=>{var O=ih(),te=c(o(O));n(O),R(()=>y(te,` ${e(u)??""}`)),g(H,O)};X(Je,H=>{e(u)&&H(st)})}var ot=c(Je,2),Le=o(ot),nt=c(Le,2),vt=o(nt);{var xt=H=>{var O=nh();Et(),g(H,O)},M=H=>{var O=oh();Et(),g(H,O)};X(vt,H=>{e(d)?H(xt):H(M,!1)})}n(nt),n(ot),n(be),n(E),R((H,O,te,ne,ie,Se,Qe)=>{y(ae,(kt(s()),m(()=>s().employee_id))),y(ge,(kt(s()),m(()=>s().name_en))),y(Be,`(${kt(s()),m(()=>s().position)??""})`),pe.disabled=e(d),Y.disabled=e(d),ce=wt(fe,1,"input-group svelte-1xirhk9",null,ce,H),J.disabled=(e(d),e(f),m(()=>e(d)||!e(f).bonus.enabled)),Ue.disabled=e(d),ke=wt(We,1,"input-group svelte-1xirhk9",null,ke,O),N.disabled=(e(d),e(f),m(()=>e(d)||!e(f).foodAllowance.enabled)),ve.disabled=e(d),Ye=wt(Ie,1,"input-group svelte-1xirhk9",null,Ye,te),oe.disabled=(e(d),e(f),m(()=>e(d)||!e(f).accommodationAllowance.enabled)),ee.disabled=e(d),Ae=wt(we,1,"input-group svelte-1xirhk9",null,Ae,ne),He.disabled=(e(d),e(f),m(()=>e(d)||!e(f).travelAllowance.enabled)),y(tt,ie),y(at,`-${Se??""}`),y(Ce,Qe),Le.disabled=e(d),nt.disabled=e(d)},[()=>({disabled:!e(f).bonus.enabled}),()=>({disabled:!e(f).foodAllowance.enabled}),()=>({disabled:!e(f).accommodationAllowance.enabled}),()=>({disabled:!e(f).travelAllowance.enabled}),()=>m(()=>w(x())),()=>m(()=>w(T())),()=>m(()=>w(b()))]),zt(pe,()=>e(f).basicSalary,H=>$e(f,e(f).basicSalary=H)),tr(Y,()=>e(f).bonus.enabled,H=>$e(f,e(f).bonus.enabled=H)),zt(J,()=>e(f).bonus.amount,H=>$e(f,e(f).bonus.amount=H)),tr(Ue,()=>e(f).foodAllowance.enabled,H=>$e(f,e(f).foodAllowance.enabled=H)),zt(N,()=>e(f).foodAllowance.amount,H=>$e(f,e(f).foodAllowance.amount=H)),tr(ve,()=>e(f).accommodationAllowance.enabled,H=>$e(f,e(f).accommodationAllowance.enabled=H)),zt(oe,()=>e(f).accommodationAllowance.amount,H=>$e(f,e(f).accommodationAllowance.amount=H)),tr(ee,()=>e(f).travelAllowance.enabled,H=>$e(f,e(f).travelAllowance.enabled=H)),zt(He,()=>e(f).travelAllowance.amount,H=>$e(f,e(f).travelAllowance.amount=H)),Z("click",Le,function(...H){var O;(O=i())==null||O.apply(this,H)}),Z("click",nt,z),g(D,E)},ue=D=>{var E=ch();g(D,E)};X(re,D=>{s()?D(me):D(ue,!1)})}g(t,F),ma()}var vh=k('<option class="svelte-m3dht2"> </option>'),uh=k('<div class="control-group svelte-m3dht2"><label class="control-label svelte-m3dht2"><span class="label-text svelte-m3dht2">Search Employees</span> <div class="search-container svelte-m3dht2"><span class="search-icon svelte-m3dht2">🔍</span> <input type="text" placeholder="Search by name, ID, position..." class="search-input svelte-m3dht2"/></div></label></div>'),fh=k('<div class="loading-state svelte-m3dht2"><div class="spinner svelte-m3dht2"></div> <p class="svelte-m3dht2">Loading employees...</p></div>'),ph=k('<p class="svelte-m3dht2">No employees match your search criteria.</p> <button class="clear-search-btn svelte-m3dht2">Clear Search</button>',1),hh=k('<p class="svelte-m3dht2">No employees are assigned to this branch.</p>'),mh=k('<div class="empty-state svelte-m3dht2"><div class="empty-icon svelte-m3dht2">👥</div> <h3 class="svelte-m3dht2">No employees found</h3> <!></div>'),_h=k('<tr class="employee-row svelte-m3dht2"><td class="svelte-m3dht2"><div class="employee-id svelte-m3dht2"><span class="id-badge svelte-m3dht2"> </span></div></td><td class="svelte-m3dht2"><div class="employee-name svelte-m3dht2"><div class="name-en svelte-m3dht2"> </div> <div class="name-ar svelte-m3dht2"> </div></div></td><td class="svelte-m3dht2"><span class="position svelte-m3dht2"> </span></td><td class="svelte-m3dht2"><span class="department svelte-m3dht2"> </span></td><td class="svelte-m3dht2"><div class="salary-amount basic svelte-m3dht2"> </div></td><td class="svelte-m3dht2"><div class="salary-amount net svelte-m3dht2"> </div></td><td class="svelte-m3dht2"><span> </span></td><td class="svelte-m3dht2"><span class="last-updated svelte-m3dht2"> </span></td><td class="svelte-m3dht2"><button class="update-btn svelte-m3dht2"><span class="btn-icon svelte-m3dht2">✏️</span> Update</button></td></tr>'),gh=k('<div class="employees-table-container svelte-m3dht2"><div class="table-header svelte-m3dht2"><h3 class="svelte-m3dht2"> </h3> <div class="table-info svelte-m3dht2"><span class="branch-info svelte-m3dht2"> </span></div></div> <div class="table-wrapper svelte-m3dht2"><table class="employees-table svelte-m3dht2"><thead class="svelte-m3dht2"><tr class="svelte-m3dht2"><th class="svelte-m3dht2">Employee ID</th><th class="svelte-m3dht2">Name</th><th class="svelte-m3dht2">Position</th><th class="svelte-m3dht2">Department</th><th class="svelte-m3dht2">Basic Salary</th><th class="svelte-m3dht2">Net Salary</th><th class="svelte-m3dht2">Status</th><th class="svelte-m3dht2">Last Updated</th><th class="svelte-m3dht2">Actions</th></tr></thead><tbody class="svelte-m3dht2"></tbody></table></div></div>'),xh=k('<div class="employees-section svelte-m3dht2"><!></div>'),bh=k('<div class="no-branch-selected svelte-m3dht2"><div class="no-branch-icon svelte-m3dht2">🏢</div> <h3 class="svelte-m3dht2">Select a Branch</h3> <p class="svelte-m3dht2">Please select a branch to view and manage employee salaries.</p></div>'),wh=k('<div class="salary-management svelte-m3dht2"><div class="salary-header svelte-m3dht2"><div class="header-content svelte-m3dht2"><h2 class="svelte-m3dht2">💰 Salary & Wage Management</h2> <p class="header-description svelte-m3dht2">Manage employee salaries, allowances, and deductions</p></div></div> <div class="salary-controls svelte-m3dht2"><div class="control-group svelte-m3dht2"><label class="control-label svelte-m3dht2"><span class="label-text svelte-m3dht2">Branch</span> <select class="branch-select svelte-m3dht2"><option class="svelte-m3dht2">Select Branch</option><!></select></label></div> <!></div> <!></div>');function yh(t,r){pa(r,!1),Ra(r,"onClose",8,()=>{});let a=Q(""),s=Q([]),i=Q(!1),l=Q("");const d=[{id:"BR001",name_en:"Main Office",name_ar:"المكتب الرئيسي",city:"Riyadh"},{id:"BR002",name_en:"North Branch",name_ar:"الفرع الشمالي",city:"Dammam"},{id:"BR003",name_en:"West Branch",name_ar:"الفرع الغربي",city:"Jeddah"},{id:"BR004",name_en:"South Branch",name_ar:"الفرع الجنوبي",city:"Abha"}],v=[{id:"EMP001",employee_id:"AQ-2024-001",name_en:"Ahmed Al-Salem",name_ar:"أحمد السالم",position:"Senior Manager",department:"Operations",branch_id:"BR001",email:"ahmed.salem@aqura.com",phone:"+966501234567",hire_date:"2021-03-15",status:"active",salary:{basicSalary:12e3,bonus:{amount:2e3,enabled:!0},foodAllowance:{amount:800,enabled:!0},accommodationAllowance:{amount:3e3,enabled:!0},travelAllowance:{amount:500,enabled:!1},otherAllowances:[{name:"Transportation",amount:600,enabled:!0},{name:"",amount:0,enabled:!1},{name:"",amount:0,enabled:!1},{name:"",amount:0,enabled:!1}],cuttings:[{name:"Insurance",amount:200,enabled:!0,applicationType:"single",singleMonth:"09-2025",startMonth:"",endMonth:""},{name:"Tax Deduction",amount:150,enabled:!0,applicationType:"multiple",singleMonth:"",startMonth:"09-2025",endMonth:"12-2025"},{name:"",amount:0,enabled:!1,applicationType:"single",singleMonth:"",startMonth:"",endMonth:""},{name:"",amount:0,enabled:!1,applicationType:"single",singleMonth:"",startMonth:"",endMonth:""}],lastUpdated:"2025-09-20T10:30:00Z"}},{id:"EMP002",employee_id:"AQ-2024-002",name_en:"Fatima Al-Zahra",name_ar:"فاطمة الزهراء",position:"HR Specialist",department:"Human Resources",branch_id:"BR001",email:"fatima.zahra@aqura.com",phone:"+966501234568",hire_date:"2021-08-20",status:"active",salary:{basicSalary:8e3,bonus:{amount:1e3,enabled:!0},foodAllowance:{amount:600,enabled:!0},accommodationAllowance:{amount:2e3,enabled:!0},travelAllowance:{amount:300,enabled:!0},otherAllowances:[{name:"Mobile Allowance",amount:200,enabled:!0},{name:"Internet Allowance",amount:150,enabled:!0},{name:"",amount:0,enabled:!1},{name:"",amount:0,enabled:!1}],cuttings:[{name:"Insurance",amount:120,enabled:!0,applicationType:"multiple",singleMonth:"",startMonth:"07-2025",endMonth:"12-2025"},{name:"",amount:0,enabled:!1,applicationType:"single",singleMonth:"",startMonth:"",endMonth:""},{name:"",amount:0,enabled:!1,applicationType:"single",singleMonth:"",startMonth:"",endMonth:""},{name:"",amount:0,enabled:!1,applicationType:"single",singleMonth:"",startMonth:"",endMonth:""}],lastUpdated:"2025-09-15T14:20:00Z"}},{id:"EMP003",employee_id:"AQ-2024-003",name_en:"Mohammed Al-Rashid",name_ar:"محمد الراشد",position:"Sales Executive",department:"Sales",branch_id:"BR002",email:"mohammed.rashid@aqura.com",phone:"+966501234569",hire_date:"2022-01-10",status:"active",salary:{basicSalary:6500,bonus:{amount:1500,enabled:!0},foodAllowance:{amount:500,enabled:!0},accommodationAllowance:{amount:1800,enabled:!0},travelAllowance:{amount:800,enabled:!0},otherAllowances:[{name:"Commission",amount:1200,enabled:!0},{name:"",amount:0,enabled:!1},{name:"",amount:0,enabled:!1},{name:"",amount:0,enabled:!1}],cuttings:[{name:"Insurance",amount:100,enabled:!0,applicationType:"single",singleMonth:"09-2025",startMonth:"",endMonth:""},{name:"Loan Deduction",amount:300,enabled:!0,applicationType:"multiple",singleMonth:"",startMonth:"09-2025",endMonth:"03-2026"},{name:"",amount:0,enabled:!1,applicationType:"single",singleMonth:"",startMonth:"",endMonth:""},{name:"",amount:0,enabled:!1,applicationType:"single",singleMonth:"",startMonth:"",endMonth:""}],lastUpdated:"2025-09-18T09:15:00Z"}},{id:"EMP004",employee_id:"AQ-2024-004",name_en:"Sarah Al-Mansouri",name_ar:"سارة المنصوري",position:"Accountant",department:"Finance",branch_id:"BR003",email:"sarah.mansouri@aqura.com",phone:"+966501234570",hire_date:"2022-06-15",status:"active",salary:{basicSalary:7e3,bonus:{amount:800,enabled:!1},foodAllowance:{amount:600,enabled:!0},accommodationAllowance:{amount:2200,enabled:!0},travelAllowance:{amount:0,enabled:!1},otherAllowances:[{name:"",amount:0,enabled:!1},{name:"",amount:0,enabled:!1},{name:"",amount:0,enabled:!1},{name:"",amount:0,enabled:!1}],cuttings:[{name:"Insurance",amount:105,enabled:!0,applicationType:"single",singleMonth:"09-2025",startMonth:"",endMonth:""},{name:"",amount:0,enabled:!1,applicationType:"single",singleMonth:"",startMonth:"",endMonth:""},{name:"",amount:0,enabled:!1,applicationType:"single",singleMonth:"",startMonth:"",endMonth:""},{name:"",amount:0,enabled:!1,applicationType:"single",singleMonth:"",startMonth:"",endMonth:""}]}},{id:"EMP005",employee_id:"AQ-2024-005",name_en:"Omar Al-Khaled",name_ar:"عمر الخالد",position:"IT Technician",department:"Information Technology",branch_id:"BR001",email:"omar.khaled@aqura.com",phone:"+966501234571",hire_date:"2023-02-28",status:"active"},{id:"EMP006",employee_id:"AQ-2024-006",name_en:"Aisha Al-Badawi",name_ar:"عائشة البدوي",position:"Marketing Coordinator",department:"Marketing",branch_id:"BR004",email:"aisha.badawi@aqura.com",phone:"+966501234572",hire_date:"2023-09-05",status:"active"}];Aa(()=>{d.length>0&&(p(a,d[0].id),u())});function u(){if(!e(a)){p(s,[]);return}p(i,!0),setTimeout(()=>{p(s,v.filter(K=>K.branch_id===e(a))),f(),p(i,!1)},500)}function f(){if(!e(l).trim())p(s,v.filter(K=>K.branch_id===e(a)));else{const K=e(l).toLowerCase();p(s,v.filter(q=>q.branch_id===e(a)).filter(q=>q.name_en.toLowerCase().includes(K)||q.name_ar.includes(K)||q.employee_id.toLowerCase().includes(K)||q.position.toLowerCase().includes(K)||q.department.toLowerCase().includes(K)))}}function h(K){const q=`employee-salary-${K.id}`;if(Kt.getWindow(q)){Kt.focusWindow(q);return}Kt.openWindow({id:q,title:`💰 Salary Management - ${K.name_en} (${K.employee_id})`,component:dh,props:{employee:{...K},onClose:()=>Kt.closeWindow(q),mockEmployeesData:v},width:1200,height:800,x:100+Math.random()*200,y:50+Math.random()*100,minWidth:800,minHeight:600})}function _(K){return typeof K!="number"?"SAR 0.00":new Intl.NumberFormat("en-SA",{style:"currency",currency:"SAR",minimumFractionDigits:2}).format(K)}function x(K){var Me,ge,Ne,Be,be,L;const q=K.salary;if(!q)return 0;let ae=q.basicSalary||0;return(Me=q.bonus)!=null&&Me.enabled&&(ae+=q.bonus.amount||0),(ge=q.foodAllowance)!=null&&ge.enabled&&(ae+=q.foodAllowance.amount||0),(Ne=q.accommodationAllowance)!=null&&Ne.enabled&&(ae+=q.accommodationAllowance.amount||0),(Be=q.travelAllowance)!=null&&Be.enabled&&(ae+=q.travelAllowance.amount||0),(be=q.otherAllowances)==null||be.forEach(Te=>{Te.enabled&&Te.name&&(ae+=Te.amount||0)}),(L=q.cuttings)==null||L.forEach(Te=>{Te.enabled&&Te.name&&(ae-=Te.amount||0)}),ae}function T(K){if(!K.salary||!K.salary.basicSalary)return{status:"not-set",label:"Not Set",class:"status-not-set"};const q=K.salary.lastUpdated;if(!q)return{status:"needs-review",label:"Needs Review",class:"status-needs-review"};const ae=new Date(q),ge=Math.floor((new Date-ae)/(1e3*60*60*24));return ge>30?{status:"outdated",label:"Outdated",class:"status-outdated"}:ge>7?{status:"needs-review",label:"Needs Review",class:"status-needs-review"}:{status:"current",label:"Current",class:"status-current"}}function b(K){var ae;return(ae=K.salary)!=null&&ae.lastUpdated?new Date(K.salary.lastUpdated).toLocaleDateString("en-SA",{year:"numeric",month:"short",day:"numeric"}):"Never"}Nt(()=>e(a),()=>{e(a)&&u()}),Nt(()=>e(l),()=>{e(l)!==void 0&&f()}),Va(),ha();var w=wh(),A=c(o(w),2),C=o(A),z=o(C),F=c(o(z),2);R(()=>{e(a),Xt(()=>{e(i)})});var re=o(F);re.value=re.__value="";var me=c(re);Mt(me,1,()=>d,Lt,(K,q)=>{var ae=vh(),Me=o(ae);n(ae);var ge={};R(()=>{y(Me,`${e(q),m(()=>e(q).name_en)??""} - ${e(q),m(()=>e(q).city)??""}`),ge!==(ge=(e(q),m(()=>e(q).id)))&&(ae.value=(ae.__value=(e(q),m(()=>e(q).id)))??"")}),g(K,ae)}),n(F),n(z),n(C);var ue=c(C,2);{var D=K=>{var q=uh(),ae=o(q),Me=c(o(ae),2),ge=c(o(Me),2);At(ge),n(Me),n(ae),n(q),R(()=>ge.disabled=e(i)),zt(ge,()=>e(l),Ne=>p(l,Ne)),g(K,q)};X(ue,K=>{e(a)&&K(D)})}n(A);var E=c(A,2);{var he=K=>{var q=xh(),ae=o(q);{var Me=Ne=>{var Be=fh();g(Ne,Be)},ge=Ne=>{var Be=Ca(),be=Bt(Be);{var L=ye=>{var P=mh(),pe=c(o(P),4);{var B=I=>{var Y=ph(),fe=c(Bt(Y),2);Z("click",fe,()=>p(l,"")),g(I,Y)},j=I=>{var Y=hh();g(I,Y)};X(pe,I=>{e(l)?I(B):I(j,!1)})}n(P),g(ye,P)},Te=ye=>{var P=gh(),pe=o(P),B=o(pe),j=o(B);n(B);var I=c(B,2),Y=o(I),fe=o(Y,!0);n(Y),n(I),n(pe);var ce=c(pe,2),J=o(ce),le=c(o(J));Mt(le,5,()=>e(s),Lt,(S,De)=>{const Ue=$i(()=>(e(De),m(()=>T(e(De)))));var We=_h(),ke=o(We),N=o(ke),V=o(N),G=o(V,!0);n(V),n(N),n(ke);var de=c(ke),ve=o(de),Ie=o(ve),Ye=o(Ie,!0);n(Ie);var oe=c(Ie,2),se=o(oe,!0);n(oe),n(ve),n(de);var U=c(de),W=o(U),ee=o(W,!0);n(W),n(U);var we=c(U),Ae=o(we),He=o(Ae,!0);n(Ae),n(we);var Ke=c(we),Oe=o(Ke),Ee=o(Oe,!0);n(Oe),n(Ke);var et=c(Ke),dt=o(et),ut=o(dt,!0);n(dt),n(et);var Pe=c(et),qe=o(Pe),tt=o(qe,!0);n(qe),n(Pe);var lt=c(Pe),Xe=o(lt),at=o(Xe,!0);n(Xe),n(lt);var Fe=c(lt),rt=o(Fe);n(Fe),n(We),R((Ce,_e,Ve)=>{y(G,(e(De),m(()=>e(De).employee_id))),y(Ye,(e(De),m(()=>e(De).name_en))),y(se,(e(De),m(()=>e(De).name_ar))),y(ee,(e(De),m(()=>e(De).position))),y(He,(e(De),m(()=>e(De).department))),y(Ee,Ce),y(ut,_e),wt(qe,1,`status-badge ${kt(e(Ue)),m(()=>e(Ue).class)??""}`,"svelte-m3dht2"),y(tt,(kt(e(Ue)),m(()=>e(Ue).label))),y(at,Ve),na(rt,"title",`Update salary for ${e(De),m(()=>e(De).name_en)??""}`)},[()=>(e(De),m(()=>{var Ce;return _(((Ce=e(De).salary)==null?void 0:Ce.basicSalary)||0)})),()=>(e(De),m(()=>_(x(e(De))))),()=>(e(De),m(()=>b(e(De))))]),Z("click",rt,()=>h(e(De))),g(S,We)}),n(le),n(J),n(ce),n(P),R(S=>{y(j,`Employees (${e(s),m(()=>e(s).length)??""})`),y(fe,S)},[()=>(e(a),m(()=>{var S;return(S=d.find(De=>De.id===e(a)))==null?void 0:S.name_en}))]),g(ye,P)};X(be,ye=>{e(s),m(()=>e(s).length===0)?ye(L):ye(Te,!1)},!0)}g(Ne,Be)};X(ae,Ne=>{e(i)?Ne(Me):Ne(ge,!1)})}n(q),g(K,q)},xe=K=>{var q=bh();g(K,q)};X(E,K=>{e(a)?K(he):K(xe,!1)})}n(w),R(()=>F.disabled=e(i)),ra(F,()=>e(a),K=>p(a,K)),g(t,w),ma()}/*! xlsx.js (C) 2013-present SheetJS -- http://sheetjs.com */var Yl=1252,kh=[874,932,936,949,950,1250,1251,1252,1253,1254,1255,1256,1257,1258,1e4],Zn={0:1252,1:65001,2:65001,77:1e4,128:932,129:949,130:1361,134:936,136:950,161:1253,162:1254,163:1258,177:1255,178:1256,186:1257,204:1251,222:874,238:1250,255:1252,69:6969},Jn=function(t){kh.indexOf(t)!=-1&&(Yl=Zn[0]=t)};function Th(){Jn(1252)}var ns=function(t){Jn(t)};function Kl(){ns(1200),Th()}function Po(t){for(var r=[],a=0,s=t.length;a<s;++a)r[a]=t.charCodeAt(a);return r}function Eh(t){for(var r=[],a=0;a<t.length>>1;++a)r[a]=String.fromCharCode(t.charCodeAt(2*a)+(t.charCodeAt(2*a+1)<<8));return r.join("")}function Ql(t){for(var r=[],a=0;a<t.length>>1;++a)r[a]=String.fromCharCode(t.charCodeAt(2*a+1)+(t.charCodeAt(2*a)<<8));return r.join("")}var mi=function(t){var r=t.charCodeAt(0),a=t.charCodeAt(1);return r==255&&a==254?Eh(t.slice(2)):r==254&&a==255?Ql(t.slice(2)):r==65279?t.slice(1):t},Yi=function(r){return String.fromCharCode(r)},Lo=function(r){return String.fromCharCode(r)},Mi,Cs="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function Oo(t){for(var r="",a=0,s=0,i=0,l=0,d=0,v=0,u=0,f=0;f<t.length;)a=t.charCodeAt(f++),l=a>>2,s=t.charCodeAt(f++),d=(a&3)<<4|s>>4,i=t.charCodeAt(f++),v=(s&15)<<2|i>>6,u=i&63,isNaN(s)?v=u=64:isNaN(i)&&(u=64),r+=Cs.charAt(l)+Cs.charAt(d)+Cs.charAt(v)+Cs.charAt(u);return r}function Gr(t){var r="",a=0,s=0,i=0,l=0,d=0,v=0,u=0;t=t.replace(/[^\w\+\/\=]/g,"");for(var f=0;f<t.length;)l=Cs.indexOf(t.charAt(f++)),d=Cs.indexOf(t.charAt(f++)),a=l<<2|d>>4,r+=String.fromCharCode(a),v=Cs.indexOf(t.charAt(f++)),s=(d&15)<<4|v>>2,v!==64&&(r+=String.fromCharCode(s)),u=Cs.indexOf(t.charAt(f++)),i=(v&3)<<6|u,u!==64&&(r+=String.fromCharCode(i));return r}var Na=function(){return typeof Buffer<"u"&&typeof process<"u"&&typeof process.versions<"u"&&!!process.versions.node}(),Vs=function(){if(typeof Buffer<"u"){var t=!Buffer.from;if(!t)try{Buffer.from("foo","utf8")}catch{t=!0}return t?function(r,a){return a?new Buffer(r,a):new Buffer(r)}:Buffer.from.bind(Buffer)}return function(){}}();function Is(t){return Na?Buffer.alloc?Buffer.alloc(t):new Buffer(t):typeof Uint8Array<"u"?new Uint8Array(t):new Array(t)}function zo(t){return Na?Buffer.allocUnsafe?Buffer.allocUnsafe(t):new Buffer(t):typeof Uint8Array<"u"?new Uint8Array(t):new Array(t)}var is=function(r){return Na?Vs(r,"binary"):r.split("").map(function(a){return a.charCodeAt(0)&255})};function Gs(t){if(Array.isArray(t))return t.map(function(s){return String.fromCharCode(s)}).join("");for(var r=[],a=0;a<t.length;++a)r[a]=String.fromCharCode(t[a]);return r.join("")}function eo(t){if(typeof ArrayBuffer>"u")throw new Error("Unsupported");if(t instanceof ArrayBuffer)return eo(new Uint8Array(t));for(var r=new Array(t.length),a=0;a<t.length;++a)r[a]=t[a];return r}var Ss=Na?function(t){return Buffer.concat(t.map(function(r){return Buffer.isBuffer(r)?r:Vs(r)}))}:function(t){if(typeof Uint8Array<"u"){var r=0,a=0;for(r=0;r<t.length;++r)a+=t[r].length;var s=new Uint8Array(a),i=0;for(r=0,a=0;r<t.length;a+=i,++r)if(i=t[r].length,t[r]instanceof Uint8Array)s.set(t[r],a);else{if(typeof t[r]=="string")throw"wtf";s.set(new Uint8Array(t[r]),a)}return s}return[].concat.apply([],t.map(function(l){return Array.isArray(l)?l:[].slice.call(l)}))};function Ah(t){for(var r=[],a=0,s=t.length+250,i=Is(t.length+255),l=0;l<t.length;++l){var d=t.charCodeAt(l);if(d<128)i[a++]=d;else if(d<2048)i[a++]=192|d>>6&31,i[a++]=128|d&63;else if(d>=55296&&d<57344){d=(d&1023)+64;var v=t.charCodeAt(++l)&1023;i[a++]=240|d>>8&7,i[a++]=128|d>>2&63,i[a++]=128|v>>6&15|(d&3)<<4,i[a++]=128|v&63}else i[a++]=224|d>>12&15,i[a++]=128|d>>6&63,i[a++]=128|d&63;a>s&&(r.push(i.slice(0,a)),a=0,i=Is(65535),s=65530)}return r.push(i.slice(0,a)),Ss(r)}var Lr=/\u0000/g,_i=/[\u0001-\u0006]/g;function ai(t){for(var r="",a=t.length-1;a>=0;)r+=t.charAt(a--);return r}function os(t,r){var a=""+t;return a.length>=r?a:lr("0",r-a.length)+a}function to(t,r){var a=""+t;return a.length>=r?a:lr(" ",r-a.length)+a}function on(t,r){var a=""+t;return a.length>=r?a:a+lr(" ",r-a.length)}function Sh(t,r){var a=""+Math.round(t);return a.length>=r?a:lr("0",r-a.length)+a}function Ch(t,r){var a=""+t;return a.length>=r?a:lr("0",r-a.length)+a}var Bo=Math.pow(2,32);function Js(t,r){if(t>Bo||t<-Bo)return Sh(t,r);var a=Math.round(t);return Ch(a,r)}function ln(t,r){return r=r||0,t.length>=7+r&&(t.charCodeAt(r)|32)===103&&(t.charCodeAt(r+1)|32)===101&&(t.charCodeAt(r+2)|32)===110&&(t.charCodeAt(r+3)|32)===101&&(t.charCodeAt(r+4)|32)===114&&(t.charCodeAt(r+5)|32)===97&&(t.charCodeAt(r+6)|32)===108}var $o=[["Sun","Sunday"],["Mon","Monday"],["Tue","Tuesday"],["Wed","Wednesday"],["Thu","Thursday"],["Fri","Friday"],["Sat","Saturday"]],Fn=[["J","Jan","January"],["F","Feb","February"],["M","Mar","March"],["A","Apr","April"],["M","May","May"],["J","Jun","June"],["J","Jul","July"],["A","Aug","August"],["S","Sep","September"],["O","Oct","October"],["N","Nov","November"],["D","Dec","December"]];function Fh(t){return t||(t={}),t[0]="General",t[1]="0",t[2]="0.00",t[3]="#,##0",t[4]="#,##0.00",t[9]="0%",t[10]="0.00%",t[11]="0.00E+00",t[12]="# ?/?",t[13]="# ??/??",t[14]="m/d/yy",t[15]="d-mmm-yy",t[16]="d-mmm",t[17]="mmm-yy",t[18]="h:mm AM/PM",t[19]="h:mm:ss AM/PM",t[20]="h:mm",t[21]="h:mm:ss",t[22]="m/d/yy h:mm",t[37]="#,##0 ;(#,##0)",t[38]="#,##0 ;[Red](#,##0)",t[39]="#,##0.00;(#,##0.00)",t[40]="#,##0.00;[Red](#,##0.00)",t[45]="mm:ss",t[46]="[h]:mm:ss",t[47]="mmss.0",t[48]="##0.0E+0",t[49]="@",t[56]='"上午/下午 "hh"時"mm"分"ss"秒 "',t}var Sa={0:"General",1:"0",2:"0.00",3:"#,##0",4:"#,##0.00",9:"0%",10:"0.00%",11:"0.00E+00",12:"# ?/?",13:"# ??/??",14:"m/d/yy",15:"d-mmm-yy",16:"d-mmm",17:"mmm-yy",18:"h:mm AM/PM",19:"h:mm:ss AM/PM",20:"h:mm",21:"h:mm:ss",22:"m/d/yy h:mm",37:"#,##0 ;(#,##0)",38:"#,##0 ;[Red](#,##0)",39:"#,##0.00;(#,##0.00)",40:"#,##0.00;[Red](#,##0.00)",45:"mm:ss",46:"[h]:mm:ss",47:"mmss.0",48:"##0.0E+0",49:"@",56:'"上午/下午 "hh"時"mm"分"ss"秒 "'},Uo={5:37,6:38,7:39,8:40,23:0,24:0,25:0,26:0,27:14,28:14,29:14,30:14,31:14,50:14,51:14,52:14,53:14,54:14,55:14,56:14,57:14,58:14,59:1,60:2,61:3,62:4,67:9,68:10,69:12,70:13,71:14,72:14,73:15,74:16,75:17,76:20,77:21,78:22,79:45,80:46,81:47,82:0},Dh={5:'"$"#,##0_);\\("$"#,##0\\)',63:'"$"#,##0_);\\("$"#,##0\\)',6:'"$"#,##0_);[Red]\\("$"#,##0\\)',64:'"$"#,##0_);[Red]\\("$"#,##0\\)',7:'"$"#,##0.00_);\\("$"#,##0.00\\)',65:'"$"#,##0.00_);\\("$"#,##0.00\\)',8:'"$"#,##0.00_);[Red]\\("$"#,##0.00\\)',66:'"$"#,##0.00_);[Red]\\("$"#,##0.00\\)',41:'_(* #,##0_);_(* \\(#,##0\\);_(* "-"_);_(@_)',42:'_("$"* #,##0_);_("$"* \\(#,##0\\);_("$"* "-"_);_(@_)',43:'_(* #,##0.00_);_(* \\(#,##0.00\\);_(* "-"??_);_(@_)',44:'_("$"* #,##0.00_);_("$"* \\(#,##0.00\\);_("$"* "-"??_);_(@_)'};function cn(t,r,a){for(var s=t<0?-1:1,i=t*s,l=0,d=1,v=0,u=1,f=0,h=0,_=Math.floor(i);f<r&&(_=Math.floor(i),v=_*d+l,h=_*f+u,!(i-_<5e-8));)i=1/(i-_),l=d,d=v,u=f,f=h;if(h>r&&(f>r?(h=u,v=l):(h=f,v=d)),!a)return[0,s*v,h];var x=Math.floor(s*v/h);return[x,s*v-x*h,h]}function zs(t,r,a){if(t>2958465||t<0)return null;var s=t|0,i=Math.floor(86400*(t-s)),l=0,d=[],v={D:s,T:i,u:86400*(t-s)-i,y:0,m:0,d:0,H:0,M:0,S:0,q:0};if(Math.abs(v.u)<1e-6&&(v.u=0),r&&r.date1904&&(s+=1462),v.u>.9999&&(v.u=0,++i==86400&&(v.T=i=0,++s,++v.D)),s===60)d=a?[1317,10,29]:[1900,2,29],l=3;else if(s===0)d=a?[1317,8,29]:[1900,1,0],l=6;else{s>60&&--s;var u=new Date(1900,0,1);u.setDate(u.getDate()+s-1),d=[u.getFullYear(),u.getMonth()+1,u.getDate()],l=u.getDay(),s<60&&(l=(l+6)%7),a&&(l=Lh(u,d))}return v.y=d[0],v.m=d[1],v.d=d[2],v.S=i%60,i=Math.floor(i/60),v.M=i%60,i=Math.floor(i/60),v.H=i,v.q=l,v}var Zl=new Date(1899,11,31,0,0,0),Mh=Zl.getTime(),Ih=new Date(1900,2,1,0,0,0);function Jl(t,r){var a=t.getTime();return r?a-=1461*24*60*60*1e3:t>=Ih&&(a+=24*60*60*1e3),(a-(Mh+(t.getTimezoneOffset()-Zl.getTimezoneOffset())*6e4))/(24*60*60*1e3)}function ao(t){return t.indexOf(".")==-1?t:t.replace(/(?:\.0*|(\.\d*[1-9])0+)$/,"$1")}function Rh(t){return t.indexOf("E")==-1?t:t.replace(/(?:\.0*|(\.\d*[1-9])0+)[Ee]/,"$1E").replace(/(E[+-])(\d)$/,"$10$2")}function Nh(t){var r=t<0?12:11,a=ao(t.toFixed(12));return a.length<=r||(a=t.toPrecision(10),a.length<=r)?a:t.toExponential(5)}function Ph(t){var r=ao(t.toFixed(11));return r.length>(t<0?12:11)||r==="0"||r==="-0"?t.toPrecision(6):r}function Ii(t){var r=Math.floor(Math.log(Math.abs(t))*Math.LOG10E),a;return r>=-4&&r<=-1?a=t.toPrecision(10+r):Math.abs(r)<=9?a=Nh(t):r===10?a=t.toFixed(10).substr(0,12):a=Ph(t),ao(Rh(a.toUpperCase()))}function js(t,r){switch(typeof t){case"string":return t;case"boolean":return t?"TRUE":"FALSE";case"number":return(t|0)===t?t.toString(10):Ii(t);case"undefined":return"";case"object":if(t==null)return"";if(t instanceof Date)return Qr(14,Jl(t,r&&r.date1904),r)}throw new Error("unsupported value in General format: "+t)}function Lh(t,r){r[0]-=581;var a=t.getDay();return t<60&&(a=(a+6)%7),a}function Oh(t,r,a,s){var i="",l=0,d=0,v=a.y,u,f=0;switch(t){case 98:v=a.y+543;case 121:switch(r.length){case 1:case 2:u=v%100,f=2;break;default:u=v%1e4,f=4;break}break;case 109:switch(r.length){case 1:case 2:u=a.m,f=r.length;break;case 3:return Fn[a.m-1][1];case 5:return Fn[a.m-1][0];default:return Fn[a.m-1][2]}break;case 100:switch(r.length){case 1:case 2:u=a.d,f=r.length;break;case 3:return $o[a.q][0];default:return $o[a.q][1]}break;case 104:switch(r.length){case 1:case 2:u=1+(a.H+11)%12,f=r.length;break;default:throw"bad hour format: "+r}break;case 72:switch(r.length){case 1:case 2:u=a.H,f=r.length;break;default:throw"bad hour format: "+r}break;case 77:switch(r.length){case 1:case 2:u=a.M,f=r.length;break;default:throw"bad minute format: "+r}break;case 115:if(r!="s"&&r!="ss"&&r!=".0"&&r!=".00"&&r!=".000")throw"bad second format: "+r;return a.u===0&&(r=="s"||r=="ss")?os(a.S,r.length):(s>=2?d=s===3?1e3:100:d=s===1?10:1,l=Math.round(d*(a.S+a.u)),l>=60*d&&(l=0),r==="s"?l===0?"0":""+l/d:(i=os(l,2+s),r==="ss"?i.substr(0,2):"."+i.substr(2,r.length-1)));case 90:switch(r){case"[h]":case"[hh]":u=a.D*24+a.H;break;case"[m]":case"[mm]":u=(a.D*24+a.H)*60+a.M;break;case"[s]":case"[ss]":u=((a.D*24+a.H)*60+a.M)*60+Math.round(a.S+a.u);break;default:throw"bad abstime format: "+r}f=r.length===3?1:2;break;case 101:u=v,f=1;break}var h=f>0?os(u,f):"";return h}function Fs(t){var r=3;if(t.length<=r)return t;for(var a=t.length%r,s=t.substr(0,a);a!=t.length;a+=r)s+=(s.length>0?",":"")+t.substr(a,r);return s}var ec=/%/g;function zh(t,r,a){var s=r.replace(ec,""),i=r.length-s.length;return bs(t,s,a*Math.pow(10,2*i))+lr("%",i)}function Bh(t,r,a){for(var s=r.length-1;r.charCodeAt(s-1)===44;)--s;return bs(t,r.substr(0,s),a/Math.pow(10,3*(r.length-s)))}function tc(t,r){var a,s=t.indexOf("E")-t.indexOf(".")-1;if(t.match(/^#+0.0E\+0$/)){if(r==0)return"0.0E+0";if(r<0)return"-"+tc(t,-r);var i=t.indexOf(".");i===-1&&(i=t.indexOf("E"));var l=Math.floor(Math.log(r)*Math.LOG10E)%i;if(l<0&&(l+=i),a=(r/Math.pow(10,l)).toPrecision(s+1+(i+l)%i),a.indexOf("e")===-1){var d=Math.floor(Math.log(r)*Math.LOG10E);for(a.indexOf(".")===-1?a=a.charAt(0)+"."+a.substr(1)+"E+"+(d-a.length+l):a+="E+"+(d-l);a.substr(0,2)==="0.";)a=a.charAt(0)+a.substr(2,i)+"."+a.substr(2+i),a=a.replace(/^0+([1-9])/,"$1").replace(/^0+\./,"0.");a=a.replace(/\+-/,"-")}a=a.replace(/^([+-]?)(\d*)\.(\d*)[Ee]/,function(v,u,f,h){return u+f+h.substr(0,(i+l)%i)+"."+h.substr(l)+"E"})}else a=r.toExponential(s);return t.match(/E\+00$/)&&a.match(/e[+-]\d$/)&&(a=a.substr(0,a.length-1)+"0"+a.charAt(a.length-1)),t.match(/E\-/)&&a.match(/e\+/)&&(a=a.replace(/e\+/,"e")),a.replace("e","E")}var ac=/# (\?+)( ?)\/( ?)(\d+)/;function $h(t,r,a){var s=parseInt(t[4],10),i=Math.round(r*s),l=Math.floor(i/s),d=i-l*s,v=s;return a+(l===0?"":""+l)+" "+(d===0?lr(" ",t[1].length+1+t[4].length):to(d,t[1].length)+t[2]+"/"+t[3]+os(v,t[4].length))}function Uh(t,r,a){return a+(r===0?"":""+r)+lr(" ",t[1].length+2+t[4].length)}var rc=/^#*0*\.([0#]+)/,sc=/\).*[0#]/,ic=/\(###\) ###\\?-####/;function Rr(t){for(var r="",a,s=0;s!=t.length;++s)switch(a=t.charCodeAt(s)){case 35:break;case 63:r+=" ";break;case 48:r+="0";break;default:r+=String.fromCharCode(a)}return r}function qo(t,r){var a=Math.pow(10,r);return""+Math.round(t*a)/a}function jo(t,r){var a=t-Math.floor(t),s=Math.pow(10,r);return r<(""+Math.round(a*s)).length?0:Math.round(a*s)}function qh(t,r){return r<(""+Math.round((t-Math.floor(t))*Math.pow(10,r))).length?1:0}function jh(t){return t<2147483647&&t>-2147483648?""+(t>=0?t|0:t-1|0):""+Math.floor(t)}function Yr(t,r,a){if(t.charCodeAt(0)===40&&!r.match(sc)){var s=r.replace(/\( */,"").replace(/ \)/,"").replace(/\)/,"");return a>=0?Yr("n",s,a):"("+Yr("n",s,-a)+")"}if(r.charCodeAt(r.length-1)===44)return Bh(t,r,a);if(r.indexOf("%")!==-1)return zh(t,r,a);if(r.indexOf("E")!==-1)return tc(r,a);if(r.charCodeAt(0)===36)return"$"+Yr(t,r.substr(r.charAt(1)==" "?2:1),a);var i,l,d,v,u=Math.abs(a),f=a<0?"-":"";if(r.match(/^00+$/))return f+Js(u,r.length);if(r.match(/^[#?]+$/))return i=Js(a,0),i==="0"&&(i=""),i.length>r.length?i:Rr(r.substr(0,r.length-i.length))+i;if(l=r.match(ac))return $h(l,u,f);if(r.match(/^#+0+$/))return f+Js(u,r.length-r.indexOf("0"));if(l=r.match(rc))return i=qo(a,l[1].length).replace(/^([^\.]+)$/,"$1."+Rr(l[1])).replace(/\.$/,"."+Rr(l[1])).replace(/\.(\d*)$/,function(b,w){return"."+w+lr("0",Rr(l[1]).length-w.length)}),r.indexOf("0.")!==-1?i:i.replace(/^0\./,".");if(r=r.replace(/^#+([0.])/,"$1"),l=r.match(/^(0*)\.(#*)$/))return f+qo(u,l[2].length).replace(/\.(\d*[1-9])0*$/,".$1").replace(/^(-?\d*)$/,"$1.").replace(/^0\./,l[1].length?"0.":".");if(l=r.match(/^#{1,3},##0(\.?)$/))return f+Fs(Js(u,0));if(l=r.match(/^#,##0\.([#0]*0)$/))return a<0?"-"+Yr(t,r,-a):Fs(""+(Math.floor(a)+qh(a,l[1].length)))+"."+os(jo(a,l[1].length),l[1].length);if(l=r.match(/^#,#*,#0/))return Yr(t,r.replace(/^#,#*,/,""),a);if(l=r.match(/^([0#]+)(\\?-([0#]+))+$/))return i=ai(Yr(t,r.replace(/[\\-]/g,""),a)),d=0,ai(ai(r.replace(/\\/g,"")).replace(/[0#]/g,function(b){return d<i.length?i.charAt(d++):b==="0"?"0":""}));if(r.match(ic))return i=Yr(t,"##########",a),"("+i.substr(0,3)+") "+i.substr(3,3)+"-"+i.substr(6);var h="";if(l=r.match(/^([#0?]+)( ?)\/( ?)([#0?]+)/))return d=Math.min(l[4].length,7),v=cn(u,Math.pow(10,d)-1,!1),i=""+f,h=bs("n",l[1],v[1]),h.charAt(h.length-1)==" "&&(h=h.substr(0,h.length-1)+"0"),i+=h+l[2]+"/"+l[3],h=on(v[2],d),h.length<l[4].length&&(h=Rr(l[4].substr(l[4].length-h.length))+h),i+=h,i;if(l=r.match(/^# ([#0?]+)( ?)\/( ?)([#0?]+)/))return d=Math.min(Math.max(l[1].length,l[4].length),7),v=cn(u,Math.pow(10,d)-1,!0),f+(v[0]||(v[1]?"":"0"))+" "+(v[1]?to(v[1],d)+l[2]+"/"+l[3]+on(v[2],d):lr(" ",2*d+1+l[2].length+l[3].length));if(l=r.match(/^[#0?]+$/))return i=Js(a,0),r.length<=i.length?i:Rr(r.substr(0,r.length-i.length))+i;if(l=r.match(/^([#0?]+)\.([#0]+)$/)){i=""+a.toFixed(Math.min(l[2].length,10)).replace(/([^0])0+$/,"$1"),d=i.indexOf(".");var _=r.indexOf(".")-d,x=r.length-i.length-_;return Rr(r.substr(0,_)+i+r.substr(r.length-x))}if(l=r.match(/^00,000\.([#0]*0)$/))return d=jo(a,l[1].length),a<0?"-"+Yr(t,r,-a):Fs(jh(a)).replace(/^\d,\d{3}$/,"0$&").replace(/^\d*$/,function(b){return"00,"+(b.length<3?os(0,3-b.length):"")+b})+"."+os(d,l[1].length);switch(r){case"###,##0.00":return Yr(t,"#,##0.00",a);case"###,###":case"##,###":case"#,###":var T=Fs(Js(u,0));return T!=="0"?f+T:"";case"###,###.00":return Yr(t,"###,##0.00",a).replace(/^0\./,".");case"#,###.00":return Yr(t,"#,##0.00",a).replace(/^0\./,".")}throw new Error("unsupported format |"+r+"|")}function Wh(t,r,a){for(var s=r.length-1;r.charCodeAt(s-1)===44;)--s;return bs(t,r.substr(0,s),a/Math.pow(10,3*(r.length-s)))}function Hh(t,r,a){var s=r.replace(ec,""),i=r.length-s.length;return bs(t,s,a*Math.pow(10,2*i))+lr("%",i)}function nc(t,r){var a,s=t.indexOf("E")-t.indexOf(".")-1;if(t.match(/^#+0.0E\+0$/)){if(r==0)return"0.0E+0";if(r<0)return"-"+nc(t,-r);var i=t.indexOf(".");i===-1&&(i=t.indexOf("E"));var l=Math.floor(Math.log(r)*Math.LOG10E)%i;if(l<0&&(l+=i),a=(r/Math.pow(10,l)).toPrecision(s+1+(i+l)%i),!a.match(/[Ee]/)){var d=Math.floor(Math.log(r)*Math.LOG10E);a.indexOf(".")===-1?a=a.charAt(0)+"."+a.substr(1)+"E+"+(d-a.length+l):a+="E+"+(d-l),a=a.replace(/\+-/,"-")}a=a.replace(/^([+-]?)(\d*)\.(\d*)[Ee]/,function(v,u,f,h){return u+f+h.substr(0,(i+l)%i)+"."+h.substr(l)+"E"})}else a=r.toExponential(s);return t.match(/E\+00$/)&&a.match(/e[+-]\d$/)&&(a=a.substr(0,a.length-1)+"0"+a.charAt(a.length-1)),t.match(/E\-/)&&a.match(/e\+/)&&(a=a.replace(/e\+/,"e")),a.replace("e","E")}function ds(t,r,a){if(t.charCodeAt(0)===40&&!r.match(sc)){var s=r.replace(/\( */,"").replace(/ \)/,"").replace(/\)/,"");return a>=0?ds("n",s,a):"("+ds("n",s,-a)+")"}if(r.charCodeAt(r.length-1)===44)return Wh(t,r,a);if(r.indexOf("%")!==-1)return Hh(t,r,a);if(r.indexOf("E")!==-1)return nc(r,a);if(r.charCodeAt(0)===36)return"$"+ds(t,r.substr(r.charAt(1)==" "?2:1),a);var i,l,d,v,u=Math.abs(a),f=a<0?"-":"";if(r.match(/^00+$/))return f+os(u,r.length);if(r.match(/^[#?]+$/))return i=""+a,a===0&&(i=""),i.length>r.length?i:Rr(r.substr(0,r.length-i.length))+i;if(l=r.match(ac))return Uh(l,u,f);if(r.match(/^#+0+$/))return f+os(u,r.length-r.indexOf("0"));if(l=r.match(rc))return i=(""+a).replace(/^([^\.]+)$/,"$1."+Rr(l[1])).replace(/\.$/,"."+Rr(l[1])),i=i.replace(/\.(\d*)$/,function(b,w){return"."+w+lr("0",Rr(l[1]).length-w.length)}),r.indexOf("0.")!==-1?i:i.replace(/^0\./,".");if(r=r.replace(/^#+([0.])/,"$1"),l=r.match(/^(0*)\.(#*)$/))return f+(""+u).replace(/\.(\d*[1-9])0*$/,".$1").replace(/^(-?\d*)$/,"$1.").replace(/^0\./,l[1].length?"0.":".");if(l=r.match(/^#{1,3},##0(\.?)$/))return f+Fs(""+u);if(l=r.match(/^#,##0\.([#0]*0)$/))return a<0?"-"+ds(t,r,-a):Fs(""+a)+"."+lr("0",l[1].length);if(l=r.match(/^#,#*,#0/))return ds(t,r.replace(/^#,#*,/,""),a);if(l=r.match(/^([0#]+)(\\?-([0#]+))+$/))return i=ai(ds(t,r.replace(/[\\-]/g,""),a)),d=0,ai(ai(r.replace(/\\/g,"")).replace(/[0#]/g,function(b){return d<i.length?i.charAt(d++):b==="0"?"0":""}));if(r.match(ic))return i=ds(t,"##########",a),"("+i.substr(0,3)+") "+i.substr(3,3)+"-"+i.substr(6);var h="";if(l=r.match(/^([#0?]+)( ?)\/( ?)([#0?]+)/))return d=Math.min(l[4].length,7),v=cn(u,Math.pow(10,d)-1,!1),i=""+f,h=bs("n",l[1],v[1]),h.charAt(h.length-1)==" "&&(h=h.substr(0,h.length-1)+"0"),i+=h+l[2]+"/"+l[3],h=on(v[2],d),h.length<l[4].length&&(h=Rr(l[4].substr(l[4].length-h.length))+h),i+=h,i;if(l=r.match(/^# ([#0?]+)( ?)\/( ?)([#0?]+)/))return d=Math.min(Math.max(l[1].length,l[4].length),7),v=cn(u,Math.pow(10,d)-1,!0),f+(v[0]||(v[1]?"":"0"))+" "+(v[1]?to(v[1],d)+l[2]+"/"+l[3]+on(v[2],d):lr(" ",2*d+1+l[2].length+l[3].length));if(l=r.match(/^[#0?]+$/))return i=""+a,r.length<=i.length?i:Rr(r.substr(0,r.length-i.length))+i;if(l=r.match(/^([#0]+)\.([#0]+)$/)){i=""+a.toFixed(Math.min(l[2].length,10)).replace(/([^0])0+$/,"$1"),d=i.indexOf(".");var _=r.indexOf(".")-d,x=r.length-i.length-_;return Rr(r.substr(0,_)+i+r.substr(r.length-x))}if(l=r.match(/^00,000\.([#0]*0)$/))return a<0?"-"+ds(t,r,-a):Fs(""+a).replace(/^\d,\d{3}$/,"0$&").replace(/^\d*$/,function(b){return"00,"+(b.length<3?os(0,3-b.length):"")+b})+"."+os(0,l[1].length);switch(r){case"###,###":case"##,###":case"#,###":var T=Fs(""+u);return T!=="0"?f+T:"";default:if(r.match(/\.[0#?]*$/))return ds(t,r.slice(0,r.lastIndexOf(".")),a)+Rr(r.slice(r.lastIndexOf(".")))}throw new Error("unsupported format |"+r+"|")}function bs(t,r,a){return(a|0)===a?ds(t,r,a):Yr(t,r,a)}function Vh(t){for(var r=[],a=!1,s=0,i=0;s<t.length;++s)switch(t.charCodeAt(s)){case 34:a=!a;break;case 95:case 42:case 92:++s;break;case 59:r[r.length]=t.substr(i,s-i),i=s+1}if(r[r.length]=t.substr(i),a===!0)throw new Error("Format |"+t+"| unterminated string ");return r}var oc=/\[[HhMmSs\u0E0A\u0E19\u0E17]*\]/;function oi(t){for(var r=0,a="",s="";r<t.length;)switch(a=t.charAt(r)){case"G":ln(t,r)&&(r+=6),r++;break;case'"':for(;t.charCodeAt(++r)!==34&&r<t.length;);++r;break;case"\\":r+=2;break;case"_":r+=2;break;case"@":++r;break;case"B":case"b":if(t.charAt(r+1)==="1"||t.charAt(r+1)==="2")return!0;case"M":case"D":case"Y":case"H":case"S":case"E":case"m":case"d":case"y":case"h":case"s":case"e":case"g":return!0;case"A":case"a":case"上":if(t.substr(r,3).toUpperCase()==="A/P"||t.substr(r,5).toUpperCase()==="AM/PM"||t.substr(r,5).toUpperCase()==="上午/下午")return!0;++r;break;case"[":for(s=a;t.charAt(r++)!=="]"&&r<t.length;)s+=t.charAt(r);if(s.match(oc))return!0;break;case".":case"0":case"#":for(;r<t.length&&("0#?.,E+-%".indexOf(a=t.charAt(++r))>-1||a=="\\"&&t.charAt(r+1)=="-"&&"0#".indexOf(t.charAt(r+2))>-1););break;case"?":for(;t.charAt(++r)===a;);break;case"*":++r,(t.charAt(r)==" "||t.charAt(r)=="*")&&++r;break;case"(":case")":++r;break;case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":for(;r<t.length&&"0123456789".indexOf(t.charAt(++r))>-1;);break;case" ":++r;break;default:++r;break}return!1}function Gh(t,r,a,s){for(var i=[],l="",d=0,v="",u="t",f,h,_,x="H";d<t.length;)switch(v=t.charAt(d)){case"G":if(!ln(t,d))throw new Error("unrecognized character "+v+" in "+t);i[i.length]={t:"G",v:"General"},d+=7;break;case'"':for(l="";(_=t.charCodeAt(++d))!==34&&d<t.length;)l+=String.fromCharCode(_);i[i.length]={t:"t",v:l},++d;break;case"\\":var T=t.charAt(++d),b=T==="("||T===")"?T:"t";i[i.length]={t:b,v:T},++d;break;case"_":i[i.length]={t:"t",v:" "},d+=2;break;case"@":i[i.length]={t:"T",v:r},++d;break;case"B":case"b":if(t.charAt(d+1)==="1"||t.charAt(d+1)==="2"){if(f==null&&(f=zs(r,a,t.charAt(d+1)==="2"),f==null))return"";i[i.length]={t:"X",v:t.substr(d,2)},u=v,d+=2;break}case"M":case"D":case"Y":case"H":case"S":case"E":v=v.toLowerCase();case"m":case"d":case"y":case"h":case"s":case"e":case"g":if(r<0||f==null&&(f=zs(r,a),f==null))return"";for(l=v;++d<t.length&&t.charAt(d).toLowerCase()===v;)l+=v;v==="m"&&u.toLowerCase()==="h"&&(v="M"),v==="h"&&(v=x),i[i.length]={t:v,v:l},u=v;break;case"A":case"a":case"上":var w={t:v,v};if(f==null&&(f=zs(r,a)),t.substr(d,3).toUpperCase()==="A/P"?(f!=null&&(w.v=f.H>=12?"P":"A"),w.t="T",x="h",d+=3):t.substr(d,5).toUpperCase()==="AM/PM"?(f!=null&&(w.v=f.H>=12?"PM":"AM"),w.t="T",d+=5,x="h"):t.substr(d,5).toUpperCase()==="上午/下午"?(f!=null&&(w.v=f.H>=12?"下午":"上午"),w.t="T",d+=5,x="h"):(w.t="t",++d),f==null&&w.t==="T")return"";i[i.length]=w,u=v;break;case"[":for(l=v;t.charAt(d++)!=="]"&&d<t.length;)l+=t.charAt(d);if(l.slice(-1)!=="]")throw'unterminated "[" block: |'+l+"|";if(l.match(oc)){if(f==null&&(f=zs(r,a),f==null))return"";i[i.length]={t:"Z",v:l.toLowerCase()},u=l.charAt(1)}else l.indexOf("$")>-1&&(l=(l.match(/\$([^-\[\]]*)/)||[])[1]||"$",oi(t)||(i[i.length]={t:"t",v:l}));break;case".":if(f!=null){for(l=v;++d<t.length&&(v=t.charAt(d))==="0";)l+=v;i[i.length]={t:"s",v:l};break}case"0":case"#":for(l=v;++d<t.length&&"0#?.,E+-%".indexOf(v=t.charAt(d))>-1;)l+=v;i[i.length]={t:"n",v:l};break;case"?":for(l=v;t.charAt(++d)===v;)l+=v;i[i.length]={t:v,v:l},u=v;break;case"*":++d,(t.charAt(d)==" "||t.charAt(d)=="*")&&++d;break;case"(":case")":i[i.length]={t:s===1?"t":v,v},++d;break;case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":for(l=v;d<t.length&&"0123456789".indexOf(t.charAt(++d))>-1;)l+=t.charAt(d);i[i.length]={t:"D",v:l};break;case" ":i[i.length]={t:v,v},++d;break;case"$":i[i.length]={t:"t",v:"$"},++d;break;default:if(",$-+/():!^&'~{}<>=€acfijklopqrtuvwxzP".indexOf(v)===-1)throw new Error("unrecognized character "+v+" in "+t);i[i.length]={t:"t",v},++d;break}var A=0,C=0,z;for(d=i.length-1,u="t";d>=0;--d)switch(i[d].t){case"h":case"H":i[d].t=x,u="h",A<1&&(A=1);break;case"s":(z=i[d].v.match(/\.0+$/))&&(C=Math.max(C,z[0].length-1)),A<3&&(A=3);case"d":case"y":case"M":case"e":u=i[d].t;break;case"m":u==="s"&&(i[d].t="M",A<2&&(A=2));break;case"X":break;case"Z":A<1&&i[d].v.match(/[Hh]/)&&(A=1),A<2&&i[d].v.match(/[Mm]/)&&(A=2),A<3&&i[d].v.match(/[Ss]/)&&(A=3)}switch(A){case 0:break;case 1:f.u>=.5&&(f.u=0,++f.S),f.S>=60&&(f.S=0,++f.M),f.M>=60&&(f.M=0,++f.H);break;case 2:f.u>=.5&&(f.u=0,++f.S),f.S>=60&&(f.S=0,++f.M);break}var F="",re;for(d=0;d<i.length;++d)switch(i[d].t){case"t":case"T":case" ":case"D":break;case"X":i[d].v="",i[d].t=";";break;case"d":case"m":case"y":case"h":case"H":case"M":case"s":case"e":case"b":case"Z":i[d].v=Oh(i[d].t.charCodeAt(0),i[d].v,f,C),i[d].t="t";break;case"n":case"?":for(re=d+1;i[re]!=null&&((v=i[re].t)==="?"||v==="D"||(v===" "||v==="t")&&i[re+1]!=null&&(i[re+1].t==="?"||i[re+1].t==="t"&&i[re+1].v==="/")||i[d].t==="("&&(v===" "||v==="n"||v===")")||v==="t"&&(i[re].v==="/"||i[re].v===" "&&i[re+1]!=null&&i[re+1].t=="?"));)i[d].v+=i[re].v,i[re]={v:"",t:";"},++re;F+=i[d].v,d=re-1;break;case"G":i[d].t="t",i[d].v=js(r,a);break}var me="",ue,D;if(F.length>0){F.charCodeAt(0)==40?(ue=r<0&&F.charCodeAt(0)===45?-r:r,D=bs("n",F,ue)):(ue=r<0&&s>1?-r:r,D=bs("n",F,ue),ue<0&&i[0]&&i[0].t=="t"&&(D=D.substr(1),i[0].v="-"+i[0].v)),re=D.length-1;var E=i.length;for(d=0;d<i.length;++d)if(i[d]!=null&&i[d].t!="t"&&i[d].v.indexOf(".")>-1){E=d;break}var he=i.length;if(E===i.length&&D.indexOf("E")===-1){for(d=i.length-1;d>=0;--d)i[d]==null||"n?".indexOf(i[d].t)===-1||(re>=i[d].v.length-1?(re-=i[d].v.length,i[d].v=D.substr(re+1,i[d].v.length)):re<0?i[d].v="":(i[d].v=D.substr(0,re+1),re=-1),i[d].t="t",he=d);re>=0&&he<i.length&&(i[he].v=D.substr(0,re+1)+i[he].v)}else if(E!==i.length&&D.indexOf("E")===-1){for(re=D.indexOf(".")-1,d=E;d>=0;--d)if(!(i[d]==null||"n?".indexOf(i[d].t)===-1)){for(h=i[d].v.indexOf(".")>-1&&d===E?i[d].v.indexOf(".")-1:i[d].v.length-1,me=i[d].v.substr(h+1);h>=0;--h)re>=0&&(i[d].v.charAt(h)==="0"||i[d].v.charAt(h)==="#")&&(me=D.charAt(re--)+me);i[d].v=me,i[d].t="t",he=d}for(re>=0&&he<i.length&&(i[he].v=D.substr(0,re+1)+i[he].v),re=D.indexOf(".")+1,d=E;d<i.length;++d)if(!(i[d]==null||"n?(".indexOf(i[d].t)===-1&&d!==E)){for(h=i[d].v.indexOf(".")>-1&&d===E?i[d].v.indexOf(".")+1:0,me=i[d].v.substr(0,h);h<i[d].v.length;++h)re<D.length&&(me+=D.charAt(re++));i[d].v=me,i[d].t="t",he=d}}}for(d=0;d<i.length;++d)i[d]!=null&&"n?".indexOf(i[d].t)>-1&&(ue=s>1&&r<0&&d>0&&i[d-1].v==="-"?-r:r,i[d].v=bs(i[d].t,i[d].v,ue),i[d].t="t");var xe="";for(d=0;d!==i.length;++d)i[d]!=null&&(xe+=i[d].v);return xe}var Wo=/\[(=|>[=]?|<[>=]?)(-?\d+(?:\.\d*)?)\]/;function Ho(t,r){if(r==null)return!1;var a=parseFloat(r[2]);switch(r[1]){case"=":if(t==a)return!0;break;case">":if(t>a)return!0;break;case"<":if(t<a)return!0;break;case"<>":if(t!=a)return!0;break;case">=":if(t>=a)return!0;break;case"<=":if(t<=a)return!0;break}return!1}function Xh(t,r){var a=Vh(t),s=a.length,i=a[s-1].indexOf("@");if(s<4&&i>-1&&--s,a.length>4)throw new Error("cannot find right format for |"+a.join("|")+"|");if(typeof r!="number")return[4,a.length===4||i>-1?a[a.length-1]:"@"];switch(a.length){case 1:a=i>-1?["General","General","General",a[0]]:[a[0],a[0],a[0],"@"];break;case 2:a=i>-1?[a[0],a[0],a[0],a[1]]:[a[0],a[1],a[0],"@"];break;case 3:a=i>-1?[a[0],a[1],a[0],a[2]]:[a[0],a[1],a[2],"@"];break}var l=r>0?a[0]:r<0?a[1]:a[2];if(a[0].indexOf("[")===-1&&a[1].indexOf("[")===-1)return[s,l];if(a[0].match(/\[[=<>]/)!=null||a[1].match(/\[[=<>]/)!=null){var d=a[0].match(Wo),v=a[1].match(Wo);return Ho(r,d)?[s,a[0]]:Ho(r,v)?[s,a[1]]:[s,a[d!=null&&v!=null?2:1]]}return[s,l]}function Qr(t,r,a){a==null&&(a={});var s="";switch(typeof t){case"string":t=="m/d/yy"&&a.dateNF?s=a.dateNF:s=t;break;case"number":t==14&&a.dateNF?s=a.dateNF:s=(a.table!=null?a.table:Sa)[t],s==null&&(s=a.table&&a.table[Uo[t]]||Sa[Uo[t]]),s==null&&(s=Dh[t]||"General");break}if(ln(s,0))return js(r,a);r instanceof Date&&(r=Jl(r,a.date1904));var i=Xh(s,r);if(ln(i[1]))return js(r,a);if(r===!0)r="TRUE";else if(r===!1)r="FALSE";else if(r===""||r==null)return"";return Gh(i[1],r,a,i[0])}function Bs(t,r){if(typeof r!="number"){r=+r||-1;for(var a=0;a<392;++a){if(Sa[a]==null){r<0&&(r=a);continue}if(Sa[a]==t){r=a;break}}r<0&&(r=391)}return Sa[r]=t,r}function lc(){Sa=Fh()}var Yh={5:'"$"#,##0_);\\("$"#,##0\\)',6:'"$"#,##0_);[Red]\\("$"#,##0\\)',7:'"$"#,##0.00_);\\("$"#,##0.00\\)',8:'"$"#,##0.00_);[Red]\\("$"#,##0.00\\)',23:"General",24:"General",25:"General",26:"General",27:"m/d/yy",28:"m/d/yy",29:"m/d/yy",30:"m/d/yy",31:"m/d/yy",32:"h:mm:ss",33:"h:mm:ss",34:"h:mm:ss",35:"h:mm:ss",36:"m/d/yy",41:'_(* #,##0_);_(* (#,##0);_(* "-"_);_(@_)',42:'_("$"* #,##0_);_("$"* (#,##0);_("$"* "-"_);_(@_)',43:'_(* #,##0.00_);_(* (#,##0.00);_(* "-"??_);_(@_)',44:'_("$"* #,##0.00_);_("$"* (#,##0.00);_("$"* "-"??_);_(@_)',50:"m/d/yy",51:"m/d/yy",52:"m/d/yy",53:"m/d/yy",54:"m/d/yy",55:"m/d/yy",56:"m/d/yy",57:"m/d/yy",58:"m/d/yy",59:"0",60:"0.00",61:"#,##0",62:"#,##0.00",63:'"$"#,##0_);\\("$"#,##0\\)',64:'"$"#,##0_);[Red]\\("$"#,##0\\)',65:'"$"#,##0.00_);\\("$"#,##0.00\\)',66:'"$"#,##0.00_);[Red]\\("$"#,##0.00\\)',67:"0%",68:"0.00%",69:"# ?/?",70:"# ??/??",71:"m/d/yy",72:"m/d/yy",73:"d-mmm-yy",74:"d-mmm",75:"mmm-yy",76:"h:mm",77:"h:mm:ss",78:"m/d/yy h:mm",79:"mm:ss",80:"[h]:mm:ss",81:"mmss.0"},cc=/[dD]+|[mM]+|[yYeE]+|[Hh]+|[Ss]+/g;function Kh(t){var r=typeof t=="number"?Sa[t]:t;return r=r.replace(cc,"(\\d+)"),new RegExp("^"+r+"$")}function Qh(t,r,a){var s=-1,i=-1,l=-1,d=-1,v=-1,u=-1;(r.match(cc)||[]).forEach(function(_,x){var T=parseInt(a[x+1],10);switch(_.toLowerCase().charAt(0)){case"y":s=T;break;case"d":l=T;break;case"h":d=T;break;case"s":u=T;break;case"m":d>=0?v=T:i=T;break}}),u>=0&&v==-1&&i>=0&&(v=i,i=-1);var f=(""+(s>=0?s:new Date().getFullYear())).slice(-4)+"-"+("00"+(i>=1?i:1)).slice(-2)+"-"+("00"+(l>=1?l:1)).slice(-2);f.length==7&&(f="0"+f),f.length==8&&(f="20"+f);var h=("00"+(d>=0?d:0)).slice(-2)+":"+("00"+(v>=0?v:0)).slice(-2)+":"+("00"+(u>=0?u:0)).slice(-2);return d==-1&&v==-1&&u==-1?f:s==-1&&i==-1&&l==-1?h:f+"T"+h}var Zh=function(){var t={};t.version="1.2.0";function r(){for(var D=0,E=new Array(256),he=0;he!=256;++he)D=he,D=D&1?-306674912^D>>>1:D>>>1,D=D&1?-306674912^D>>>1:D>>>1,D=D&1?-306674912^D>>>1:D>>>1,D=D&1?-306674912^D>>>1:D>>>1,D=D&1?-306674912^D>>>1:D>>>1,D=D&1?-306674912^D>>>1:D>>>1,D=D&1?-306674912^D>>>1:D>>>1,D=D&1?-306674912^D>>>1:D>>>1,E[he]=D;return typeof Int32Array<"u"?new Int32Array(E):E}var a=r();function s(D){var E=0,he=0,xe=0,K=typeof Int32Array<"u"?new Int32Array(4096):new Array(4096);for(xe=0;xe!=256;++xe)K[xe]=D[xe];for(xe=0;xe!=256;++xe)for(he=D[xe],E=256+xe;E<4096;E+=256)he=K[E]=he>>>8^D[he&255];var q=[];for(xe=1;xe!=16;++xe)q[xe-1]=typeof Int32Array<"u"?K.subarray(xe*256,xe*256+256):K.slice(xe*256,xe*256+256);return q}var i=s(a),l=i[0],d=i[1],v=i[2],u=i[3],f=i[4],h=i[5],_=i[6],x=i[7],T=i[8],b=i[9],w=i[10],A=i[11],C=i[12],z=i[13],F=i[14];function re(D,E){for(var he=E^-1,xe=0,K=D.length;xe<K;)he=he>>>8^a[(he^D.charCodeAt(xe++))&255];return~he}function me(D,E){for(var he=E^-1,xe=D.length-15,K=0;K<xe;)he=F[D[K++]^he&255]^z[D[K++]^he>>8&255]^C[D[K++]^he>>16&255]^A[D[K++]^he>>>24]^w[D[K++]]^b[D[K++]]^T[D[K++]]^x[D[K++]]^_[D[K++]]^h[D[K++]]^f[D[K++]]^u[D[K++]]^v[D[K++]]^d[D[K++]]^l[D[K++]]^a[D[K++]];for(xe+=15;K<xe;)he=he>>>8^a[(he^D[K++])&255];return~he}function ue(D,E){for(var he=E^-1,xe=0,K=D.length,q=0,ae=0;xe<K;)q=D.charCodeAt(xe++),q<128?he=he>>>8^a[(he^q)&255]:q<2048?(he=he>>>8^a[(he^(192|q>>6&31))&255],he=he>>>8^a[(he^(128|q&63))&255]):q>=55296&&q<57344?(q=(q&1023)+64,ae=D.charCodeAt(xe++)&1023,he=he>>>8^a[(he^(240|q>>8&7))&255],he=he>>>8^a[(he^(128|q>>2&63))&255],he=he>>>8^a[(he^(128|ae>>6&15|(q&3)<<4))&255],he=he>>>8^a[(he^(128|ae&63))&255]):(he=he>>>8^a[(he^(224|q>>12&15))&255],he=he>>>8^a[(he^(128|q>>6&63))&255],he=he>>>8^a[(he^(128|q&63))&255]);return~he}return t.table=a,t.bstr=re,t.buf=me,t.str=ue,t}(),Oa=function(){var r={};r.version="1.2.1";function a(M,H){for(var O=M.split("/"),te=H.split("/"),ne=0,ie=0,Se=Math.min(O.length,te.length);ne<Se;++ne){if(ie=O[ne].length-te[ne].length)return ie;if(O[ne]!=te[ne])return O[ne]<te[ne]?-1:1}return O.length-te.length}function s(M){if(M.charAt(M.length-1)=="/")return M.slice(0,-1).indexOf("/")===-1?M:s(M.slice(0,-1));var H=M.lastIndexOf("/");return H===-1?M:M.slice(0,H+1)}function i(M){if(M.charAt(M.length-1)=="/")return i(M.slice(0,-1));var H=M.lastIndexOf("/");return H===-1?M:M.slice(H+1)}function l(M,H){typeof H=="string"&&(H=new Date(H));var O=H.getHours();O=O<<6|H.getMinutes(),O=O<<5|H.getSeconds()>>>1,M.write_shift(2,O);var te=H.getFullYear()-1980;te=te<<4|H.getMonth()+1,te=te<<5|H.getDate(),M.write_shift(2,te)}function d(M){var H=M.read_shift(2)&65535,O=M.read_shift(2)&65535,te=new Date,ne=O&31;O>>>=5;var ie=O&15;O>>>=4,te.setMilliseconds(0),te.setFullYear(O+1980),te.setMonth(ie-1),te.setDate(ne);var Se=H&31;H>>>=5;var Qe=H&63;return H>>>=6,te.setHours(H),te.setMinutes(Qe),te.setSeconds(Se<<1),te}function v(M){wr(M,0);for(var H={},O=0;M.l<=M.length-4;){var te=M.read_shift(2),ne=M.read_shift(2),ie=M.l+ne,Se={};switch(te){case 21589:O=M.read_shift(1),O&1&&(Se.mtime=M.read_shift(4)),ne>5&&(O&2&&(Se.atime=M.read_shift(4)),O&4&&(Se.ctime=M.read_shift(4))),Se.mtime&&(Se.mt=new Date(Se.mtime*1e3));break}M.l=ie,H[te]=Se}return H}var u;function f(){return u||(u={})}function h(M,H){if(M[0]==80&&M[1]==75)return tt(M,H);if((M[0]|32)==109&&(M[1]|32)==105)return Je(M,H);if(M.length<512)throw new Error("CFB file size "+M.length+" < 512");var O=3,te=512,ne=0,ie=0,Se=0,Qe=0,je=0,ze=[],Re=M.slice(0,512);wr(Re,0);var it=_(Re);switch(O=it[0],O){case 3:te=512;break;case 4:te=4096;break;case 0:if(it[1]==0)return tt(M,H);default:throw new Error("Major Version: Expected 3 or 4 saw "+O)}te!==512&&(Re=M.slice(0,te),wr(Re,28));var ft=M.slice(0,te);x(Re,O);var mt=Re.read_shift(4,"i");if(O===3&&mt!==0)throw new Error("# Directory Sectors: Expected 0 saw "+mt);Re.l+=4,Se=Re.read_shift(4,"i"),Re.l+=4,Re.chk("00100000","Mini Stream Cutoff Size: "),Qe=Re.read_shift(4,"i"),ne=Re.read_shift(4,"i"),je=Re.read_shift(4,"i"),ie=Re.read_shift(4,"i");for(var ht=-1,pt=0;pt<109&&(ht=Re.read_shift(4,"i"),!(ht<0));++pt)ze[pt]=ht;var _t=T(M,te);A(je,ie,_t,te,ze);var Ge=z(_t,Se,ze,te);Ge[Se].name="!Directory",ne>0&&Qe!==ae&&(Ge[Qe].name="!MiniFAT"),Ge[ze[0]].name="!FAT",Ge.fat_addrs=ze,Ge.ssz=te;var ct={},Ze=[],bt=[],It=[];F(Se,Ge,_t,Ze,ne,ct,bt,Qe),b(bt,It,Ze),Ze.shift();var Ot={FileIndex:bt,FullPaths:It};return H&&H.raw&&(Ot.raw={header:ft,sectors:_t}),Ot}function _(M){if(M[M.l]==80&&M[M.l+1]==75)return[0,0];M.chk(Me,"Header Signature: "),M.l+=16;var H=M.read_shift(2,"u");return[M.read_shift(2,"u"),H]}function x(M,H){var O=9;switch(M.l+=2,O=M.read_shift(2)){case 9:if(H!=3)throw new Error("Sector Shift: Expected 9 saw "+O);break;case 12:if(H!=4)throw new Error("Sector Shift: Expected 12 saw "+O);break;default:throw new Error("Sector Shift: Expected 9 or 12 saw "+O)}M.chk("0600","Mini Sector Shift: "),M.chk("000000000000","Reserved: ")}function T(M,H){for(var O=Math.ceil(M.length/H)-1,te=[],ne=1;ne<O;++ne)te[ne-1]=M.slice(ne*H,(ne+1)*H);return te[O-1]=M.slice(O*H),te}function b(M,H,O){for(var te=0,ne=0,ie=0,Se=0,Qe=0,je=O.length,ze=[],Re=[];te<je;++te)ze[te]=Re[te]=te,H[te]=O[te];for(;Qe<Re.length;++Qe)te=Re[Qe],ne=M[te].L,ie=M[te].R,Se=M[te].C,ze[te]===te&&(ne!==-1&&ze[ne]!==ne&&(ze[te]=ze[ne]),ie!==-1&&ze[ie]!==ie&&(ze[te]=ze[ie])),Se!==-1&&(ze[Se]=te),ne!==-1&&te!=ze[te]&&(ze[ne]=ze[te],Re.lastIndexOf(ne)<Qe&&Re.push(ne)),ie!==-1&&te!=ze[te]&&(ze[ie]=ze[te],Re.lastIndexOf(ie)<Qe&&Re.push(ie));for(te=1;te<je;++te)ze[te]===te&&(ie!==-1&&ze[ie]!==ie?ze[te]=ze[ie]:ne!==-1&&ze[ne]!==ne&&(ze[te]=ze[ne]));for(te=1;te<je;++te)if(M[te].type!==0){if(Qe=te,Qe!=ze[Qe])do Qe=ze[Qe],H[te]=H[Qe]+"/"+H[te];while(Qe!==0&&ze[Qe]!==-1&&Qe!=ze[Qe]);ze[te]=-1}for(H[0]+="/",te=1;te<je;++te)M[te].type!==2&&(H[te]+="/")}function w(M,H,O){for(var te=M.start,ne=M.size,ie=[],Se=te;O&&ne>0&&Se>=0;)ie.push(H.slice(Se*q,Se*q+q)),ne-=q,Se=Os(O,Se*4);return ie.length===0?mr(0):Ss(ie).slice(0,M.size)}function A(M,H,O,te,ne){var ie=ae;if(M===ae){if(H!==0)throw new Error("DIFAT chain shorter than expected")}else if(M!==-1){var Se=O[M],Qe=(te>>>2)-1;if(!Se)return;for(var je=0;je<Qe&&(ie=Os(Se,je*4))!==ae;++je)ne.push(ie);A(Os(Se,te-4),H-1,O,te,ne)}}function C(M,H,O,te,ne){var ie=[],Se=[];ne||(ne=[]);var Qe=te-1,je=0,ze=0;for(je=H;je>=0;){ne[je]=!0,ie[ie.length]=je,Se.push(M[je]);var Re=O[Math.floor(je*4/te)];if(ze=je*4&Qe,te<4+ze)throw new Error("FAT boundary crossed: "+je+" 4 "+te);if(!M[Re])break;je=Os(M[Re],ze)}return{nodes:ie,data:tl([Se])}}function z(M,H,O,te){var ne=M.length,ie=[],Se=[],Qe=[],je=[],ze=te-1,Re=0,it=0,ft=0,mt=0;for(Re=0;Re<ne;++Re)if(Qe=[],ft=Re+H,ft>=ne&&(ft-=ne),!Se[ft]){je=[];var ht=[];for(it=ft;it>=0;){ht[it]=!0,Se[it]=!0,Qe[Qe.length]=it,je.push(M[it]);var pt=O[Math.floor(it*4/te)];if(mt=it*4&ze,te<4+mt)throw new Error("FAT boundary crossed: "+it+" 4 "+te);if(!M[pt]||(it=Os(M[pt],mt),ht[it]))break}ie[ft]={nodes:Qe,data:tl([je])}}return ie}function F(M,H,O,te,ne,ie,Se,Qe){for(var je=0,ze=te.length?2:0,Re=H[M].data,it=0,ft=0,mt;it<Re.length;it+=128){var ht=Re.slice(it,it+128);wr(ht,64),ft=ht.read_shift(2),mt=oo(ht,0,ft-ze),te.push(mt);var pt={name:mt,type:ht.read_shift(1),color:ht.read_shift(1),L:ht.read_shift(4,"i"),R:ht.read_shift(4,"i"),C:ht.read_shift(4,"i"),clsid:ht.read_shift(16),state:ht.read_shift(4,"i"),start:0,size:0},_t=ht.read_shift(2)+ht.read_shift(2)+ht.read_shift(2)+ht.read_shift(2);_t!==0&&(pt.ct=re(ht,ht.l-8));var Ge=ht.read_shift(2)+ht.read_shift(2)+ht.read_shift(2)+ht.read_shift(2);Ge!==0&&(pt.mt=re(ht,ht.l-8)),pt.start=ht.read_shift(4,"i"),pt.size=ht.read_shift(4,"i"),pt.size<0&&pt.start<0&&(pt.size=pt.type=0,pt.start=ae,pt.name=""),pt.type===5?(je=pt.start,ne>0&&je!==ae&&(H[je].name="!StreamData")):pt.size>=4096?(pt.storage="fat",H[pt.start]===void 0&&(H[pt.start]=C(O,pt.start,H.fat_addrs,H.ssz)),H[pt.start].name=pt.name,pt.content=H[pt.start].data.slice(0,pt.size)):(pt.storage="minifat",pt.size<0?pt.size=0:je!==ae&&pt.start!==ae&&H[je]&&(pt.content=w(pt,H[je].data,(H[Qe]||{}).data))),pt.content&&wr(pt.content,0),ie[mt]=pt,Se.push(pt)}}function re(M,H){return new Date((Hr(M,H+4)/1e7*Math.pow(2,32)+Hr(M,H)/1e7-11644473600)*1e3)}function me(M,H){return f(),h(u.readFileSync(M),H)}function ue(M,H){var O=H&&H.type;switch(O||Na&&Buffer.isBuffer(M)&&(O="buffer"),O||"base64"){case"file":return me(M,H);case"base64":return h(is(Gr(M)),H);case"binary":return h(is(M),H)}return h(M,H)}function D(M,H){var O=H||{},te=O.root||"Root Entry";if(M.FullPaths||(M.FullPaths=[]),M.FileIndex||(M.FileIndex=[]),M.FullPaths.length!==M.FileIndex.length)throw new Error("inconsistent CFB structure");M.FullPaths.length===0&&(M.FullPaths[0]=te+"/",M.FileIndex[0]={name:te,type:5}),O.CLSID&&(M.FileIndex[0].clsid=O.CLSID),E(M)}function E(M){var H="Sh33tJ5";if(!Oa.find(M,"/"+H)){var O=mr(4);O[0]=55,O[1]=O[3]=50,O[2]=54,M.FileIndex.push({name:H,type:2,content:O,size:4,L:69,R:69,C:69}),M.FullPaths.push(M.FullPaths[0]+H),he(M)}}function he(M,H){D(M);for(var O=!1,te=!1,ne=M.FullPaths.length-1;ne>=0;--ne){var ie=M.FileIndex[ne];switch(ie.type){case 0:te?O=!0:(M.FileIndex.pop(),M.FullPaths.pop());break;case 1:case 2:case 5:te=!0,isNaN(ie.R*ie.L*ie.C)&&(O=!0),ie.R>-1&&ie.L>-1&&ie.R==ie.L&&(O=!0);break;default:O=!0;break}}if(!(!O&&!H)){var Se=new Date(1987,1,19),Qe=0,je=Object.create?Object.create(null):{},ze=[];for(ne=0;ne<M.FullPaths.length;++ne)je[M.FullPaths[ne]]=!0,M.FileIndex[ne].type!==0&&ze.push([M.FullPaths[ne],M.FileIndex[ne]]);for(ne=0;ne<ze.length;++ne){var Re=s(ze[ne][0]);te=je[Re],te||(ze.push([Re,{name:i(Re).replace("/",""),type:1,clsid:Ne,ct:Se,mt:Se,content:null}]),je[Re]=!0)}for(ze.sort(function(mt,ht){return a(mt[0],ht[0])}),M.FullPaths=[],M.FileIndex=[],ne=0;ne<ze.length;++ne)M.FullPaths[ne]=ze[ne][0],M.FileIndex[ne]=ze[ne][1];for(ne=0;ne<ze.length;++ne){var it=M.FileIndex[ne],ft=M.FullPaths[ne];if(it.name=i(ft).replace("/",""),it.L=it.R=it.C=-(it.color=1),it.size=it.content?it.content.length:0,it.start=0,it.clsid=it.clsid||Ne,ne===0)it.C=ze.length>1?1:-1,it.size=0,it.type=5;else if(ft.slice(-1)=="/"){for(Qe=ne+1;Qe<ze.length&&s(M.FullPaths[Qe])!=ft;++Qe);for(it.C=Qe>=ze.length?-1:Qe,Qe=ne+1;Qe<ze.length&&s(M.FullPaths[Qe])!=s(ft);++Qe);it.R=Qe>=ze.length?-1:Qe,it.type=1}else s(M.FullPaths[ne+1]||"")==s(ft)&&(it.R=ne+1),it.type=2}}}function xe(M,H){var O=H||{};if(O.fileType=="mad")return st(M,O);switch(he(M),O.fileType){case"zip":return Xe(M,O)}var te=function(mt){for(var ht=0,pt=0,_t=0;_t<mt.FileIndex.length;++_t){var Ge=mt.FileIndex[_t];if(Ge.content){var ct=Ge.content.length;ct>0&&(ct<4096?ht+=ct+63>>6:pt+=ct+511>>9)}}for(var Ze=mt.FullPaths.length+3>>2,bt=ht+7>>3,It=ht+127>>7,Ot=bt+pt+Ze+It,Pt=Ot+127>>7,gt=Pt<=109?0:Math.ceil((Pt-109)/127);Ot+Pt+gt+127>>7>Pt;)gt=++Pt<=109?0:Math.ceil((Pt-109)/127);var yt=[1,gt,Pt,It,Ze,pt,ht,0];return mt.FileIndex[0].size=ht<<6,yt[7]=(mt.FileIndex[0].start=yt[0]+yt[1]+yt[2]+yt[3]+yt[4]+yt[5])+(yt[6]+7>>3),yt}(M),ne=mr(te[7]<<9),ie=0,Se=0;{for(ie=0;ie<8;++ie)ne.write_shift(1,ge[ie]);for(ie=0;ie<8;++ie)ne.write_shift(2,0);for(ne.write_shift(2,62),ne.write_shift(2,3),ne.write_shift(2,65534),ne.write_shift(2,9),ne.write_shift(2,6),ie=0;ie<3;++ie)ne.write_shift(2,0);for(ne.write_shift(4,0),ne.write_shift(4,te[2]),ne.write_shift(4,te[0]+te[1]+te[2]+te[3]-1),ne.write_shift(4,0),ne.write_shift(4,4096),ne.write_shift(4,te[3]?te[0]+te[1]+te[2]-1:ae),ne.write_shift(4,te[3]),ne.write_shift(-4,te[1]?te[0]-1:ae),ne.write_shift(4,te[1]),ie=0;ie<109;++ie)ne.write_shift(-4,ie<te[2]?te[1]+ie:-1)}if(te[1])for(Se=0;Se<te[1];++Se){for(;ie<236+Se*127;++ie)ne.write_shift(-4,ie<te[2]?te[1]+ie:-1);ne.write_shift(-4,Se===te[1]-1?ae:Se+1)}var Qe=function(mt){for(Se+=mt;ie<Se-1;++ie)ne.write_shift(-4,ie+1);mt&&(++ie,ne.write_shift(-4,ae))};for(Se=ie=0,Se+=te[1];ie<Se;++ie)ne.write_shift(-4,Be.DIFSECT);for(Se+=te[2];ie<Se;++ie)ne.write_shift(-4,Be.FATSECT);Qe(te[3]),Qe(te[4]);for(var je=0,ze=0,Re=M.FileIndex[0];je<M.FileIndex.length;++je)Re=M.FileIndex[je],Re.content&&(ze=Re.content.length,!(ze<4096)&&(Re.start=Se,Qe(ze+511>>9)));for(Qe(te[6]+7>>3);ne.l&511;)ne.write_shift(-4,Be.ENDOFCHAIN);for(Se=ie=0,je=0;je<M.FileIndex.length;++je)Re=M.FileIndex[je],Re.content&&(ze=Re.content.length,!(!ze||ze>=4096)&&(Re.start=Se,Qe(ze+63>>6)));for(;ne.l&511;)ne.write_shift(-4,Be.ENDOFCHAIN);for(ie=0;ie<te[4]<<2;++ie){var it=M.FullPaths[ie];if(!it||it.length===0){for(je=0;je<17;++je)ne.write_shift(4,0);for(je=0;je<3;++je)ne.write_shift(4,-1);for(je=0;je<12;++je)ne.write_shift(4,0);continue}Re=M.FileIndex[ie],ie===0&&(Re.start=Re.size?Re.start-1:ae);var ft=ie===0&&O.root||Re.name;if(ze=2*(ft.length+1),ne.write_shift(64,ft,"utf16le"),ne.write_shift(2,ze),ne.write_shift(1,Re.type),ne.write_shift(1,Re.color),ne.write_shift(-4,Re.L),ne.write_shift(-4,Re.R),ne.write_shift(-4,Re.C),Re.clsid)ne.write_shift(16,Re.clsid,"hex");else for(je=0;je<4;++je)ne.write_shift(4,0);ne.write_shift(4,Re.state||0),ne.write_shift(4,0),ne.write_shift(4,0),ne.write_shift(4,0),ne.write_shift(4,0),ne.write_shift(4,Re.start),ne.write_shift(4,Re.size),ne.write_shift(4,0)}for(ie=1;ie<M.FileIndex.length;++ie)if(Re=M.FileIndex[ie],Re.size>=4096)if(ne.l=Re.start+1<<9,Na&&Buffer.isBuffer(Re.content))Re.content.copy(ne,ne.l,0,Re.size),ne.l+=Re.size+511&-512;else{for(je=0;je<Re.size;++je)ne.write_shift(1,Re.content[je]);for(;je&511;++je)ne.write_shift(1,0)}for(ie=1;ie<M.FileIndex.length;++ie)if(Re=M.FileIndex[ie],Re.size>0&&Re.size<4096)if(Na&&Buffer.isBuffer(Re.content))Re.content.copy(ne,ne.l,0,Re.size),ne.l+=Re.size+63&-64;else{for(je=0;je<Re.size;++je)ne.write_shift(1,Re.content[je]);for(;je&63;++je)ne.write_shift(1,0)}if(Na)ne.l=ne.length;else for(;ne.l<ne.length;)ne.write_shift(1,0);return ne}function K(M,H){var O=M.FullPaths.map(function(je){return je.toUpperCase()}),te=O.map(function(je){var ze=je.split("/");return ze[ze.length-(je.slice(-1)=="/"?2:1)]}),ne=!1;H.charCodeAt(0)===47?(ne=!0,H=O[0].slice(0,-1)+H):ne=H.indexOf("/")!==-1;var ie=H.toUpperCase(),Se=ne===!0?O.indexOf(ie):te.indexOf(ie);if(Se!==-1)return M.FileIndex[Se];var Qe=!ie.match(_i);for(ie=ie.replace(Lr,""),Qe&&(ie=ie.replace(_i,"!")),Se=0;Se<O.length;++Se)if((Qe?O[Se].replace(_i,"!"):O[Se]).replace(Lr,"")==ie||(Qe?te[Se].replace(_i,"!"):te[Se]).replace(Lr,"")==ie)return M.FileIndex[Se];return null}var q=64,ae=-2,Me="d0cf11e0a1b11ae1",ge=[208,207,17,224,161,177,26,225],Ne="00000000000000000000000000000000",Be={MAXREGSECT:-6,DIFSECT:-4,FATSECT:-3,ENDOFCHAIN:ae,FREESECT:-1,HEADER_SIGNATURE:Me,HEADER_MINOR_VERSION:"3e00",MAXREGSID:-6,NOSTREAM:-1,HEADER_CLSID:Ne,EntryTypes:["unknown","storage","stream","lockbytes","property","root"]};function be(M,H,O){f();var te=xe(M,O);u.writeFileSync(H,te)}function L(M){for(var H=new Array(M.length),O=0;O<M.length;++O)H[O]=String.fromCharCode(M[O]);return H.join("")}function Te(M,H){var O=xe(M,H);switch(H&&H.type||"buffer"){case"file":return f(),u.writeFileSync(H.filename,O),O;case"binary":return typeof O=="string"?O:L(O);case"base64":return Oo(typeof O=="string"?O:L(O));case"buffer":if(Na)return Buffer.isBuffer(O)?O:Vs(O);case"array":return typeof O=="string"?is(O):O}return O}var ye;function P(M){try{var H=M.InflateRaw,O=new H;if(O._processChunk(new Uint8Array([3,0]),O._finishFlushFlag),O.bytesRead)ye=M;else throw new Error("zlib does not expose bytesRead")}catch(te){console.error("cannot use native zlib: "+(te.message||te))}}function pe(M,H){if(!ye)return Pe(M,H);var O=ye.InflateRaw,te=new O,ne=te._processChunk(M.slice(M.l),te._finishFlushFlag);return M.l+=te.bytesRead,ne}function B(M){return ye?ye.deflateRawSync(M):Ae(M)}var j=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],I=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258],Y=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577];function fe(M){var H=(M<<1|M<<11)&139536|(M<<5|M<<15)&558144;return(H>>16|H>>8|H)&255}for(var ce=typeof Uint8Array<"u",J=ce?new Uint8Array(256):[],le=0;le<256;++le)J[le]=fe(le);function S(M,H){var O=J[M&255];return H<=8?O>>>8-H:(O=O<<8|J[M>>8&255],H<=16?O>>>16-H:(O=O<<8|J[M>>16&255],O>>>24-H))}function De(M,H){var O=H&7,te=H>>>3;return(M[te]|(O<=6?0:M[te+1]<<8))>>>O&3}function Ue(M,H){var O=H&7,te=H>>>3;return(M[te]|(O<=5?0:M[te+1]<<8))>>>O&7}function We(M,H){var O=H&7,te=H>>>3;return(M[te]|(O<=4?0:M[te+1]<<8))>>>O&15}function ke(M,H){var O=H&7,te=H>>>3;return(M[te]|(O<=3?0:M[te+1]<<8))>>>O&31}function N(M,H){var O=H&7,te=H>>>3;return(M[te]|(O<=1?0:M[te+1]<<8))>>>O&127}function V(M,H,O){var te=H&7,ne=H>>>3,ie=(1<<O)-1,Se=M[ne]>>>te;return O<8-te||(Se|=M[ne+1]<<8-te,O<16-te)||(Se|=M[ne+2]<<16-te,O<24-te)||(Se|=M[ne+3]<<24-te),Se&ie}function G(M,H,O){var te=H&7,ne=H>>>3;return te<=5?M[ne]|=(O&7)<<te:(M[ne]|=O<<te&255,M[ne+1]=(O&7)>>8-te),H+3}function de(M,H,O){var te=H&7,ne=H>>>3;return O=(O&1)<<te,M[ne]|=O,H+1}function ve(M,H,O){var te=H&7,ne=H>>>3;return O<<=te,M[ne]|=O&255,O>>>=8,M[ne+1]=O,H+8}function Ie(M,H,O){var te=H&7,ne=H>>>3;return O<<=te,M[ne]|=O&255,O>>>=8,M[ne+1]=O&255,M[ne+2]=O>>>8,H+16}function Ye(M,H){var O=M.length,te=2*O>H?2*O:H+5,ne=0;if(O>=H)return M;if(Na){var ie=zo(te);if(M.copy)M.copy(ie);else for(;ne<M.length;++ne)ie[ne]=M[ne];return ie}else if(ce){var Se=new Uint8Array(te);if(Se.set)Se.set(M);else for(;ne<O;++ne)Se[ne]=M[ne];return Se}return M.length=te,M}function oe(M){for(var H=new Array(M),O=0;O<M;++O)H[O]=0;return H}function se(M,H,O){var te=1,ne=0,ie=0,Se=0,Qe=0,je=M.length,ze=ce?new Uint16Array(32):oe(32);for(ie=0;ie<32;++ie)ze[ie]=0;for(ie=je;ie<O;++ie)M[ie]=0;je=M.length;var Re=ce?new Uint16Array(je):oe(je);for(ie=0;ie<je;++ie)ze[ne=M[ie]]++,te<ne&&(te=ne),Re[ie]=0;for(ze[0]=0,ie=1;ie<=te;++ie)ze[ie+16]=Qe=Qe+ze[ie-1]<<1;for(ie=0;ie<je;++ie)Qe=M[ie],Qe!=0&&(Re[ie]=ze[Qe+16]++);var it=0;for(ie=0;ie<je;++ie)if(it=M[ie],it!=0)for(Qe=S(Re[ie],te)>>te-it,Se=(1<<te+4-it)-1;Se>=0;--Se)H[Qe|Se<<it]=it&15|ie<<4;return te}var U=ce?new Uint16Array(512):oe(512),W=ce?new Uint16Array(32):oe(32);if(!ce){for(var ee=0;ee<512;++ee)U[ee]=0;for(ee=0;ee<32;++ee)W[ee]=0}(function(){for(var M=[],H=0;H<32;H++)M.push(5);se(M,W,32);var O=[];for(H=0;H<=143;H++)O.push(8);for(;H<=255;H++)O.push(9);for(;H<=279;H++)O.push(7);for(;H<=287;H++)O.push(8);se(O,U,288)})();var we=function(){for(var H=ce?new Uint8Array(32768):[],O=0,te=0;O<Y.length-1;++O)for(;te<Y[O+1];++te)H[te]=O;for(;te<32768;++te)H[te]=29;var ne=ce?new Uint8Array(259):[];for(O=0,te=0;O<I.length-1;++O)for(;te<I[O+1];++te)ne[te]=O;function ie(Qe,je){for(var ze=0;ze<Qe.length;){var Re=Math.min(65535,Qe.length-ze),it=ze+Re==Qe.length;for(je.write_shift(1,+it),je.write_shift(2,Re),je.write_shift(2,~Re&65535);Re-- >0;)je[je.l++]=Qe[ze++]}return je.l}function Se(Qe,je){for(var ze=0,Re=0,it=ce?new Uint16Array(32768):[];Re<Qe.length;){var ft=Math.min(65535,Qe.length-Re);if(ft<10){for(ze=G(je,ze,+(Re+ft==Qe.length)),ze&7&&(ze+=8-(ze&7)),je.l=ze/8|0,je.write_shift(2,ft),je.write_shift(2,~ft&65535);ft-- >0;)je[je.l++]=Qe[Re++];ze=je.l*8;continue}ze=G(je,ze,+(Re+ft==Qe.length)+2);for(var mt=0;ft-- >0;){var ht=Qe[Re];mt=(mt<<5^ht)&32767;var pt=-1,_t=0;if((pt=it[mt])&&(pt|=Re&-32768,pt>Re&&(pt-=32768),pt<Re))for(;Qe[pt+_t]==Qe[Re+_t]&&_t<250;)++_t;if(_t>2){ht=ne[_t],ht<=22?ze=ve(je,ze,J[ht+1]>>1)-1:(ve(je,ze,3),ze+=5,ve(je,ze,J[ht-23]>>5),ze+=3);var Ge=ht<8?0:ht-4>>2;Ge>0&&(Ie(je,ze,_t-I[ht]),ze+=Ge),ht=H[Re-pt],ze=ve(je,ze,J[ht]>>3),ze-=3;var ct=ht<4?0:ht-2>>1;ct>0&&(Ie(je,ze,Re-pt-Y[ht]),ze+=ct);for(var Ze=0;Ze<_t;++Ze)it[mt]=Re&32767,mt=(mt<<5^Qe[Re])&32767,++Re;ft-=_t-1}else ht<=143?ht=ht+48:ze=de(je,ze,1),ze=ve(je,ze,J[ht]),it[mt]=Re&32767,++Re}ze=ve(je,ze,0)-1}return je.l=(ze+7)/8|0,je.l}return function(je,ze){return je.length<8?ie(je,ze):Se(je,ze)}}();function Ae(M){var H=mr(50+Math.floor(M.length*1.1)),O=we(M,H);return H.slice(0,O)}var He=ce?new Uint16Array(32768):oe(32768),Ke=ce?new Uint16Array(32768):oe(32768),Oe=ce?new Uint16Array(128):oe(128),Ee=1,et=1;function dt(M,H){var O=ke(M,H)+257;H+=5;var te=ke(M,H)+1;H+=5;var ne=We(M,H)+4;H+=4;for(var ie=0,Se=ce?new Uint8Array(19):oe(19),Qe=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],je=1,ze=ce?new Uint8Array(8):oe(8),Re=ce?new Uint8Array(8):oe(8),it=Se.length,ft=0;ft<ne;++ft)Se[j[ft]]=ie=Ue(M,H),je<ie&&(je=ie),ze[ie]++,H+=3;var mt=0;for(ze[0]=0,ft=1;ft<=je;++ft)Re[ft]=mt=mt+ze[ft-1]<<1;for(ft=0;ft<it;++ft)(mt=Se[ft])!=0&&(Qe[ft]=Re[mt]++);var ht=0;for(ft=0;ft<it;++ft)if(ht=Se[ft],ht!=0){mt=J[Qe[ft]]>>8-ht;for(var pt=(1<<7-ht)-1;pt>=0;--pt)Oe[mt|pt<<ht]=ht&7|ft<<3}var _t=[];for(je=1;_t.length<O+te;)switch(mt=Oe[N(M,H)],H+=mt&7,mt>>>=3){case 16:for(ie=3+De(M,H),H+=2,mt=_t[_t.length-1];ie-- >0;)_t.push(mt);break;case 17:for(ie=3+Ue(M,H),H+=3;ie-- >0;)_t.push(0);break;case 18:for(ie=11+N(M,H),H+=7;ie-- >0;)_t.push(0);break;default:_t.push(mt),je<mt&&(je=mt);break}var Ge=_t.slice(0,O),ct=_t.slice(O);for(ft=O;ft<286;++ft)Ge[ft]=0;for(ft=te;ft<30;++ft)ct[ft]=0;return Ee=se(Ge,He,286),et=se(ct,Ke,30),H}function ut(M,H){if(M[0]==3&&!(M[1]&3))return[Is(H),2];for(var O=0,te=0,ne=zo(H||1<<18),ie=0,Se=ne.length>>>0,Qe=0,je=0;!(te&1);){if(te=Ue(M,O),O+=3,te>>>1)te>>1==1?(Qe=9,je=5):(O=dt(M,O),Qe=Ee,je=et);else{O&7&&(O+=8-(O&7));var ze=M[O>>>3]|M[(O>>>3)+1]<<8;if(O+=32,ze>0)for(!H&&Se<ie+ze&&(ne=Ye(ne,ie+ze),Se=ne.length);ze-- >0;)ne[ie++]=M[O>>>3],O+=8;continue}for(;;){!H&&Se<ie+32767&&(ne=Ye(ne,ie+32767),Se=ne.length);var Re=V(M,O,Qe),it=te>>>1==1?U[Re]:He[Re];if(O+=it&15,it>>>=4,!(it>>>8&255))ne[ie++]=it;else{if(it==256)break;it-=257;var ft=it<8?0:it-4>>2;ft>5&&(ft=0);var mt=ie+I[it];ft>0&&(mt+=V(M,O,ft),O+=ft),Re=V(M,O,je),it=te>>>1==1?W[Re]:Ke[Re],O+=it&15,it>>>=4;var ht=it<4?0:it-2>>1,pt=Y[it];for(ht>0&&(pt+=V(M,O,ht),O+=ht),!H&&Se<mt&&(ne=Ye(ne,mt+100),Se=ne.length);ie<mt;)ne[ie]=ne[ie-pt],++ie}}}return H?[ne,O+7>>>3]:[ne.slice(0,ie),O+7>>>3]}function Pe(M,H){var O=M.slice(M.l||0),te=ut(O,H);return M.l+=te[1],te[0]}function qe(M,H){if(M)typeof console<"u"&&console.error(H);else throw new Error(H)}function tt(M,H){var O=M;wr(O,0);var te=[],ne=[],ie={FileIndex:te,FullPaths:ne};D(ie,{root:H.root});for(var Se=O.length-4;(O[Se]!=80||O[Se+1]!=75||O[Se+2]!=5||O[Se+3]!=6)&&Se>=0;)--Se;O.l=Se+4,O.l+=4;var Qe=O.read_shift(2);O.l+=6;var je=O.read_shift(4);for(O.l=je,Se=0;Se<Qe;++Se){O.l+=20;var ze=O.read_shift(4),Re=O.read_shift(4),it=O.read_shift(2),ft=O.read_shift(2),mt=O.read_shift(2);O.l+=8;var ht=O.read_shift(4),pt=v(O.slice(O.l+it,O.l+it+ft));O.l+=it+ft+mt;var _t=O.l;O.l=ht+4,lt(O,ze,Re,ie,pt),O.l=_t}return ie}function lt(M,H,O,te,ne){M.l+=2;var ie=M.read_shift(2),Se=M.read_shift(2),Qe=d(M);if(ie&8257)throw new Error("Unsupported ZIP encryption");for(var je=M.read_shift(4),ze=M.read_shift(4),Re=M.read_shift(4),it=M.read_shift(2),ft=M.read_shift(2),mt="",ht=0;ht<it;++ht)mt+=String.fromCharCode(M[M.l++]);if(ft){var pt=v(M.slice(M.l,M.l+ft));(pt[21589]||{}).mt&&(Qe=pt[21589].mt),((ne||{})[21589]||{}).mt&&(Qe=ne[21589].mt)}M.l+=ft;var _t=M.slice(M.l,M.l+ze);switch(Se){case 8:_t=pe(M,Re);break;case 0:break;default:throw new Error("Unsupported ZIP Compression method "+Se)}var Ge=!1;ie&8&&(je=M.read_shift(4),je==134695760&&(je=M.read_shift(4),Ge=!0),ze=M.read_shift(4),Re=M.read_shift(4)),ze!=H&&qe(Ge,"Bad compressed size: "+H+" != "+ze),Re!=O&&qe(Ge,"Bad uncompressed size: "+O+" != "+Re),Le(te,mt,_t,{unsafe:!0,mt:Qe})}function Xe(M,H){var O=H||{},te=[],ne=[],ie=mr(1),Se=O.compression?8:0,Qe=0,je=0,ze=0,Re=0,it=0,ft=M.FullPaths[0],mt=ft,ht=M.FileIndex[0],pt=[],_t=0;for(je=1;je<M.FullPaths.length;++je)if(mt=M.FullPaths[je].slice(ft.length),ht=M.FileIndex[je],!(!ht.size||!ht.content||mt=="Sh33tJ5")){var Ge=Re,ct=mr(mt.length);for(ze=0;ze<mt.length;++ze)ct.write_shift(1,mt.charCodeAt(ze)&127);ct=ct.slice(0,ct.l),pt[it]=Zh.buf(ht.content,0);var Ze=ht.content;Se==8&&(Ze=B(Ze)),ie=mr(30),ie.write_shift(4,67324752),ie.write_shift(2,20),ie.write_shift(2,Qe),ie.write_shift(2,Se),ht.mt?l(ie,ht.mt):ie.write_shift(4,0),ie.write_shift(-4,pt[it]),ie.write_shift(4,Ze.length),ie.write_shift(4,ht.content.length),ie.write_shift(2,ct.length),ie.write_shift(2,0),Re+=ie.length,te.push(ie),Re+=ct.length,te.push(ct),Re+=Ze.length,te.push(Ze),ie=mr(46),ie.write_shift(4,33639248),ie.write_shift(2,0),ie.write_shift(2,20),ie.write_shift(2,Qe),ie.write_shift(2,Se),ie.write_shift(4,0),ie.write_shift(-4,pt[it]),ie.write_shift(4,Ze.length),ie.write_shift(4,ht.content.length),ie.write_shift(2,ct.length),ie.write_shift(2,0),ie.write_shift(2,0),ie.write_shift(2,0),ie.write_shift(2,0),ie.write_shift(4,0),ie.write_shift(4,Ge),_t+=ie.l,ne.push(ie),_t+=ct.length,ne.push(ct),++it}return ie=mr(22),ie.write_shift(4,101010256),ie.write_shift(2,0),ie.write_shift(2,0),ie.write_shift(2,it),ie.write_shift(2,it),ie.write_shift(4,_t),ie.write_shift(4,Re),ie.write_shift(2,0),Ss([Ss(te),Ss(ne),ie])}var at={htm:"text/html",xml:"text/xml",gif:"image/gif",jpg:"image/jpeg",png:"image/png",mso:"application/x-mso",thmx:"application/vnd.ms-officetheme",sh33tj5:"application/octet-stream"};function Fe(M,H){if(M.ctype)return M.ctype;var O=M.name||"",te=O.match(/\.([^\.]+)$/);return te&&at[te[1]]||H&&(te=(O=H).match(/[\.\\]([^\.\\])+$/),te&&at[te[1]])?at[te[1]]:"application/octet-stream"}function rt(M){for(var H=Oo(M),O=[],te=0;te<H.length;te+=76)O.push(H.slice(te,te+76));return O.join(`\r
`)+`\r
`}function Ce(M){var H=M.replace(/[\x00-\x08\x0B\x0C\x0E-\x1F\x7E-\xFF=]/g,function(ze){var Re=ze.charCodeAt(0).toString(16).toUpperCase();return"="+(Re.length==1?"0"+Re:Re)});H=H.replace(/ $/mg,"=20").replace(/\t$/mg,"=09"),H.charAt(0)==`
`&&(H="=0D"+H.slice(1)),H=H.replace(/\r(?!\n)/mg,"=0D").replace(/\n\n/mg,`
=0A`).replace(/([^\r\n])\n/mg,"$1=0A");for(var O=[],te=H.split(`\r
`),ne=0;ne<te.length;++ne){var ie=te[ne];if(ie.length==0){O.push("");continue}for(var Se=0;Se<ie.length;){var Qe=76,je=ie.slice(Se,Se+Qe);je.charAt(Qe-1)=="="?Qe--:je.charAt(Qe-2)=="="?Qe-=2:je.charAt(Qe-3)=="="&&(Qe-=3),je=ie.slice(Se,Se+Qe),Se+=Qe,Se<ie.length&&(je+="="),O.push(je)}}return O.join(`\r
`)}function _e(M){for(var H=[],O=0;O<M.length;++O){for(var te=M[O];O<=M.length&&te.charAt(te.length-1)=="=";)te=te.slice(0,te.length-1)+M[++O];H.push(te)}for(var ne=0;ne<H.length;++ne)H[ne]=H[ne].replace(/[=][0-9A-Fa-f]{2}/g,function(ie){return String.fromCharCode(parseInt(ie.slice(1),16))});return is(H.join(`\r
`))}function Ve(M,H,O){for(var te="",ne="",ie="",Se,Qe=0;Qe<10;++Qe){var je=H[Qe];if(!je||je.match(/^\s*$/))break;var ze=je.match(/^(.*?):\s*([^\s].*)$/);if(ze)switch(ze[1].toLowerCase()){case"content-location":te=ze[2].trim();break;case"content-type":ie=ze[2].trim();break;case"content-transfer-encoding":ne=ze[2].trim();break}}switch(++Qe,ne.toLowerCase()){case"base64":Se=is(Gr(H.slice(Qe).join("")));break;case"quoted-printable":Se=_e(H.slice(Qe));break;default:throw new Error("Unsupported Content-Transfer-Encoding "+ne)}var Re=Le(M,te.slice(O.length),Se,{unsafe:!0});ie&&(Re.ctype=ie)}function Je(M,H){if(L(M.slice(0,13)).toLowerCase()!="mime-version:")throw new Error("Unsupported MAD header");var O=H&&H.root||"",te=(Na&&Buffer.isBuffer(M)?M.toString("binary"):L(M)).split(`\r
`),ne=0,ie="";for(ne=0;ne<te.length;++ne)if(ie=te[ne],!!/^Content-Location:/i.test(ie)&&(ie=ie.slice(ie.indexOf("file")),O||(O=ie.slice(0,ie.lastIndexOf("/")+1)),ie.slice(0,O.length)!=O))for(;O.length>0&&(O=O.slice(0,O.length-1),O=O.slice(0,O.lastIndexOf("/")+1),ie.slice(0,O.length)!=O););var Se=(te[1]||"").match(/boundary="(.*?)"/);if(!Se)throw new Error("MAD cannot find boundary");var Qe="--"+(Se[1]||""),je=[],ze=[],Re={FileIndex:je,FullPaths:ze};D(Re);var it,ft=0;for(ne=0;ne<te.length;++ne){var mt=te[ne];mt!==Qe&&mt!==Qe+"--"||(ft++&&Ve(Re,te.slice(it,ne),O),it=ne)}return Re}function st(M,H){var O=H||{},te=O.boundary||"SheetJS";te="------="+te;for(var ne=["MIME-Version: 1.0",'Content-Type: multipart/related; boundary="'+te.slice(2)+'"',"","",""],ie=M.FullPaths[0],Se=ie,Qe=M.FileIndex[0],je=1;je<M.FullPaths.length;++je)if(Se=M.FullPaths[je].slice(ie.length),Qe=M.FileIndex[je],!(!Qe.size||!Qe.content||Se=="Sh33tJ5")){Se=Se.replace(/[\x00-\x08\x0B\x0C\x0E-\x1F\x7E-\xFF]/g,function(_t){return"_x"+_t.charCodeAt(0).toString(16)+"_"}).replace(/[\u0080-\uFFFF]/g,function(_t){return"_u"+_t.charCodeAt(0).toString(16)+"_"});for(var ze=Qe.content,Re=Na&&Buffer.isBuffer(ze)?ze.toString("binary"):L(ze),it=0,ft=Math.min(1024,Re.length),mt=0,ht=0;ht<=ft;++ht)(mt=Re.charCodeAt(ht))>=32&&mt<128&&++it;var pt=it>=ft*4/5;ne.push(te),ne.push("Content-Location: "+(O.root||"file:///C:/SheetJS/")+Se),ne.push("Content-Transfer-Encoding: "+(pt?"quoted-printable":"base64")),ne.push("Content-Type: "+Fe(Qe,Se)),ne.push(""),ne.push(pt?Ce(Re):rt(Re))}return ne.push(te+`--\r
`),ne.join(`\r
`)}function ot(M){var H={};return D(H,M),H}function Le(M,H,O,te){var ne=te&&te.unsafe;ne||D(M);var ie=!ne&&Oa.find(M,H);if(!ie){var Se=M.FullPaths[0];H.slice(0,Se.length)==Se?Se=H:(Se.slice(-1)!="/"&&(Se+="/"),Se=(Se+H).replace("//","/")),ie={name:i(H),type:2},M.FileIndex.push(ie),M.FullPaths.push(Se),ne||Oa.utils.cfb_gc(M)}return ie.content=O,ie.size=O?O.length:0,te&&(te.CLSID&&(ie.clsid=te.CLSID),te.mt&&(ie.mt=te.mt),te.ct&&(ie.ct=te.ct)),ie}function nt(M,H){D(M);var O=Oa.find(M,H);if(O){for(var te=0;te<M.FileIndex.length;++te)if(M.FileIndex[te]==O)return M.FileIndex.splice(te,1),M.FullPaths.splice(te,1),!0}return!1}function vt(M,H,O){D(M);var te=Oa.find(M,H);if(te){for(var ne=0;ne<M.FileIndex.length;++ne)if(M.FileIndex[ne]==te)return M.FileIndex[ne].name=i(O),M.FullPaths[ne]=O,!0}return!1}function xt(M){he(M,!0)}return r.find=K,r.read=ue,r.parse=h,r.write=Te,r.writeFile=be,r.utils={cfb_new:ot,cfb_add:Le,cfb_del:nt,cfb_mov:vt,cfb_gc:xt,ReadShift:wi,CheckField:Mc,prep_blob:wr,bconcat:Ss,use_zlib:P,_deflateRaw:Ae,_inflateRaw:Pe,consts:Be},r}();function Jh(t){if(typeof Deno<"u")return Deno.readFileSync(t);if(typeof $<"u"&&typeof File<"u"&&typeof Folder<"u")try{var r=File(t);r.open("r"),r.encoding="binary";var a=r.read();return r.close(),a}catch(s){if(!s.message||!s.message.match(/onstruct/))throw s}throw new Error("Cannot access file "+t)}function fs(t){for(var r=Object.keys(t),a=[],s=0;s<r.length;++s)Object.prototype.hasOwnProperty.call(t,r[s])&&a.push(r[s]);return a}function ro(t){for(var r=[],a=fs(t),s=0;s!==a.length;++s)r[t[a[s]]]=a[s];return r}var dn=new Date(1899,11,30,0,0,0);function zr(t,r){var a=t.getTime(),s=dn.getTime()+(t.getTimezoneOffset()-dn.getTimezoneOffset())*6e4;return(a-s)/(24*60*60*1e3)}var dc=new Date,em=dn.getTime()+(dc.getTimezoneOffset()-dn.getTimezoneOffset())*6e4,Vo=dc.getTimezoneOffset();function xn(t){var r=new Date;return r.setTime(t*24*60*60*1e3+em),r.getTimezoneOffset()!==Vo&&r.setTime(r.getTime()+(r.getTimezoneOffset()-Vo)*6e4),r}function tm(t){var r=0,a=0,s=!1,i=t.match(/P([0-9\.]+Y)?([0-9\.]+M)?([0-9\.]+D)?T([0-9\.]+H)?([0-9\.]+M)?([0-9\.]+S)?/);if(!i)throw new Error("|"+t+"| is not an ISO8601 Duration");for(var l=1;l!=i.length;++l)if(i[l]){switch(a=1,l>3&&(s=!0),i[l].slice(i[l].length-1)){case"Y":throw new Error("Unsupported ISO Duration Field: "+i[l].slice(i[l].length-1));case"D":a*=24;case"H":a*=60;case"M":if(s)a*=60;else throw new Error("Unsupported ISO Duration Field: M")}r+=a*parseInt(i[l],10)}return r}var Go=new Date("2017-02-19T19:06:09.000Z"),vc=isNaN(Go.getFullYear())?new Date("2/19/17"):Go,am=vc.getFullYear()==2017;function br(t,r){var a=new Date(t);if(am)return r>0?a.setTime(a.getTime()+a.getTimezoneOffset()*60*1e3):r<0&&a.setTime(a.getTime()-a.getTimezoneOffset()*60*1e3),a;if(t instanceof Date)return t;if(vc.getFullYear()==1917&&!isNaN(a.getFullYear())){var s=a.getFullYear();return t.indexOf(""+s)>-1||a.setFullYear(a.getFullYear()+100),a}var i=t.match(/\d+/g)||["2017","2","19","0","0","0"],l=new Date(+i[0],+i[1]-1,+i[2],+i[3]||0,+i[4]||0,+i[5]||0);return t.indexOf("Z")>-1&&(l=new Date(l.getTime()-l.getTimezoneOffset()*60*1e3)),l}function Ws(t,r){if(Na&&Buffer.isBuffer(t)){if(r){if(t[0]==255&&t[1]==254)return xi(t.slice(2).toString("utf16le"));if(t[1]==254&&t[2]==255)return xi(Ql(t.slice(2).toString("binary")))}return t.toString("binary")}if(typeof TextDecoder<"u")try{if(r){if(t[0]==255&&t[1]==254)return xi(new TextDecoder("utf-16le").decode(t.slice(2)));if(t[0]==254&&t[1]==255)return xi(new TextDecoder("utf-16be").decode(t.slice(2)))}var a={"€":"","‚":"",ƒ:"","„":"","…":"","†":"","‡":"","ˆ":"","‰":"",Š:"","‹":"",Œ:"",Ž:"","‘":"","’":"","“":"","”":"","•":"","–":"","—":"","˜":"","™":"",š:"","›":"",œ:"",ž:"",Ÿ:""};return Array.isArray(t)&&(t=new Uint8Array(t)),new TextDecoder("latin1").decode(t).replace(/[€‚ƒ„…†‡ˆ‰Š‹ŒŽ‘’“”•–—˜™š›œžŸ]/g,function(l){return a[l]||l})}catch{}for(var s=[],i=0;i!=t.length;++i)s.push(String.fromCharCode(t[i]));return s.join("")}function kr(t){if(typeof JSON<"u"&&!Array.isArray(t))return JSON.parse(JSON.stringify(t));if(typeof t!="object"||t==null)return t;if(t instanceof Date)return new Date(t.getTime());var r={};for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(r[a]=kr(t[a]));return r}function lr(t,r){for(var a="";a.length<r;)a+=t;return a}function ls(t){var r=Number(t);if(!isNaN(r))return isFinite(r)?r:NaN;if(!/\d/.test(t))return r;var a=1,s=t.replace(/([\d]),([\d])/g,"$1$2").replace(/[$]/g,"").replace(/[%]/g,function(){return a*=100,""});return!isNaN(r=Number(s))||(s=s.replace(/[(](.*)[)]/,function(i,l){return a=-a,l}),!isNaN(r=Number(s)))?r/a:r}var rm=["january","february","march","april","may","june","july","august","september","october","november","december"];function ii(t){var r=new Date(t),a=new Date(NaN),s=r.getYear(),i=r.getMonth(),l=r.getDate();if(isNaN(l))return a;var d=t.toLowerCase();if(d.match(/jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec/)){if(d=d.replace(/[^a-z]/g,"").replace(/([^a-z]|^)[ap]m?([^a-z]|$)/,""),d.length>3&&rm.indexOf(d)==-1)return a}else if(d.match(/[a-z]/))return a;return s<0||s>8099?a:(i>0||l>1)&&s!=101?r:t.match(/[^-0-9:,\/\\]/)?a:r}var sm=function(){var t="abacaba".split(/(:?b)/i).length==5;return function(a,s,i){if(t||typeof s=="string")return a.split(s);for(var l=a.split(s),d=[l[0]],v=1;v<l.length;++v)d.push(i),d.push(l[v]);return d}}();function uc(t){return t?t.content&&t.type?Ws(t.content,!0):t.data?mi(t.data):t.asNodeBuffer&&Na?mi(t.asNodeBuffer().toString("binary")):t.asBinary?mi(t.asBinary()):t._data&&t._data.getContent?mi(Ws(Array.prototype.slice.call(t._data.getContent(),0))):null:null}function fc(t){if(!t)return null;if(t.data)return Po(t.data);if(t.asNodeBuffer&&Na)return t.asNodeBuffer();if(t._data&&t._data.getContent){var r=t._data.getContent();return typeof r=="string"?Po(r):Array.prototype.slice.call(r)}return t.content&&t.type?t.content:null}function im(t){return t&&t.name.slice(-4)===".bin"?fc(t):uc(t)}function Kr(t,r){for(var a=t.FullPaths||fs(t.files),s=r.toLowerCase().replace(/[\/]/g,"\\"),i=s.replace(/\\/g,"/"),l=0;l<a.length;++l){var d=a[l].replace(/^Root Entry[\/]/,"").toLowerCase();if(s==d||i==d)return t.files?t.files[a[l]]:t.FileIndex[l]}return null}function so(t,r){var a=Kr(t,r);if(a==null)throw new Error("Cannot find file "+r+" in zip");return a}function fr(t,r,a){if(!a)return im(so(t,r));if(!r)return null;try{return fr(t,r)}catch{return null}}function Vr(t,r,a){if(!a)return uc(so(t,r));if(!r)return null;try{return Vr(t,r)}catch{return null}}function nm(t,r,a){return fc(so(t,r))}function Xo(t){for(var r=t.FullPaths||fs(t.files),a=[],s=0;s<r.length;++s)r[s].slice(-1)!="/"&&a.push(r[s].replace(/^Root Entry[\/]/,""));return a.sort()}function om(t,r,a){if(t.FullPaths){if(typeof a=="string"){var s;return Na?s=Vs(a):s=Ah(a),Oa.utils.cfb_add(t,r,s)}Oa.utils.cfb_add(t,r,a)}else t.file(r,a)}function pc(t,r){switch(r.type){case"base64":return Oa.read(t,{type:"base64"});case"binary":return Oa.read(t,{type:"binary"});case"buffer":case"array":return Oa.read(t,{type:"buffer"})}throw new Error("Unrecognized type "+r.type)}function gi(t,r){if(t.charAt(0)=="/")return t.slice(1);var a=r.split("/");r.slice(-1)!="/"&&a.pop();for(var s=t.split("/");s.length!==0;){var i=s.shift();i===".."?a.pop():i!=="."&&a.push(i)}return a.join("/")}var hc=`<?xml version="1.0" encoding="UTF-8" standalone="yes"?>\r
`,lm=/([^"\s?>\/]+)\s*=\s*((?:")([^"]*)(?:")|(?:')([^']*)(?:')|([^'">\s]+))/g,Yo=/<[\/\?]?[a-zA-Z0-9:_-]+(?:\s+[^"\s?>\/]+\s*=\s*(?:"[^"]*"|'[^']*'|[^'">\s=]+))*\s*[\/\?]?>/mg,cm=/<[^>]*>/g,Mr=hc.match(Yo)?Yo:cm,dm=/<\w*:/,vm=/<(\/?)\w+:/;function ba(t,r,a){for(var s={},i=0,l=0;i!==t.length&&!((l=t.charCodeAt(i))===32||l===10||l===13);++i);if(r||(s[0]=t.slice(0,i)),i===t.length)return s;var d=t.match(lm),v=0,u="",f=0,h="",_="",x=1;if(d)for(f=0;f!=d.length;++f){for(_=d[f],l=0;l!=_.length&&_.charCodeAt(l)!==61;++l);for(h=_.slice(0,l).trim();_.charCodeAt(l+1)==32;)++l;for(x=(i=_.charCodeAt(l+1))==34||i==39?1:0,u=_.slice(l+1+x,_.length-x),v=0;v!=h.length&&h.charCodeAt(v)!==58;++v);if(v===h.length)h.indexOf("_")>0&&(h=h.slice(0,h.indexOf("_"))),s[h]=u,s[h.toLowerCase()]=u;else{var T=(v===5&&h.slice(0,5)==="xmlns"?"xmlns":"")+h.slice(v+1);if(s[T]&&h.slice(v-3,v)=="ext")continue;s[T]=u,s[T.toLowerCase()]=u}}return s}function ps(t){return t.replace(vm,"<$1")}var mc={"&quot;":'"',"&apos;":"'","&gt;":">","&lt;":"<","&amp;":"&"},um=ro(mc),Ua=function(){var t=/&(?:quot|apos|gt|lt|amp|#x?([\da-fA-F]+));/ig,r=/_x([\da-fA-F]{4})_/ig;return function a(s){var i=s+"",l=i.indexOf("<![CDATA[");if(l==-1)return i.replace(t,function(v,u){return mc[v]||String.fromCharCode(parseInt(u,v.indexOf("x")>-1?16:10))||v}).replace(r,function(v,u){return String.fromCharCode(parseInt(u,16))});var d=i.indexOf("]]>");return a(i.slice(0,l))+i.slice(l+9,d)+a(i.slice(d+3))}}(),fm=/[&<>'"]/g,pm=/[\u0000-\u001f]/g;function io(t){var r=t+"";return r.replace(fm,function(a){return um[a]}).replace(/\n/g,"<br/>").replace(pm,function(a){return"&#x"+("000"+a.charCodeAt(0).toString(16)).slice(-4)+";"})}var Ko=function(){var t=/&#(\d+);/g;function r(a,s){return String.fromCharCode(parseInt(s,10))}return function(s){return s.replace(t,r)}}();function er(t){switch(t){case 1:case!0:case"1":case"true":case"TRUE":return!0;default:return!1}}function Dn(t){for(var r="",a=0,s=0,i=0,l=0,d=0,v=0;a<t.length;){if(s=t.charCodeAt(a++),s<128){r+=String.fromCharCode(s);continue}if(i=t.charCodeAt(a++),s>191&&s<224){d=(s&31)<<6,d|=i&63,r+=String.fromCharCode(d);continue}if(l=t.charCodeAt(a++),s<240){r+=String.fromCharCode((s&15)<<12|(i&63)<<6|l&63);continue}d=t.charCodeAt(a++),v=((s&7)<<18|(i&63)<<12|(l&63)<<6|d&63)-65536,r+=String.fromCharCode(55296+(v>>>10&1023)),r+=String.fromCharCode(56320+(v&1023))}return r}function Qo(t){var r=Is(2*t.length),a,s,i=1,l=0,d=0,v;for(s=0;s<t.length;s+=i)i=1,(v=t.charCodeAt(s))<128?a=v:v<224?(a=(v&31)*64+(t.charCodeAt(s+1)&63),i=2):v<240?(a=(v&15)*4096+(t.charCodeAt(s+1)&63)*64+(t.charCodeAt(s+2)&63),i=3):(i=4,a=(v&7)*262144+(t.charCodeAt(s+1)&63)*4096+(t.charCodeAt(s+2)&63)*64+(t.charCodeAt(s+3)&63),a-=65536,d=55296+(a>>>10&1023),a=56320+(a&1023)),d!==0&&(r[l++]=d&255,r[l++]=d>>>8,d=0),r[l++]=a%256,r[l++]=a>>>8;return r.slice(0,l).toString("ucs2")}function Zo(t){return Vs(t,"binary").toString("utf8")}var Ki="foo bar bazâð£",Ka=Na&&(Zo(Ki)==Dn(Ki)&&Zo||Qo(Ki)==Dn(Ki)&&Qo)||Dn,xi=Na?function(t){return Vs(t,"utf8").toString("binary")}:function(t){for(var r=[],a=0,s=0,i=0;a<t.length;)switch(s=t.charCodeAt(a++),!0){case s<128:r.push(String.fromCharCode(s));break;case s<2048:r.push(String.fromCharCode(192+(s>>6))),r.push(String.fromCharCode(128+(s&63)));break;case(s>=55296&&s<57344):s-=55296,i=t.charCodeAt(a++)-56320+(s<<10),r.push(String.fromCharCode(240+(i>>18&7))),r.push(String.fromCharCode(144+(i>>12&63))),r.push(String.fromCharCode(128+(i>>6&63))),r.push(String.fromCharCode(128+(i&63)));break;default:r.push(String.fromCharCode(224+(s>>12))),r.push(String.fromCharCode(128+(s>>6&63))),r.push(String.fromCharCode(128+(s&63)))}return r.join("")},Ri=function(){var t={};return function(a,s){var i=a+"|"+(s||"");return t[i]?t[i]:t[i]=new RegExp("<(?:\\w+:)?"+a+'(?: xml:space="preserve")?(?:[^>]*)>([\\s\\S]*?)</(?:\\w+:)?'+a+">",s||"")}}(),_c=function(){var t=[["nbsp"," "],["middot","·"],["quot",'"'],["apos","'"],["gt",">"],["lt","<"],["amp","&"]].map(function(r){return[new RegExp("&"+r[0]+";","ig"),r[1]]});return function(a){for(var s=a.replace(/^[\t\n\r ]+/,"").replace(/[\t\n\r ]+$/,"").replace(/>\s+/g,">").replace(/\s+</g,"<").replace(/[\t\n\r ]+/g," ").replace(/<\s*[bB][rR]\s*\/?>/g,`
`).replace(/<[^>]*>/g,""),i=0;i<t.length;++i)s=s.replace(t[i][0],t[i][1]);return s}}(),hm=function(){var t={};return function(a){return t[a]!==void 0?t[a]:t[a]=new RegExp("<(?:vt:)?"+a+">([\\s\\S]*?)</(?:vt:)?"+a+">","g")}}(),mm=/<\/?(?:vt:)?variant>/g,_m=/<(?:vt:)([^>]*)>([\s\S]*)</;function Jo(t,r){var a=ba(t),s=t.match(hm(a.baseType))||[],i=[];if(s.length!=a.size){if(r.WTF)throw new Error("unexpected vector length "+s.length+" != "+a.size);return i}return s.forEach(function(l){var d=l.replace(mm,"").match(_m);d&&i.push({v:Ka(d[2]),t:d[1]})}),i}var gm=/(^\s|\s$|\n)/;function xm(t){return fs(t).map(function(r){return" "+r+'="'+t[r]+'"'}).join("")}function bm(t,r,a){return"<"+t+(a!=null?xm(a):"")+(r!=null?(r.match(gm)?' xml:space="preserve"':"")+">"+r+"</"+t:"/")+">"}function no(t){if(Na&&Buffer.isBuffer(t))return t.toString("utf8");if(typeof t=="string")return t;if(typeof Uint8Array<"u"&&t instanceof Uint8Array)return Ka(Gs(eo(t)));throw new Error("Bad input format: expected Buffer or string")}var Ni=/<(\/?)([^\s?><!\/:]*:|)([^\s?<>:\/]+)(?:[\s?:\/][^>]*)?>/mg,wm={CT:"http://schemas.openxmlformats.org/package/2006/content-types"},ym=["http://schemas.openxmlformats.org/spreadsheetml/2006/main","http://purl.oclc.org/ooxml/spreadsheetml/main","http://schemas.microsoft.com/office/excel/2006/main","http://schemas.microsoft.com/office/excel/2006/2"];function km(t,r){for(var a=1-2*(t[r+7]>>>7),s=((t[r+7]&127)<<4)+(t[r+6]>>>4&15),i=t[r+6]&15,l=5;l>=0;--l)i=i*256+t[r+l];return s==2047?i==0?a*(1/0):NaN:(s==0?s=-1022:(s-=1023,i+=Math.pow(2,52)),a*Math.pow(2,s-52)*i)}function Tm(t,r,a){var s=(r<0||1/r==-1/0?1:0)<<7,i=0,l=0,d=s?-r:r;isFinite(d)?d==0?i=l=0:(i=Math.floor(Math.log(d)/Math.LN2),l=d*Math.pow(2,52-i),i<=-1023&&(!isFinite(l)||l<Math.pow(2,52))?i=-1022:(l-=Math.pow(2,52),i+=1023)):(i=2047,l=isNaN(r)?26985:0);for(var v=0;v<=5;++v,l/=256)t[a+v]=l&255;t[a+6]=(i&15)<<4|l&15,t[a+7]=i>>4|s}var el=function(t){for(var r=[],a=10240,s=0;s<t[0].length;++s)if(t[0][s])for(var i=0,l=t[0][s].length;i<l;i+=a)r.push.apply(r,t[0][s].slice(i,i+a));return r},tl=Na?function(t){return t[0].length>0&&Buffer.isBuffer(t[0][0])?Buffer.concat(t[0].map(function(r){return Buffer.isBuffer(r)?r:Vs(r)})):el(t)}:el,al=function(t,r,a){for(var s=[],i=r;i<a;i+=2)s.push(String.fromCharCode(xs(t,i)));return s.join("").replace(Lr,"")},oo=Na?function(t,r,a){return Buffer.isBuffer(t)?t.toString("utf16le",r,a).replace(Lr,""):al(t,r,a)}:al,rl=function(t,r,a){for(var s=[],i=r;i<r+a;++i)s.push(("0"+t[i].toString(16)).slice(-2));return s.join("")},gc=Na?function(t,r,a){return Buffer.isBuffer(t)?t.toString("hex",r,r+a):rl(t,r,a)}:rl,sl=function(t,r,a){for(var s=[],i=r;i<a;i++)s.push(String.fromCharCode(ei(t,i)));return s.join("")},Ui=Na?function(r,a,s){return Buffer.isBuffer(r)?r.toString("utf8",a,s):sl(r,a,s)}:sl,xc=function(t,r){var a=Hr(t,r);return a>0?Ui(t,r+4,r+4+a-1):""},bc=xc,wc=function(t,r){var a=Hr(t,r);return a>0?Ui(t,r+4,r+4+a-1):""},yc=wc,kc=function(t,r){var a=2*Hr(t,r);return a>0?Ui(t,r+4,r+4+a-1):""},Tc=kc,Ec=function(r,a){var s=Hr(r,a);return s>0?oo(r,a+4,a+4+s):""},Ac=Ec,Sc=function(t,r){var a=Hr(t,r);return a>0?Ui(t,r+4,r+4+a):""},Cc=Sc,Fc=function(t,r){return km(t,r)},vn=Fc,Dc=function(r){return Array.isArray(r)||typeof Uint8Array<"u"&&r instanceof Uint8Array};Na&&(bc=function(r,a){if(!Buffer.isBuffer(r))return xc(r,a);var s=r.readUInt32LE(a);return s>0?r.toString("utf8",a+4,a+4+s-1):""},yc=function(r,a){if(!Buffer.isBuffer(r))return wc(r,a);var s=r.readUInt32LE(a);return s>0?r.toString("utf8",a+4,a+4+s-1):""},Tc=function(r,a){if(!Buffer.isBuffer(r))return kc(r,a);var s=2*r.readUInt32LE(a);return r.toString("utf16le",a+4,a+4+s-1)},Ac=function(r,a){if(!Buffer.isBuffer(r))return Ec(r,a);var s=r.readUInt32LE(a);return r.toString("utf16le",a+4,a+4+s)},Cc=function(r,a){if(!Buffer.isBuffer(r))return Sc(r,a);var s=r.readUInt32LE(a);return r.toString("utf8",a+4,a+4+s)},vn=function(r,a){return Buffer.isBuffer(r)?r.readDoubleLE(a):Fc(r,a)},Dc=function(r){return Buffer.isBuffer(r)||Array.isArray(r)||typeof Uint8Array<"u"&&r instanceof Uint8Array});var ei=function(t,r){return t[r]},xs=function(t,r){return t[r+1]*256+t[r]},Em=function(t,r){var a=t[r+1]*256+t[r];return a<32768?a:(65535-a+1)*-1},Hr=function(t,r){return t[r+3]*(1<<24)+(t[r+2]<<16)+(t[r+1]<<8)+t[r]},Os=function(t,r){return t[r+3]<<24|t[r+2]<<16|t[r+1]<<8|t[r]},Am=function(t,r){return t[r]<<24|t[r+1]<<16|t[r+2]<<8|t[r+3]};function wi(t,r){var a="",s,i,l=[],d,v,u,f;switch(r){case"dbcs":if(f=this.l,Na&&Buffer.isBuffer(this))a=this.slice(this.l,this.l+2*t).toString("utf16le");else for(u=0;u<t;++u)a+=String.fromCharCode(xs(this,f)),f+=2;t*=2;break;case"utf8":a=Ui(this,this.l,this.l+t);break;case"utf16le":t*=2,a=oo(this,this.l,this.l+t);break;case"wstr":return wi.call(this,t,"dbcs");case"lpstr-ansi":a=bc(this,this.l),t=4+Hr(this,this.l);break;case"lpstr-cp":a=yc(this,this.l),t=4+Hr(this,this.l);break;case"lpwstr":a=Tc(this,this.l),t=4+2*Hr(this,this.l);break;case"lpp4":t=4+Hr(this,this.l),a=Ac(this,this.l),t&2&&(t+=2);break;case"8lpp4":t=4+Hr(this,this.l),a=Cc(this,this.l),t&3&&(t+=4-(t&3));break;case"cstr":for(t=0,a="";(d=ei(this,this.l+t++))!==0;)l.push(Yi(d));a=l.join("");break;case"_wstr":for(t=0,a="";(d=xs(this,this.l+t))!==0;)l.push(Yi(d)),t+=2;t+=2,a=l.join("");break;case"dbcs-cont":for(a="",f=this.l,u=0;u<t;++u){if(this.lens&&this.lens.indexOf(f)!==-1)return d=ei(this,f),this.l=f+1,v=wi.call(this,t-u,d?"dbcs-cont":"sbcs-cont"),l.join("")+v;l.push(Yi(xs(this,f))),f+=2}a=l.join(""),t*=2;break;case"cpstr":case"sbcs-cont":for(a="",f=this.l,u=0;u!=t;++u){if(this.lens&&this.lens.indexOf(f)!==-1)return d=ei(this,f),this.l=f+1,v=wi.call(this,t-u,d?"dbcs-cont":"sbcs-cont"),l.join("")+v;l.push(Yi(ei(this,f))),f+=1}a=l.join("");break;default:switch(t){case 1:return s=ei(this,this.l),this.l++,s;case 2:return s=(r==="i"?Em:xs)(this,this.l),this.l+=2,s;case 4:case-4:return r==="i"||!(this[this.l+3]&128)?(s=(t>0?Os:Am)(this,this.l),this.l+=4,s):(i=Hr(this,this.l),this.l+=4,i);case 8:case-8:if(r==="f")return t==8?i=vn(this,this.l):i=vn([this[this.l+7],this[this.l+6],this[this.l+5],this[this.l+4],this[this.l+3],this[this.l+2],this[this.l+1],this[this.l+0]],0),this.l+=8,i;t=8;case 16:a=gc(this,this.l,t);break}}return this.l+=t,a}var Sm=function(t,r,a){t[a]=r&255,t[a+1]=r>>>8&255,t[a+2]=r>>>16&255,t[a+3]=r>>>24&255},Cm=function(t,r,a){t[a]=r&255,t[a+1]=r>>8&255,t[a+2]=r>>16&255,t[a+3]=r>>24&255},Fm=function(t,r,a){t[a]=r&255,t[a+1]=r>>>8&255};function Dm(t,r,a){var s=0,i=0;if(a==="dbcs"){for(i=0;i!=r.length;++i)Fm(this,r.charCodeAt(i),this.l+2*i);s=2*r.length}else if(a==="sbcs"){for(r=r.replace(/[^\x00-\x7F]/g,"_"),i=0;i!=r.length;++i)this[this.l+i]=r.charCodeAt(i)&255;s=r.length}else if(a==="hex"){for(;i<t;++i)this[this.l++]=parseInt(r.slice(2*i,2*i+2),16)||0;return this}else if(a==="utf16le"){var l=Math.min(this.l+t,this.length);for(i=0;i<Math.min(r.length,t);++i){var d=r.charCodeAt(i);this[this.l++]=d&255,this[this.l++]=d>>8}for(;this.l<l;)this[this.l++]=0;return this}else switch(t){case 1:s=1,this[this.l]=r&255;break;case 2:s=2,this[this.l]=r&255,r>>>=8,this[this.l+1]=r&255;break;case 3:s=3,this[this.l]=r&255,r>>>=8,this[this.l+1]=r&255,r>>>=8,this[this.l+2]=r&255;break;case 4:s=4,Sm(this,r,this.l);break;case 8:if(s=8,a==="f"){Tm(this,r,this.l);break}case 16:break;case-4:s=4,Cm(this,r,this.l);break}return this.l+=s,this}function Mc(t,r){var a=gc(this,this.l,t.length>>1);if(a!==t)throw new Error(r+"Expected "+t+" saw "+a);this.l+=t.length>>1}function wr(t,r){t.l=r,t.read_shift=wi,t.chk=Mc,t.write_shift=Dm}function Dr(t,r){t.l+=r}function mr(t){var r=Is(t);return wr(r,0),r}function Ts(t,r,a){if(t){var s,i,l;wr(t,t.l||0);for(var d=t.length,v=0,u=0;t.l<d;){v=t.read_shift(1),v&128&&(v=(v&127)+((t.read_shift(1)&127)<<7));var f=_n[v]||_n[65535];for(s=t.read_shift(1),l=s&127,i=1;i<4&&s&128;++i)l+=((s=t.read_shift(1))&127)<<7*i;u=t.l+l;var h=f.f&&f.f(t,l,a);if(t.l=u,r(h,f,v))return}}}function Bn(){var t=[],r=Na?256:2048,a=function(f){var h=mr(f);return wr(h,0),h},s=a(r),i=function(){s&&(s.length>s.l&&(s=s.slice(0,s.l),s.l=s.length),s.length>0&&t.push(s),s=null)},l=function(f){return s&&f<s.length-s.l?s:(i(),s=a(Math.max(f+1,r)))},d=function(){return i(),Ss(t)},v=function(f){i(),s=f,s.l==null&&(s.l=s.length),l(r)};return{next:l,push:v,end:d,_bufs:t}}function yi(t,r,a){var s=kr(t);if(r.s?(s.cRel&&(s.c+=r.s.c),s.rRel&&(s.r+=r.s.r)):(s.cRel&&(s.c+=r.c),s.rRel&&(s.r+=r.r)),!a||a.biff<12){for(;s.c>=256;)s.c-=256;for(;s.r>=65536;)s.r-=65536}return s}function il(t,r,a){var s=kr(t);return s.s=yi(s.s,r.s,a),s.e=yi(s.e,r.s,a),s}function ki(t,r){if(t.cRel&&t.c<0)for(t=kr(t);t.c<0;)t.c+=r>8?16384:256;if(t.rRel&&t.r<0)for(t=kr(t);t.r<0;)t.r+=r>8?1048576:r>5?65536:16384;var a=Ea(t);return!t.cRel&&t.cRel!=null&&(a=Rm(a)),!t.rRel&&t.rRel!=null&&(a=Mm(a)),a}function Mn(t,r){return t.s.r==0&&!t.s.rRel&&t.e.r==(r.biff>=12?1048575:r.biff>=8?65536:16384)&&!t.e.rRel?(t.s.cRel?"":"$")+_r(t.s.c)+":"+(t.e.cRel?"":"$")+_r(t.e.c):t.s.c==0&&!t.s.cRel&&t.e.c==(r.biff>=12?16383:255)&&!t.e.cRel?(t.s.rRel?"":"$")+Tr(t.s.r)+":"+(t.e.rRel?"":"$")+Tr(t.e.r):ki(t.s,r.biff)+":"+ki(t.e,r.biff)}function lo(t){return parseInt(Im(t),10)-1}function Tr(t){return""+(t+1)}function Mm(t){return t.replace(/([A-Z]|^)(\d+)$/,"$1$$$2")}function Im(t){return t.replace(/\$(\d+)$/,"$1")}function co(t){for(var r=Nm(t),a=0,s=0;s!==r.length;++s)a=26*a+r.charCodeAt(s)-64;return a-1}function _r(t){if(t<0)throw new Error("invalid column "+t);var r="";for(++t;t;t=Math.floor((t-1)/26))r=String.fromCharCode((t-1)%26+65)+r;return r}function Rm(t){return t.replace(/^([A-Z])/,"$$$1")}function Nm(t){return t.replace(/^\$([A-Z])/,"$1")}function Pm(t){return t.replace(/(\$?[A-Z]*)(\$?\d*)/,"$1,$2").split(",")}function Pr(t){for(var r=0,a=0,s=0;s<t.length;++s){var i=t.charCodeAt(s);i>=48&&i<=57?r=10*r+(i-48):i>=65&&i<=90&&(a=26*a+(i-64))}return{c:a-1,r:r-1}}function Ea(t){for(var r=t.c+1,a="";r;r=(r-1)/26|0)a=String.fromCharCode((r-1)%26+65)+a;return a+(t.r+1)}function li(t){var r=t.indexOf(":");return r==-1?{s:Pr(t),e:Pr(t)}:{s:Pr(t.slice(0,r)),e:Pr(t.slice(r+1))}}function za(t,r){return typeof r>"u"||typeof r=="number"?za(t.s,t.e):(typeof t!="string"&&(t=Ea(t)),typeof r!="string"&&(r=Ea(r)),t==r?t:t+":"+r)}function cr(t){var r={s:{c:0,r:0},e:{c:0,r:0}},a=0,s=0,i=0,l=t.length;for(a=0;s<l&&!((i=t.charCodeAt(s)-64)<1||i>26);++s)a=26*a+i;for(r.s.c=--a,a=0;s<l&&!((i=t.charCodeAt(s)-48)<0||i>9);++s)a=10*a+i;if(r.s.r=--a,s===l||i!=10)return r.e.c=r.s.c,r.e.r=r.s.r,r;for(++s,a=0;s!=l&&!((i=t.charCodeAt(s)-64)<1||i>26);++s)a=26*a+i;for(r.e.c=--a,a=0;s!=l&&!((i=t.charCodeAt(s)-48)<0||i>9);++s)a=10*a+i;return r.e.r=--a,r}function nl(t,r){var a=t.t=="d"&&r instanceof Date;if(t.z!=null)try{return t.w=Qr(t.z,a?zr(r):r)}catch{}try{return t.w=Qr((t.XF||{}).numFmtId||(a?14:0),a?zr(r):r)}catch{return""+r}}function ys(t,r,a){return t==null||t.t==null||t.t=="z"?"":t.w!==void 0?t.w:(t.t=="d"&&!t.z&&a&&a.dateNF&&(t.z=a.dateNF),t.t=="e"?Ks[t.v]||t.v:r==null?nl(t,t.v):nl(t,r))}function Ns(t,r){var a=r&&r.sheet?r.sheet:"Sheet1",s={};return s[a]=t,{SheetNames:[a],Sheets:s}}function Ic(t,r,a){var s=a||{},i=t?Array.isArray(t):s.dense,l=t||(i?[]:{}),d=0,v=0;if(l&&s.origin!=null){if(typeof s.origin=="number")d=s.origin;else{var u=typeof s.origin=="string"?Pr(s.origin):s.origin;d=u.r,v=u.c}l["!ref"]||(l["!ref"]="A1:A1")}var f={s:{c:1e7,r:1e7},e:{c:0,r:0}};if(l["!ref"]){var h=cr(l["!ref"]);f.s.c=h.s.c,f.s.r=h.s.r,f.e.c=Math.max(f.e.c,h.e.c),f.e.r=Math.max(f.e.r,h.e.r),d==-1&&(f.e.r=d=h.e.r+1)}for(var _=0;_!=r.length;++_)if(r[_]){if(!Array.isArray(r[_]))throw new Error("aoa_to_sheet expects an array of arrays");for(var x=0;x!=r[_].length;++x)if(!(typeof r[_][x]>"u")){var T={v:r[_][x]},b=d+_,w=v+x;if(f.s.r>b&&(f.s.r=b),f.s.c>w&&(f.s.c=w),f.e.r<b&&(f.e.r=b),f.e.c<w&&(f.e.c=w),r[_][x]&&typeof r[_][x]=="object"&&!Array.isArray(r[_][x])&&!(r[_][x]instanceof Date))T=r[_][x];else if(Array.isArray(T.v)&&(T.f=r[_][x][1],T.v=T.v[0]),T.v===null)if(T.f)T.t="n";else if(s.nullError)T.t="e",T.v=0;else if(s.sheetStubs)T.t="z";else continue;else typeof T.v=="number"?T.t="n":typeof T.v=="boolean"?T.t="b":T.v instanceof Date?(T.z=s.dateNF||Sa[14],s.cellDates?(T.t="d",T.w=Qr(T.z,zr(T.v))):(T.t="n",T.v=zr(T.v),T.w=Qr(T.z,T.v))):T.t="s";if(i)l[b]||(l[b]=[]),l[b][w]&&l[b][w].z&&(T.z=l[b][w].z),l[b][w]=T;else{var A=Ea({c:w,r:b});l[A]&&l[A].z&&(T.z=l[A].z),l[A]=T}}}return f.s.c<1e7&&(l["!ref"]=za(f)),l}function ci(t,r){return Ic(null,t,r)}function Lm(t){return t.read_shift(4,"i")}function Fr(t){var r=t.read_shift(4);return r===0?"":t.read_shift(r,"dbcs")}function Om(t){return{ich:t.read_shift(2),ifnt:t.read_shift(2)}}function vo(t,r){var a=t.l,s=t.read_shift(1),i=Fr(t),l=[],d={t:i,h:i};if(s&1){for(var v=t.read_shift(4),u=0;u!=v;++u)l.push(Om(t));d.r=l}else d.r=[{ich:0,ifnt:0}];return t.l=a+r,d}var zm=vo;function es(t){var r=t.read_shift(4),a=t.read_shift(2);return a+=t.read_shift(1)<<16,t.l++,{c:r,iStyleRef:a}}function Xs(t){var r=t.read_shift(2);return r+=t.read_shift(1)<<16,t.l++,{c:-1,iStyleRef:r}}var Bm=Fr;function uo(t){var r=t.read_shift(4);return r===0||r===4294967295?"":t.read_shift(r,"dbcs")}var $m=Fr,$n=uo;function fo(t){var r=t.slice(t.l,t.l+4),a=r[0]&1,s=r[0]&2;t.l+=4;var i=s===0?vn([0,0,0,0,r[0]&252,r[1],r[2],r[3]],0):Os(r,0)>>2;return a?i/100:i}function Rc(t){var r={s:{},e:{}};return r.s.r=t.read_shift(4),r.e.r=t.read_shift(4),r.s.c=t.read_shift(4),r.e.c=t.read_shift(4),r}var Ys=Rc;function Sr(t){if(t.length-t.l<8)throw"XLS Xnum Buffer underflow";return t.read_shift(8,"f")}function Um(t){var r={},a=t.read_shift(1),s=a>>>1,i=t.read_shift(1),l=t.read_shift(2,"i"),d=t.read_shift(1),v=t.read_shift(1),u=t.read_shift(1);switch(t.l++,s){case 0:r.auto=1;break;case 1:r.index=i;var f=$s[i];f&&(r.rgb=Li(f));break;case 2:r.rgb=Li([d,v,u]);break;case 3:r.theme=i;break}return l!=0&&(r.tint=l>0?l/32767:l/32768),r}function qm(t){var r=t.read_shift(1);t.l++;var a={fBold:r&1,fItalic:r&2,fUnderline:r&4,fStrikeout:r&8,fOutline:r&16,fShadow:r&32,fCondense:r&64,fExtend:r&128};return a}function Nc(t,r){var a={2:"BITMAP",3:"METAFILEPICT",8:"DIB",14:"ENHMETAFILE"},s=t.read_shift(4);switch(s){case 0:return"";case 4294967295:case 4294967294:return a[t.read_shift(4)]||""}if(s>400)throw new Error("Unsupported Clipboard: "+s.toString(16));return t.l-=4,t.read_shift(0,r==1?"lpstr":"lpwstr")}function jm(t){return Nc(t,1)}function Wm(t){return Nc(t,2)}var po=2,Br=3,Qi=11,ol=12,un=19,Zi=64,Hm=65,Vm=71,Gm=4108,Xm=4126,xr=80,Pc=81,Ym=[xr,Pc],Km={1:{n:"CodePage",t:po},2:{n:"Category",t:xr},3:{n:"PresentationFormat",t:xr},4:{n:"ByteCount",t:Br},5:{n:"LineCount",t:Br},6:{n:"ParagraphCount",t:Br},7:{n:"SlideCount",t:Br},8:{n:"NoteCount",t:Br},9:{n:"HiddenCount",t:Br},10:{n:"MultimediaClipCount",t:Br},11:{n:"ScaleCrop",t:Qi},12:{n:"HeadingPairs",t:Gm},13:{n:"TitlesOfParts",t:Xm},14:{n:"Manager",t:xr},15:{n:"Company",t:xr},16:{n:"LinksUpToDate",t:Qi},17:{n:"CharacterCount",t:Br},19:{n:"SharedDoc",t:Qi},22:{n:"HyperlinksChanged",t:Qi},23:{n:"AppVersion",t:Br,p:"version"},24:{n:"DigSig",t:Hm},26:{n:"ContentType",t:xr},27:{n:"ContentStatus",t:xr},28:{n:"Language",t:xr},29:{n:"Version",t:xr},255:{},2147483648:{n:"Locale",t:un},2147483651:{n:"Behavior",t:un},1919054434:{}},Qm={1:{n:"CodePage",t:po},2:{n:"Title",t:xr},3:{n:"Subject",t:xr},4:{n:"Author",t:xr},5:{n:"Keywords",t:xr},6:{n:"Comments",t:xr},7:{n:"Template",t:xr},8:{n:"LastAuthor",t:xr},9:{n:"RevNumber",t:xr},10:{n:"EditTime",t:Zi},11:{n:"LastPrinted",t:Zi},12:{n:"CreatedDate",t:Zi},13:{n:"ModifiedDate",t:Zi},14:{n:"PageCount",t:Br},15:{n:"WordCount",t:Br},16:{n:"CharCount",t:Br},17:{n:"Thumbnail",t:Vm},18:{n:"Application",t:xr},19:{n:"DocSecurity",t:Br},255:{},2147483648:{n:"Locale",t:un},2147483651:{n:"Behavior",t:un},1919054434:{}},ll={1:"US",2:"CA",3:"",7:"RU",20:"EG",30:"GR",31:"NL",32:"BE",33:"FR",34:"ES",36:"HU",39:"IT",41:"CH",43:"AT",44:"GB",45:"DK",46:"SE",47:"NO",48:"PL",49:"DE",52:"MX",55:"BR",61:"AU",64:"NZ",66:"TH",81:"JP",82:"KR",84:"VN",86:"CN",90:"TR",105:"JS",213:"DZ",216:"MA",218:"LY",351:"PT",354:"IS",358:"FI",420:"CZ",886:"TW",961:"LB",962:"JO",963:"SY",964:"IQ",965:"KW",966:"SA",971:"AE",972:"IL",974:"QA",981:"IR",65535:"US"},Zm=[null,"solid","mediumGray","darkGray","lightGray","darkHorizontal","darkVertical","darkDown","darkUp","darkGrid","darkTrellis","lightHorizontal","lightVertical","lightDown","lightUp","lightGrid","lightTrellis","gray125","gray0625"];function Jm(t){return t.map(function(r){return[r>>16&255,r>>8&255,r&255]})}var e_=Jm([0,16777215,16711680,65280,255,16776960,16711935,65535,0,16777215,16711680,65280,255,16776960,16711935,65535,8388608,32768,128,8421376,8388736,32896,12632256,8421504,10066431,10040166,16777164,13434879,6684774,16744576,26316,13421823,128,16711935,16776960,65535,8388736,8388608,32896,255,52479,13434879,13434828,16777113,10079487,16751052,13408767,16764057,3368703,3394764,10079232,16763904,16750848,16737792,6710937,9868950,13158,3381606,13056,3355392,10040064,10040166,3355545,3355443,16777215,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),$s=kr(e_),Ks={0:"#NULL!",7:"#DIV/0!",15:"#VALUE!",23:"#REF!",29:"#NAME?",36:"#NUM!",42:"#N/A",43:"#GETTING_DATA",255:"#WTF?"},Lc={"#NULL!":0,"#DIV/0!":7,"#VALUE!":15,"#REF!":23,"#NAME?":29,"#NUM!":36,"#N/A":42,"#GETTING_DATA":43,"#WTF?":255},cl={"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet.main+xml":"workbooks","application/vnd.ms-excel.sheet.macroEnabled.main+xml":"workbooks","application/vnd.ms-excel.sheet.binary.macroEnabled.main":"workbooks","application/vnd.ms-excel.addin.macroEnabled.main+xml":"workbooks","application/vnd.openxmlformats-officedocument.spreadsheetml.template.main+xml":"workbooks","application/vnd.openxmlformats-officedocument.spreadsheetml.worksheet+xml":"sheets","application/vnd.ms-excel.worksheet":"sheets","application/vnd.ms-excel.binIndexWs":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.chartsheet+xml":"charts","application/vnd.ms-excel.chartsheet":"charts","application/vnd.ms-excel.macrosheet+xml":"macros","application/vnd.ms-excel.macrosheet":"macros","application/vnd.ms-excel.intlmacrosheet":"TODO","application/vnd.ms-excel.binIndexMs":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.dialogsheet+xml":"dialogs","application/vnd.ms-excel.dialogsheet":"dialogs","application/vnd.openxmlformats-officedocument.spreadsheetml.sharedStrings+xml":"strs","application/vnd.ms-excel.sharedStrings":"strs","application/vnd.openxmlformats-officedocument.spreadsheetml.styles+xml":"styles","application/vnd.ms-excel.styles":"styles","application/vnd.openxmlformats-package.core-properties+xml":"coreprops","application/vnd.openxmlformats-officedocument.custom-properties+xml":"custprops","application/vnd.openxmlformats-officedocument.extended-properties+xml":"extprops","application/vnd.openxmlformats-officedocument.customXmlProperties+xml":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.customProperty":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.comments+xml":"comments","application/vnd.ms-excel.comments":"comments","application/vnd.ms-excel.threadedcomments+xml":"threadedcomments","application/vnd.ms-excel.person+xml":"people","application/vnd.openxmlformats-officedocument.spreadsheetml.sheetMetadata+xml":"metadata","application/vnd.ms-excel.sheetMetadata":"metadata","application/vnd.ms-excel.pivotTable":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.pivotTable+xml":"TODO","application/vnd.openxmlformats-officedocument.drawingml.chart+xml":"TODO","application/vnd.ms-office.chartcolorstyle+xml":"TODO","application/vnd.ms-office.chartstyle+xml":"TODO","application/vnd.ms-office.chartex+xml":"TODO","application/vnd.ms-excel.calcChain":"calcchains","application/vnd.openxmlformats-officedocument.spreadsheetml.calcChain+xml":"calcchains","application/vnd.openxmlformats-officedocument.spreadsheetml.printerSettings":"TODO","application/vnd.ms-office.activeX":"TODO","application/vnd.ms-office.activeX+xml":"TODO","application/vnd.ms-excel.attachedToolbars":"TODO","application/vnd.ms-excel.connections":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.connections+xml":"TODO","application/vnd.ms-excel.externalLink":"links","application/vnd.openxmlformats-officedocument.spreadsheetml.externalLink+xml":"links","application/vnd.ms-excel.pivotCacheDefinition":"TODO","application/vnd.ms-excel.pivotCacheRecords":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.pivotCacheDefinition+xml":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.pivotCacheRecords+xml":"TODO","application/vnd.ms-excel.queryTable":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.queryTable+xml":"TODO","application/vnd.ms-excel.userNames":"TODO","application/vnd.ms-excel.revisionHeaders":"TODO","application/vnd.ms-excel.revisionLog":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.revisionHeaders+xml":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.revisionLog+xml":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.userNames+xml":"TODO","application/vnd.ms-excel.tableSingleCells":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.tableSingleCells+xml":"TODO","application/vnd.ms-excel.slicer":"TODO","application/vnd.ms-excel.slicerCache":"TODO","application/vnd.ms-excel.slicer+xml":"TODO","application/vnd.ms-excel.slicerCache+xml":"TODO","application/vnd.ms-excel.wsSortMap":"TODO","application/vnd.ms-excel.table":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.table+xml":"TODO","application/vnd.openxmlformats-officedocument.theme+xml":"themes","application/vnd.openxmlformats-officedocument.themeOverride+xml":"TODO","application/vnd.ms-excel.Timeline+xml":"TODO","application/vnd.ms-excel.TimelineCache+xml":"TODO","application/vnd.ms-office.vbaProject":"vba","application/vnd.ms-office.vbaProjectSignature":"TODO","application/vnd.ms-office.volatileDependencies":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.volatileDependencies+xml":"TODO","application/vnd.ms-excel.controlproperties+xml":"TODO","application/vnd.openxmlformats-officedocument.model+data":"TODO","application/vnd.ms-excel.Survey+xml":"TODO","application/vnd.openxmlformats-officedocument.drawing+xml":"drawings","application/vnd.openxmlformats-officedocument.drawingml.chartshapes+xml":"TODO","application/vnd.openxmlformats-officedocument.drawingml.diagramColors+xml":"TODO","application/vnd.openxmlformats-officedocument.drawingml.diagramData+xml":"TODO","application/vnd.openxmlformats-officedocument.drawingml.diagramLayout+xml":"TODO","application/vnd.openxmlformats-officedocument.drawingml.diagramStyle+xml":"TODO","application/vnd.openxmlformats-officedocument.vmlDrawing":"TODO","application/vnd.openxmlformats-package.relationships+xml":"rels","application/vnd.openxmlformats-officedocument.oleObject":"TODO","image/png":"TODO",sheet:"js"};function t_(){return{workbooks:[],sheets:[],charts:[],dialogs:[],macros:[],rels:[],strs:[],comments:[],threadedcomments:[],links:[],coreprops:[],extprops:[],custprops:[],themes:[],styles:[],calcchains:[],vba:[],drawings:[],metadata:[],people:[],TODO:[],xmlns:""}}function a_(t){var r=t_();if(!t||!t.match)return r;var a={};if((t.match(Mr)||[]).forEach(function(s){var i=ba(s);switch(i[0].replace(dm,"<")){case"<?xml":break;case"<Types":r.xmlns=i["xmlns"+(i[0].match(/<(\w+):/)||["",""])[1]];break;case"<Default":a[i.Extension]=i.ContentType;break;case"<Override":r[cl[i.ContentType]]!==void 0&&r[cl[i.ContentType]].push(i.PartName);break}}),r.xmlns!==wm.CT)throw new Error("Unknown Namespace: "+r.xmlns);return r.calcchain=r.calcchains.length>0?r.calcchains[0]:"",r.sst=r.strs.length>0?r.strs[0]:"",r.style=r.styles.length>0?r.styles[0]:"",r.defaults=a,delete r.calcchains,r}var ti={WB:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/officeDocument",SHEET:"http://sheetjs.openxmlformats.org/officeDocument/2006/relationships/officeDocument",HLINK:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/hyperlink",VML:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/vmlDrawing",XPATH:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/externalLinkPath",XMISS:"http://schemas.microsoft.com/office/2006/relationships/xlExternalLinkPath/xlPathMissing",XLINK:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/externalLink",CXML:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/customXml",CXMLP:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/customXmlProps",CMNT:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/comments",CORE_PROPS:"http://schemas.openxmlformats.org/package/2006/relationships/metadata/core-properties",EXT_PROPS:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/extended-properties",CUST_PROPS:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/custom-properties",SST:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/sharedStrings",STY:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/styles",THEME:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/theme",CHART:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/chart",CHARTEX:"http://schemas.microsoft.com/office/2014/relationships/chartEx",CS:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/chartsheet",WS:["http://schemas.openxmlformats.org/officeDocument/2006/relationships/worksheet","http://purl.oclc.org/ooxml/officeDocument/relationships/worksheet"],DS:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/dialogsheet",MS:"http://schemas.microsoft.com/office/2006/relationships/xlMacrosheet",IMG:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/image",DRAW:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/drawing",XLMETA:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/sheetMetadata",TCMNT:"http://schemas.microsoft.com/office/2017/10/relationships/threadedComment",PEOPLE:"http://schemas.microsoft.com/office/2017/10/relationships/person",VBA:"http://schemas.microsoft.com/office/2006/relationships/vbaProject"};function Un(t){var r=t.lastIndexOf("/");return t.slice(0,r+1)+"_rels/"+t.slice(r+1)+".rels"}function Ti(t,r){var a={"!id":{}};if(!t)return a;r.charAt(0)!=="/"&&(r="/"+r);var s={};return(t.match(Mr)||[]).forEach(function(i){var l=ba(i);if(l[0]==="<Relationship"){var d={};d.Type=l.Type,d.Target=l.Target,d.Id=l.Id,l.TargetMode&&(d.TargetMode=l.TargetMode);var v=l.TargetMode==="External"?l.Target:gi(l.Target,r);a[v]=d,s[l.Id]=d}}),a["!id"]=s,a}var r_="application/vnd.oasis.opendocument.spreadsheet";function s_(t,r){for(var a=no(t),s,i;s=Ni.exec(a);)switch(s[3]){case"manifest":break;case"file-entry":if(i=ba(s[0],!1),i.path=="/"&&i.type!==r_)throw new Error("This OpenDocument is not a spreadsheet");break;case"encryption-data":case"algorithm":case"start-key-generation":case"key-derivation":throw new Error("Unsupported ODS Encryption");default:if(r&&r.WTF)throw s}}var Ei=[["cp:category","Category"],["cp:contentStatus","ContentStatus"],["cp:keywords","Keywords"],["cp:lastModifiedBy","LastAuthor"],["cp:lastPrinted","LastPrinted"],["cp:revision","RevNumber"],["cp:version","Version"],["dc:creator","Author"],["dc:description","Comments"],["dc:identifier","Identifier"],["dc:language","Language"],["dc:subject","Subject"],["dc:title","Title"],["dcterms:created","CreatedDate","date"],["dcterms:modified","ModifiedDate","date"]],i_=function(){for(var t=new Array(Ei.length),r=0;r<Ei.length;++r){var a=Ei[r],s="(?:"+a[0].slice(0,a[0].indexOf(":"))+":)"+a[0].slice(a[0].indexOf(":")+1);t[r]=new RegExp("<"+s+"[^>]*>([\\s\\S]*?)</"+s+">")}return t}();function Oc(t){var r={};t=Ka(t);for(var a=0;a<Ei.length;++a){var s=Ei[a],i=t.match(i_[a]);i!=null&&i.length>0&&(r[s[1]]=Ua(i[1])),s[2]==="date"&&r[s[1]]&&(r[s[1]]=br(r[s[1]]))}return r}var n_=[["Application","Application","string"],["AppVersion","AppVersion","string"],["Company","Company","string"],["DocSecurity","DocSecurity","string"],["Manager","Manager","string"],["HyperlinksChanged","HyperlinksChanged","bool"],["SharedDoc","SharedDoc","bool"],["LinksUpToDate","LinksUpToDate","bool"],["ScaleCrop","ScaleCrop","bool"],["HeadingPairs","HeadingPairs","raw"],["TitlesOfParts","TitlesOfParts","raw"]];function zc(t,r,a,s){var i=[];if(typeof t=="string")i=Jo(t,s);else for(var l=0;l<t.length;++l)i=i.concat(t[l].map(function(h){return{v:h}}));var d=typeof r=="string"?Jo(r,s).map(function(h){return h.v}):r,v=0,u=0;if(d.length>0)for(var f=0;f!==i.length;f+=2){switch(u=+i[f+1].v,i[f].v){case"Worksheets":case"工作表":case"Листы":case"أوراق العمل":case"ワークシート":case"גליונות עבודה":case"Arbeitsblätter":case"Çalışma Sayfaları":case"Feuilles de calcul":case"Fogli di lavoro":case"Folhas de cálculo":case"Planilhas":case"Regneark":case"Hojas de cálculo":case"Werkbladen":a.Worksheets=u,a.SheetNames=d.slice(v,v+u);break;case"Named Ranges":case"Rangos con nombre":case"名前付き一覧":case"Benannte Bereiche":case"Navngivne områder":a.NamedRanges=u,a.DefinedNames=d.slice(v,v+u);break;case"Charts":case"Diagramme":a.Chartsheets=u,a.ChartNames=d.slice(v,v+u);break}v+=u}}function o_(t,r,a){var s={};return r||(r={}),t=Ka(t),n_.forEach(function(i){var l=(t.match(Ri(i[0]))||[])[1];switch(i[2]){case"string":l&&(r[i[1]]=Ua(l));break;case"bool":r[i[1]]=l==="true";break;case"raw":var d=t.match(new RegExp("<"+i[0]+"[^>]*>([\\s\\S]*?)</"+i[0]+">"));d&&d.length>0&&(s[i[1]]=d[1]);break}}),s.HeadingPairs&&s.TitlesOfParts&&zc(s.HeadingPairs,s.TitlesOfParts,r,a),r}var l_=/<[^>]+>[^<]*/g;function c_(t,r){var a={},s="",i=t.match(l_);if(i)for(var l=0;l!=i.length;++l){var d=i[l],v=ba(d);switch(v[0]){case"<?xml":break;case"<Properties":break;case"<property":s=Ua(v.name);break;case"</property>":s=null;break;default:if(d.indexOf("<vt:")===0){var u=d.split(">"),f=u[0].slice(4),h=u[1];switch(f){case"lpstr":case"bstr":case"lpwstr":a[s]=Ua(h);break;case"bool":a[s]=er(h);break;case"i1":case"i2":case"i4":case"i8":case"int":case"uint":a[s]=parseInt(h,10);break;case"r4":case"r8":case"decimal":a[s]=parseFloat(h);break;case"filetime":case"date":a[s]=br(h);break;case"cy":case"error":a[s]=Ua(h);break;default:if(f.slice(-1)=="/")break;r.WTF&&typeof console<"u"&&console.warn("Unexpected",d,f,u)}}else if(d.slice(0,2)!=="</"){if(r.WTF)throw new Error(d)}}}return a}var d_={Title:"Title",Subject:"Subject",Author:"Author",Keywords:"Keywords",Comments:"Description",LastAuthor:"LastAuthor",RevNumber:"Revision",Application:"AppName",LastPrinted:"LastPrinted",CreatedDate:"Created",ModifiedDate:"LastSaved",Category:"Category",Manager:"Manager",Company:"Company",AppVersion:"Version",ContentStatus:"ContentStatus",Identifier:"Identifier",Language:"Language"},In;function v_(t,r,a){In||(In=ro(d_)),r=In[r]||r,t[r]=a}function ho(t){var r=t.read_shift(4),a=t.read_shift(4);return new Date((a/1e7*Math.pow(2,32)+r/1e7-11644473600)*1e3).toISOString().replace(/\.000/,"")}function Bc(t,r,a){var s=t.l,i=t.read_shift(0,"lpstr-cp");if(a)for(;t.l-s&3;)++t.l;return i}function $c(t,r,a){var s=t.read_shift(0,"lpwstr");return s}function Uc(t,r,a){return r===31?$c(t):Bc(t,r,a)}function qn(t,r,a){return Uc(t,r,a===!1?0:4)}function u_(t,r){if(!r)throw new Error("VtUnalignedString must have positive length");return Uc(t,r,0)}function f_(t){for(var r=t.read_shift(4),a=[],s=0;s!=r;++s){var i=t.l;a[s]=t.read_shift(0,"lpwstr").replace(Lr,""),t.l-i&2&&(t.l+=2)}return a}function p_(t){for(var r=t.read_shift(4),a=[],s=0;s!=r;++s)a[s]=t.read_shift(0,"lpstr-cp").replace(Lr,"");return a}function h_(t){var r=t.l,a=fn(t,Pc);t[t.l]==0&&t[t.l+1]==0&&t.l-r&2&&(t.l+=2);var s=fn(t,Br);return[a,s]}function m_(t){for(var r=t.read_shift(4),a=[],s=0;s<r/2;++s)a.push(h_(t));return a}function dl(t,r){for(var a=t.read_shift(4),s={},i=0;i!=a;++i){var l=t.read_shift(4),d=t.read_shift(4);s[l]=t.read_shift(d,r===1200?"utf16le":"utf8").replace(Lr,"").replace(_i,"!"),r===1200&&d%2&&(t.l+=2)}return t.l&3&&(t.l=t.l>>3<<2),s}function qc(t){var r=t.read_shift(4),a=t.slice(t.l,t.l+r);return t.l+=r,(r&3)>0&&(t.l+=4-(r&3)&3),a}function __(t){var r={};return r.Size=t.read_shift(4),t.l+=r.Size+3-(r.Size-1)%4,r}function fn(t,r,a){var s=t.read_shift(2),i,l=a||{};if(t.l+=2,r!==ol&&s!==r&&Ym.indexOf(r)===-1&&!((r&65534)==4126&&(s&65534)==4126))throw new Error("Expected type "+r+" saw "+s);switch(r===ol?s:r){case 2:return i=t.read_shift(2,"i"),l.raw||(t.l+=2),i;case 3:return i=t.read_shift(4,"i"),i;case 11:return t.read_shift(4)!==0;case 19:return i=t.read_shift(4),i;case 30:return Bc(t,s,4).replace(Lr,"");case 31:return $c(t);case 64:return ho(t);case 65:return qc(t);case 71:return __(t);case 80:return qn(t,s,!l.raw).replace(Lr,"");case 81:return u_(t,s).replace(Lr,"");case 4108:return m_(t);case 4126:case 4127:return s==4127?f_(t):p_(t);default:throw new Error("TypedPropertyValue unrecognized type "+r+" "+s)}}function vl(t,r){var a=t.l,s=t.read_shift(4),i=t.read_shift(4),l=[],d=0,v=0,u=-1,f={};for(d=0;d!=i;++d){var h=t.read_shift(4),_=t.read_shift(4);l[d]=[h,_+a]}l.sort(function(z,F){return z[1]-F[1]});var x={};for(d=0;d!=i;++d){if(t.l!==l[d][1]){var T=!0;if(d>0&&r)switch(r[l[d-1][0]].t){case 2:t.l+2===l[d][1]&&(t.l+=2,T=!1);break;case 80:t.l<=l[d][1]&&(t.l=l[d][1],T=!1);break;case 4108:t.l<=l[d][1]&&(t.l=l[d][1],T=!1);break}if((!r||d==0)&&t.l<=l[d][1]&&(T=!1,t.l=l[d][1]),T)throw new Error("Read Error: Expected address "+l[d][1]+" at "+t.l+" :"+d)}if(r){var b=r[l[d][0]];if(x[b.n]=fn(t,b.t,{raw:!0}),b.p==="version"&&(x[b.n]=String(x[b.n]>>16)+"."+("0000"+String(x[b.n]&65535)).slice(-4)),b.n=="CodePage")switch(x[b.n]){case 0:x[b.n]=1252;case 874:case 932:case 936:case 949:case 950:case 1250:case 1251:case 1253:case 1254:case 1255:case 1256:case 1257:case 1258:case 1e4:case 1200:case 1201:case 1252:case 65e3:case-536:case 65001:case-535:ns(v=x[b.n]>>>0&65535);break;default:throw new Error("Unsupported CodePage: "+x[b.n])}}else if(l[d][0]===1){if(v=x.CodePage=fn(t,po),ns(v),u!==-1){var w=t.l;t.l=l[u][1],f=dl(t,v),t.l=w}}else if(l[d][0]===0){if(v===0){u=d,t.l=l[d+1][1];continue}f=dl(t,v)}else{var A=f[l[d][0]],C;switch(t[t.l]){case 65:t.l+=4,C=qc(t);break;case 30:t.l+=4,C=qn(t,t[t.l-4]).replace(/\u0000+$/,"");break;case 31:t.l+=4,C=qn(t,t[t.l-4]).replace(/\u0000+$/,"");break;case 3:t.l+=4,C=t.read_shift(4,"i");break;case 19:t.l+=4,C=t.read_shift(4);break;case 5:t.l+=4,C=t.read_shift(8,"f");break;case 11:t.l+=4,C=vr(t,4);break;case 64:t.l+=4,C=br(ho(t));break;default:throw new Error("unparsed value: "+t[t.l])}x[A]=C}}return t.l=a+s,x}function ul(t,r,a){var s=t.content;if(!s)return{};wr(s,0);var i,l,d,v,u=0;s.chk("feff","Byte Order: "),s.read_shift(2);var f=s.read_shift(4),h=s.read_shift(16);if(h!==Oa.utils.consts.HEADER_CLSID&&h!==a)throw new Error("Bad PropertySet CLSID "+h);if(i=s.read_shift(4),i!==1&&i!==2)throw new Error("Unrecognized #Sets: "+i);if(l=s.read_shift(16),v=s.read_shift(4),i===1&&v!==s.l)throw new Error("Length mismatch: "+v+" !== "+s.l);i===2&&(d=s.read_shift(16),u=s.read_shift(4));var _=vl(s,r),x={SystemIdentifier:f};for(var T in _)x[T]=_[T];if(x.FMTID=l,i===1)return x;if(u-s.l==2&&(s.l+=2),s.l!==u)throw new Error("Length mismatch 2: "+s.l+" !== "+u);var b;try{b=vl(s,null)}catch{}for(T in b)x[T]=b[T];return x.FMTID=[l,d],x}function As(t,r){return t.read_shift(r),null}function g_(t,r,a){for(var s=[],i=t.l+r;t.l<i;)s.push(a(t,i-t.l));if(i!==t.l)throw new Error("Slurp error");return s}function vr(t,r){return t.read_shift(r)===1}function pr(t){return t.read_shift(2,"u")}function jc(t,r){return g_(t,r,pr)}function x_(t){var r=t.read_shift(1),a=t.read_shift(1);return a===1?r:r===1}function qi(t,r,a){var s=t.read_shift(a&&a.biff>=12?2:1),i="sbcs-cont";if(a&&a.biff>=8,!a||a.biff==8){var l=t.read_shift(1);l&&(i="dbcs-cont")}else a.biff==12&&(i="wstr");a.biff>=2&&a.biff<=5&&(i="cpstr");var d=s?t.read_shift(s,i):"";return d}function b_(t){var r=t.read_shift(2),a=t.read_shift(1),s=a&4,i=a&8,l=1+(a&1),d=0,v,u={};i&&(d=t.read_shift(2)),s&&(v=t.read_shift(4));var f=l==2?"dbcs-cont":"sbcs-cont",h=r===0?"":t.read_shift(r,f);return i&&(t.l+=4*d),s&&(t.l+=v),u.t=h,i||(u.raw="<t>"+u.t+"</t>",u.r=u.t),u}function Hs(t,r,a){var s;if(a){if(a.biff>=2&&a.biff<=5)return t.read_shift(r,"cpstr");if(a.biff>=12)return t.read_shift(r,"dbcs-cont")}var i=t.read_shift(1);return i===0?s=t.read_shift(r,"sbcs-cont"):s=t.read_shift(r,"dbcs-cont"),s}function ji(t,r,a){var s=t.read_shift(a&&a.biff==2?1:2);return s===0?(t.l++,""):Hs(t,s,a)}function Qs(t,r,a){if(a.biff>5)return ji(t,r,a);var s=t.read_shift(1);return s===0?(t.l++,""):t.read_shift(s,a.biff<=4||!t.lens?"cpstr":"sbcs-cont")}function w_(t){var r=t.read_shift(1);t.l++;var a=t.read_shift(2);return t.l+=2,[r,a]}function y_(t){var r=t.read_shift(4),a=t.l,s=!1;r>24&&(t.l+=r-24,t.read_shift(16)==="795881f43b1d7f48af2c825dc4852763"&&(s=!0),t.l=a);var i=t.read_shift((s?r-24:r)>>1,"utf16le").replace(Lr,"");return s&&(t.l+=24),i}function k_(t){for(var r=t.read_shift(2),a="";r-- >0;)a+="../";var s=t.read_shift(0,"lpstr-ansi");if(t.l+=2,t.read_shift(2)!=57005)throw new Error("Bad FileMoniker");var i=t.read_shift(4);if(i===0)return a+s.replace(/\\/g,"/");var l=t.read_shift(4);if(t.read_shift(2)!=3)throw new Error("Bad FileMoniker");var d=t.read_shift(l>>1,"utf16le").replace(Lr,"");return a+d}function T_(t,r){var a=t.read_shift(16);switch(a){case"e0c9ea79f9bace118c8200aa004ba90b":return y_(t);case"0303000000000000c000000000000046":return k_(t);default:throw new Error("Unsupported Moniker "+a)}}function Ji(t){var r=t.read_shift(4),a=r>0?t.read_shift(r,"utf16le").replace(Lr,""):"";return a}function E_(t,r){var a=t.l+r,s=t.read_shift(4);if(s!==2)throw new Error("Unrecognized streamVersion: "+s);var i=t.read_shift(2);t.l+=2;var l,d,v,u,f="",h,_;i&16&&(l=Ji(t,a-t.l)),i&128&&(d=Ji(t,a-t.l)),(i&257)===257&&(v=Ji(t,a-t.l)),(i&257)===1&&(u=T_(t,a-t.l)),i&8&&(f=Ji(t,a-t.l)),i&32&&(h=t.read_shift(16)),i&64&&(_=ho(t)),t.l=a;var x=d||v||u||"";x&&f&&(x+="#"+f),x||(x="#"+f),i&2&&x.charAt(0)=="/"&&x.charAt(1)!="/"&&(x="file://"+x);var T={Target:x};return h&&(T.guid=h),_&&(T.time=_),l&&(T.Tooltip=l),T}function Wc(t){var r=t.read_shift(1),a=t.read_shift(1),s=t.read_shift(1),i=t.read_shift(1);return[r,a,s,i]}function Hc(t,r){var a=Wc(t);return a[3]=0,a}function hs(t){var r=t.read_shift(2),a=t.read_shift(2),s=t.read_shift(2);return{r,c:a,ixfe:s}}function A_(t){var r=t.read_shift(2),a=t.read_shift(2);return t.l+=8,{type:r,flags:a}}function S_(t,r,a){return r===0?"":Qs(t,r,a)}function C_(t,r,a){var s=a.biff>8?4:2,i=t.read_shift(s),l=t.read_shift(s,"i"),d=t.read_shift(s,"i");return[i,l,d]}function Vc(t){var r=t.read_shift(2),a=fo(t);return[r,a]}function F_(t,r,a){t.l+=4,r-=4;var s=t.l+r,i=qi(t,r,a),l=t.read_shift(2);if(s-=t.l,l!==s)throw new Error("Malformed AddinUdf: padding = "+s+" != "+l);return t.l+=l,i}function bn(t){var r=t.read_shift(2),a=t.read_shift(2),s=t.read_shift(2),i=t.read_shift(2);return{s:{c:s,r},e:{c:i,r:a}}}function Gc(t){var r=t.read_shift(2),a=t.read_shift(2),s=t.read_shift(1),i=t.read_shift(1);return{s:{c:s,r},e:{c:i,r:a}}}var D_=Gc;function Xc(t){t.l+=4;var r=t.read_shift(2),a=t.read_shift(2),s=t.read_shift(2);return t.l+=12,[a,r,s]}function M_(t){var r={};return t.l+=4,t.l+=16,r.fSharedNote=t.read_shift(2),t.l+=4,r}function I_(t){var r={};return t.l+=4,t.cf=t.read_shift(2),r}function Er(t){t.l+=2,t.l+=t.read_shift(2)}var R_={0:Er,4:Er,5:Er,6:Er,7:I_,8:Er,9:Er,10:Er,11:Er,12:Er,13:M_,14:Er,15:Er,16:Er,17:Er,18:Er,19:Er,20:Er,21:Xc};function N_(t,r){for(var a=t.l+r,s=[];t.l<a;){var i=t.read_shift(2);t.l-=2;try{s.push(R_[i](t,a-t.l))}catch{return t.l=a,s}}return t.l!=a&&(t.l=a),s}function en(t,r){var a={BIFFVer:0,dt:0};switch(a.BIFFVer=t.read_shift(2),r-=2,r>=2&&(a.dt=t.read_shift(2),t.l-=2),a.BIFFVer){case 1536:case 1280:case 1024:case 768:case 512:case 2:case 7:break;default:if(r>6)throw new Error("Unexpected BIFF Ver "+a.BIFFVer)}return t.read_shift(r),a}function P_(t,r){return r===0||t.read_shift(2),1200}function L_(t,r,a){if(a.enc)return t.l+=r,"";var s=t.l,i=Qs(t,0,a);return t.read_shift(r+s-t.l),i}function O_(t,r,a){var s=a&&a.biff==8||r==2?t.read_shift(2):(t.l+=r,0);return{fDialog:s&16,fBelow:s&64,fRight:s&128}}function z_(t,r,a){var s=t.read_shift(4),i=t.read_shift(1)&3,l=t.read_shift(1);switch(l){case 0:l="Worksheet";break;case 1:l="Macrosheet";break;case 2:l="Chartsheet";break;case 6:l="VBAModule";break}var d=qi(t,0,a);return d.length===0&&(d="Sheet1"),{pos:s,hs:i,dt:l,name:d}}function B_(t,r){for(var a=t.l+r,s=t.read_shift(4),i=t.read_shift(4),l=[],d=0;d!=i&&t.l<a;++d)l.push(b_(t));return l.Count=s,l.Unique=i,l}function $_(t,r){var a={};return a.dsst=t.read_shift(2),t.l+=r-2,a}function U_(t){var r={};r.r=t.read_shift(2),r.c=t.read_shift(2),r.cnt=t.read_shift(2)-r.c;var a=t.read_shift(2);t.l+=4;var s=t.read_shift(1);return t.l+=3,s&7&&(r.level=s&7),s&32&&(r.hidden=!0),s&64&&(r.hpt=a/20),r}function q_(t){var r=A_(t);if(r.type!=2211)throw new Error("Invalid Future Record "+r.type);var a=t.read_shift(4);return a!==0}function j_(t){return t.read_shift(2),t.read_shift(4)}function fl(t,r,a){var s=0;a&&a.biff==2||(s=t.read_shift(2));var i=t.read_shift(2);a&&a.biff==2&&(s=1-(i>>15),i&=32767);var l={Unsynced:s&1,DyZero:(s&2)>>1,ExAsc:(s&4)>>2,ExDsc:(s&8)>>3};return[l,i]}function W_(t){var r=t.read_shift(2),a=t.read_shift(2),s=t.read_shift(2),i=t.read_shift(2),l=t.read_shift(2),d=t.read_shift(2),v=t.read_shift(2),u=t.read_shift(2),f=t.read_shift(2);return{Pos:[r,a],Dim:[s,i],Flags:l,CurTab:d,FirstTab:v,Selected:u,TabRatio:f}}function H_(t,r,a){if(a&&a.biff>=2&&a.biff<5)return{};var s=t.read_shift(2);return{RTL:s&64}}function V_(){}function G_(t,r,a){var s={dyHeight:t.read_shift(2),fl:t.read_shift(2)};switch(a&&a.biff||8){case 2:break;case 3:case 4:t.l+=2;break;default:t.l+=10;break}return s.name=qi(t,0,a),s}function X_(t){var r=hs(t);return r.isst=t.read_shift(4),r}function Y_(t,r,a){a.biffguess&&a.biff==2&&(a.biff=5);var s=t.l+r,i=hs(t);a.biff==2&&t.l++;var l=ji(t,s-t.l,a);return i.val=l,i}function K_(t,r,a){var s=t.read_shift(2),i=Qs(t,0,a);return[s,i]}var Q_=Qs;function pl(t,r,a){var s=t.l+r,i=a.biff==8||!a.biff?4:2,l=t.read_shift(i),d=t.read_shift(i),v=t.read_shift(2),u=t.read_shift(2);return t.l=s,{s:{r:l,c:v},e:{r:d,c:u}}}function Z_(t){var r=t.read_shift(2),a=t.read_shift(2),s=Vc(t);return{r,c:a,ixfe:s[0],rknum:s[1]}}function J_(t,r){for(var a=t.l+r-2,s=t.read_shift(2),i=t.read_shift(2),l=[];t.l<a;)l.push(Vc(t));if(t.l!==a)throw new Error("MulRK read error");var d=t.read_shift(2);if(l.length!=d-i+1)throw new Error("MulRK length mismatch");return{r:s,c:i,C:d,rkrec:l}}function eg(t,r){for(var a=t.l+r-2,s=t.read_shift(2),i=t.read_shift(2),l=[];t.l<a;)l.push(t.read_shift(2));if(t.l!==a)throw new Error("MulBlank read error");var d=t.read_shift(2);if(l.length!=d-i+1)throw new Error("MulBlank length mismatch");return{r:s,c:i,C:d,ixfe:l}}function tg(t,r,a,s){var i={},l=t.read_shift(4),d=t.read_shift(4),v=t.read_shift(4),u=t.read_shift(2);return i.patternType=Zm[v>>26],s.cellStyles&&(i.alc=l&7,i.fWrap=l>>3&1,i.alcV=l>>4&7,i.fJustLast=l>>7&1,i.trot=l>>8&255,i.cIndent=l>>16&15,i.fShrinkToFit=l>>20&1,i.iReadOrder=l>>22&2,i.fAtrNum=l>>26&1,i.fAtrFnt=l>>27&1,i.fAtrAlc=l>>28&1,i.fAtrBdr=l>>29&1,i.fAtrPat=l>>30&1,i.fAtrProt=l>>31&1,i.dgLeft=d&15,i.dgRight=d>>4&15,i.dgTop=d>>8&15,i.dgBottom=d>>12&15,i.icvLeft=d>>16&127,i.icvRight=d>>23&127,i.grbitDiag=d>>30&3,i.icvTop=v&127,i.icvBottom=v>>7&127,i.icvDiag=v>>14&127,i.dgDiag=v>>21&15,i.icvFore=u&127,i.icvBack=u>>7&127,i.fsxButton=u>>14&1),i}function ag(t,r,a){var s={};return s.ifnt=t.read_shift(2),s.numFmtId=t.read_shift(2),s.flags=t.read_shift(2),s.fStyle=s.flags>>2&1,r-=6,s.data=tg(t,r,s.fStyle,a),s}function rg(t){t.l+=4;var r=[t.read_shift(2),t.read_shift(2)];if(r[0]!==0&&r[0]--,r[1]!==0&&r[1]--,r[0]>7||r[1]>7)throw new Error("Bad Gutters: "+r.join("|"));return r}function hl(t,r,a){var s=hs(t);(a.biff==2||r==9)&&++t.l;var i=x_(t);return s.val=i,s.t=i===!0||i===!1?"b":"e",s}function sg(t,r,a){a.biffguess&&a.biff==2&&(a.biff=5);var s=hs(t),i=Sr(t);return s.val=i,s}var ml=S_;function ig(t,r,a){var s=t.l+r,i=t.read_shift(2),l=t.read_shift(2);if(a.sbcch=l,l==1025||l==14849)return[l,i];if(l<1||l>255)throw new Error("Unexpected SupBook type: "+l);for(var d=Hs(t,l),v=[];s>t.l;)v.push(ji(t));return[l,i,d,v]}function _l(t,r,a){var s=t.read_shift(2),i,l={fBuiltIn:s&1,fWantAdvise:s>>>1&1,fWantPict:s>>>2&1,fOle:s>>>3&1,fOleLink:s>>>4&1,cf:s>>>5&1023,fIcon:s>>>15&1};return a.sbcch===14849&&(i=F_(t,r-2,a)),l.body=i||t.read_shift(r-2),typeof i=="string"&&(l.Name=i),l}var ng=["_xlnm.Consolidate_Area","_xlnm.Auto_Open","_xlnm.Auto_Close","_xlnm.Extract","_xlnm.Database","_xlnm.Criteria","_xlnm.Print_Area","_xlnm.Print_Titles","_xlnm.Recorder","_xlnm.Data_Form","_xlnm.Auto_Activate","_xlnm.Auto_Deactivate","_xlnm.Sheet_Title","_xlnm._FilterDatabase"];function gl(t,r,a){var s=t.l+r,i=t.read_shift(2),l=t.read_shift(1),d=t.read_shift(1),v=t.read_shift(a&&a.biff==2?1:2),u=0;(!a||a.biff>=5)&&(a.biff!=5&&(t.l+=2),u=t.read_shift(2),a.biff==5&&(t.l+=2),t.l+=4);var f=Hs(t,d,a);i&32&&(f=ng[f.charCodeAt(0)]);var h=s-t.l;a&&a.biff==2&&--h;var _=s==t.l||v===0||!(h>0)?[]:Ub(t,h,a,v);return{chKey:l,Name:f,itab:u,rgce:_}}function Yc(t,r,a){if(a.biff<8)return og(t,r,a);for(var s=[],i=t.l+r,l=t.read_shift(a.biff>8?4:2);l--!==0;)s.push(C_(t,a.biff>8?12:6,a));if(t.l!=i)throw new Error("Bad ExternSheet: "+t.l+" != "+i);return s}function og(t,r,a){t[t.l+1]==3&&t[t.l]++;var s=qi(t,r,a);return s.charCodeAt(0)==3?s.slice(1):s}function lg(t,r,a){if(a.biff<8){t.l+=r;return}var s=t.read_shift(2),i=t.read_shift(2),l=Hs(t,s,a),d=Hs(t,i,a);return[l,d]}function cg(t,r,a){var s=Gc(t);t.l++;var i=t.read_shift(1);return r-=8,[qb(t,r,a),i,s]}function xl(t,r,a){var s=D_(t);switch(a.biff){case 2:t.l++,r-=7;break;case 3:case 4:t.l+=2,r-=8;break;default:t.l+=6,r-=12}return[s,Bb(t,r,a)]}function dg(t){var r=t.read_shift(4)!==0,a=t.read_shift(4)!==0,s=t.read_shift(4);return[r,a,s]}function vg(t,r,a){if(!(a.biff<8)){var s=t.read_shift(2),i=t.read_shift(2),l=t.read_shift(2),d=t.read_shift(2),v=Qs(t,0,a);return a.biff<8&&t.read_shift(1),[{r:s,c:i},v,d,l]}}function ug(t,r,a){return vg(t,r,a)}function fg(t,r){for(var a=[],s=t.read_shift(2);s--;)a.push(bn(t));return a}function pg(t,r,a){if(a&&a.biff<8)return mg(t,r,a);var s=Xc(t),i=N_(t,r-22,s[1]);return{cmo:s,ft:i}}var hg={8:function(t,r){var a=t.l+r;t.l+=10;var s=t.read_shift(2);t.l+=4,t.l+=2,t.l+=2,t.l+=2,t.l+=4;var i=t.read_shift(1);return t.l+=i,t.l=a,{fmt:s}}};function mg(t,r,a){t.l+=4;var s=t.read_shift(2),i=t.read_shift(2),l=t.read_shift(2);t.l+=2,t.l+=2,t.l+=2,t.l+=2,t.l+=2,t.l+=2,t.l+=2,t.l+=2,t.l+=2,t.l+=6,r-=36;var d=[];return d.push((hg[s]||Dr)(t,r,a)),{cmo:[i,s,l],ft:d}}function _g(t,r,a){var s=t.l,i="";try{t.l+=4;var l=(a.lastobj||{cmo:[0,0]}).cmo[1],d;[0,5,7,11,12,14].indexOf(l)==-1?t.l+=6:d=w_(t,6,a);var v=t.read_shift(2);t.read_shift(2),pr(t,2);var u=t.read_shift(2);t.l+=u;for(var f=1;f<t.lens.length-1;++f){if(t.l-s!=t.lens[f])throw new Error("TxO: bad continue record");var h=t[t.l],_=Hs(t,t.lens[f+1]-t.lens[f]-1);if(i+=_,i.length>=(h?v:2*v))break}if(i.length!==v&&i.length!==v*2)throw new Error("cchText: "+v+" != "+i.length);return t.l=s+r,{t:i}}catch{return t.l=s+r,{t:i}}}function gg(t,r){var a=bn(t);t.l+=16;var s=E_(t,r-24);return[a,s]}function xg(t,r){t.read_shift(2);var a=bn(t),s=t.read_shift((r-10)/2,"dbcs-cont");return s=s.replace(Lr,""),[a,s]}function bg(t){var r=[0,0],a;return a=t.read_shift(2),r[0]=ll[a]||a,a=t.read_shift(2),r[1]=ll[a]||a,r}function wg(t){for(var r=t.read_shift(2),a=[];r-- >0;)a.push(Hc(t));return a}function yg(t){for(var r=t.read_shift(2),a=[];r-- >0;)a.push(Hc(t));return a}function kg(t){t.l+=2;var r={cxfs:0,crc:0};return r.cxfs=t.read_shift(2),r.crc=t.read_shift(4),r}function Kc(t,r,a){if(!a.cellStyles)return Dr(t,r);var s=a&&a.biff>=12?4:2,i=t.read_shift(s),l=t.read_shift(s),d=t.read_shift(s),v=t.read_shift(s),u=t.read_shift(2);s==2&&(t.l+=2);var f={s:i,e:l,w:d,ixfe:v,flags:u};return(a.biff>=5||!a.biff)&&(f.level=u>>8&7),f}function Tg(t,r){var a={};return r<32||(t.l+=16,a.header=Sr(t),a.footer=Sr(t),t.l+=2),a}function Eg(t,r,a){var s={area:!1};if(a.biff!=5)return t.l+=r,s;var i=t.read_shift(1);return t.l+=3,i&16&&(s.area=!0),s}var Ag=hs,Sg=jc,Cg=ji;function Fg(t){var r=t.read_shift(2),a=t.read_shift(2),s=t.read_shift(4),i={fmt:r,env:a,len:s,data:t.slice(t.l,t.l+s)};return t.l+=s,i}function Dg(t,r,a){a.biffguess&&a.biff==5&&(a.biff=2);var s=hs(t);++t.l;var i=Qs(t,r-7,a);return s.t="str",s.val=i,s}function Mg(t){var r=hs(t);++t.l;var a=Sr(t);return r.t="n",r.val=a,r}function Ig(t){var r=hs(t);++t.l;var a=t.read_shift(2);return r.t="n",r.val=a,r}function Rg(t){var r=t.read_shift(1);return r===0?(t.l++,""):t.read_shift(r,"sbcs-cont")}function Ng(t,r){t.l+=6,t.l+=2,t.l+=1,t.l+=3,t.l+=1,t.l+=r-13}function Pg(t,r,a){var s=t.l+r,i=hs(t),l=t.read_shift(2),d=Hs(t,l,a);return t.l=s,i.t="str",i.val=d,i}var Lg=[2,3,48,49,131,139,140,245],bl=function(){var t={1:437,2:850,3:1252,4:1e4,100:852,101:866,102:865,103:861,104:895,105:620,106:737,107:857,120:950,121:949,122:936,123:932,124:874,125:1255,126:1256,150:10007,151:10029,152:10006,200:1250,201:1251,202:1254,203:1253,0:20127,8:865,9:437,10:850,11:437,13:437,14:850,15:437,16:850,17:437,18:850,19:932,20:850,21:437,22:850,23:865,24:437,25:437,26:850,27:437,28:863,29:850,31:852,34:852,35:852,36:860,37:850,38:866,55:850,64:852,77:936,78:949,79:950,80:874,87:1252,88:1252,89:1252,108:863,134:737,135:852,136:857,204:1257,255:16969},r=ro({1:437,2:850,3:1252,4:1e4,100:852,101:866,102:865,103:861,104:895,105:620,106:737,107:857,120:950,121:949,122:936,123:932,124:874,125:1255,126:1256,150:10007,151:10029,152:10006,200:1250,201:1251,202:1254,203:1253,0:20127});function a(v,u){var f=[],h=Is(1);switch(u.type){case"base64":h=is(Gr(v));break;case"binary":h=is(v);break;case"buffer":case"array":h=v;break}wr(h,0);var _=h.read_shift(1),x=!!(_&136),T=!1,b=!1;switch(_){case 2:break;case 3:break;case 48:T=!0,x=!0;break;case 49:T=!0,x=!0;break;case 131:break;case 139:break;case 140:b=!0;break;case 245:break;default:throw new Error("DBF Unsupported Version: "+_.toString(16))}var w=0,A=521;_==2&&(w=h.read_shift(2)),h.l+=3,_!=2&&(w=h.read_shift(4)),w>1048576&&(w=1e6),_!=2&&(A=h.read_shift(2));var C=h.read_shift(2),z=u.codepage||1252;_!=2&&(h.l+=16,h.read_shift(1),h[h.l]!==0&&(z=t[h[h.l]]),h.l+=1,h.l+=2),b&&(h.l+=36);for(var F=[],re={},me=Math.min(h.length,_==2?521:A-10-(T?264:0)),ue=b?32:11;h.l<me&&h[h.l]!=13;)switch(re={},re.name=Mi.utils.decode(z,h.slice(h.l,h.l+ue)).replace(/[\u0000\r\n].*$/g,""),h.l+=ue,re.type=String.fromCharCode(h.read_shift(1)),_!=2&&!b&&(re.offset=h.read_shift(4)),re.len=h.read_shift(1),_==2&&(re.offset=h.read_shift(2)),re.dec=h.read_shift(1),re.name.length&&F.push(re),_!=2&&(h.l+=b?13:14),re.type){case"B":(!T||re.len!=8)&&u.WTF&&console.log("Skipping "+re.name+":"+re.type);break;case"G":case"P":u.WTF&&console.log("Skipping "+re.name+":"+re.type);break;case"+":case"0":case"@":case"C":case"D":case"F":case"I":case"L":case"M":case"N":case"O":case"T":case"Y":break;default:throw new Error("Unknown Field Type: "+re.type)}if(h[h.l]!==13&&(h.l=A-1),h.read_shift(1)!==13)throw new Error("DBF Terminator not found "+h.l+" "+h[h.l]);h.l=A;var D=0,E=0;for(f[0]=[],E=0;E!=F.length;++E)f[0][E]=F[E].name;for(;w-- >0;){if(h[h.l]===42){h.l+=C;continue}for(++h.l,f[++D]=[],E=0,E=0;E!=F.length;++E){var he=h.slice(h.l,h.l+F[E].len);h.l+=F[E].len,wr(he,0);var xe=Mi.utils.decode(z,he);switch(F[E].type){case"C":xe.trim().length&&(f[D][E]=xe.replace(/\s+$/,""));break;case"D":xe.length===8?f[D][E]=new Date(+xe.slice(0,4),+xe.slice(4,6)-1,+xe.slice(6,8)):f[D][E]=xe;break;case"F":f[D][E]=parseFloat(xe.trim());break;case"+":case"I":f[D][E]=b?he.read_shift(-4,"i")^2147483648:he.read_shift(4,"i");break;case"L":switch(xe.trim().toUpperCase()){case"Y":case"T":f[D][E]=!0;break;case"N":case"F":f[D][E]=!1;break;case"":case"?":break;default:throw new Error("DBF Unrecognized L:|"+xe+"|")}break;case"M":if(!x)throw new Error("DBF Unexpected MEMO for type "+_.toString(16));f[D][E]="##MEMO##"+(b?parseInt(xe.trim(),10):he.read_shift(4));break;case"N":xe=xe.replace(/\u0000/g,"").trim(),xe&&xe!="."&&(f[D][E]=+xe||0);break;case"@":f[D][E]=new Date(he.read_shift(-8,"f")-621356832e5);break;case"T":f[D][E]=new Date((he.read_shift(4)-2440588)*864e5+he.read_shift(4));break;case"Y":f[D][E]=he.read_shift(4,"i")/1e4+he.read_shift(4,"i")/1e4*Math.pow(2,32);break;case"O":f[D][E]=-he.read_shift(-8,"f");break;case"B":if(T&&F[E].len==8){f[D][E]=he.read_shift(8,"f");break}case"G":case"P":he.l+=F[E].len;break;case"0":if(F[E].name==="_NullFlags")break;default:throw new Error("DBF Unsupported data type "+F[E].type)}}}if(_!=2&&h.l<h.length&&h[h.l++]!=26)throw new Error("DBF EOF Marker missing "+(h.l-1)+" of "+h.length+" "+h[h.l-1].toString(16));return u&&u.sheetRows&&(f=f.slice(0,u.sheetRows)),u.DBF=F,f}function s(v,u){var f=u||{};f.dateNF||(f.dateNF="yyyymmdd");var h=ci(a(v,f),f);return h["!cols"]=f.DBF.map(function(_){return{wch:_.len,DBF:_}}),delete f.DBF,h}function i(v,u){try{return Ns(s(v,u),u)}catch(f){if(u&&u.WTF)throw f}return{SheetNames:[],Sheets:{}}}var l={B:8,C:250,L:1,D:8,"?":0,"":0};function d(v,u){var f=u||{};if(+f.codepage>=0&&ns(+f.codepage),f.type=="string")throw new Error("Cannot write DBF to JS string");var h=Bn(),_=Xn(v,{header:1,raw:!0,cellDates:!0}),x=_[0],T=_.slice(1),b=v["!cols"]||[],w=0,A=0,C=0,z=1;for(w=0;w<x.length;++w){if(((b[w]||{}).DBF||{}).name){x[w]=b[w].DBF.name,++C;continue}if(x[w]!=null){if(++C,typeof x[w]=="number"&&(x[w]=x[w].toString(10)),typeof x[w]!="string")throw new Error("DBF Invalid column name "+x[w]+" |"+typeof x[w]+"|");if(x.indexOf(x[w])!==w){for(A=0;A<1024;++A)if(x.indexOf(x[w]+"_"+A)==-1){x[w]+="_"+A;break}}}}var F=cr(v["!ref"]),re=[],me=[],ue=[];for(w=0;w<=F.e.c-F.s.c;++w){var D="",E="",he=0,xe=[];for(A=0;A<T.length;++A)T[A][w]!=null&&xe.push(T[A][w]);if(xe.length==0||x[w]==null){re[w]="?";continue}for(A=0;A<xe.length;++A){switch(typeof xe[A]){case"number":E="B";break;case"string":E="C";break;case"boolean":E="L";break;case"object":E=xe[A]instanceof Date?"D":"C";break;default:E="C"}he=Math.max(he,String(xe[A]).length),D=D&&D!=E?"C":E}he>250&&(he=250),E=((b[w]||{}).DBF||{}).type,E=="C"&&b[w].DBF.len>he&&(he=b[w].DBF.len),D=="B"&&E=="N"&&(D="N",ue[w]=b[w].DBF.dec,he=b[w].DBF.len),me[w]=D=="C"||E=="N"?he:l[D]||0,z+=me[w],re[w]=D}var K=h.next(32);for(K.write_shift(4,318902576),K.write_shift(4,T.length),K.write_shift(2,296+32*C),K.write_shift(2,z),w=0;w<4;++w)K.write_shift(4,0);for(K.write_shift(4,0|(+r[Yl]||3)<<8),w=0,A=0;w<x.length;++w)if(x[w]!=null){var q=h.next(32),ae=(x[w].slice(-10)+"\0\0\0\0\0\0\0\0\0\0\0").slice(0,11);q.write_shift(1,ae,"sbcs"),q.write_shift(1,re[w]=="?"?"C":re[w],"sbcs"),q.write_shift(4,A),q.write_shift(1,me[w]||l[re[w]]||0),q.write_shift(1,ue[w]||0),q.write_shift(1,2),q.write_shift(4,0),q.write_shift(1,0),q.write_shift(4,0),q.write_shift(4,0),A+=me[w]||l[re[w]]||0}var Me=h.next(264);for(Me.write_shift(4,13),w=0;w<65;++w)Me.write_shift(4,0);for(w=0;w<T.length;++w){var ge=h.next(z);for(ge.write_shift(1,0),A=0;A<x.length;++A)if(x[A]!=null)switch(re[A]){case"L":ge.write_shift(1,T[w][A]==null?63:T[w][A]?84:70);break;case"B":ge.write_shift(8,T[w][A]||0,"f");break;case"N":var Ne="0";for(typeof T[w][A]=="number"&&(Ne=T[w][A].toFixed(ue[A]||0)),C=0;C<me[A]-Ne.length;++C)ge.write_shift(1,32);ge.write_shift(1,Ne,"sbcs");break;case"D":T[w][A]?(ge.write_shift(4,("0000"+T[w][A].getFullYear()).slice(-4),"sbcs"),ge.write_shift(2,("00"+(T[w][A].getMonth()+1)).slice(-2),"sbcs"),ge.write_shift(2,("00"+T[w][A].getDate()).slice(-2),"sbcs")):ge.write_shift(8,"00000000","sbcs");break;case"C":var Be=String(T[w][A]!=null?T[w][A]:"").slice(0,me[A]);for(ge.write_shift(1,Be,"sbcs"),C=0;C<me[A]-Be.length;++C)ge.write_shift(1,32);break}}return h.next(1).write_shift(1,26),h.end()}return{to_workbook:i,to_sheet:s,from_sheet:d}}(),Og=function(){var t={AA:"À",BA:"Á",CA:"Â",DA:195,HA:"Ä",JA:197,AE:"È",BE:"É",CE:"Ê",HE:"Ë",AI:"Ì",BI:"Í",CI:"Î",HI:"Ï",AO:"Ò",BO:"Ó",CO:"Ô",DO:213,HO:"Ö",AU:"Ù",BU:"Ú",CU:"Û",HU:"Ü",Aa:"à",Ba:"á",Ca:"â",Da:227,Ha:"ä",Ja:229,Ae:"è",Be:"é",Ce:"ê",He:"ë",Ai:"ì",Bi:"í",Ci:"î",Hi:"ï",Ao:"ò",Bo:"ó",Co:"ô",Do:245,Ho:"ö",Au:"ù",Bu:"ú",Cu:"û",Hu:"ü",KC:"Ç",Kc:"ç",q:"æ",z:"œ",a:"Æ",j:"Œ",DN:209,Dn:241,Hy:255,S:169,c:170,R:174,"B ":180,0:176,1:177,2:178,3:179,5:181,6:182,7:183,Q:185,k:186,b:208,i:216,l:222,s:240,y:248,"!":161,'"':162,"#":163,"(":164,"%":165,"'":167,"H ":168,"+":171,";":187,"<":188,"=":189,">":190,"?":191,"{":223},r=new RegExp("\x1BN("+fs(t).join("|").replace(/\|\|\|/,"|\\||").replace(/([?()+])/g,"\\$1")+"|\\|)","gm"),a=function(x,T){var b=t[T];return typeof b=="number"?Lo(b):b},s=function(x,T,b){var w=T.charCodeAt(0)-32<<4|b.charCodeAt(0)-48;return w==59?x:Lo(w)};t["|"]=254;function i(x,T){switch(T.type){case"base64":return l(Gr(x),T);case"binary":return l(x,T);case"buffer":return l(Na&&Buffer.isBuffer(x)?x.toString("binary"):Gs(x),T);case"array":return l(Ws(x),T)}throw new Error("Unrecognized type "+T.type)}function l(x,T){var b=x.split(/[\n\r]+/),w=-1,A=-1,C=0,z=0,F=[],re=[],me=null,ue={},D=[],E=[],he=[],xe=0,K;for(+T.codepage>=0&&ns(+T.codepage);C!==b.length;++C){xe=0;var q=b[C].trim().replace(/\x1B([\x20-\x2F])([\x30-\x3F])/g,s).replace(r,a),ae=q.replace(/;;/g,"\0").split(";").map(function(j){return j.replace(/\u0000/g,";")}),Me=ae[0],ge;if(q.length>0)switch(Me){case"ID":break;case"E":break;case"B":break;case"O":break;case"W":break;case"P":ae[1].charAt(0)=="P"&&re.push(q.slice(3).replace(/;;/g,";"));break;case"C":var Ne=!1,Be=!1,be=!1,L=!1,Te=-1,ye=-1;for(z=1;z<ae.length;++z)switch(ae[z].charAt(0)){case"A":break;case"X":A=parseInt(ae[z].slice(1))-1,Be=!0;break;case"Y":for(w=parseInt(ae[z].slice(1))-1,Be||(A=0),K=F.length;K<=w;++K)F[K]=[];break;case"K":ge=ae[z].slice(1),ge.charAt(0)==='"'?ge=ge.slice(1,ge.length-1):ge==="TRUE"?ge=!0:ge==="FALSE"?ge=!1:isNaN(ls(ge))?isNaN(ii(ge).getDate())||(ge=br(ge)):(ge=ls(ge),me!==null&&oi(me)&&(ge=xn(ge))),Ne=!0;break;case"E":L=!0;var P=ri(ae[z].slice(1),{r:w,c:A});F[w][A]=[F[w][A],P];break;case"S":be=!0,F[w][A]=[F[w][A],"S5S"];break;case"G":break;case"R":Te=parseInt(ae[z].slice(1))-1;break;case"C":ye=parseInt(ae[z].slice(1))-1;break;default:if(T&&T.WTF)throw new Error("SYLK bad record "+q)}if(Ne&&(F[w][A]&&F[w][A].length==2?F[w][A][0]=ge:F[w][A]=ge,me=null),be){if(L)throw new Error("SYLK shared formula cannot have own formula");var pe=Te>-1&&F[Te][ye];if(!pe||!pe[1])throw new Error("SYLK shared formula cannot find base");F[w][A][1]=nd(pe[1],{r:w-Te,c:A-ye})}break;case"F":var B=0;for(z=1;z<ae.length;++z)switch(ae[z].charAt(0)){case"X":A=parseInt(ae[z].slice(1))-1,++B;break;case"Y":for(w=parseInt(ae[z].slice(1))-1,K=F.length;K<=w;++K)F[K]=[];break;case"M":xe=parseInt(ae[z].slice(1))/20;break;case"F":break;case"G":break;case"P":me=re[parseInt(ae[z].slice(1))];break;case"S":break;case"D":break;case"N":break;case"W":for(he=ae[z].slice(1).split(" "),K=parseInt(he[0],10);K<=parseInt(he[1],10);++K)xe=parseInt(he[2],10),E[K-1]=xe===0?{hidden:!0}:{wch:xe},ni(E[K-1]);break;case"C":A=parseInt(ae[z].slice(1))-1,E[A]||(E[A]={});break;case"R":w=parseInt(ae[z].slice(1))-1,D[w]||(D[w]={}),xe>0?(D[w].hpt=xe,D[w].hpx=Oi(xe)):xe===0&&(D[w].hidden=!0);break;default:if(T&&T.WTF)throw new Error("SYLK bad record "+q)}B<1&&(me=null);break;default:if(T&&T.WTF)throw new Error("SYLK bad record "+q)}}return D.length>0&&(ue["!rows"]=D),E.length>0&&(ue["!cols"]=E),T&&T.sheetRows&&(F=F.slice(0,T.sheetRows)),[F,ue]}function d(x,T){var b=i(x,T),w=b[0],A=b[1],C=ci(w,T);return fs(A).forEach(function(z){C[z]=A[z]}),C}function v(x,T){return Ns(d(x,T),T)}function u(x,T,b,w){var A="C;Y"+(b+1)+";X"+(w+1)+";K";switch(x.t){case"n":A+=x.v||0,x.f&&!x.F&&(A+=";E"+kx(x.f,{r:b,c:w}));break;case"b":A+=x.v?"TRUE":"FALSE";break;case"e":A+=x.w||x.v;break;case"d":A+='"'+(x.w||x.v)+'"';break;case"s":A+='"'+x.v.replace(/"/g,"").replace(/;/g,";;")+'"';break}return A}function f(x,T){T.forEach(function(b,w){var A="F;W"+(w+1)+" "+(w+1)+" ";b.hidden?A+="0":(typeof b.width=="number"&&!b.wpx&&(b.wpx=hn(b.width)),typeof b.wpx=="number"&&!b.wch&&(b.wch=mn(b.wpx)),typeof b.wch=="number"&&(A+=Math.round(b.wch))),A.charAt(A.length-1)!=" "&&x.push(A)})}function h(x,T){T.forEach(function(b,w){var A="F;";b.hidden?A+="M0;":b.hpt?A+="M"+20*b.hpt+";":b.hpx&&(A+="M"+20*rd(b.hpx)+";"),A.length>2&&x.push(A+"R"+(w+1))})}function _(x,T){var b=["ID;PWXL;N;E"],w=[],A=cr(x["!ref"]),C,z=Array.isArray(x),F=`\r
`;b.push("P;PGeneral"),b.push("F;P0;DG0G8;M255"),x["!cols"]&&f(b,x["!cols"]),x["!rows"]&&h(b,x["!rows"]),b.push("B;Y"+(A.e.r-A.s.r+1)+";X"+(A.e.c-A.s.c+1)+";D"+[A.s.c,A.s.r,A.e.c,A.e.r].join(" "));for(var re=A.s.r;re<=A.e.r;++re)for(var me=A.s.c;me<=A.e.c;++me){var ue=Ea({r:re,c:me});C=z?(x[re]||[])[me]:x[ue],!(!C||C.v==null&&(!C.f||C.F))&&w.push(u(C,x,re,me))}return b.join(F)+F+w.join(F)+F+"E"+F}return{to_workbook:v,to_sheet:d,from_sheet:_}}(),zg=function(){function t(l,d){switch(d.type){case"base64":return r(Gr(l),d);case"binary":return r(l,d);case"buffer":return r(Na&&Buffer.isBuffer(l)?l.toString("binary"):Gs(l),d);case"array":return r(Ws(l),d)}throw new Error("Unrecognized type "+d.type)}function r(l,d){for(var v=l.split(`
`),u=-1,f=-1,h=0,_=[];h!==v.length;++h){if(v[h].trim()==="BOT"){_[++u]=[],f=0;continue}if(!(u<0)){var x=v[h].trim().split(","),T=x[0],b=x[1];++h;for(var w=v[h]||"";(w.match(/["]/g)||[]).length&1&&h<v.length-1;)w+=`
`+v[++h];switch(w=w.trim(),+T){case-1:if(w==="BOT"){_[++u]=[],f=0;continue}else if(w!=="EOD")throw new Error("Unrecognized DIF special command "+w);break;case 0:w==="TRUE"?_[u][f]=!0:w==="FALSE"?_[u][f]=!1:isNaN(ls(b))?isNaN(ii(b).getDate())?_[u][f]=b:_[u][f]=br(b):_[u][f]=ls(b),++f;break;case 1:w=w.slice(1,w.length-1),w=w.replace(/""/g,'"'),w&&w.match(/^=".*"$/)&&(w=w.slice(2,-1)),_[u][f++]=w!==""?w:null;break}if(w==="EOD")break}}return d&&d.sheetRows&&(_=_.slice(0,d.sheetRows)),_}function a(l,d){return ci(t(l,d),d)}function s(l,d){return Ns(a(l,d),d)}var i=function(){var l=function(u,f,h,_,x){u.push(f),u.push(h+","+_),u.push('"'+x.replace(/"/g,'""')+'"')},d=function(u,f,h,_){u.push(f+","+h),u.push(f==1?'"'+_.replace(/"/g,'""')+'"':_)};return function(u){var f=[],h=cr(u["!ref"]),_,x=Array.isArray(u);l(f,"TABLE",0,1,"sheetjs"),l(f,"VECTORS",0,h.e.r-h.s.r+1,""),l(f,"TUPLES",0,h.e.c-h.s.c+1,""),l(f,"DATA",0,0,"");for(var T=h.s.r;T<=h.e.r;++T){d(f,-1,0,"BOT");for(var b=h.s.c;b<=h.e.c;++b){var w=Ea({r:T,c:b});if(_=x?(u[T]||[])[b]:u[w],!_){d(f,1,0,"");continue}switch(_.t){case"n":var A=_.w;!A&&_.v!=null&&(A=_.v),A==null?_.f&&!_.F?d(f,1,0,"="+_.f):d(f,1,0,""):d(f,0,A,"V");break;case"b":d(f,0,_.v?1:0,_.v?"TRUE":"FALSE");break;case"s":d(f,1,0,isNaN(_.v)?_.v:'="'+_.v+'"');break;case"d":_.w||(_.w=Qr(_.z||Sa[14],zr(br(_.v)))),d(f,0,_.w,"V");break;default:d(f,1,0,"")}}}d(f,-1,0,"EOD");var C=`\r
`,z=f.join(C);return z}}();return{to_workbook:s,to_sheet:a,from_sheet:i}}(),Bg=function(){function t(_){return _.replace(/\\b/g,"\\").replace(/\\c/g,":").replace(/\\n/g,`
`)}function r(_){return _.replace(/\\/g,"\\b").replace(/:/g,"\\c").replace(/\n/g,"\\n")}function a(_,x){for(var T=_.split(`
`),b=-1,w=-1,A=0,C=[];A!==T.length;++A){var z=T[A].trim().split(":");if(z[0]==="cell"){var F=Pr(z[1]);if(C.length<=F.r)for(b=C.length;b<=F.r;++b)C[b]||(C[b]=[]);switch(b=F.r,w=F.c,z[2]){case"t":C[b][w]=t(z[3]);break;case"v":C[b][w]=+z[3];break;case"vtf":var re=z[z.length-1];case"vtc":switch(z[3]){case"nl":C[b][w]=!!+z[4];break;default:C[b][w]=+z[4];break}z[2]=="vtf"&&(C[b][w]=[C[b][w],re])}}}return x&&x.sheetRows&&(C=C.slice(0,x.sheetRows)),C}function s(_,x){return ci(a(_,x),x)}function i(_,x){return Ns(s(_,x),x)}var l=["socialcalc:version:1.5","MIME-Version: 1.0","Content-Type: multipart/mixed; boundary=SocialCalcSpreadsheetControlSave"].join(`
`),d=["--SocialCalcSpreadsheetControlSave","Content-type: text/plain; charset=UTF-8"].join(`
`)+`
`,v=["# SocialCalc Spreadsheet Control Save","part:sheet"].join(`
`),u="--SocialCalcSpreadsheetControlSave--";function f(_){if(!_||!_["!ref"])return"";for(var x=[],T=[],b,w="",A=li(_["!ref"]),C=Array.isArray(_),z=A.s.r;z<=A.e.r;++z)for(var F=A.s.c;F<=A.e.c;++F)if(w=Ea({r:z,c:F}),b=C?(_[z]||[])[F]:_[w],!(!b||b.v==null||b.t==="z")){switch(T=["cell",w,"t"],b.t){case"s":case"str":T.push(r(b.v));break;case"n":b.f?(T[2]="vtf",T[3]="n",T[4]=b.v,T[5]=r(b.f)):(T[2]="v",T[3]=b.v);break;case"b":T[2]="vt"+(b.f?"f":"c"),T[3]="nl",T[4]=b.v?"1":"0",T[5]=r(b.f||(b.v?"TRUE":"FALSE"));break;case"d":var re=zr(br(b.v));T[2]="vtc",T[3]="nd",T[4]=""+re,T[5]=b.w||Qr(b.z||Sa[14],re);break;case"e":continue}x.push(T.join(":"))}return x.push("sheet:c:"+(A.e.c-A.s.c+1)+":r:"+(A.e.r-A.s.r+1)+":tvf:1"),x.push("valueformat:1:text-wiki"),x.join(`
`)}function h(_){return[l,d,v,d,f(_),u].join(`
`)}return{to_workbook:i,to_sheet:s,from_sheet:h}}(),Pi=function(){function t(h,_,x,T,b){b.raw?_[x][T]=h:h===""||(h==="TRUE"?_[x][T]=!0:h==="FALSE"?_[x][T]=!1:isNaN(ls(h))?isNaN(ii(h).getDate())?_[x][T]=h:_[x][T]=br(h):_[x][T]=ls(h))}function r(h,_){var x=_||{},T=[];if(!h||h.length===0)return T;for(var b=h.split(/[\r\n]/),w=b.length-1;w>=0&&b[w].length===0;)--w;for(var A=10,C=0,z=0;z<=w;++z)C=b[z].indexOf(" "),C==-1?C=b[z].length:C++,A=Math.max(A,C);for(z=0;z<=w;++z){T[z]=[];var F=0;for(t(b[z].slice(0,A).trim(),T,z,F,x),F=1;F<=(b[z].length-A)/10+1;++F)t(b[z].slice(A+(F-1)*10,A+F*10).trim(),T,z,F,x)}return x.sheetRows&&(T=T.slice(0,x.sheetRows)),T}var a={44:",",9:"	",59:";",124:"|"},s={44:3,9:2,59:1,124:0};function i(h){for(var _={},x=!1,T=0,b=0;T<h.length;++T)(b=h.charCodeAt(T))==34?x=!x:!x&&b in a&&(_[b]=(_[b]||0)+1);b=[];for(T in _)Object.prototype.hasOwnProperty.call(_,T)&&b.push([_[T],T]);if(!b.length){_=s;for(T in _)Object.prototype.hasOwnProperty.call(_,T)&&b.push([_[T],T])}return b.sort(function(w,A){return w[0]-A[0]||s[w[1]]-s[A[1]]}),a[b.pop()[1]]||44}function l(h,_){var x=_||{},T="",b=x.dense?[]:{},w={s:{c:0,r:0},e:{c:0,r:0}};h.slice(0,4)=="sep="?h.charCodeAt(5)==13&&h.charCodeAt(6)==10?(T=h.charAt(4),h=h.slice(7)):h.charCodeAt(5)==13||h.charCodeAt(5)==10?(T=h.charAt(4),h=h.slice(6)):T=i(h.slice(0,1024)):x&&x.FS?T=x.FS:T=i(h.slice(0,1024));var A=0,C=0,z=0,F=0,re=0,me=T.charCodeAt(0),ue=!1,D=0,E=h.charCodeAt(0);h=h.replace(/\r\n/mg,`
`);var he=x.dateNF!=null?Kh(x.dateNF):null;function xe(){var K=h.slice(F,re),q={};if(K.charAt(0)=='"'&&K.charAt(K.length-1)=='"'&&(K=K.slice(1,-1).replace(/""/g,'"')),K.length===0)q.t="z";else if(x.raw)q.t="s",q.v=K;else if(K.trim().length===0)q.t="s",q.v=K;else if(K.charCodeAt(0)==61)K.charCodeAt(1)==34&&K.charCodeAt(K.length-1)==34?(q.t="s",q.v=K.slice(2,-1).replace(/""/g,'"')):Ex(K)?(q.t="n",q.f=K.slice(1)):(q.t="s",q.v=K);else if(K=="TRUE")q.t="b",q.v=!0;else if(K=="FALSE")q.t="b",q.v=!1;else if(!isNaN(z=ls(K)))q.t="n",x.cellText!==!1&&(q.w=K),q.v=z;else if(!isNaN(ii(K).getDate())||he&&K.match(he)){q.z=x.dateNF||Sa[14];var ae=0;he&&K.match(he)&&(K=Qh(K,x.dateNF,K.match(he)||[]),ae=1),x.cellDates?(q.t="d",q.v=br(K,ae)):(q.t="n",q.v=zr(br(K,ae))),x.cellText!==!1&&(q.w=Qr(q.z,q.v instanceof Date?zr(q.v):q.v)),x.cellNF||delete q.z}else q.t="s",q.v=K;if(q.t=="z"||(x.dense?(b[A]||(b[A]=[]),b[A][C]=q):b[Ea({c:C,r:A})]=q),F=re+1,E=h.charCodeAt(F),w.e.c<C&&(w.e.c=C),w.e.r<A&&(w.e.r=A),D==me)++C;else if(C=0,++A,x.sheetRows&&x.sheetRows<=A)return!0}e:for(;re<h.length;++re)switch(D=h.charCodeAt(re)){case 34:E===34&&(ue=!ue);break;case me:case 10:case 13:if(!ue&&xe())break e;break}return re-F>0&&xe(),b["!ref"]=za(w),b}function d(h,_){return!(_&&_.PRN)||_.FS||h.slice(0,4)=="sep="||h.indexOf("	")>=0||h.indexOf(",")>=0||h.indexOf(";")>=0?l(h,_):ci(r(h,_),_)}function v(h,_){var x="",T=_.type=="string"?[0,0,0,0]:ko(h,_);switch(_.type){case"base64":x=Gr(h);break;case"binary":x=h;break;case"buffer":_.codepage==65001?x=h.toString("utf8"):_.codepage&&typeof Mi<"u"||(x=Na&&Buffer.isBuffer(h)?h.toString("binary"):Gs(h));break;case"array":x=Ws(h);break;case"string":x=h;break;default:throw new Error("Unrecognized type "+_.type)}return T[0]==239&&T[1]==187&&T[2]==191?x=Ka(x.slice(3)):_.type!="string"&&_.type!="buffer"&&_.codepage==65001?x=Ka(x):_.type=="binary"&&typeof Mi<"u",x.slice(0,19)=="socialcalc:version:"?Bg.to_sheet(_.type=="string"?x:Ka(x),_):d(x,_)}function u(h,_){return Ns(v(h,_),_)}function f(h){for(var _=[],x=cr(h["!ref"]),T,b=Array.isArray(h),w=x.s.r;w<=x.e.r;++w){for(var A=[],C=x.s.c;C<=x.e.c;++C){var z=Ea({r:w,c:C});if(T=b?(h[w]||[])[C]:h[z],!T||T.v==null){A.push("          ");continue}for(var F=(T.w||(ys(T),T.w)||"").slice(0,10);F.length<10;)F+=" ";A.push(F+(C===0?" ":""))}_.push(A.join(""))}return _.join(`
`)}return{to_workbook:u,to_sheet:v,from_sheet:f}}();function $g(t,r){var a=r||{},s=!!a.WTF;a.WTF=!0;try{var i=Og.to_workbook(t,a);return a.WTF=s,i}catch(l){if(a.WTF=s,!l.message.match(/SYLK bad record ID/)&&s)throw l;return Pi.to_workbook(t,r)}}var Ai=function(){function t(P,pe,B){if(P){wr(P,P.l||0);for(var j=B.Enum||Te;P.l<P.length;){var I=P.read_shift(2),Y=j[I]||j[65535],fe=P.read_shift(2),ce=P.l+fe,J=Y.f&&Y.f(P,fe,B);if(P.l=ce,pe(J,Y,I))return}}}function r(P,pe){switch(pe.type){case"base64":return a(is(Gr(P)),pe);case"binary":return a(is(P),pe);case"buffer":case"array":return a(P,pe)}throw"Unsupported type "+pe.type}function a(P,pe){if(!P)return P;var B=pe||{},j=B.dense?[]:{},I="Sheet1",Y="",fe=0,ce={},J=[],le=[],S={s:{r:0,c:0},e:{r:0,c:0}},De=B.sheetRows||0;if(P[2]==0&&(P[3]==8||P[3]==9)&&P.length>=16&&P[14]==5&&P[15]===108)throw new Error("Unsupported Works 3 for Mac file");if(P[2]==2)B.Enum=Te,t(P,function(N,V,G){switch(G){case 0:B.vers=N,N>=4096&&(B.qpro=!0);break;case 6:S=N;break;case 204:N&&(Y=N);break;case 222:Y=N;break;case 15:case 51:B.qpro||(N[1].v=N[1].v.slice(1));case 13:case 14:case 16:G==14&&(N[2]&112)==112&&(N[2]&15)>1&&(N[2]&15)<15&&(N[1].z=B.dateNF||Sa[14],B.cellDates&&(N[1].t="d",N[1].v=xn(N[1].v))),B.qpro&&N[3]>fe&&(j["!ref"]=za(S),ce[I]=j,J.push(I),j=B.dense?[]:{},S={s:{r:0,c:0},e:{r:0,c:0}},fe=N[3],I=Y||"Sheet"+(fe+1),Y="");var de=B.dense?(j[N[0].r]||[])[N[0].c]:j[Ea(N[0])];if(de){de.t=N[1].t,de.v=N[1].v,N[1].z!=null&&(de.z=N[1].z),N[1].f!=null&&(de.f=N[1].f);break}B.dense?(j[N[0].r]||(j[N[0].r]=[]),j[N[0].r][N[0].c]=N[1]):j[Ea(N[0])]=N[1];break}},B);else if(P[2]==26||P[2]==14)B.Enum=ye,P[2]==14&&(B.qpro=!0,P.l=0),t(P,function(N,V,G){switch(G){case 204:I=N;break;case 22:N[1].v=N[1].v.slice(1);case 23:case 24:case 25:case 37:case 39:case 40:if(N[3]>fe&&(j["!ref"]=za(S),ce[I]=j,J.push(I),j=B.dense?[]:{},S={s:{r:0,c:0},e:{r:0,c:0}},fe=N[3],I="Sheet"+(fe+1)),De>0&&N[0].r>=De)break;B.dense?(j[N[0].r]||(j[N[0].r]=[]),j[N[0].r][N[0].c]=N[1]):j[Ea(N[0])]=N[1],S.e.c<N[0].c&&(S.e.c=N[0].c),S.e.r<N[0].r&&(S.e.r=N[0].r);break;case 27:N[14e3]&&(le[N[14e3][0]]=N[14e3][1]);break;case 1537:le[N[0]]=N[1],N[0]==fe&&(I=N[1]);break}},B);else throw new Error("Unrecognized LOTUS BOF "+P[2]);if(j["!ref"]=za(S),ce[Y||I]=j,J.push(Y||I),!le.length)return{SheetNames:J,Sheets:ce};for(var Ue={},We=[],ke=0;ke<le.length;++ke)ce[J[ke]]?(We.push(le[ke]||J[ke]),Ue[le[ke]]=ce[le[ke]]||ce[J[ke]]):(We.push(le[ke]),Ue[le[ke]]={"!ref":"A1"});return{SheetNames:We,Sheets:Ue}}function s(P,pe){var B=pe||{};if(+B.codepage>=0&&ns(+B.codepage),B.type=="string")throw new Error("Cannot write WK1 to JS string");var j=Bn(),I=cr(P["!ref"]),Y=Array.isArray(P),fe=[];as(j,0,l(1030)),as(j,6,u(I));for(var ce=Math.min(I.e.r,8191),J=I.s.r;J<=ce;++J)for(var le=Tr(J),S=I.s.c;S<=I.e.c;++S){J===I.s.r&&(fe[S]=_r(S));var De=fe[S]+le,Ue=Y?(P[J]||[])[S]:P[De];if(!(!Ue||Ue.t=="z"))if(Ue.t=="n")(Ue.v|0)==Ue.v&&Ue.v>=-32768&&Ue.v<=32767?as(j,13,T(J,S,Ue.v)):as(j,14,w(J,S,Ue.v));else{var We=ys(Ue);as(j,15,_(J,S,We.slice(0,239)))}}return as(j,1),j.end()}function i(P,pe){var B=pe||{};if(+B.codepage>=0&&ns(+B.codepage),B.type=="string")throw new Error("Cannot write WK3 to JS string");var j=Bn();as(j,0,d(P));for(var I=0,Y=0;I<P.SheetNames.length;++I)(P.Sheets[P.SheetNames[I]]||{})["!ref"]&&as(j,27,L(P.SheetNames[I],Y++));var fe=0;for(I=0;I<P.SheetNames.length;++I){var ce=P.Sheets[P.SheetNames[I]];if(!(!ce||!ce["!ref"])){for(var J=cr(ce["!ref"]),le=Array.isArray(ce),S=[],De=Math.min(J.e.r,8191),Ue=J.s.r;Ue<=De;++Ue)for(var We=Tr(Ue),ke=J.s.c;ke<=J.e.c;++ke){Ue===J.s.r&&(S[ke]=_r(ke));var N=S[ke]+We,V=le?(ce[Ue]||[])[ke]:ce[N];if(!(!V||V.t=="z"))if(V.t=="n")as(j,23,xe(Ue,ke,fe,V.v));else{var G=ys(V);as(j,22,D(Ue,ke,fe,G.slice(0,239)))}}++fe}}return as(j,1),j.end()}function l(P){var pe=mr(2);return pe.write_shift(2,P),pe}function d(P){var pe=mr(26);pe.write_shift(2,4096),pe.write_shift(2,4),pe.write_shift(4,0);for(var B=0,j=0,I=0,Y=0;Y<P.SheetNames.length;++Y){var fe=P.SheetNames[Y],ce=P.Sheets[fe];if(!(!ce||!ce["!ref"])){++I;var J=li(ce["!ref"]);B<J.e.r&&(B=J.e.r),j<J.e.c&&(j=J.e.c)}}return B>8191&&(B=8191),pe.write_shift(2,B),pe.write_shift(1,I),pe.write_shift(1,j),pe.write_shift(2,0),pe.write_shift(2,0),pe.write_shift(1,1),pe.write_shift(1,2),pe.write_shift(4,0),pe.write_shift(4,0),pe}function v(P,pe,B){var j={s:{c:0,r:0},e:{c:0,r:0}};return pe==8&&B.qpro?(j.s.c=P.read_shift(1),P.l++,j.s.r=P.read_shift(2),j.e.c=P.read_shift(1),P.l++,j.e.r=P.read_shift(2),j):(j.s.c=P.read_shift(2),j.s.r=P.read_shift(2),pe==12&&B.qpro&&(P.l+=2),j.e.c=P.read_shift(2),j.e.r=P.read_shift(2),pe==12&&B.qpro&&(P.l+=2),j.s.c==65535&&(j.s.c=j.e.c=j.s.r=j.e.r=0),j)}function u(P){var pe=mr(8);return pe.write_shift(2,P.s.c),pe.write_shift(2,P.s.r),pe.write_shift(2,P.e.c),pe.write_shift(2,P.e.r),pe}function f(P,pe,B){var j=[{c:0,r:0},{t:"n",v:0},0,0];return B.qpro&&B.vers!=20768?(j[0].c=P.read_shift(1),j[3]=P.read_shift(1),j[0].r=P.read_shift(2),P.l+=2):(j[2]=P.read_shift(1),j[0].c=P.read_shift(2),j[0].r=P.read_shift(2)),j}function h(P,pe,B){var j=P.l+pe,I=f(P,pe,B);if(I[1].t="s",B.vers==20768){P.l++;var Y=P.read_shift(1);return I[1].v=P.read_shift(Y,"utf8"),I}return B.qpro&&P.l++,I[1].v=P.read_shift(j-P.l,"cstr"),I}function _(P,pe,B){var j=mr(7+B.length);j.write_shift(1,255),j.write_shift(2,pe),j.write_shift(2,P),j.write_shift(1,39);for(var I=0;I<j.length;++I){var Y=B.charCodeAt(I);j.write_shift(1,Y>=128?95:Y)}return j.write_shift(1,0),j}function x(P,pe,B){var j=f(P,pe,B);return j[1].v=P.read_shift(2,"i"),j}function T(P,pe,B){var j=mr(7);return j.write_shift(1,255),j.write_shift(2,pe),j.write_shift(2,P),j.write_shift(2,B,"i"),j}function b(P,pe,B){var j=f(P,pe,B);return j[1].v=P.read_shift(8,"f"),j}function w(P,pe,B){var j=mr(13);return j.write_shift(1,255),j.write_shift(2,pe),j.write_shift(2,P),j.write_shift(8,B,"f"),j}function A(P,pe,B){var j=P.l+pe,I=f(P,pe,B);if(I[1].v=P.read_shift(8,"f"),B.qpro)P.l=j;else{var Y=P.read_shift(2);re(P.slice(P.l,P.l+Y),I),P.l+=Y}return I}function C(P,pe,B){var j=pe&32768;return pe&=-32769,pe=(j?P:0)+(pe>=8192?pe-16384:pe),(j?"":"$")+(B?_r(pe):Tr(pe))}var z={51:["FALSE",0],52:["TRUE",0],70:["LEN",1],80:["SUM",69],81:["AVERAGEA",69],82:["COUNTA",69],83:["MINA",69],84:["MAXA",69],111:["T",1]},F=["","","","","","","","","","+","-","*","/","^","=","<>","<=",">=","<",">","","","","","&","","","","","","",""];function re(P,pe){wr(P,0);for(var B=[],j=0,I="",Y="",fe="",ce="";P.l<P.length;){var J=P[P.l++];switch(J){case 0:B.push(P.read_shift(8,"f"));break;case 1:Y=C(pe[0].c,P.read_shift(2),!0),I=C(pe[0].r,P.read_shift(2),!1),B.push(Y+I);break;case 2:{var le=C(pe[0].c,P.read_shift(2),!0),S=C(pe[0].r,P.read_shift(2),!1);Y=C(pe[0].c,P.read_shift(2),!0),I=C(pe[0].r,P.read_shift(2),!1),B.push(le+S+":"+Y+I)}break;case 3:if(P.l<P.length){console.error("WK1 premature formula end");return}break;case 4:B.push("("+B.pop()+")");break;case 5:B.push(P.read_shift(2));break;case 6:{for(var De="";J=P[P.l++];)De+=String.fromCharCode(J);B.push('"'+De.replace(/"/g,'""')+'"')}break;case 8:B.push("-"+B.pop());break;case 23:B.push("+"+B.pop());break;case 22:B.push("NOT("+B.pop()+")");break;case 20:case 21:ce=B.pop(),fe=B.pop(),B.push(["AND","OR"][J-20]+"("+fe+","+ce+")");break;default:if(J<32&&F[J])ce=B.pop(),fe=B.pop(),B.push(fe+F[J]+ce);else if(z[J]){if(j=z[J][1],j==69&&(j=P[P.l++]),j>B.length){console.error("WK1 bad formula parse 0x"+J.toString(16)+":|"+B.join("|")+"|");return}var Ue=B.slice(-j);B.length-=j,B.push(z[J][0]+"("+Ue.join(",")+")")}else return J<=7?console.error("WK1 invalid opcode "+J.toString(16)):J<=24?console.error("WK1 unsupported op "+J.toString(16)):J<=30?console.error("WK1 invalid opcode "+J.toString(16)):J<=115?console.error("WK1 unsupported function opcode "+J.toString(16)):console.error("WK1 unrecognized opcode "+J.toString(16))}}B.length==1?pe[1].f=""+B[0]:console.error("WK1 bad formula parse |"+B.join("|")+"|")}function me(P){var pe=[{c:0,r:0},{t:"n",v:0},0];return pe[0].r=P.read_shift(2),pe[3]=P[P.l++],pe[0].c=P[P.l++],pe}function ue(P,pe){var B=me(P);return B[1].t="s",B[1].v=P.read_shift(pe-4,"cstr"),B}function D(P,pe,B,j){var I=mr(6+j.length);I.write_shift(2,P),I.write_shift(1,B),I.write_shift(1,pe),I.write_shift(1,39);for(var Y=0;Y<j.length;++Y){var fe=j.charCodeAt(Y);I.write_shift(1,fe>=128?95:fe)}return I.write_shift(1,0),I}function E(P,pe){var B=me(P);B[1].v=P.read_shift(2);var j=B[1].v>>1;if(B[1].v&1)switch(j&7){case 0:j=(j>>3)*5e3;break;case 1:j=(j>>3)*500;break;case 2:j=(j>>3)/20;break;case 3:j=(j>>3)/200;break;case 4:j=(j>>3)/2e3;break;case 5:j=(j>>3)/2e4;break;case 6:j=(j>>3)/16;break;case 7:j=(j>>3)/64;break}return B[1].v=j,B}function he(P,pe){var B=me(P),j=P.read_shift(4),I=P.read_shift(4),Y=P.read_shift(2);if(Y==65535)return j===0&&I===3221225472?(B[1].t="e",B[1].v=15):j===0&&I===3489660928?(B[1].t="e",B[1].v=42):B[1].v=0,B;var fe=Y&32768;return Y=(Y&32767)-16446,B[1].v=(1-fe*2)*(I*Math.pow(2,Y+32)+j*Math.pow(2,Y)),B}function xe(P,pe,B,j){var I=mr(14);if(I.write_shift(2,P),I.write_shift(1,B),I.write_shift(1,pe),j==0)return I.write_shift(4,0),I.write_shift(4,0),I.write_shift(2,65535),I;var Y=0,fe=0,ce=0,J=0;return j<0&&(Y=1,j=-j),fe=Math.log2(j)|0,j/=Math.pow(2,fe-31),J=j>>>0,J&2147483648||(j/=2,++fe,J=j>>>0),j-=J,J|=2147483648,J>>>=0,j*=Math.pow(2,32),ce=j>>>0,I.write_shift(4,ce),I.write_shift(4,J),fe+=16383+(Y?32768:0),I.write_shift(2,fe),I}function K(P,pe){var B=he(P);return P.l+=pe-14,B}function q(P,pe){var B=me(P),j=P.read_shift(4);return B[1].v=j>>6,B}function ae(P,pe){var B=me(P),j=P.read_shift(8,"f");return B[1].v=j,B}function Me(P,pe){var B=ae(P);return P.l+=pe-10,B}function ge(P,pe){return P[P.l+pe-1]==0?P.read_shift(pe,"cstr"):""}function Ne(P,pe){var B=P[P.l++];B>pe-1&&(B=pe-1);for(var j="";j.length<B;)j+=String.fromCharCode(P[P.l++]);return j}function Be(P,pe,B){if(!(!B.qpro||pe<21)){var j=P.read_shift(1);P.l+=17,P.l+=1,P.l+=2;var I=P.read_shift(pe-21,"cstr");return[j,I]}}function be(P,pe){for(var B={},j=P.l+pe;P.l<j;){var I=P.read_shift(2);if(I==14e3){for(B[I]=[0,""],B[I][0]=P.read_shift(2);P[P.l];)B[I][1]+=String.fromCharCode(P[P.l]),P.l++;P.l++}}return B}function L(P,pe){var B=mr(5+P.length);B.write_shift(2,14e3),B.write_shift(2,pe);for(var j=0;j<P.length;++j){var I=P.charCodeAt(j);B[B.l++]=I>127?95:I}return B[B.l++]=0,B}var Te={0:{n:"BOF",f:pr},1:{n:"EOF"},2:{n:"CALCMODE"},3:{n:"CALCORDER"},4:{n:"SPLIT"},5:{n:"SYNC"},6:{n:"RANGE",f:v},7:{n:"WINDOW1"},8:{n:"COLW1"},9:{n:"WINTWO"},10:{n:"COLW2"},11:{n:"NAME"},12:{n:"BLANK"},13:{n:"INTEGER",f:x},14:{n:"NUMBER",f:b},15:{n:"LABEL",f:h},16:{n:"FORMULA",f:A},24:{n:"TABLE"},25:{n:"ORANGE"},26:{n:"PRANGE"},27:{n:"SRANGE"},28:{n:"FRANGE"},29:{n:"KRANGE1"},32:{n:"HRANGE"},35:{n:"KRANGE2"},36:{n:"PROTEC"},37:{n:"FOOTER"},38:{n:"HEADER"},39:{n:"SETUP"},40:{n:"MARGINS"},41:{n:"LABELFMT"},42:{n:"TITLES"},43:{n:"SHEETJS"},45:{n:"GRAPH"},46:{n:"NGRAPH"},47:{n:"CALCCOUNT"},48:{n:"UNFORMATTED"},49:{n:"CURSORW12"},50:{n:"WINDOW"},51:{n:"STRING",f:h},55:{n:"PASSWORD"},56:{n:"LOCKED"},60:{n:"QUERY"},61:{n:"QUERYNAME"},62:{n:"PRINT"},63:{n:"PRINTNAME"},64:{n:"GRAPH2"},65:{n:"GRAPHNAME"},66:{n:"ZOOM"},67:{n:"SYMSPLIT"},68:{n:"NSROWS"},69:{n:"NSCOLS"},70:{n:"RULER"},71:{n:"NNAME"},72:{n:"ACOMM"},73:{n:"AMACRO"},74:{n:"PARSE"},102:{n:"PRANGES??"},103:{n:"RRANGES??"},104:{n:"FNAME??"},105:{n:"MRANGES??"},204:{n:"SHEETNAMECS",f:ge},222:{n:"SHEETNAMELP",f:Ne},65535:{n:""}},ye={0:{n:"BOF"},1:{n:"EOF"},2:{n:"PASSWORD"},3:{n:"CALCSET"},4:{n:"WINDOWSET"},5:{n:"SHEETCELLPTR"},6:{n:"SHEETLAYOUT"},7:{n:"COLUMNWIDTH"},8:{n:"HIDDENCOLUMN"},9:{n:"USERRANGE"},10:{n:"SYSTEMRANGE"},11:{n:"ZEROFORCE"},12:{n:"SORTKEYDIR"},13:{n:"FILESEAL"},14:{n:"DATAFILLNUMS"},15:{n:"PRINTMAIN"},16:{n:"PRINTSTRING"},17:{n:"GRAPHMAIN"},18:{n:"GRAPHSTRING"},19:{n:"??"},20:{n:"ERRCELL"},21:{n:"NACELL"},22:{n:"LABEL16",f:ue},23:{n:"NUMBER17",f:he},24:{n:"NUMBER18",f:E},25:{n:"FORMULA19",f:K},26:{n:"FORMULA1A"},27:{n:"XFORMAT",f:be},28:{n:"DTLABELMISC"},29:{n:"DTLABELCELL"},30:{n:"GRAPHWINDOW"},31:{n:"CPA"},32:{n:"LPLAUTO"},33:{n:"QUERY"},34:{n:"HIDDENSHEET"},35:{n:"??"},37:{n:"NUMBER25",f:q},38:{n:"??"},39:{n:"NUMBER27",f:ae},40:{n:"FORMULA28",f:Me},142:{n:"??"},147:{n:"??"},150:{n:"??"},151:{n:"??"},152:{n:"??"},153:{n:"??"},154:{n:"??"},155:{n:"??"},156:{n:"??"},163:{n:"??"},174:{n:"??"},175:{n:"??"},176:{n:"??"},177:{n:"??"},184:{n:"??"},185:{n:"??"},186:{n:"??"},187:{n:"??"},188:{n:"??"},195:{n:"??"},201:{n:"??"},204:{n:"SHEETNAMECS",f:ge},205:{n:"??"},206:{n:"??"},207:{n:"??"},208:{n:"??"},256:{n:"??"},259:{n:"??"},260:{n:"??"},261:{n:"??"},262:{n:"??"},263:{n:"??"},265:{n:"??"},266:{n:"??"},267:{n:"??"},268:{n:"??"},270:{n:"??"},271:{n:"??"},384:{n:"??"},389:{n:"??"},390:{n:"??"},393:{n:"??"},396:{n:"??"},512:{n:"??"},514:{n:"??"},513:{n:"??"},516:{n:"??"},517:{n:"??"},640:{n:"??"},641:{n:"??"},642:{n:"??"},643:{n:"??"},644:{n:"??"},645:{n:"??"},646:{n:"??"},647:{n:"??"},648:{n:"??"},658:{n:"??"},659:{n:"??"},660:{n:"??"},661:{n:"??"},662:{n:"??"},665:{n:"??"},666:{n:"??"},768:{n:"??"},772:{n:"??"},1537:{n:"SHEETINFOQP",f:Be},1600:{n:"??"},1602:{n:"??"},1793:{n:"??"},1794:{n:"??"},1795:{n:"??"},1796:{n:"??"},1920:{n:"??"},2048:{n:"??"},2049:{n:"??"},2052:{n:"??"},2688:{n:"??"},10998:{n:"??"},12849:{n:"??"},28233:{n:"??"},28484:{n:"??"},65535:{n:""}};return{sheet_to_wk1:s,book_to_wk3:i,to_workbook:r}}();function Ug(t){var r={},a=t.match(Mr),s=0,i=!1;if(a)for(;s!=a.length;++s){var l=ba(a[s]);switch(l[0].replace(/\w*:/g,"")){case"<condense":break;case"<extend":break;case"<shadow":if(!l.val)break;case"<shadow>":case"<shadow/>":r.shadow=1;break;case"</shadow>":break;case"<charset":if(l.val=="1")break;r.cp=Zn[parseInt(l.val,10)];break;case"<outline":if(!l.val)break;case"<outline>":case"<outline/>":r.outline=1;break;case"</outline>":break;case"<rFont":r.name=l.val;break;case"<sz":r.sz=l.val;break;case"<strike":if(!l.val)break;case"<strike>":case"<strike/>":r.strike=1;break;case"</strike>":break;case"<u":if(!l.val)break;switch(l.val){case"double":r.uval="double";break;case"singleAccounting":r.uval="single-accounting";break;case"doubleAccounting":r.uval="double-accounting";break}case"<u>":case"<u/>":r.u=1;break;case"</u>":break;case"<b":if(l.val=="0")break;case"<b>":case"<b/>":r.b=1;break;case"</b>":break;case"<i":if(l.val=="0")break;case"<i>":case"<i/>":r.i=1;break;case"</i>":break;case"<color":l.rgb&&(r.color=l.rgb.slice(2,8));break;case"<color>":case"<color/>":case"</color>":break;case"<family":r.family=l.val;break;case"<family>":case"<family/>":case"</family>":break;case"<vertAlign":r.valign=l.val;break;case"<vertAlign>":case"<vertAlign/>":case"</vertAlign>":break;case"<scheme":break;case"<scheme>":case"<scheme/>":case"</scheme>":break;case"<extLst":case"<extLst>":case"</extLst>":break;case"<ext":i=!0;break;case"</ext>":i=!1;break;default:if(l[0].charCodeAt(1)!==47&&!i)throw new Error("Unrecognized rich format "+l[0])}}return r}var qg=function(){var t=Ri("t"),r=Ri("rPr");function a(l){var d=l.match(t);if(!d)return{t:"s",v:""};var v={t:"s",v:Ua(d[1])},u=l.match(r);return u&&(v.s=Ug(u[1])),v}var s=/<(?:\w+:)?r>/g,i=/<\/(?:\w+:)?r>/;return function(d){return d.replace(s,"").split(i).map(a).filter(function(v){return v.v})}}(),jg=function(){var r=/(\r\n|\n)/g;function a(i,l,d){var v=[];i.u&&v.push("text-decoration: underline;"),i.uval&&v.push("text-underline-style:"+i.uval+";"),i.sz&&v.push("font-size:"+i.sz+"pt;"),i.outline&&v.push("text-effect: outline;"),i.shadow&&v.push("text-shadow: auto;"),l.push('<span style="'+v.join("")+'">'),i.b&&(l.push("<b>"),d.push("</b>")),i.i&&(l.push("<i>"),d.push("</i>")),i.strike&&(l.push("<s>"),d.push("</s>"));var u=i.valign||"";return u=="superscript"||u=="super"?u="sup":u=="subscript"&&(u="sub"),u!=""&&(l.push("<"+u+">"),d.push("</"+u+">")),d.push("</span>"),i}function s(i){var l=[[],i.v,[]];return i.v?(i.s&&a(i.s,l[0],l[2]),l[0].join("")+l[1].replace(r,"<br/>")+l[2].join("")):""}return function(l){return l.map(s).join("")}}(),Wg=/<(?:\w+:)?t[^>]*>([^<]*)<\/(?:\w+:)?t>/g,Hg=/<(?:\w+:)?r>/,Vg=/<(?:\w+:)?rPh.*?>([\s\S]*?)<\/(?:\w+:)?rPh>/g;function mo(t,r){var a=r?r.cellHTML:!0,s={};return t?(t.match(/^\s*<(?:\w+:)?t[^>]*>/)?(s.t=Ua(Ka(t.slice(t.indexOf(">")+1).split(/<\/(?:\w+:)?t>/)[0]||"")),s.r=Ka(t),a&&(s.h=io(s.t))):t.match(Hg)&&(s.r=Ka(t),s.t=Ua(Ka((t.replace(Vg,"").match(Wg)||[]).join("").replace(Mr,""))),a&&(s.h=jg(qg(s.r)))),s):{t:""}}var Gg=/<(?:\w+:)?sst([^>]*)>([\s\S]*)<\/(?:\w+:)?sst>/,Xg=/<(?:\w+:)?(?:si|sstItem)>/g,Yg=/<\/(?:\w+:)?(?:si|sstItem)>/;function Kg(t,r){var a=[],s="";if(!t)return a;var i=t.match(Gg);if(i){s=i[2].replace(Xg,"").split(Yg);for(var l=0;l!=s.length;++l){var d=mo(s[l].trim(),r);d!=null&&(a[a.length]=d)}i=ba(i[1]),a.Count=i.count,a.Unique=i.uniqueCount}return a}function Qg(t){return[t.read_shift(4),t.read_shift(4)]}function Zg(t,r){var a=[],s=!1;return Ts(t,function(l,d,v){switch(v){case 159:a.Count=l[0],a.Unique=l[1];break;case 19:a.push(l);break;case 160:return!0;case 35:s=!0;break;case 36:s=!1;break;default:if(d.T,!s||r.WTF)throw new Error("Unexpected record 0x"+v.toString(16))}}),a}function Qc(t){for(var r=[],a=t.split(""),s=0;s<a.length;++s)r[s]=a[s].charCodeAt(0);return r}function ws(t,r){var a={};return a.Major=t.read_shift(2),a.Minor=t.read_shift(2),r>=4&&(t.l+=r-4),a}function Jg(t){var r={};return r.id=t.read_shift(0,"lpp4"),r.R=ws(t,4),r.U=ws(t,4),r.W=ws(t,4),r}function e2(t){for(var r=t.read_shift(4),a=t.l+r-4,s={},i=t.read_shift(4),l=[];i-- >0;)l.push({t:t.read_shift(4),v:t.read_shift(0,"lpp4")});if(s.name=t.read_shift(0,"lpp4"),s.comps=l,t.l!=a)throw new Error("Bad DataSpaceMapEntry: "+t.l+" != "+a);return s}function t2(t){var r=[];t.l+=4;for(var a=t.read_shift(4);a-- >0;)r.push(e2(t));return r}function a2(t){var r=[];t.l+=4;for(var a=t.read_shift(4);a-- >0;)r.push(t.read_shift(0,"lpp4"));return r}function r2(t){var r={};return t.read_shift(4),t.l+=4,r.id=t.read_shift(0,"lpp4"),r.name=t.read_shift(0,"lpp4"),r.R=ws(t,4),r.U=ws(t,4),r.W=ws(t,4),r}function s2(t){var r=r2(t);if(r.ename=t.read_shift(0,"8lpp4"),r.blksz=t.read_shift(4),r.cmode=t.read_shift(4),t.read_shift(4)!=4)throw new Error("Bad !Primary record");return r}function Zc(t,r){var a=t.l+r,s={};s.Flags=t.read_shift(4)&63,t.l+=4,s.AlgID=t.read_shift(4);var i=!1;switch(s.AlgID){case 26126:case 26127:case 26128:i=s.Flags==36;break;case 26625:i=s.Flags==4;break;case 0:i=s.Flags==16||s.Flags==4||s.Flags==36;break;default:throw"Unrecognized encryption algorithm: "+s.AlgID}if(!i)throw new Error("Encryption Flags/AlgID mismatch");return s.AlgIDHash=t.read_shift(4),s.KeySize=t.read_shift(4),s.ProviderType=t.read_shift(4),t.l+=8,s.CSPName=t.read_shift(a-t.l>>1,"utf16le"),t.l=a,s}function Jc(t,r){var a={},s=t.l+r;return t.l+=4,a.Salt=t.slice(t.l,t.l+16),t.l+=16,a.Verifier=t.slice(t.l,t.l+16),t.l+=16,t.read_shift(4),a.VerifierHash=t.slice(t.l,s),t.l=s,a}function i2(t){var r=ws(t);switch(r.Minor){case 2:return[r.Minor,n2(t)];case 3:return[r.Minor,o2()];case 4:return[r.Minor,l2(t)]}throw new Error("ECMA-376 Encrypted file unrecognized Version: "+r.Minor)}function n2(t){var r=t.read_shift(4);if((r&63)!=36)throw new Error("EncryptionInfo mismatch");var a=t.read_shift(4),s=Zc(t,a),i=Jc(t,t.length-t.l);return{t:"Std",h:s,v:i}}function o2(){throw new Error("File is password-protected: ECMA-376 Extensible")}function l2(t){var r=["saltSize","blockSize","keyBits","hashSize","cipherAlgorithm","cipherChaining","hashAlgorithm","saltValue"];t.l+=4;var a=t.read_shift(t.length-t.l,"utf8"),s={};return a.replace(Mr,function(l){var d=ba(l);switch(ps(d[0])){case"<?xml":break;case"<encryption":case"</encryption>":break;case"<keyData":r.forEach(function(v){s[v]=d[v]});break;case"<dataIntegrity":s.encryptedHmacKey=d.encryptedHmacKey,s.encryptedHmacValue=d.encryptedHmacValue;break;case"<keyEncryptors>":case"<keyEncryptors":s.encs=[];break;case"</keyEncryptors>":break;case"<keyEncryptor":s.uri=d.uri;break;case"</keyEncryptor>":break;case"<encryptedKey":s.encs.push(d);break;default:throw d[0]}}),s}function c2(t,r){var a={},s=a.EncryptionVersionInfo=ws(t,4);if(r-=4,s.Minor!=2)throw new Error("unrecognized minor version code: "+s.Minor);if(s.Major>4||s.Major<2)throw new Error("unrecognized major version code: "+s.Major);a.Flags=t.read_shift(4),r-=4;var i=t.read_shift(4);return r-=4,a.EncryptionHeader=Zc(t,i),r-=i,a.EncryptionVerifier=Jc(t,r),a}function d2(t){var r={},a=r.EncryptionVersionInfo=ws(t,4);if(a.Major!=1||a.Minor!=1)throw"unrecognized version code "+a.Major+" : "+a.Minor;return r.Salt=t.read_shift(16),r.EncryptedVerifier=t.read_shift(16),r.EncryptedVerifierHash=t.read_shift(16),r}function v2(t){var r=0,a,s=Qc(t),i=s.length+1,l,d,v,u,f;for(a=Is(i),a[0]=s.length,l=1;l!=i;++l)a[l]=s[l-1];for(l=i-1;l>=0;--l)d=a[l],v=r&16384?1:0,u=r<<1&32767,f=v|u,r=f^d;return r^52811}var ed=function(){var t=[187,255,255,186,255,255,185,128,0,190,15,0,191,15,0],r=[57840,7439,52380,33984,4364,3600,61902,12606,6258,57657,54287,34041,10252,43370,20163],a=[44796,19929,39858,10053,20106,40212,10761,31585,63170,64933,60267,50935,40399,11199,17763,35526,1453,2906,5812,11624,23248,885,1770,3540,7080,14160,28320,56640,55369,41139,20807,41614,21821,43642,17621,28485,56970,44341,19019,38038,14605,29210,60195,50791,40175,10751,21502,43004,24537,18387,36774,3949,7898,15796,31592,63184,47201,24803,49606,37805,14203,28406,56812,17824,35648,1697,3394,6788,13576,27152,43601,17539,35078,557,1114,2228,4456,30388,60776,51953,34243,7079,14158,28316,14128,28256,56512,43425,17251,34502,7597,13105,26210,52420,35241,883,1766,3532,4129,8258,16516,33032,4657,9314,18628],s=function(d){return(d/2|d*128)&255},i=function(d,v){return s(d^v)},l=function(d){for(var v=r[d.length-1],u=104,f=d.length-1;f>=0;--f)for(var h=d[f],_=0;_!=7;++_)h&64&&(v^=a[u]),h*=2,--u;return v};return function(d){for(var v=Qc(d),u=l(v),f=v.length,h=Is(16),_=0;_!=16;++_)h[_]=0;var x,T,b;for((f&1)===1&&(x=u>>8,h[f]=i(t[0],x),--f,x=u&255,T=v[v.length-1],h[f]=i(T,x));f>0;)--f,x=u>>8,h[f]=i(v[f],x),--f,x=u&255,h[f]=i(v[f],x);for(f=15,b=15-v.length;b>0;)x=u>>8,h[f]=i(t[b],x),--f,--b,x=u&255,h[f]=i(v[f],x),--f,--b;return h}}(),u2=function(t,r,a,s,i){i||(i=r),s||(s=ed(t));var l,d;for(l=0;l!=r.length;++l)d=r[l],d^=s[a],d=(d>>5|d<<3)&255,i[l]=d,++a;return[i,a,s]},f2=function(t){var r=0,a=ed(t);return function(s){var i=u2("",s,r,a);return r=i[1],i[0]}};function p2(t,r,a,s){var i={key:pr(t),verificationBytes:pr(t)};return a.password&&(i.verifier=v2(a.password)),s.valid=i.verificationBytes===i.verifier,s.valid&&(s.insitu=f2(a.password)),i}function h2(t,r,a){var s=a||{};return s.Info=t.read_shift(2),t.l-=2,s.Info===1?s.Data=d2(t):s.Data=c2(t,r),s}function m2(t,r,a){var s={Type:a.biff>=8?t.read_shift(2):0};return s.Type?h2(t,r-2,s):p2(t,a.biff>=8?r:r-2,a,s),s}var _2=function(){function t(i,l){switch(l.type){case"base64":return r(Gr(i),l);case"binary":return r(i,l);case"buffer":return r(Na&&Buffer.isBuffer(i)?i.toString("binary"):Gs(i),l);case"array":return r(Ws(i),l)}throw new Error("Unrecognized type "+l.type)}function r(i,l){var d=l||{},v=d.dense?[]:{},u=i.match(/\\trowd.*?\\row\b/g);if(!u.length)throw new Error("RTF missing table");var f={s:{c:0,r:0},e:{c:0,r:u.length-1}};return u.forEach(function(h,_){Array.isArray(v)&&(v[_]=[]);for(var x=/\\\w+\b/g,T=0,b,w=-1;b=x.exec(h);){switch(b[0]){case"\\cell":var A=h.slice(T,x.lastIndex-b[0].length);if(A[0]==" "&&(A=A.slice(1)),++w,A.length){var C={v:A,t:"s"};Array.isArray(v)?v[_][w]=C:v[Ea({r:_,c:w})]=C}break}T=x.lastIndex}w>f.e.c&&(f.e.c=w)}),v["!ref"]=za(f),v}function a(i,l){return Ns(t(i,l),l)}function s(i){for(var l=["{\\rtf1\\ansi"],d=cr(i["!ref"]),v,u=Array.isArray(i),f=d.s.r;f<=d.e.r;++f){l.push("\\trowd\\trautofit1");for(var h=d.s.c;h<=d.e.c;++h)l.push("\\cellx"+(h+1));for(l.push("\\pard\\intbl"),h=d.s.c;h<=d.e.c;++h){var _=Ea({r:f,c:h});v=u?(i[f]||[])[h]:i[_],!(!v||v.v==null&&(!v.f||v.F))&&(l.push(" "+(v.w||(ys(v),v.w))),l.push("\\cell"))}l.push("\\pard\\intbl\\row")}return l.join("")+"}"}return{to_workbook:a,to_sheet:t,from_sheet:s}}();function g2(t){var r=t.slice(t[0]==="#"?1:0).slice(0,6);return[parseInt(r.slice(0,2),16),parseInt(r.slice(2,4),16),parseInt(r.slice(4,6),16)]}function Li(t){for(var r=0,a=1;r!=3;++r)a=a*256+(t[r]>255?255:t[r]<0?0:t[r]);return a.toString(16).toUpperCase().slice(1)}function x2(t){var r=t[0]/255,a=t[1]/255,s=t[2]/255,i=Math.max(r,a,s),l=Math.min(r,a,s),d=i-l;if(d===0)return[0,0,r];var v=0,u=0,f=i+l;switch(u=d/(f>1?2-f:f),i){case r:v=((a-s)/d+6)%6;break;case a:v=(s-r)/d+2;break;case s:v=(r-a)/d+4;break}return[v/6,u,f/2]}function b2(t){var r=t[0],a=t[1],s=t[2],i=a*2*(s<.5?s:1-s),l=s-i/2,d=[l,l,l],v=6*r,u;if(a!==0)switch(v|0){case 0:case 6:u=i*v,d[0]+=i,d[1]+=u;break;case 1:u=i*(2-v),d[0]+=u,d[1]+=i;break;case 2:u=i*(v-2),d[1]+=i,d[2]+=u;break;case 3:u=i*(4-v),d[1]+=u,d[2]+=i;break;case 4:u=i*(v-4),d[2]+=i,d[0]+=u;break;case 5:u=i*(6-v),d[2]+=u,d[0]+=i;break}for(var f=0;f!=3;++f)d[f]=Math.round(d[f]*255);return d}function pn(t,r){if(r===0)return t;var a=x2(g2(t));return r<0?a[2]=a[2]*(1+r):a[2]=1-(1-a[2])*(1-r),Li(b2(a))}var td=6,w2=15,y2=1,Nr=td;function hn(t){return Math.floor((t+Math.round(128/Nr)/256)*Nr)}function mn(t){return Math.floor((t-5)/Nr*100+.5)/100}function jn(t){return Math.round((t*Nr+5)/Nr*256)/256}function Rn(t){return jn(mn(hn(t)))}function _o(t){var r=Math.abs(t-Rn(t)),a=Nr;if(r>.005)for(Nr=y2;Nr<w2;++Nr)Math.abs(t-Rn(t))<=r&&(r=Math.abs(t-Rn(t)),a=Nr);Nr=a}function ni(t){t.width?(t.wpx=hn(t.width),t.wch=mn(t.wpx),t.MDW=Nr):t.wpx?(t.wch=mn(t.wpx),t.width=jn(t.wch),t.MDW=Nr):typeof t.wch=="number"&&(t.width=jn(t.wch),t.wpx=hn(t.width),t.MDW=Nr),t.customWidth&&delete t.customWidth}var k2=96,ad=k2;function rd(t){return t*96/ad}function Oi(t){return t*ad/96}var T2={None:"none",Solid:"solid",Gray50:"mediumGray",Gray75:"darkGray",Gray25:"lightGray",HorzStripe:"darkHorizontal",VertStripe:"darkVertical",ReverseDiagStripe:"darkDown",DiagStripe:"darkUp",DiagCross:"darkGrid",ThickDiagCross:"darkTrellis",ThinHorzStripe:"lightHorizontal",ThinVertStripe:"lightVertical",ThinReverseDiagStripe:"lightDown",ThinHorzCross:"lightGrid"};function E2(t,r,a,s){r.Borders=[];var i={},l=!1;(t[0].match(Mr)||[]).forEach(function(d){var v=ba(d);switch(ps(v[0])){case"<borders":case"<borders>":case"</borders>":break;case"<border":case"<border>":case"<border/>":i={},v.diagonalUp&&(i.diagonalUp=er(v.diagonalUp)),v.diagonalDown&&(i.diagonalDown=er(v.diagonalDown)),r.Borders.push(i);break;case"</border>":break;case"<left/>":break;case"<left":case"<left>":break;case"</left>":break;case"<right/>":break;case"<right":case"<right>":break;case"</right>":break;case"<top/>":break;case"<top":case"<top>":break;case"</top>":break;case"<bottom/>":break;case"<bottom":case"<bottom>":break;case"</bottom>":break;case"<diagonal":case"<diagonal>":case"<diagonal/>":break;case"</diagonal>":break;case"<horizontal":case"<horizontal>":case"<horizontal/>":break;case"</horizontal>":break;case"<vertical":case"<vertical>":case"<vertical/>":break;case"</vertical>":break;case"<start":case"<start>":case"<start/>":break;case"</start>":break;case"<end":case"<end>":case"<end/>":break;case"</end>":break;case"<color":case"<color>":break;case"<color/>":case"</color>":break;case"<extLst":case"<extLst>":case"</extLst>":break;case"<ext":l=!0;break;case"</ext>":l=!1;break;default:if(s&&s.WTF&&!l)throw new Error("unrecognized "+v[0]+" in borders")}})}function A2(t,r,a,s){r.Fills=[];var i={},l=!1;(t[0].match(Mr)||[]).forEach(function(d){var v=ba(d);switch(ps(v[0])){case"<fills":case"<fills>":case"</fills>":break;case"<fill>":case"<fill":case"<fill/>":i={},r.Fills.push(i);break;case"</fill>":break;case"<gradientFill>":break;case"<gradientFill":case"</gradientFill>":r.Fills.push(i),i={};break;case"<patternFill":case"<patternFill>":v.patternType&&(i.patternType=v.patternType);break;case"<patternFill/>":case"</patternFill>":break;case"<bgColor":i.bgColor||(i.bgColor={}),v.indexed&&(i.bgColor.indexed=parseInt(v.indexed,10)),v.theme&&(i.bgColor.theme=parseInt(v.theme,10)),v.tint&&(i.bgColor.tint=parseFloat(v.tint)),v.rgb&&(i.bgColor.rgb=v.rgb.slice(-6));break;case"<bgColor/>":case"</bgColor>":break;case"<fgColor":i.fgColor||(i.fgColor={}),v.theme&&(i.fgColor.theme=parseInt(v.theme,10)),v.tint&&(i.fgColor.tint=parseFloat(v.tint)),v.rgb!=null&&(i.fgColor.rgb=v.rgb.slice(-6));break;case"<fgColor/>":case"</fgColor>":break;case"<stop":case"<stop/>":break;case"</stop>":break;case"<color":case"<color/>":break;case"</color>":break;case"<extLst":case"<extLst>":case"</extLst>":break;case"<ext":l=!0;break;case"</ext>":l=!1;break;default:if(s&&s.WTF&&!l)throw new Error("unrecognized "+v[0]+" in fills")}})}function S2(t,r,a,s){r.Fonts=[];var i={},l=!1;(t[0].match(Mr)||[]).forEach(function(d){var v=ba(d);switch(ps(v[0])){case"<fonts":case"<fonts>":case"</fonts>":break;case"<font":case"<font>":break;case"</font>":case"<font/>":r.Fonts.push(i),i={};break;case"<name":v.val&&(i.name=Ka(v.val));break;case"<name/>":case"</name>":break;case"<b":i.bold=v.val?er(v.val):1;break;case"<b/>":i.bold=1;break;case"<i":i.italic=v.val?er(v.val):1;break;case"<i/>":i.italic=1;break;case"<u":switch(v.val){case"none":i.underline=0;break;case"single":i.underline=1;break;case"double":i.underline=2;break;case"singleAccounting":i.underline=33;break;case"doubleAccounting":i.underline=34;break}break;case"<u/>":i.underline=1;break;case"<strike":i.strike=v.val?er(v.val):1;break;case"<strike/>":i.strike=1;break;case"<outline":i.outline=v.val?er(v.val):1;break;case"<outline/>":i.outline=1;break;case"<shadow":i.shadow=v.val?er(v.val):1;break;case"<shadow/>":i.shadow=1;break;case"<condense":i.condense=v.val?er(v.val):1;break;case"<condense/>":i.condense=1;break;case"<extend":i.extend=v.val?er(v.val):1;break;case"<extend/>":i.extend=1;break;case"<sz":v.val&&(i.sz=+v.val);break;case"<sz/>":case"</sz>":break;case"<vertAlign":v.val&&(i.vertAlign=v.val);break;case"<vertAlign/>":case"</vertAlign>":break;case"<family":v.val&&(i.family=parseInt(v.val,10));break;case"<family/>":case"</family>":break;case"<scheme":v.val&&(i.scheme=v.val);break;case"<scheme/>":case"</scheme>":break;case"<charset":if(v.val=="1")break;v.codepage=Zn[parseInt(v.val,10)];break;case"<color":if(i.color||(i.color={}),v.auto&&(i.color.auto=er(v.auto)),v.rgb)i.color.rgb=v.rgb.slice(-6);else if(v.indexed){i.color.index=parseInt(v.indexed,10);var u=$s[i.color.index];i.color.index==81&&(u=$s[1]),u||(u=$s[1]),i.color.rgb=u[0].toString(16)+u[1].toString(16)+u[2].toString(16)}else v.theme&&(i.color.theme=parseInt(v.theme,10),v.tint&&(i.color.tint=parseFloat(v.tint)),v.theme&&a.themeElements&&a.themeElements.clrScheme&&(i.color.rgb=pn(a.themeElements.clrScheme[i.color.theme].rgb,i.color.tint||0)));break;case"<color/>":case"</color>":break;case"<AlternateContent":l=!0;break;case"</AlternateContent>":l=!1;break;case"<extLst":case"<extLst>":case"</extLst>":break;case"<ext":l=!0;break;case"</ext>":l=!1;break;default:if(s&&s.WTF&&!l)throw new Error("unrecognized "+v[0]+" in fonts")}})}function C2(t,r,a){r.NumberFmt=[];for(var s=fs(Sa),i=0;i<s.length;++i)r.NumberFmt[s[i]]=Sa[s[i]];var l=t[0].match(Mr);if(l)for(i=0;i<l.length;++i){var d=ba(l[i]);switch(ps(d[0])){case"<numFmts":case"</numFmts>":case"<numFmts/>":case"<numFmts>":break;case"<numFmt":{var v=Ua(Ka(d.formatCode)),u=parseInt(d.numFmtId,10);if(r.NumberFmt[u]=v,u>0){if(u>392){for(u=392;u>60&&r.NumberFmt[u]!=null;--u);r.NumberFmt[u]=v}Bs(v,u)}}break;case"</numFmt>":break;default:if(a.WTF)throw new Error("unrecognized "+d[0]+" in numFmts")}}}var tn=["numFmtId","fillId","fontId","borderId","xfId"],an=["applyAlignment","applyBorder","applyFill","applyFont","applyNumberFormat","applyProtection","pivotButton","quotePrefix"];function F2(t,r,a){r.CellXf=[];var s,i=!1;(t[0].match(Mr)||[]).forEach(function(l){var d=ba(l),v=0;switch(ps(d[0])){case"<cellXfs":case"<cellXfs>":case"<cellXfs/>":case"</cellXfs>":break;case"<xf":case"<xf/>":for(s=d,delete s[0],v=0;v<tn.length;++v)s[tn[v]]&&(s[tn[v]]=parseInt(s[tn[v]],10));for(v=0;v<an.length;++v)s[an[v]]&&(s[an[v]]=er(s[an[v]]));if(r.NumberFmt&&s.numFmtId>392){for(v=392;v>60;--v)if(r.NumberFmt[s.numFmtId]==r.NumberFmt[v]){s.numFmtId=v;break}}r.CellXf.push(s);break;case"</xf>":break;case"<alignment":case"<alignment/>":var u={};d.vertical&&(u.vertical=d.vertical),d.horizontal&&(u.horizontal=d.horizontal),d.textRotation!=null&&(u.textRotation=d.textRotation),d.indent&&(u.indent=d.indent),d.wrapText&&(u.wrapText=er(d.wrapText)),s.alignment=u;break;case"</alignment>":break;case"<protection":break;case"</protection>":case"<protection/>":break;case"<AlternateContent":i=!0;break;case"</AlternateContent>":i=!1;break;case"<extLst":case"<extLst>":case"</extLst>":break;case"<ext":i=!0;break;case"</ext>":i=!1;break;default:if(a&&a.WTF&&!i)throw new Error("unrecognized "+d[0]+" in cellXfs")}})}var D2=function(){var r=/<(?:\w+:)?numFmts([^>]*)>[\S\s]*?<\/(?:\w+:)?numFmts>/,a=/<(?:\w+:)?cellXfs([^>]*)>[\S\s]*?<\/(?:\w+:)?cellXfs>/,s=/<(?:\w+:)?fills([^>]*)>[\S\s]*?<\/(?:\w+:)?fills>/,i=/<(?:\w+:)?fonts([^>]*)>[\S\s]*?<\/(?:\w+:)?fonts>/,l=/<(?:\w+:)?borders([^>]*)>[\S\s]*?<\/(?:\w+:)?borders>/;return function(v,u,f){var h={};if(!v)return h;v=v.replace(/<!--([\s\S]*?)-->/mg,"").replace(/<!DOCTYPE[^\[]*\[[^\]]*\]>/gm,"");var _;return(_=v.match(r))&&C2(_,h,f),(_=v.match(i))&&S2(_,h,u,f),(_=v.match(s))&&A2(_,h,u,f),(_=v.match(l))&&E2(_,h,u,f),(_=v.match(a))&&F2(_,h,f),h}}();function M2(t,r){var a=t.read_shift(2),s=Fr(t);return[a,s]}function I2(t,r,a){var s={};s.sz=t.read_shift(2)/20;var i=qm(t);i.fItalic&&(s.italic=1),i.fCondense&&(s.condense=1),i.fExtend&&(s.extend=1),i.fShadow&&(s.shadow=1),i.fOutline&&(s.outline=1),i.fStrikeout&&(s.strike=1);var l=t.read_shift(2);switch(l===700&&(s.bold=1),t.read_shift(2)){case 1:s.vertAlign="superscript";break;case 2:s.vertAlign="subscript";break}var d=t.read_shift(1);d!=0&&(s.underline=d);var v=t.read_shift(1);v>0&&(s.family=v);var u=t.read_shift(1);switch(u>0&&(s.charset=u),t.l++,s.color=Um(t),t.read_shift(1)){case 1:s.scheme="major";break;case 2:s.scheme="minor";break}return s.name=Fr(t),s}var R2=Dr;function N2(t,r){var a=t.l+r,s=t.read_shift(2),i=t.read_shift(2);return t.l=a,{ixfe:s,numFmtId:i}}var P2=Dr;function L2(t,r,a){var s={};s.NumberFmt=[];for(var i in Sa)s.NumberFmt[i]=Sa[i];s.CellXf=[],s.Fonts=[];var l=[],d=!1;return Ts(t,function(u,f,h){switch(h){case 44:s.NumberFmt[u[0]]=u[1],Bs(u[1],u[0]);break;case 43:s.Fonts.push(u),u.color.theme!=null&&r&&r.themeElements&&r.themeElements.clrScheme&&(u.color.rgb=pn(r.themeElements.clrScheme[u.color.theme].rgb,u.color.tint||0));break;case 1025:break;case 45:break;case 46:break;case 47:l[l.length-1]==617&&s.CellXf.push(u);break;case 48:case 507:case 572:case 475:break;case 1171:case 2102:case 1130:case 512:case 2095:case 3072:break;case 35:d=!0;break;case 36:d=!1;break;case 37:l.push(h),d=!0;break;case 38:l.pop(),d=!1;break;default:if(f.T>0)l.push(h);else if(f.T<0)l.pop();else if(!d||a.WTF&&l[l.length-1]!=37)throw new Error("Unexpected record 0x"+h.toString(16))}}),s}var O2=["</a:lt1>","</a:dk1>","</a:lt2>","</a:dk2>","</a:accent1>","</a:accent2>","</a:accent3>","</a:accent4>","</a:accent5>","</a:accent6>","</a:hlink>","</a:folHlink>"];function z2(t,r,a){r.themeElements.clrScheme=[];var s={};(t[0].match(Mr)||[]).forEach(function(i){var l=ba(i);switch(l[0]){case"<a:clrScheme":case"</a:clrScheme>":break;case"<a:srgbClr":s.rgb=l.val;break;case"<a:sysClr":s.rgb=l.lastClr;break;case"<a:dk1>":case"</a:dk1>":case"<a:lt1>":case"</a:lt1>":case"<a:dk2>":case"</a:dk2>":case"<a:lt2>":case"</a:lt2>":case"<a:accent1>":case"</a:accent1>":case"<a:accent2>":case"</a:accent2>":case"<a:accent3>":case"</a:accent3>":case"<a:accent4>":case"</a:accent4>":case"<a:accent5>":case"</a:accent5>":case"<a:accent6>":case"</a:accent6>":case"<a:hlink>":case"</a:hlink>":case"<a:folHlink>":case"</a:folHlink>":l[0].charAt(1)==="/"?(r.themeElements.clrScheme[O2.indexOf(l[0])]=s,s={}):s.name=l[0].slice(3,l[0].length-1);break;default:if(a&&a.WTF)throw new Error("Unrecognized "+l[0]+" in clrScheme")}})}function B2(){}function $2(){}var U2=/<a:clrScheme([^>]*)>[\s\S]*<\/a:clrScheme>/,q2=/<a:fontScheme([^>]*)>[\s\S]*<\/a:fontScheme>/,j2=/<a:fmtScheme([^>]*)>[\s\S]*<\/a:fmtScheme>/;function W2(t,r,a){r.themeElements={};var s;[["clrScheme",U2,z2],["fontScheme",q2,B2],["fmtScheme",j2,$2]].forEach(function(i){if(!(s=t.match(i[1])))throw new Error(i[0]+" not found in themeElements");i[2](s,r,a)})}var H2=/<a:themeElements([^>]*)>[\s\S]*<\/a:themeElements>/;function sd(t,r){(!t||t.length===0)&&(t=V2());var a,s={};if(!(a=t.match(H2)))throw new Error("themeElements not found in theme");return W2(a[0],s,r),s.raw=t,s}function V2(t,r){var a=[hc];return a[a.length]='<a:theme xmlns:a="http://schemas.openxmlformats.org/drawingml/2006/main" name="Office Theme">',a[a.length]="<a:themeElements>",a[a.length]='<a:clrScheme name="Office">',a[a.length]='<a:dk1><a:sysClr val="windowText" lastClr="000000"/></a:dk1>',a[a.length]='<a:lt1><a:sysClr val="window" lastClr="FFFFFF"/></a:lt1>',a[a.length]='<a:dk2><a:srgbClr val="1F497D"/></a:dk2>',a[a.length]='<a:lt2><a:srgbClr val="EEECE1"/></a:lt2>',a[a.length]='<a:accent1><a:srgbClr val="4F81BD"/></a:accent1>',a[a.length]='<a:accent2><a:srgbClr val="C0504D"/></a:accent2>',a[a.length]='<a:accent3><a:srgbClr val="9BBB59"/></a:accent3>',a[a.length]='<a:accent4><a:srgbClr val="8064A2"/></a:accent4>',a[a.length]='<a:accent5><a:srgbClr val="4BACC6"/></a:accent5>',a[a.length]='<a:accent6><a:srgbClr val="F79646"/></a:accent6>',a[a.length]='<a:hlink><a:srgbClr val="0000FF"/></a:hlink>',a[a.length]='<a:folHlink><a:srgbClr val="800080"/></a:folHlink>',a[a.length]="</a:clrScheme>",a[a.length]='<a:fontScheme name="Office">',a[a.length]="<a:majorFont>",a[a.length]='<a:latin typeface="Cambria"/>',a[a.length]='<a:ea typeface=""/>',a[a.length]='<a:cs typeface=""/>',a[a.length]='<a:font script="Jpan" typeface="ＭＳ Ｐゴシック"/>',a[a.length]='<a:font script="Hang" typeface="맑은 고딕"/>',a[a.length]='<a:font script="Hans" typeface="宋体"/>',a[a.length]='<a:font script="Hant" typeface="新細明體"/>',a[a.length]='<a:font script="Arab" typeface="Times New Roman"/>',a[a.length]='<a:font script="Hebr" typeface="Times New Roman"/>',a[a.length]='<a:font script="Thai" typeface="Tahoma"/>',a[a.length]='<a:font script="Ethi" typeface="Nyala"/>',a[a.length]='<a:font script="Beng" typeface="Vrinda"/>',a[a.length]='<a:font script="Gujr" typeface="Shruti"/>',a[a.length]='<a:font script="Khmr" typeface="MoolBoran"/>',a[a.length]='<a:font script="Knda" typeface="Tunga"/>',a[a.length]='<a:font script="Guru" typeface="Raavi"/>',a[a.length]='<a:font script="Cans" typeface="Euphemia"/>',a[a.length]='<a:font script="Cher" typeface="Plantagenet Cherokee"/>',a[a.length]='<a:font script="Yiii" typeface="Microsoft Yi Baiti"/>',a[a.length]='<a:font script="Tibt" typeface="Microsoft Himalaya"/>',a[a.length]='<a:font script="Thaa" typeface="MV Boli"/>',a[a.length]='<a:font script="Deva" typeface="Mangal"/>',a[a.length]='<a:font script="Telu" typeface="Gautami"/>',a[a.length]='<a:font script="Taml" typeface="Latha"/>',a[a.length]='<a:font script="Syrc" typeface="Estrangelo Edessa"/>',a[a.length]='<a:font script="Orya" typeface="Kalinga"/>',a[a.length]='<a:font script="Mlym" typeface="Kartika"/>',a[a.length]='<a:font script="Laoo" typeface="DokChampa"/>',a[a.length]='<a:font script="Sinh" typeface="Iskoola Pota"/>',a[a.length]='<a:font script="Mong" typeface="Mongolian Baiti"/>',a[a.length]='<a:font script="Viet" typeface="Times New Roman"/>',a[a.length]='<a:font script="Uigh" typeface="Microsoft Uighur"/>',a[a.length]='<a:font script="Geor" typeface="Sylfaen"/>',a[a.length]="</a:majorFont>",a[a.length]="<a:minorFont>",a[a.length]='<a:latin typeface="Calibri"/>',a[a.length]='<a:ea typeface=""/>',a[a.length]='<a:cs typeface=""/>',a[a.length]='<a:font script="Jpan" typeface="ＭＳ Ｐゴシック"/>',a[a.length]='<a:font script="Hang" typeface="맑은 고딕"/>',a[a.length]='<a:font script="Hans" typeface="宋体"/>',a[a.length]='<a:font script="Hant" typeface="新細明體"/>',a[a.length]='<a:font script="Arab" typeface="Arial"/>',a[a.length]='<a:font script="Hebr" typeface="Arial"/>',a[a.length]='<a:font script="Thai" typeface="Tahoma"/>',a[a.length]='<a:font script="Ethi" typeface="Nyala"/>',a[a.length]='<a:font script="Beng" typeface="Vrinda"/>',a[a.length]='<a:font script="Gujr" typeface="Shruti"/>',a[a.length]='<a:font script="Khmr" typeface="DaunPenh"/>',a[a.length]='<a:font script="Knda" typeface="Tunga"/>',a[a.length]='<a:font script="Guru" typeface="Raavi"/>',a[a.length]='<a:font script="Cans" typeface="Euphemia"/>',a[a.length]='<a:font script="Cher" typeface="Plantagenet Cherokee"/>',a[a.length]='<a:font script="Yiii" typeface="Microsoft Yi Baiti"/>',a[a.length]='<a:font script="Tibt" typeface="Microsoft Himalaya"/>',a[a.length]='<a:font script="Thaa" typeface="MV Boli"/>',a[a.length]='<a:font script="Deva" typeface="Mangal"/>',a[a.length]='<a:font script="Telu" typeface="Gautami"/>',a[a.length]='<a:font script="Taml" typeface="Latha"/>',a[a.length]='<a:font script="Syrc" typeface="Estrangelo Edessa"/>',a[a.length]='<a:font script="Orya" typeface="Kalinga"/>',a[a.length]='<a:font script="Mlym" typeface="Kartika"/>',a[a.length]='<a:font script="Laoo" typeface="DokChampa"/>',a[a.length]='<a:font script="Sinh" typeface="Iskoola Pota"/>',a[a.length]='<a:font script="Mong" typeface="Mongolian Baiti"/>',a[a.length]='<a:font script="Viet" typeface="Arial"/>',a[a.length]='<a:font script="Uigh" typeface="Microsoft Uighur"/>',a[a.length]='<a:font script="Geor" typeface="Sylfaen"/>',a[a.length]="</a:minorFont>",a[a.length]="</a:fontScheme>",a[a.length]='<a:fmtScheme name="Office">',a[a.length]="<a:fillStyleLst>",a[a.length]='<a:solidFill><a:schemeClr val="phClr"/></a:solidFill>',a[a.length]='<a:gradFill rotWithShape="1">',a[a.length]="<a:gsLst>",a[a.length]='<a:gs pos="0"><a:schemeClr val="phClr"><a:tint val="50000"/><a:satMod val="300000"/></a:schemeClr></a:gs>',a[a.length]='<a:gs pos="35000"><a:schemeClr val="phClr"><a:tint val="37000"/><a:satMod val="300000"/></a:schemeClr></a:gs>',a[a.length]='<a:gs pos="100000"><a:schemeClr val="phClr"><a:tint val="15000"/><a:satMod val="350000"/></a:schemeClr></a:gs>',a[a.length]="</a:gsLst>",a[a.length]='<a:lin ang="16200000" scaled="1"/>',a[a.length]="</a:gradFill>",a[a.length]='<a:gradFill rotWithShape="1">',a[a.length]="<a:gsLst>",a[a.length]='<a:gs pos="0"><a:schemeClr val="phClr"><a:tint val="100000"/><a:shade val="100000"/><a:satMod val="130000"/></a:schemeClr></a:gs>',a[a.length]='<a:gs pos="100000"><a:schemeClr val="phClr"><a:tint val="50000"/><a:shade val="100000"/><a:satMod val="350000"/></a:schemeClr></a:gs>',a[a.length]="</a:gsLst>",a[a.length]='<a:lin ang="16200000" scaled="0"/>',a[a.length]="</a:gradFill>",a[a.length]="</a:fillStyleLst>",a[a.length]="<a:lnStyleLst>",a[a.length]='<a:ln w="9525" cap="flat" cmpd="sng" algn="ctr"><a:solidFill><a:schemeClr val="phClr"><a:shade val="95000"/><a:satMod val="105000"/></a:schemeClr></a:solidFill><a:prstDash val="solid"/></a:ln>',a[a.length]='<a:ln w="25400" cap="flat" cmpd="sng" algn="ctr"><a:solidFill><a:schemeClr val="phClr"/></a:solidFill><a:prstDash val="solid"/></a:ln>',a[a.length]='<a:ln w="38100" cap="flat" cmpd="sng" algn="ctr"><a:solidFill><a:schemeClr val="phClr"/></a:solidFill><a:prstDash val="solid"/></a:ln>',a[a.length]="</a:lnStyleLst>",a[a.length]="<a:effectStyleLst>",a[a.length]="<a:effectStyle>",a[a.length]="<a:effectLst>",a[a.length]='<a:outerShdw blurRad="40000" dist="20000" dir="5400000" rotWithShape="0"><a:srgbClr val="000000"><a:alpha val="38000"/></a:srgbClr></a:outerShdw>',a[a.length]="</a:effectLst>",a[a.length]="</a:effectStyle>",a[a.length]="<a:effectStyle>",a[a.length]="<a:effectLst>",a[a.length]='<a:outerShdw blurRad="40000" dist="23000" dir="5400000" rotWithShape="0"><a:srgbClr val="000000"><a:alpha val="35000"/></a:srgbClr></a:outerShdw>',a[a.length]="</a:effectLst>",a[a.length]="</a:effectStyle>",a[a.length]="<a:effectStyle>",a[a.length]="<a:effectLst>",a[a.length]='<a:outerShdw blurRad="40000" dist="23000" dir="5400000" rotWithShape="0"><a:srgbClr val="000000"><a:alpha val="35000"/></a:srgbClr></a:outerShdw>',a[a.length]="</a:effectLst>",a[a.length]='<a:scene3d><a:camera prst="orthographicFront"><a:rot lat="0" lon="0" rev="0"/></a:camera><a:lightRig rig="threePt" dir="t"><a:rot lat="0" lon="0" rev="1200000"/></a:lightRig></a:scene3d>',a[a.length]='<a:sp3d><a:bevelT w="63500" h="25400"/></a:sp3d>',a[a.length]="</a:effectStyle>",a[a.length]="</a:effectStyleLst>",a[a.length]="<a:bgFillStyleLst>",a[a.length]='<a:solidFill><a:schemeClr val="phClr"/></a:solidFill>',a[a.length]='<a:gradFill rotWithShape="1">',a[a.length]="<a:gsLst>",a[a.length]='<a:gs pos="0"><a:schemeClr val="phClr"><a:tint val="40000"/><a:satMod val="350000"/></a:schemeClr></a:gs>',a[a.length]='<a:gs pos="40000"><a:schemeClr val="phClr"><a:tint val="45000"/><a:shade val="99000"/><a:satMod val="350000"/></a:schemeClr></a:gs>',a[a.length]='<a:gs pos="100000"><a:schemeClr val="phClr"><a:shade val="20000"/><a:satMod val="255000"/></a:schemeClr></a:gs>',a[a.length]="</a:gsLst>",a[a.length]='<a:path path="circle"><a:fillToRect l="50000" t="-80000" r="50000" b="180000"/></a:path>',a[a.length]="</a:gradFill>",a[a.length]='<a:gradFill rotWithShape="1">',a[a.length]="<a:gsLst>",a[a.length]='<a:gs pos="0"><a:schemeClr val="phClr"><a:tint val="80000"/><a:satMod val="300000"/></a:schemeClr></a:gs>',a[a.length]='<a:gs pos="100000"><a:schemeClr val="phClr"><a:shade val="30000"/><a:satMod val="200000"/></a:schemeClr></a:gs>',a[a.length]="</a:gsLst>",a[a.length]='<a:path path="circle"><a:fillToRect l="50000" t="50000" r="50000" b="50000"/></a:path>',a[a.length]="</a:gradFill>",a[a.length]="</a:bgFillStyleLst>",a[a.length]="</a:fmtScheme>",a[a.length]="</a:themeElements>",a[a.length]="<a:objectDefaults>",a[a.length]="<a:spDef>",a[a.length]='<a:spPr/><a:bodyPr/><a:lstStyle/><a:style><a:lnRef idx="1"><a:schemeClr val="accent1"/></a:lnRef><a:fillRef idx="3"><a:schemeClr val="accent1"/></a:fillRef><a:effectRef idx="2"><a:schemeClr val="accent1"/></a:effectRef><a:fontRef idx="minor"><a:schemeClr val="lt1"/></a:fontRef></a:style>',a[a.length]="</a:spDef>",a[a.length]="<a:lnDef>",a[a.length]='<a:spPr/><a:bodyPr/><a:lstStyle/><a:style><a:lnRef idx="2"><a:schemeClr val="accent1"/></a:lnRef><a:fillRef idx="0"><a:schemeClr val="accent1"/></a:fillRef><a:effectRef idx="1"><a:schemeClr val="accent1"/></a:effectRef><a:fontRef idx="minor"><a:schemeClr val="tx1"/></a:fontRef></a:style>',a[a.length]="</a:lnDef>",a[a.length]="</a:objectDefaults>",a[a.length]="<a:extraClrSchemeLst/>",a[a.length]="</a:theme>",a.join("")}function G2(t,r,a){var s=t.l+r,i=t.read_shift(4);if(i!==124226){if(!a.cellStyles){t.l=s;return}var l=t.slice(t.l);t.l=s;var d;try{d=pc(l,{type:"array"})}catch{return}var v=Vr(d,"theme/theme/theme1.xml",!0);if(v)return sd(v,a)}}function X2(t){return t.read_shift(4)}function Y2(t){var r={};switch(r.xclrType=t.read_shift(2),r.nTintShade=t.read_shift(2),r.xclrType){case 0:t.l+=4;break;case 1:r.xclrValue=K2(t,4);break;case 2:r.xclrValue=Wc(t);break;case 3:r.xclrValue=X2(t);break;case 4:t.l+=4;break}return t.l+=8,r}function K2(t,r){return Dr(t,r)}function Q2(t,r){return Dr(t,r)}function Z2(t){var r=t.read_shift(2),a=t.read_shift(2)-4,s=[r];switch(r){case 4:case 5:case 7:case 8:case 9:case 10:case 11:case 13:s[1]=Y2(t);break;case 6:s[1]=Q2(t,a);break;case 14:case 15:s[1]=t.read_shift(a===1?1:2);break;default:throw new Error("Unrecognized ExtProp type: "+r+" "+a)}return s}function J2(t,r){var a=t.l+r;t.l+=2;var s=t.read_shift(2);t.l+=2;for(var i=t.read_shift(2),l=[];i-- >0;)l.push(Z2(t,a-t.l));return{ixfe:s,ext:l}}function ex(t,r){r.forEach(function(a){switch(a[0]){}})}function tx(t,r){return{flags:t.read_shift(4),version:t.read_shift(4),name:Fr(t)}}function ax(t){for(var r=[],a=t.read_shift(4);a-- >0;)r.push([t.read_shift(4),t.read_shift(4)]);return r}function rx(t){return t.l+=4,t.read_shift(4)!=0}function sx(t,r,a){var s={Types:[],Cell:[],Value:[]},i=a||{},l=[],d=!1,v=2;return Ts(t,function(u,f,h){switch(h){case 335:s.Types.push({name:u.name});break;case 51:u.forEach(function(_){v==1?s.Cell.push({type:s.Types[_[0]-1].name,index:_[1]}):v==0&&s.Value.push({type:s.Types[_[0]-1].name,index:_[1]})});break;case 337:v=u?1:0;break;case 338:v=2;break;case 35:l.push(h),d=!0;break;case 36:l.pop(),d=!1;break;default:if(!f.T){if(!d||i.WTF&&l[l.length-1]!=35)throw new Error("Unexpected record 0x"+h.toString(16))}}}),s}function ix(t,r,a){var s={Types:[],Cell:[],Value:[]};if(!t)return s;var i=!1,l=2,d;return t.replace(Mr,function(v){var u=ba(v);switch(ps(u[0])){case"<?xml":break;case"<metadata":case"</metadata>":break;case"<metadataTypes":case"</metadataTypes>":break;case"<metadataType":s.Types.push({name:u.name});break;case"</metadataType>":break;case"<futureMetadata":for(var f=0;f<s.Types.length;++f)s.Types[f].name==u.name&&(d=s.Types[f]);break;case"</futureMetadata>":break;case"<bk>":break;case"</bk>":break;case"<rc":l==1?s.Cell.push({type:s.Types[u.t-1].name,index:+u.v}):l==0&&s.Value.push({type:s.Types[u.t-1].name,index:+u.v});break;case"</rc>":break;case"<cellMetadata":l=1;break;case"</cellMetadata>":l=2;break;case"<valueMetadata":l=0;break;case"</valueMetadata>":l=2;break;case"<extLst":case"<extLst>":case"</extLst>":case"<extLst/>":break;case"<ext":i=!0;break;case"</ext>":i=!1;break;case"<rvb":if(!d)break;d.offsets||(d.offsets=[]),d.offsets.push(+u.i);break;default:if(!i&&a.WTF)throw new Error("unrecognized "+u[0]+" in metadata")}return v}),s}function nx(t){var r=[];if(!t)return r;var a=1;return(t.match(Mr)||[]).forEach(function(s){var i=ba(s);switch(i[0]){case"<?xml":break;case"<calcChain":case"<calcChain>":case"</calcChain>":break;case"<c":delete i[0],i.i?a=i.i:i.i=a,r.push(i);break}}),r}function ox(t){var r={};r.i=t.read_shift(4);var a={};a.r=t.read_shift(4),a.c=t.read_shift(4),r.r=Ea(a);var s=t.read_shift(1);return s&2&&(r.l="1"),s&8&&(r.a="1"),r}function lx(t,r,a){var s=[];return Ts(t,function(l,d,v){switch(v){case 63:s.push(l);break;default:if(!d.T)throw new Error("Unexpected record 0x"+v.toString(16))}}),s}function cx(t,r,a,s){if(!t)return t;var i=s||{},l=!1;Ts(t,function(v,u,f){switch(f){case 359:case 363:case 364:case 366:case 367:case 368:case 369:case 370:case 371:case 472:case 577:case 578:case 579:case 580:case 581:case 582:case 583:case 584:case 585:case 586:case 587:break;case 35:l=!0;break;case 36:l=!1;break;default:if(!u.T){if(!l||i.WTF)throw new Error("Unexpected record 0x"+f.toString(16))}}},i)}function dx(t,r){if(!t)return"??";var a=(t.match(/<c:chart [^>]*r:id="([^"]*)"/)||["",""])[1];return r["!id"][a].Target}function wl(t,r,a,s){var i=Array.isArray(t),l;r.forEach(function(d){var v=Pr(d.ref);if(i?(t[v.r]||(t[v.r]=[]),l=t[v.r][v.c]):l=t[d.ref],!l){l={t:"z"},i?t[v.r][v.c]=l:t[d.ref]=l;var u=cr(t["!ref"]||"BDWGO1000001:A1");u.s.r>v.r&&(u.s.r=v.r),u.e.r<v.r&&(u.e.r=v.r),u.s.c>v.c&&(u.s.c=v.c),u.e.c<v.c&&(u.e.c=v.c);var f=za(u);f!==t["!ref"]&&(t["!ref"]=f)}l.c||(l.c=[]);var h={a:d.author,t:d.t,r:d.r,T:a};d.h&&(h.h=d.h);for(var _=l.c.length-1;_>=0;--_){if(!a&&l.c[_].T)return;a&&!l.c[_].T&&l.c.splice(_,1)}if(a&&s){for(_=0;_<s.length;++_)if(h.a==s[_].id){h.a=s[_].name||h.a;break}}l.c.push(h)})}function vx(t,r){if(t.match(/<(?:\w+:)?comments *\/>/))return[];var a=[],s=[],i=t.match(/<(?:\w+:)?authors>([\s\S]*)<\/(?:\w+:)?authors>/);i&&i[1]&&i[1].split(/<\/\w*:?author>/).forEach(function(d){if(!(d===""||d.trim()==="")){var v=d.match(/<(?:\w+:)?author[^>]*>(.*)/);v&&a.push(v[1])}});var l=t.match(/<(?:\w+:)?commentList>([\s\S]*)<\/(?:\w+:)?commentList>/);return l&&l[1]&&l[1].split(/<\/\w*:?comment>/).forEach(function(d){if(!(d===""||d.trim()==="")){var v=d.match(/<(?:\w+:)?comment[^>]*>/);if(v){var u=ba(v[0]),f={author:u.authorId&&a[u.authorId]||"sheetjsghost",ref:u.ref,guid:u.guid},h=Pr(u.ref);if(!(r.sheetRows&&r.sheetRows<=h.r)){var _=d.match(/<(?:\w+:)?text>([\s\S]*)<\/(?:\w+:)?text>/),x=!!_&&!!_[1]&&mo(_[1])||{r:"",t:"",h:""};f.r=x.r,x.r=="<t></t>"&&(x.t=x.h=""),f.t=(x.t||"").replace(/\r\n/g,`
`).replace(/\r/g,`
`),r.cellHTML&&(f.h=x.h),s.push(f)}}}}),s}function ux(t,r){var a=[],s=!1,i={},l=0;return t.replace(Mr,function(v,u){var f=ba(v);switch(ps(f[0])){case"<?xml":break;case"<ThreadedComments":break;case"</ThreadedComments>":break;case"<threadedComment":i={author:f.personId,guid:f.id,ref:f.ref,T:1};break;case"</threadedComment>":i.t!=null&&a.push(i);break;case"<text>":case"<text":l=u+v.length;break;case"</text>":i.t=t.slice(l,u).replace(/\r\n/g,`
`).replace(/\r/g,`
`);break;case"<mentions":case"<mentions>":s=!0;break;case"</mentions>":s=!1;break;case"<extLst":case"<extLst>":case"</extLst>":case"<extLst/>":break;case"<ext":s=!0;break;case"</ext>":s=!1;break;default:if(!s&&r.WTF)throw new Error("unrecognized "+f[0]+" in threaded comments")}return v}),a}function fx(t,r){var a=[],s=!1;return t.replace(Mr,function(l){var d=ba(l);switch(ps(d[0])){case"<?xml":break;case"<personList":break;case"</personList>":break;case"<person":a.push({name:d.displayname,id:d.id});break;case"</person>":break;case"<extLst":case"<extLst>":case"</extLst>":case"<extLst/>":break;case"<ext":s=!0;break;case"</ext>":s=!1;break;default:if(!s&&r.WTF)throw new Error("unrecognized "+d[0]+" in threaded comments")}return l}),a}function px(t){var r={};r.iauthor=t.read_shift(4);var a=Ys(t);return r.rfx=a.s,r.ref=Ea(a.s),t.l+=16,r}var hx=Fr;function mx(t,r){var a=[],s=[],i={},l=!1;return Ts(t,function(v,u,f){switch(f){case 632:s.push(v);break;case 635:i=v;break;case 637:i.t=v.t,i.h=v.h,i.r=v.r;break;case 636:if(i.author=s[i.iauthor],delete i.iauthor,r.sheetRows&&i.rfx&&r.sheetRows<=i.rfx.r)break;i.t||(i.t=""),delete i.rfx,a.push(i);break;case 3072:break;case 35:l=!0;break;case 36:l=!1;break;case 37:break;case 38:break;default:if(!u.T){if(!l||r.WTF)throw new Error("Unexpected record 0x"+f.toString(16))}}}),a}var _x="application/vnd.ms-office.vbaProject";function gx(t){var r=Oa.utils.cfb_new({root:"R"});return t.FullPaths.forEach(function(a,s){if(!(a.slice(-1)==="/"||!a.match(/_VBA_PROJECT_CUR/))){var i=a.replace(/^[^\/]*/,"R").replace(/\/_VBA_PROJECT_CUR\u0000*/,"");Oa.utils.cfb_add(r,i,t.FileIndex[s].content)}}),Oa.write(r)}function xx(){return{"!type":"dialog"}}function bx(){return{"!type":"dialog"}}function wx(){return{"!type":"macro"}}function yx(){return{"!type":"macro"}}var ri=function(){var t=/(^|[^A-Za-z_])R(\[?-?\d+\]|[1-9]\d*|)C(\[?-?\d+\]|[1-9]\d*|)(?![A-Za-z0-9_])/g,r={r:0,c:0};function a(s,i,l,d){var v=!1,u=!1;l.length==0?u=!0:l.charAt(0)=="["&&(u=!0,l=l.slice(1,-1)),d.length==0?v=!0:d.charAt(0)=="["&&(v=!0,d=d.slice(1,-1));var f=l.length>0?parseInt(l,10)|0:0,h=d.length>0?parseInt(d,10)|0:0;return v?h+=r.c:--h,u?f+=r.r:--f,i+(v?"":"$")+_r(h)+(u?"":"$")+Tr(f)}return function(i,l){return r=l,i.replace(t,a)}}(),id=/(^|[^._A-Z0-9])([$]?)([A-Z]{1,2}|[A-W][A-Z]{2}|X[A-E][A-Z]|XF[A-D])([$]?)(10[0-3]\d{4}|104[0-7]\d{3}|1048[0-4]\d{2}|10485[0-6]\d|104857[0-6]|[1-9]\d{0,5})(?![_.\(A-Za-z0-9])/g,kx=function(){return function(r,a){return r.replace(id,function(s,i,l,d,v,u){var f=co(d)-(l?0:a.c),h=lo(u)-(v?0:a.r),_=h==0?"":v?h+1:"["+h+"]",x=f==0?"":l?f+1:"["+f+"]";return i+"R"+_+"C"+x})}}();function nd(t,r){return t.replace(id,function(a,s,i,l,d,v){return s+(i=="$"?i+l:_r(co(l)+r.c))+(d=="$"?d+v:Tr(lo(v)+r.r))})}function Tx(t,r,a){var s=li(r),i=s.s,l=Pr(a),d={r:l.r-i.r,c:l.c-i.c};return nd(t,d)}function Ex(t){return t.length!=1}function yl(t){return t.replace(/_xlfn\./g,"")}function ur(t){t.l+=1}function Rs(t,r){var a=t.read_shift(2);return[a&16383,a>>14&1,a>>15&1]}function od(t,r,a){var s=2;if(a){if(a.biff>=2&&a.biff<=5)return ld(t);a.biff==12&&(s=4)}var i=t.read_shift(s),l=t.read_shift(s),d=Rs(t),v=Rs(t);return{s:{r:i,c:d[0],cRel:d[1],rRel:d[2]},e:{r:l,c:v[0],cRel:v[1],rRel:v[2]}}}function ld(t){var r=Rs(t),a=Rs(t),s=t.read_shift(1),i=t.read_shift(1);return{s:{r:r[0],c:s,cRel:r[1],rRel:r[2]},e:{r:a[0],c:i,cRel:a[1],rRel:a[2]}}}function Ax(t,r,a){if(a.biff<8)return ld(t);var s=t.read_shift(a.biff==12?4:2),i=t.read_shift(a.biff==12?4:2),l=Rs(t),d=Rs(t);return{s:{r:s,c:l[0],cRel:l[1],rRel:l[2]},e:{r:i,c:d[0],cRel:d[1],rRel:d[2]}}}function cd(t,r,a){if(a&&a.biff>=2&&a.biff<=5)return Sx(t);var s=t.read_shift(a&&a.biff==12?4:2),i=Rs(t);return{r:s,c:i[0],cRel:i[1],rRel:i[2]}}function Sx(t){var r=Rs(t),a=t.read_shift(1);return{r:r[0],c:a,cRel:r[1],rRel:r[2]}}function Cx(t){var r=t.read_shift(2),a=t.read_shift(2);return{r,c:a&255,fQuoted:!!(a&16384),cRel:a>>15,rRel:a>>15}}function Fx(t,r,a){var s=a&&a.biff?a.biff:8;if(s>=2&&s<=5)return Dx(t);var i=t.read_shift(s>=12?4:2),l=t.read_shift(2),d=(l&16384)>>14,v=(l&32768)>>15;if(l&=16383,v==1)for(;i>524287;)i-=1048576;if(d==1)for(;l>8191;)l=l-16384;return{r:i,c:l,cRel:d,rRel:v}}function Dx(t){var r=t.read_shift(2),a=t.read_shift(1),s=(r&32768)>>15,i=(r&16384)>>14;return r&=16383,s==1&&r>=8192&&(r=r-16384),i==1&&a>=128&&(a=a-256),{r,c:a,cRel:i,rRel:s}}function Mx(t,r,a){var s=(t[t.l++]&96)>>5,i=od(t,a.biff>=2&&a.biff<=5?6:8,a);return[s,i]}function Ix(t,r,a){var s=(t[t.l++]&96)>>5,i=t.read_shift(2,"i"),l=8;if(a)switch(a.biff){case 5:t.l+=12,l=6;break;case 12:l=12;break}var d=od(t,l,a);return[s,i,d]}function Rx(t,r,a){var s=(t[t.l++]&96)>>5;return t.l+=a&&a.biff>8?12:a.biff<8?6:8,[s]}function Nx(t,r,a){var s=(t[t.l++]&96)>>5,i=t.read_shift(2),l=8;if(a)switch(a.biff){case 5:t.l+=12,l=6;break;case 12:l=12;break}return t.l+=l,[s,i]}function Px(t,r,a){var s=(t[t.l++]&96)>>5,i=Ax(t,r-1,a);return[s,i]}function Lx(t,r,a){var s=(t[t.l++]&96)>>5;return t.l+=a.biff==2?6:a.biff==12?14:7,[s]}function kl(t){var r=t[t.l+1]&1,a=1;return t.l+=4,[r,a]}function Ox(t,r,a){t.l+=2;for(var s=t.read_shift(a&&a.biff==2?1:2),i=[],l=0;l<=s;++l)i.push(t.read_shift(a&&a.biff==2?1:2));return i}function zx(t,r,a){var s=t[t.l+1]&255?1:0;return t.l+=2,[s,t.read_shift(a&&a.biff==2?1:2)]}function Bx(t,r,a){var s=t[t.l+1]&255?1:0;return t.l+=2,[s,t.read_shift(a&&a.biff==2?1:2)]}function $x(t){var r=t[t.l+1]&255?1:0;return t.l+=2,[r,t.read_shift(2)]}function Ux(t,r,a){var s=t[t.l+1]&255?1:0;return t.l+=a&&a.biff==2?3:4,[s]}function dd(t){var r=t.read_shift(1),a=t.read_shift(1);return[r,a]}function qx(t){return t.read_shift(2),dd(t)}function jx(t){return t.read_shift(2),dd(t)}function Wx(t,r,a){var s=(t[t.l]&96)>>5;t.l+=1;var i=cd(t,0,a);return[s,i]}function Hx(t,r,a){var s=(t[t.l]&96)>>5;t.l+=1;var i=Fx(t,0,a);return[s,i]}function Vx(t,r,a){var s=(t[t.l]&96)>>5;t.l+=1;var i=t.read_shift(2);a&&a.biff==5&&(t.l+=12);var l=cd(t,0,a);return[s,i,l]}function Gx(t,r,a){var s=(t[t.l]&96)>>5;t.l+=1;var i=t.read_shift(a&&a.biff<=3?1:2);return[Xb[i],fd[i],s]}function Xx(t,r,a){var s=t[t.l++],i=t.read_shift(1),l=a&&a.biff<=3?[s==88?-1:0,t.read_shift(1)]:Yx(t);return[i,(l[0]===0?fd:Gb)[l[1]]]}function Yx(t){return[t[t.l+1]>>7,t.read_shift(2)&32767]}function Kx(t,r,a){t.l+=a&&a.biff==2?3:4}function Qx(t,r,a){if(t.l++,a&&a.biff==12)return[t.read_shift(4,"i"),0];var s=t.read_shift(2),i=t.read_shift(a&&a.biff==2?1:2);return[s,i]}function Zx(t){return t.l++,Ks[t.read_shift(1)]}function Jx(t){return t.l++,t.read_shift(2)}function eb(t){return t.l++,t.read_shift(1)!==0}function tb(t){return t.l++,Sr(t)}function ab(t,r,a){return t.l++,qi(t,r-1,a)}function rb(t,r){var a=[t.read_shift(1)];if(r==12)switch(a[0]){case 2:a[0]=4;break;case 4:a[0]=16;break;case 0:a[0]=1;break;case 1:a[0]=2;break}switch(a[0]){case 4:a[1]=vr(t,1)?"TRUE":"FALSE",r!=12&&(t.l+=7);break;case 37:case 16:a[1]=Ks[t[t.l]],t.l+=r==12?4:8;break;case 0:t.l+=8;break;case 1:a[1]=Sr(t);break;case 2:a[1]=Qs(t,0,{biff:r>0&&r<8?2:r});break;default:throw new Error("Bad SerAr: "+a[0])}return a}function sb(t,r,a){for(var s=t.read_shift(a.biff==12?4:2),i=[],l=0;l!=s;++l)i.push((a.biff==12?Ys:bn)(t));return i}function ib(t,r,a){var s=0,i=0;a.biff==12?(s=t.read_shift(4),i=t.read_shift(4)):(i=1+t.read_shift(1),s=1+t.read_shift(2)),a.biff>=2&&a.biff<8&&(--s,--i==0&&(i=256));for(var l=0,d=[];l!=s&&(d[l]=[]);++l)for(var v=0;v!=i;++v)d[l][v]=rb(t,a.biff);return d}function nb(t,r,a){var s=t.read_shift(1)>>>5&3,i=!a||a.biff>=8?4:2,l=t.read_shift(i);switch(a.biff){case 2:t.l+=5;break;case 3:case 4:t.l+=8;break;case 5:t.l+=12;break}return[s,0,l]}function ob(t,r,a){if(a.biff==5)return lb(t);var s=t.read_shift(1)>>>5&3,i=t.read_shift(2),l=t.read_shift(4);return[s,i,l]}function lb(t){var r=t.read_shift(1)>>>5&3,a=t.read_shift(2,"i");t.l+=8;var s=t.read_shift(2);return t.l+=12,[r,a,s]}function cb(t,r,a){var s=t.read_shift(1)>>>5&3;t.l+=a&&a.biff==2?3:4;var i=t.read_shift(a&&a.biff==2?1:2);return[s,i]}function db(t,r,a){var s=t.read_shift(1)>>>5&3,i=t.read_shift(a&&a.biff==2?1:2);return[s,i]}function vb(t,r,a){var s=t.read_shift(1)>>>5&3;return t.l+=4,a.biff<8&&t.l--,a.biff==12&&(t.l+=2),[s]}function ub(t,r,a){var s=(t[t.l++]&96)>>5,i=t.read_shift(2),l=4;if(a)switch(a.biff){case 5:l=15;break;case 12:l=6;break}return t.l+=l,[s,i]}var fb=Dr,pb=Dr,hb=Dr;function Wi(t,r,a){return t.l+=2,[Cx(t)]}function go(t){return t.l+=6,[]}var mb=Wi,_b=go,gb=go,xb=Wi;function vd(t){return t.l+=2,[pr(t),t.read_shift(2)&1]}var bb=Wi,wb=vd,yb=go,kb=Wi,Tb=Wi,Eb=["Data","All","Headers","??","?Data2","??","?DataHeaders","??","Totals","??","??","??","?DataTotals","??","??","??","?Current"];function Ab(t){t.l+=2;var r=t.read_shift(2),a=t.read_shift(2),s=t.read_shift(4),i=t.read_shift(2),l=t.read_shift(2),d=Eb[a>>2&31];return{ixti:r,coltype:a&3,rt:d,idx:s,c:i,C:l}}function Sb(t){return t.l+=2,[t.read_shift(4)]}function Cb(t,r,a){return t.l+=5,t.l+=2,t.l+=a.biff==2?1:4,["PTGSHEET"]}function Fb(t,r,a){return t.l+=a.biff==2?4:5,["PTGENDSHEET"]}function Db(t){var r=t.read_shift(1)>>>5&3,a=t.read_shift(2);return[r,a]}function Mb(t){var r=t.read_shift(1)>>>5&3,a=t.read_shift(2);return[r,a]}function Ib(t){return t.l+=4,[0,0]}var Tl={1:{n:"PtgExp",f:Qx},2:{n:"PtgTbl",f:hb},3:{n:"PtgAdd",f:ur},4:{n:"PtgSub",f:ur},5:{n:"PtgMul",f:ur},6:{n:"PtgDiv",f:ur},7:{n:"PtgPower",f:ur},8:{n:"PtgConcat",f:ur},9:{n:"PtgLt",f:ur},10:{n:"PtgLe",f:ur},11:{n:"PtgEq",f:ur},12:{n:"PtgGe",f:ur},13:{n:"PtgGt",f:ur},14:{n:"PtgNe",f:ur},15:{n:"PtgIsect",f:ur},16:{n:"PtgUnion",f:ur},17:{n:"PtgRange",f:ur},18:{n:"PtgUplus",f:ur},19:{n:"PtgUminus",f:ur},20:{n:"PtgPercent",f:ur},21:{n:"PtgParen",f:ur},22:{n:"PtgMissArg",f:ur},23:{n:"PtgStr",f:ab},26:{n:"PtgSheet",f:Cb},27:{n:"PtgEndSheet",f:Fb},28:{n:"PtgErr",f:Zx},29:{n:"PtgBool",f:eb},30:{n:"PtgInt",f:Jx},31:{n:"PtgNum",f:tb},32:{n:"PtgArray",f:Lx},33:{n:"PtgFunc",f:Gx},34:{n:"PtgFuncVar",f:Xx},35:{n:"PtgName",f:nb},36:{n:"PtgRef",f:Wx},37:{n:"PtgArea",f:Mx},38:{n:"PtgMemArea",f:cb},39:{n:"PtgMemErr",f:fb},40:{n:"PtgMemNoMem",f:pb},41:{n:"PtgMemFunc",f:db},42:{n:"PtgRefErr",f:vb},43:{n:"PtgAreaErr",f:Rx},44:{n:"PtgRefN",f:Hx},45:{n:"PtgAreaN",f:Px},46:{n:"PtgMemAreaN",f:Db},47:{n:"PtgMemNoMemN",f:Mb},57:{n:"PtgNameX",f:ob},58:{n:"PtgRef3d",f:Vx},59:{n:"PtgArea3d",f:Ix},60:{n:"PtgRefErr3d",f:ub},61:{n:"PtgAreaErr3d",f:Nx},255:{}},Rb={64:32,96:32,65:33,97:33,66:34,98:34,67:35,99:35,68:36,100:36,69:37,101:37,70:38,102:38,71:39,103:39,72:40,104:40,73:41,105:41,74:42,106:42,75:43,107:43,76:44,108:44,77:45,109:45,78:46,110:46,79:47,111:47,88:34,120:34,89:57,121:57,90:58,122:58,91:59,123:59,92:60,124:60,93:61,125:61},Nb={1:{n:"PtgElfLel",f:vd},2:{n:"PtgElfRw",f:kb},3:{n:"PtgElfCol",f:mb},6:{n:"PtgElfRwV",f:Tb},7:{n:"PtgElfColV",f:xb},10:{n:"PtgElfRadical",f:bb},11:{n:"PtgElfRadicalS",f:yb},13:{n:"PtgElfColS",f:_b},15:{n:"PtgElfColSV",f:gb},16:{n:"PtgElfRadicalLel",f:wb},25:{n:"PtgList",f:Ab},29:{n:"PtgSxName",f:Sb},255:{}},Pb={0:{n:"PtgAttrNoop",f:Ib},1:{n:"PtgAttrSemi",f:Ux},2:{n:"PtgAttrIf",f:Bx},4:{n:"PtgAttrChoose",f:Ox},8:{n:"PtgAttrGoto",f:zx},16:{n:"PtgAttrSum",f:Kx},32:{n:"PtgAttrBaxcel",f:kl},33:{n:"PtgAttrBaxcel",f:kl},64:{n:"PtgAttrSpace",f:qx},65:{n:"PtgAttrSpaceSemi",f:jx},128:{n:"PtgAttrIfError",f:$x},255:{}};function Hi(t,r,a,s){if(s.biff<8)return Dr(t,r);for(var i=t.l+r,l=[],d=0;d!==a.length;++d)switch(a[d][0]){case"PtgArray":a[d][1]=ib(t,0,s),l.push(a[d][1]);break;case"PtgMemArea":a[d][2]=sb(t,a[d][1],s),l.push(a[d][2]);break;case"PtgExp":s&&s.biff==12&&(a[d][1][1]=t.read_shift(4),l.push(a[d][1]));break;case"PtgList":case"PtgElfRadicalS":case"PtgElfColS":case"PtgElfColSV":throw"Unsupported "+a[d][0]}return r=i-t.l,r!==0&&l.push(Dr(t,r)),l}function Vi(t,r,a){for(var s=t.l+r,i,l,d=[];s!=t.l;)r=s-t.l,l=t[t.l],i=Tl[l]||Tl[Rb[l]],(l===24||l===25)&&(i=(l===24?Nb:Pb)[t[t.l+1]]),!i||!i.f?Dr(t,r):d.push([i.n,i.f(t,r,a)]);return d}function Lb(t){for(var r=[],a=0;a<t.length;++a){for(var s=t[a],i=[],l=0;l<s.length;++l){var d=s[l];if(d)switch(d[0]){case 2:i.push('"'+d[1].replace(/"/g,'""')+'"');break;default:i.push(d[1])}else i.push("")}r.push(i.join(","))}return r.join(";")}var Ob={PtgAdd:"+",PtgConcat:"&",PtgDiv:"/",PtgEq:"=",PtgGe:">=",PtgGt:">",PtgLe:"<=",PtgLt:"<",PtgMul:"*",PtgNe:"<>",PtgPower:"^",PtgSub:"-"};function zb(t,r){if(!t&&!(r&&r.biff<=5&&r.biff>=2))throw new Error("empty sheet name");return/[^\w\u4E00-\u9FFF\u3040-\u30FF]/.test(t)?"'"+t+"'":t}function ud(t,r,a){if(!t)return"SH33TJSERR0";if(a.biff>8&&(!t.XTI||!t.XTI[r]))return t.SheetNames[r];if(!t.XTI)return"SH33TJSERR6";var s=t.XTI[r];if(a.biff<8)return r>1e4&&(r-=65536),r<0&&(r=-r),r==0?"":t.XTI[r-1];if(!s)return"SH33TJSERR1";var i="";if(a.biff>8)switch(t[s[0]][0]){case 357:return i=s[1]==-1?"#REF":t.SheetNames[s[1]],s[1]==s[2]?i:i+":"+t.SheetNames[s[2]];case 358:return a.SID!=null?t.SheetNames[a.SID]:"SH33TJSSAME"+t[s[0]][0];case 355:default:return"SH33TJSSRC"+t[s[0]][0]}switch(t[s[0]][0][0]){case 1025:return i=s[1]==-1?"#REF":t.SheetNames[s[1]]||"SH33TJSERR3",s[1]==s[2]?i:i+":"+t.SheetNames[s[2]];case 14849:return t[s[0]].slice(1).map(function(l){return l.Name}).join(";;");default:return t[s[0]][0][3]?(i=s[1]==-1?"#REF":t[s[0]][0][3][s[1]]||"SH33TJSERR4",s[1]==s[2]?i:i+":"+t[s[0]][0][3][s[2]]):"SH33TJSERR2"}}function El(t,r,a){var s=ud(t,r,a);return s=="#REF"?s:zb(s,a)}function Ar(t,r,a,s,i){var l=i&&i.biff||8,d={s:{c:0,r:0}},v=[],u,f,h,_=0,x=0,T,b="";if(!t[0]||!t[0][0])return"";for(var w=-1,A="",C=0,z=t[0].length;C<z;++C){var F=t[0][C];switch(F[0]){case"PtgUminus":v.push("-"+v.pop());break;case"PtgUplus":v.push("+"+v.pop());break;case"PtgPercent":v.push(v.pop()+"%");break;case"PtgAdd":case"PtgConcat":case"PtgDiv":case"PtgEq":case"PtgGe":case"PtgGt":case"PtgLe":case"PtgLt":case"PtgMul":case"PtgNe":case"PtgPower":case"PtgSub":if(u=v.pop(),f=v.pop(),w>=0){switch(t[0][w][1][0]){case 0:A=lr(" ",t[0][w][1][1]);break;case 1:A=lr("\r",t[0][w][1][1]);break;default:if(A="",i.WTF)throw new Error("Unexpected PtgAttrSpaceType "+t[0][w][1][0])}f=f+A,w=-1}v.push(f+Ob[F[0]]+u);break;case"PtgIsect":u=v.pop(),f=v.pop(),v.push(f+" "+u);break;case"PtgUnion":u=v.pop(),f=v.pop(),v.push(f+","+u);break;case"PtgRange":u=v.pop(),f=v.pop(),v.push(f+":"+u);break;case"PtgAttrChoose":break;case"PtgAttrGoto":break;case"PtgAttrIf":break;case"PtgAttrIfError":break;case"PtgRef":h=yi(F[1][1],d,i),v.push(ki(h,l));break;case"PtgRefN":h=a?yi(F[1][1],a,i):F[1][1],v.push(ki(h,l));break;case"PtgRef3d":_=F[1][1],h=yi(F[1][2],d,i),b=El(s,_,i),v.push(b+"!"+ki(h,l));break;case"PtgFunc":case"PtgFuncVar":var re=F[1][0],me=F[1][1];re||(re=0),re&=127;var ue=re==0?[]:v.slice(-re);v.length-=re,me==="User"&&(me=ue.shift()),v.push(me+"("+ue.join(",")+")");break;case"PtgBool":v.push(F[1]?"TRUE":"FALSE");break;case"PtgInt":v.push(F[1]);break;case"PtgNum":v.push(String(F[1]));break;case"PtgStr":v.push('"'+F[1].replace(/"/g,'""')+'"');break;case"PtgErr":v.push(F[1]);break;case"PtgAreaN":T=il(F[1][1],a?{s:a}:d,i),v.push(Mn(T,i));break;case"PtgArea":T=il(F[1][1],d,i),v.push(Mn(T,i));break;case"PtgArea3d":_=F[1][1],T=F[1][2],b=El(s,_,i),v.push(b+"!"+Mn(T,i));break;case"PtgAttrSum":v.push("SUM("+v.pop()+")");break;case"PtgAttrBaxcel":case"PtgAttrSemi":break;case"PtgName":x=F[1][2];var D=(s.names||[])[x-1]||(s[0]||[])[x],E=D?D.Name:"SH33TJSNAME"+String(x);E&&E.slice(0,6)=="_xlfn."&&!i.xlfn&&(E=E.slice(6)),v.push(E);break;case"PtgNameX":var he=F[1][1];x=F[1][2];var xe;if(i.biff<=5)he<0&&(he=-he),s[he]&&(xe=s[he][x]);else{var K="";if(((s[he]||[])[0]||[])[0]==14849||(((s[he]||[])[0]||[])[0]==1025?s[he][x]&&s[he][x].itab>0&&(K=s.SheetNames[s[he][x].itab-1]+"!"):K=s.SheetNames[x-1]+"!"),s[he]&&s[he][x])K+=s[he][x].Name;else if(s[0]&&s[0][x])K+=s[0][x].Name;else{var q=(ud(s,he,i)||"").split(";;");q[x-1]?K=q[x-1]:K+="SH33TJSERRX"}v.push(K);break}xe||(xe={Name:"SH33TJSERRY"}),v.push(xe.Name);break;case"PtgParen":var ae="(",Me=")";if(w>=0){switch(A="",t[0][w][1][0]){case 2:ae=lr(" ",t[0][w][1][1])+ae;break;case 3:ae=lr("\r",t[0][w][1][1])+ae;break;case 4:Me=lr(" ",t[0][w][1][1])+Me;break;case 5:Me=lr("\r",t[0][w][1][1])+Me;break;default:if(i.WTF)throw new Error("Unexpected PtgAttrSpaceType "+t[0][w][1][0])}w=-1}v.push(ae+v.pop()+Me);break;case"PtgRefErr":v.push("#REF!");break;case"PtgRefErr3d":v.push("#REF!");break;case"PtgExp":h={c:F[1][1],r:F[1][0]};var ge={c:a.c,r:a.r};if(s.sharedf[Ea(h)]){var Ne=s.sharedf[Ea(h)];v.push(Ar(Ne,d,ge,s,i))}else{var Be=!1;for(u=0;u!=s.arrayf.length;++u)if(f=s.arrayf[u],!(h.c<f[0].s.c||h.c>f[0].e.c)&&!(h.r<f[0].s.r||h.r>f[0].e.r)){v.push(Ar(f[1],d,ge,s,i)),Be=!0;break}Be||v.push(F[1])}break;case"PtgArray":v.push("{"+Lb(F[1])+"}");break;case"PtgMemArea":break;case"PtgAttrSpace":case"PtgAttrSpaceSemi":w=C;break;case"PtgTbl":break;case"PtgMemErr":break;case"PtgMissArg":v.push("");break;case"PtgAreaErr":v.push("#REF!");break;case"PtgAreaErr3d":v.push("#REF!");break;case"PtgList":v.push("Table"+F[1].idx+"[#"+F[1].rt+"]");break;case"PtgMemAreaN":case"PtgMemNoMemN":case"PtgAttrNoop":case"PtgSheet":case"PtgEndSheet":break;case"PtgMemFunc":break;case"PtgMemNoMem":break;case"PtgElfCol":case"PtgElfColS":case"PtgElfColSV":case"PtgElfColV":case"PtgElfLel":case"PtgElfRadical":case"PtgElfRadicalLel":case"PtgElfRadicalS":case"PtgElfRw":case"PtgElfRwV":throw new Error("Unsupported ELFs");case"PtgSxName":throw new Error("Unrecognized Formula Token: "+String(F));default:throw new Error("Unrecognized Formula Token: "+String(F))}var be=["PtgAttrSpace","PtgAttrSpaceSemi","PtgAttrGoto"];if(i.biff!=3&&w>=0&&be.indexOf(t[0][C][0])==-1){F=t[0][w];var L=!0;switch(F[1][0]){case 4:L=!1;case 0:A=lr(" ",F[1][1]);break;case 5:L=!1;case 1:A=lr("\r",F[1][1]);break;default:if(A="",i.WTF)throw new Error("Unexpected PtgAttrSpaceType "+F[1][0])}v.push((L?A:"")+v.pop()+(L?"":A)),w=-1}}if(v.length>1&&i.WTF)throw new Error("bad formula stack");return v[0]}function Bb(t,r,a){var s=t.l+r,i=a.biff==2?1:2,l,d=t.read_shift(i);if(d==65535)return[[],Dr(t,r-2)];var v=Vi(t,d,a);return r!==d+i&&(l=Hi(t,r-d-i,v,a)),t.l=s,[v,l]}function $b(t,r,a){var s=t.l+r,i=a.biff==2?1:2,l,d=t.read_shift(i);if(d==65535)return[[],Dr(t,r-2)];var v=Vi(t,d,a);return r!==d+i&&(l=Hi(t,r-d-i,v,a)),t.l=s,[v,l]}function Ub(t,r,a,s){var i=t.l+r,l=Vi(t,s,a),d;return i!==t.l&&(d=Hi(t,i-t.l,l,a)),[l,d]}function qb(t,r,a){var s=t.l+r,i,l=t.read_shift(2),d=Vi(t,l,a);return l==65535?[[],Dr(t,r-2)]:(r!==l+2&&(i=Hi(t,s-l-2,d,a)),[d,i])}function jb(t){var r;if(xs(t,t.l+6)!==65535)return[Sr(t),"n"];switch(t[t.l]){case 0:return t.l+=8,["String","s"];case 1:return r=t[t.l+2]===1,t.l+=8,[r,"b"];case 2:return r=t[t.l+2],t.l+=8,[r,"e"];case 3:return t.l+=8,["","s"]}return[]}function Nn(t,r,a){var s=t.l+r,i=hs(t);a.biff==2&&++t.l;var l=jb(t),d=t.read_shift(1);a.biff!=2&&(t.read_shift(1),a.biff>=5&&t.read_shift(4));var v=$b(t,s-t.l,a);return{cell:i,val:l[0],formula:v,shared:d>>3&1,tt:l[1]}}function wn(t,r,a){var s=t.read_shift(4),i=Vi(t,s,a),l=t.read_shift(4),d=l>0?Hi(t,l,i,a):null;return[i,d]}var Wb=wn,yn=wn,Hb=wn,Vb=wn,Gb={0:"BEEP",1:"OPEN",2:"OPEN.LINKS",3:"CLOSE.ALL",4:"SAVE",5:"SAVE.AS",6:"FILE.DELETE",7:"PAGE.SETUP",8:"PRINT",9:"PRINTER.SETUP",10:"QUIT",11:"NEW.WINDOW",12:"ARRANGE.ALL",13:"WINDOW.SIZE",14:"WINDOW.MOVE",15:"FULL",16:"CLOSE",17:"RUN",22:"SET.PRINT.AREA",23:"SET.PRINT.TITLES",24:"SET.PAGE.BREAK",25:"REMOVE.PAGE.BREAK",26:"FONT",27:"DISPLAY",28:"PROTECT.DOCUMENT",29:"PRECISION",30:"A1.R1C1",31:"CALCULATE.NOW",32:"CALCULATION",34:"DATA.FIND",35:"EXTRACT",36:"DATA.DELETE",37:"SET.DATABASE",38:"SET.CRITERIA",39:"SORT",40:"DATA.SERIES",41:"TABLE",42:"FORMAT.NUMBER",43:"ALIGNMENT",44:"STYLE",45:"BORDER",46:"CELL.PROTECTION",47:"COLUMN.WIDTH",48:"UNDO",49:"CUT",50:"COPY",51:"PASTE",52:"CLEAR",53:"PASTE.SPECIAL",54:"EDIT.DELETE",55:"INSERT",56:"FILL.RIGHT",57:"FILL.DOWN",61:"DEFINE.NAME",62:"CREATE.NAMES",63:"FORMULA.GOTO",64:"FORMULA.FIND",65:"SELECT.LAST.CELL",66:"SHOW.ACTIVE.CELL",67:"GALLERY.AREA",68:"GALLERY.BAR",69:"GALLERY.COLUMN",70:"GALLERY.LINE",71:"GALLERY.PIE",72:"GALLERY.SCATTER",73:"COMBINATION",74:"PREFERRED",75:"ADD.OVERLAY",76:"GRIDLINES",77:"SET.PREFERRED",78:"AXES",79:"LEGEND",80:"ATTACH.TEXT",81:"ADD.ARROW",82:"SELECT.CHART",83:"SELECT.PLOT.AREA",84:"PATTERNS",85:"MAIN.CHART",86:"OVERLAY",87:"SCALE",88:"FORMAT.LEGEND",89:"FORMAT.TEXT",90:"EDIT.REPEAT",91:"PARSE",92:"JUSTIFY",93:"HIDE",94:"UNHIDE",95:"WORKSPACE",96:"FORMULA",97:"FORMULA.FILL",98:"FORMULA.ARRAY",99:"DATA.FIND.NEXT",100:"DATA.FIND.PREV",101:"FORMULA.FIND.NEXT",102:"FORMULA.FIND.PREV",103:"ACTIVATE",104:"ACTIVATE.NEXT",105:"ACTIVATE.PREV",106:"UNLOCKED.NEXT",107:"UNLOCKED.PREV",108:"COPY.PICTURE",109:"SELECT",110:"DELETE.NAME",111:"DELETE.FORMAT",112:"VLINE",113:"HLINE",114:"VPAGE",115:"HPAGE",116:"VSCROLL",117:"HSCROLL",118:"ALERT",119:"NEW",120:"CANCEL.COPY",121:"SHOW.CLIPBOARD",122:"MESSAGE",124:"PASTE.LINK",125:"APP.ACTIVATE",126:"DELETE.ARROW",127:"ROW.HEIGHT",128:"FORMAT.MOVE",129:"FORMAT.SIZE",130:"FORMULA.REPLACE",131:"SEND.KEYS",132:"SELECT.SPECIAL",133:"APPLY.NAMES",134:"REPLACE.FONT",135:"FREEZE.PANES",136:"SHOW.INFO",137:"SPLIT",138:"ON.WINDOW",139:"ON.DATA",140:"DISABLE.INPUT",142:"OUTLINE",143:"LIST.NAMES",144:"FILE.CLOSE",145:"SAVE.WORKBOOK",146:"DATA.FORM",147:"COPY.CHART",148:"ON.TIME",149:"WAIT",150:"FORMAT.FONT",151:"FILL.UP",152:"FILL.LEFT",153:"DELETE.OVERLAY",155:"SHORT.MENUS",159:"SET.UPDATE.STATUS",161:"COLOR.PALETTE",162:"DELETE.STYLE",163:"WINDOW.RESTORE",164:"WINDOW.MAXIMIZE",166:"CHANGE.LINK",167:"CALCULATE.DOCUMENT",168:"ON.KEY",169:"APP.RESTORE",170:"APP.MOVE",171:"APP.SIZE",172:"APP.MINIMIZE",173:"APP.MAXIMIZE",174:"BRING.TO.FRONT",175:"SEND.TO.BACK",185:"MAIN.CHART.TYPE",186:"OVERLAY.CHART.TYPE",187:"SELECT.END",188:"OPEN.MAIL",189:"SEND.MAIL",190:"STANDARD.FONT",191:"CONSOLIDATE",192:"SORT.SPECIAL",193:"GALLERY.3D.AREA",194:"GALLERY.3D.COLUMN",195:"GALLERY.3D.LINE",196:"GALLERY.3D.PIE",197:"VIEW.3D",198:"GOAL.SEEK",199:"WORKGROUP",200:"FILL.GROUP",201:"UPDATE.LINK",202:"PROMOTE",203:"DEMOTE",204:"SHOW.DETAIL",206:"UNGROUP",207:"OBJECT.PROPERTIES",208:"SAVE.NEW.OBJECT",209:"SHARE",210:"SHARE.NAME",211:"DUPLICATE",212:"APPLY.STYLE",213:"ASSIGN.TO.OBJECT",214:"OBJECT.PROTECTION",215:"HIDE.OBJECT",216:"SET.EXTRACT",217:"CREATE.PUBLISHER",218:"SUBSCRIBE.TO",219:"ATTRIBUTES",220:"SHOW.TOOLBAR",222:"PRINT.PREVIEW",223:"EDIT.COLOR",224:"SHOW.LEVELS",225:"FORMAT.MAIN",226:"FORMAT.OVERLAY",227:"ON.RECALC",228:"EDIT.SERIES",229:"DEFINE.STYLE",240:"LINE.PRINT",243:"ENTER.DATA",249:"GALLERY.RADAR",250:"MERGE.STYLES",251:"EDITION.OPTIONS",252:"PASTE.PICTURE",253:"PASTE.PICTURE.LINK",254:"SPELLING",256:"ZOOM",259:"INSERT.OBJECT",260:"WINDOW.MINIMIZE",265:"SOUND.NOTE",266:"SOUND.PLAY",267:"FORMAT.SHAPE",268:"EXTEND.POLYGON",269:"FORMAT.AUTO",272:"GALLERY.3D.BAR",273:"GALLERY.3D.SURFACE",274:"FILL.AUTO",276:"CUSTOMIZE.TOOLBAR",277:"ADD.TOOL",278:"EDIT.OBJECT",279:"ON.DOUBLECLICK",280:"ON.ENTRY",281:"WORKBOOK.ADD",282:"WORKBOOK.MOVE",283:"WORKBOOK.COPY",284:"WORKBOOK.OPTIONS",285:"SAVE.WORKSPACE",288:"CHART.WIZARD",289:"DELETE.TOOL",290:"MOVE.TOOL",291:"WORKBOOK.SELECT",292:"WORKBOOK.ACTIVATE",293:"ASSIGN.TO.TOOL",295:"COPY.TOOL",296:"RESET.TOOL",297:"CONSTRAIN.NUMERIC",298:"PASTE.TOOL",302:"WORKBOOK.NEW",305:"SCENARIO.CELLS",306:"SCENARIO.DELETE",307:"SCENARIO.ADD",308:"SCENARIO.EDIT",309:"SCENARIO.SHOW",310:"SCENARIO.SHOW.NEXT",311:"SCENARIO.SUMMARY",312:"PIVOT.TABLE.WIZARD",313:"PIVOT.FIELD.PROPERTIES",314:"PIVOT.FIELD",315:"PIVOT.ITEM",316:"PIVOT.ADD.FIELDS",318:"OPTIONS.CALCULATION",319:"OPTIONS.EDIT",320:"OPTIONS.VIEW",321:"ADDIN.MANAGER",322:"MENU.EDITOR",323:"ATTACH.TOOLBARS",324:"VBAActivate",325:"OPTIONS.CHART",328:"VBA.INSERT.FILE",330:"VBA.PROCEDURE.DEFINITION",336:"ROUTING.SLIP",338:"ROUTE.DOCUMENT",339:"MAIL.LOGON",342:"INSERT.PICTURE",343:"EDIT.TOOL",344:"GALLERY.DOUGHNUT",350:"CHART.TREND",352:"PIVOT.ITEM.PROPERTIES",354:"WORKBOOK.INSERT",355:"OPTIONS.TRANSITION",356:"OPTIONS.GENERAL",370:"FILTER.ADVANCED",373:"MAIL.ADD.MAILER",374:"MAIL.DELETE.MAILER",375:"MAIL.REPLY",376:"MAIL.REPLY.ALL",377:"MAIL.FORWARD",378:"MAIL.NEXT.LETTER",379:"DATA.LABEL",380:"INSERT.TITLE",381:"FONT.PROPERTIES",382:"MACRO.OPTIONS",383:"WORKBOOK.HIDE",384:"WORKBOOK.UNHIDE",385:"WORKBOOK.DELETE",386:"WORKBOOK.NAME",388:"GALLERY.CUSTOM",390:"ADD.CHART.AUTOFORMAT",391:"DELETE.CHART.AUTOFORMAT",392:"CHART.ADD.DATA",393:"AUTO.OUTLINE",394:"TAB.ORDER",395:"SHOW.DIALOG",396:"SELECT.ALL",397:"UNGROUP.SHEETS",398:"SUBTOTAL.CREATE",399:"SUBTOTAL.REMOVE",400:"RENAME.OBJECT",412:"WORKBOOK.SCROLL",413:"WORKBOOK.NEXT",414:"WORKBOOK.PREV",415:"WORKBOOK.TAB.SPLIT",416:"FULL.SCREEN",417:"WORKBOOK.PROTECT",420:"SCROLLBAR.PROPERTIES",421:"PIVOT.SHOW.PAGES",422:"TEXT.TO.COLUMNS",423:"FORMAT.CHARTTYPE",424:"LINK.FORMAT",425:"TRACER.DISPLAY",430:"TRACER.NAVIGATE",431:"TRACER.CLEAR",432:"TRACER.ERROR",433:"PIVOT.FIELD.GROUP",434:"PIVOT.FIELD.UNGROUP",435:"CHECKBOX.PROPERTIES",436:"LABEL.PROPERTIES",437:"LISTBOX.PROPERTIES",438:"EDITBOX.PROPERTIES",439:"PIVOT.REFRESH",440:"LINK.COMBO",441:"OPEN.TEXT",442:"HIDE.DIALOG",443:"SET.DIALOG.FOCUS",444:"ENABLE.OBJECT",445:"PUSHBUTTON.PROPERTIES",446:"SET.DIALOG.DEFAULT",447:"FILTER",448:"FILTER.SHOW.ALL",449:"CLEAR.OUTLINE",450:"FUNCTION.WIZARD",451:"ADD.LIST.ITEM",452:"SET.LIST.ITEM",453:"REMOVE.LIST.ITEM",454:"SELECT.LIST.ITEM",455:"SET.CONTROL.VALUE",456:"SAVE.COPY.AS",458:"OPTIONS.LISTS.ADD",459:"OPTIONS.LISTS.DELETE",460:"SERIES.AXES",461:"SERIES.X",462:"SERIES.Y",463:"ERRORBAR.X",464:"ERRORBAR.Y",465:"FORMAT.CHART",466:"SERIES.ORDER",467:"MAIL.LOGOFF",468:"CLEAR.ROUTING.SLIP",469:"APP.ACTIVATE.MICROSOFT",470:"MAIL.EDIT.MAILER",471:"ON.SHEET",472:"STANDARD.WIDTH",473:"SCENARIO.MERGE",474:"SUMMARY.INFO",475:"FIND.FILE",476:"ACTIVE.CELL.FONT",477:"ENABLE.TIPWIZARD",478:"VBA.MAKE.ADDIN",480:"INSERTDATATABLE",481:"WORKGROUP.OPTIONS",482:"MAIL.SEND.MAILER",485:"AUTOCORRECT",489:"POST.DOCUMENT",491:"PICKLIST",493:"VIEW.SHOW",494:"VIEW.DEFINE",495:"VIEW.DELETE",509:"SHEET.BACKGROUND",510:"INSERT.MAP.OBJECT",511:"OPTIONS.MENONO",517:"MSOCHECKS",518:"NORMAL",519:"LAYOUT",520:"RM.PRINT.AREA",521:"CLEAR.PRINT.AREA",522:"ADD.PRINT.AREA",523:"MOVE.BRK",545:"HIDECURR.NOTE",546:"HIDEALL.NOTES",547:"DELETE.NOTE",548:"TRAVERSE.NOTES",549:"ACTIVATE.NOTES",620:"PROTECT.REVISIONS",621:"UNPROTECT.REVISIONS",647:"OPTIONS.ME",653:"WEB.PUBLISH",667:"NEWWEBQUERY",673:"PIVOT.TABLE.CHART",753:"OPTIONS.SAVE",755:"OPTIONS.SPELL",808:"HIDEALL.INKANNOTS"},fd={0:"COUNT",1:"IF",2:"ISNA",3:"ISERROR",4:"SUM",5:"AVERAGE",6:"MIN",7:"MAX",8:"ROW",9:"COLUMN",10:"NA",11:"NPV",12:"STDEV",13:"DOLLAR",14:"FIXED",15:"SIN",16:"COS",17:"TAN",18:"ATAN",19:"PI",20:"SQRT",21:"EXP",22:"LN",23:"LOG10",24:"ABS",25:"INT",26:"SIGN",27:"ROUND",28:"LOOKUP",29:"INDEX",30:"REPT",31:"MID",32:"LEN",33:"VALUE",34:"TRUE",35:"FALSE",36:"AND",37:"OR",38:"NOT",39:"MOD",40:"DCOUNT",41:"DSUM",42:"DAVERAGE",43:"DMIN",44:"DMAX",45:"DSTDEV",46:"VAR",47:"DVAR",48:"TEXT",49:"LINEST",50:"TREND",51:"LOGEST",52:"GROWTH",53:"GOTO",54:"HALT",55:"RETURN",56:"PV",57:"FV",58:"NPER",59:"PMT",60:"RATE",61:"MIRR",62:"IRR",63:"RAND",64:"MATCH",65:"DATE",66:"TIME",67:"DAY",68:"MONTH",69:"YEAR",70:"WEEKDAY",71:"HOUR",72:"MINUTE",73:"SECOND",74:"NOW",75:"AREAS",76:"ROWS",77:"COLUMNS",78:"OFFSET",79:"ABSREF",80:"RELREF",81:"ARGUMENT",82:"SEARCH",83:"TRANSPOSE",84:"ERROR",85:"STEP",86:"TYPE",87:"ECHO",88:"SET.NAME",89:"CALLER",90:"DEREF",91:"WINDOWS",92:"SERIES",93:"DOCUMENTS",94:"ACTIVE.CELL",95:"SELECTION",96:"RESULT",97:"ATAN2",98:"ASIN",99:"ACOS",100:"CHOOSE",101:"HLOOKUP",102:"VLOOKUP",103:"LINKS",104:"INPUT",105:"ISREF",106:"GET.FORMULA",107:"GET.NAME",108:"SET.VALUE",109:"LOG",110:"EXEC",111:"CHAR",112:"LOWER",113:"UPPER",114:"PROPER",115:"LEFT",116:"RIGHT",117:"EXACT",118:"TRIM",119:"REPLACE",120:"SUBSTITUTE",121:"CODE",122:"NAMES",123:"DIRECTORY",124:"FIND",125:"CELL",126:"ISERR",127:"ISTEXT",128:"ISNUMBER",129:"ISBLANK",130:"T",131:"N",132:"FOPEN",133:"FCLOSE",134:"FSIZE",135:"FREADLN",136:"FREAD",137:"FWRITELN",138:"FWRITE",139:"FPOS",140:"DATEVALUE",141:"TIMEVALUE",142:"SLN",143:"SYD",144:"DDB",145:"GET.DEF",146:"REFTEXT",147:"TEXTREF",148:"INDIRECT",149:"REGISTER",150:"CALL",151:"ADD.BAR",152:"ADD.MENU",153:"ADD.COMMAND",154:"ENABLE.COMMAND",155:"CHECK.COMMAND",156:"RENAME.COMMAND",157:"SHOW.BAR",158:"DELETE.MENU",159:"DELETE.COMMAND",160:"GET.CHART.ITEM",161:"DIALOG.BOX",162:"CLEAN",163:"MDETERM",164:"MINVERSE",165:"MMULT",166:"FILES",167:"IPMT",168:"PPMT",169:"COUNTA",170:"CANCEL.KEY",171:"FOR",172:"WHILE",173:"BREAK",174:"NEXT",175:"INITIATE",176:"REQUEST",177:"POKE",178:"EXECUTE",179:"TERMINATE",180:"RESTART",181:"HELP",182:"GET.BAR",183:"PRODUCT",184:"FACT",185:"GET.CELL",186:"GET.WORKSPACE",187:"GET.WINDOW",188:"GET.DOCUMENT",189:"DPRODUCT",190:"ISNONTEXT",191:"GET.NOTE",192:"NOTE",193:"STDEVP",194:"VARP",195:"DSTDEVP",196:"DVARP",197:"TRUNC",198:"ISLOGICAL",199:"DCOUNTA",200:"DELETE.BAR",201:"UNREGISTER",204:"USDOLLAR",205:"FINDB",206:"SEARCHB",207:"REPLACEB",208:"LEFTB",209:"RIGHTB",210:"MIDB",211:"LENB",212:"ROUNDUP",213:"ROUNDDOWN",214:"ASC",215:"DBCS",216:"RANK",219:"ADDRESS",220:"DAYS360",221:"TODAY",222:"VDB",223:"ELSE",224:"ELSE.IF",225:"END.IF",226:"FOR.CELL",227:"MEDIAN",228:"SUMPRODUCT",229:"SINH",230:"COSH",231:"TANH",232:"ASINH",233:"ACOSH",234:"ATANH",235:"DGET",236:"CREATE.OBJECT",237:"VOLATILE",238:"LAST.ERROR",239:"CUSTOM.UNDO",240:"CUSTOM.REPEAT",241:"FORMULA.CONVERT",242:"GET.LINK.INFO",243:"TEXT.BOX",244:"INFO",245:"GROUP",246:"GET.OBJECT",247:"DB",248:"PAUSE",251:"RESUME",252:"FREQUENCY",253:"ADD.TOOLBAR",254:"DELETE.TOOLBAR",255:"User",256:"RESET.TOOLBAR",257:"EVALUATE",258:"GET.TOOLBAR",259:"GET.TOOL",260:"SPELLING.CHECK",261:"ERROR.TYPE",262:"APP.TITLE",263:"WINDOW.TITLE",264:"SAVE.TOOLBAR",265:"ENABLE.TOOL",266:"PRESS.TOOL",267:"REGISTER.ID",268:"GET.WORKBOOK",269:"AVEDEV",270:"BETADIST",271:"GAMMALN",272:"BETAINV",273:"BINOMDIST",274:"CHIDIST",275:"CHIINV",276:"COMBIN",277:"CONFIDENCE",278:"CRITBINOM",279:"EVEN",280:"EXPONDIST",281:"FDIST",282:"FINV",283:"FISHER",284:"FISHERINV",285:"FLOOR",286:"GAMMADIST",287:"GAMMAINV",288:"CEILING",289:"HYPGEOMDIST",290:"LOGNORMDIST",291:"LOGINV",292:"NEGBINOMDIST",293:"NORMDIST",294:"NORMSDIST",295:"NORMINV",296:"NORMSINV",297:"STANDARDIZE",298:"ODD",299:"PERMUT",300:"POISSON",301:"TDIST",302:"WEIBULL",303:"SUMXMY2",304:"SUMX2MY2",305:"SUMX2PY2",306:"CHITEST",307:"CORREL",308:"COVAR",309:"FORECAST",310:"FTEST",311:"INTERCEPT",312:"PEARSON",313:"RSQ",314:"STEYX",315:"SLOPE",316:"TTEST",317:"PROB",318:"DEVSQ",319:"GEOMEAN",320:"HARMEAN",321:"SUMSQ",322:"KURT",323:"SKEW",324:"ZTEST",325:"LARGE",326:"SMALL",327:"QUARTILE",328:"PERCENTILE",329:"PERCENTRANK",330:"MODE",331:"TRIMMEAN",332:"TINV",334:"MOVIE.COMMAND",335:"GET.MOVIE",336:"CONCATENATE",337:"POWER",338:"PIVOT.ADD.DATA",339:"GET.PIVOT.TABLE",340:"GET.PIVOT.FIELD",341:"GET.PIVOT.ITEM",342:"RADIANS",343:"DEGREES",344:"SUBTOTAL",345:"SUMIF",346:"COUNTIF",347:"COUNTBLANK",348:"SCENARIO.GET",349:"OPTIONS.LISTS.GET",350:"ISPMT",351:"DATEDIF",352:"DATESTRING",353:"NUMBERSTRING",354:"ROMAN",355:"OPEN.DIALOG",356:"SAVE.DIALOG",357:"VIEW.GET",358:"GETPIVOTDATA",359:"HYPERLINK",360:"PHONETIC",361:"AVERAGEA",362:"MAXA",363:"MINA",364:"STDEVPA",365:"VARPA",366:"STDEVA",367:"VARA",368:"BAHTTEXT",369:"THAIDAYOFWEEK",370:"THAIDIGIT",371:"THAIMONTHOFYEAR",372:"THAINUMSOUND",373:"THAINUMSTRING",374:"THAISTRINGLENGTH",375:"ISTHAIDIGIT",376:"ROUNDBAHTDOWN",377:"ROUNDBAHTUP",378:"THAIYEAR",379:"RTD",380:"CUBEVALUE",381:"CUBEMEMBER",382:"CUBEMEMBERPROPERTY",383:"CUBERANKEDMEMBER",384:"HEX2BIN",385:"HEX2DEC",386:"HEX2OCT",387:"DEC2BIN",388:"DEC2HEX",389:"DEC2OCT",390:"OCT2BIN",391:"OCT2HEX",392:"OCT2DEC",393:"BIN2DEC",394:"BIN2OCT",395:"BIN2HEX",396:"IMSUB",397:"IMDIV",398:"IMPOWER",399:"IMABS",400:"IMSQRT",401:"IMLN",402:"IMLOG2",403:"IMLOG10",404:"IMSIN",405:"IMCOS",406:"IMEXP",407:"IMARGUMENT",408:"IMCONJUGATE",409:"IMAGINARY",410:"IMREAL",411:"COMPLEX",412:"IMSUM",413:"IMPRODUCT",414:"SERIESSUM",415:"FACTDOUBLE",416:"SQRTPI",417:"QUOTIENT",418:"DELTA",419:"GESTEP",420:"ISEVEN",421:"ISODD",422:"MROUND",423:"ERF",424:"ERFC",425:"BESSELJ",426:"BESSELK",427:"BESSELY",428:"BESSELI",429:"XIRR",430:"XNPV",431:"PRICEMAT",432:"YIELDMAT",433:"INTRATE",434:"RECEIVED",435:"DISC",436:"PRICEDISC",437:"YIELDDISC",438:"TBILLEQ",439:"TBILLPRICE",440:"TBILLYIELD",441:"PRICE",442:"YIELD",443:"DOLLARDE",444:"DOLLARFR",445:"NOMINAL",446:"EFFECT",447:"CUMPRINC",448:"CUMIPMT",449:"EDATE",450:"EOMONTH",451:"YEARFRAC",452:"COUPDAYBS",453:"COUPDAYS",454:"COUPDAYSNC",455:"COUPNCD",456:"COUPNUM",457:"COUPPCD",458:"DURATION",459:"MDURATION",460:"ODDLPRICE",461:"ODDLYIELD",462:"ODDFPRICE",463:"ODDFYIELD",464:"RANDBETWEEN",465:"WEEKNUM",466:"AMORDEGRC",467:"AMORLINC",468:"CONVERT",724:"SHEETJS",469:"ACCRINT",470:"ACCRINTM",471:"WORKDAY",472:"NETWORKDAYS",473:"GCD",474:"MULTINOMIAL",475:"LCM",476:"FVSCHEDULE",477:"CUBEKPIMEMBER",478:"CUBESET",479:"CUBESETCOUNT",480:"IFERROR",481:"COUNTIFS",482:"SUMIFS",483:"AVERAGEIF",484:"AVERAGEIFS"},Xb={2:1,3:1,10:0,15:1,16:1,17:1,18:1,19:0,20:1,21:1,22:1,23:1,24:1,25:1,26:1,27:2,30:2,31:3,32:1,33:1,34:0,35:0,38:1,39:2,40:3,41:3,42:3,43:3,44:3,45:3,47:3,48:2,53:1,61:3,63:0,65:3,66:3,67:1,68:1,69:1,70:1,71:1,72:1,73:1,74:0,75:1,76:1,77:1,79:2,80:2,83:1,85:0,86:1,89:0,90:1,94:0,95:0,97:2,98:1,99:1,101:3,102:3,105:1,106:1,108:2,111:1,112:1,113:1,114:1,117:2,118:1,119:4,121:1,126:1,127:1,128:1,129:1,130:1,131:1,133:1,134:1,135:1,136:2,137:2,138:2,140:1,141:1,142:3,143:4,144:4,161:1,162:1,163:1,164:1,165:2,172:1,175:2,176:2,177:3,178:2,179:1,184:1,186:1,189:3,190:1,195:3,196:3,197:1,198:1,199:3,201:1,207:4,210:3,211:1,212:2,213:2,214:1,215:1,225:0,229:1,230:1,231:1,232:1,233:1,234:1,235:3,244:1,247:4,252:2,257:1,261:1,271:1,273:4,274:2,275:2,276:2,277:3,278:3,279:1,280:3,281:3,282:3,283:1,284:1,285:2,286:4,287:3,288:2,289:4,290:3,291:3,292:3,293:4,294:1,295:3,296:1,297:3,298:1,299:2,300:3,301:3,302:4,303:2,304:2,305:2,306:2,307:2,308:2,309:3,310:2,311:2,312:2,313:2,314:2,315:2,316:4,325:2,326:2,327:2,328:2,331:2,332:2,337:2,342:1,343:1,346:2,347:1,350:4,351:3,352:1,353:2,360:1,368:1,369:1,370:1,371:1,372:1,373:1,374:1,375:1,376:1,377:1,378:1,382:3,385:1,392:1,393:1,396:2,397:2,398:2,399:1,400:1,401:1,402:1,403:1,404:1,405:1,406:1,407:1,408:1,409:1,410:1,414:4,415:1,416:1,417:2,420:1,421:1,422:2,424:1,425:2,426:2,427:2,428:2,430:3,438:3,439:3,440:3,443:2,444:2,445:2,446:2,447:6,448:6,449:2,450:2,464:2,468:3,476:2,479:1,480:2,65535:0};function Al(t){return t.slice(0,3)=="of:"&&(t=t.slice(3)),t.charCodeAt(0)==61&&(t=t.slice(1),t.charCodeAt(0)==61&&(t=t.slice(1))),t=t.replace(/COM\.MICROSOFT\./g,""),t=t.replace(/\[((?:\.[A-Z]+[0-9]+)(?::\.[A-Z]+[0-9]+)?)\]/g,function(r,a){return a.replace(/\./g,"")}),t=t.replace(/\[.(#[A-Z]*[?!])\]/g,"$1"),t.replace(/[;~]/g,",").replace(/\|/g,";")}function Pn(t){var r=t.split(":"),a=r[0].split(".")[0];return[a,r[0].split(".")[1]+(r.length>1?":"+(r[1].split(".")[1]||r[1].split(".")[0]):"")]}var Si={},si={};function Ci(t,r){if(t){var a=[.7,.7,.75,.75,.3,.3];r=="xlml"&&(a=[1,1,1,1,.5,.5]),t.left==null&&(t.left=a[0]),t.right==null&&(t.right=a[1]),t.top==null&&(t.top=a[2]),t.bottom==null&&(t.bottom=a[3]),t.header==null&&(t.header=a[4]),t.footer==null&&(t.footer=a[5])}}function pd(t,r,a,s,i,l){try{s.cellNF&&(t.z=Sa[r])}catch(v){if(s.WTF)throw v}if(!(t.t==="z"&&!s.cellStyles)){if(t.t==="d"&&typeof t.v=="string"&&(t.v=br(t.v)),(!s||s.cellText!==!1)&&t.t!=="z")try{if(Sa[r]==null&&Bs(Yh[r]||"General",r),t.t==="e")t.w=t.w||Ks[t.v];else if(r===0)if(t.t==="n")(t.v|0)===t.v?t.w=t.v.toString(10):t.w=Ii(t.v);else if(t.t==="d"){var d=zr(t.v);(d|0)===d?t.w=d.toString(10):t.w=Ii(d)}else{if(t.v===void 0)return"";t.w=js(t.v,si)}else t.t==="d"?t.w=Qr(r,zr(t.v),si):t.w=Qr(r,t.v,si)}catch(v){if(s.WTF)throw v}if(s.cellStyles&&a!=null)try{t.s=l.Fills[a],t.s.fgColor&&t.s.fgColor.theme&&!t.s.fgColor.rgb&&(t.s.fgColor.rgb=pn(i.themeElements.clrScheme[t.s.fgColor.theme].rgb,t.s.fgColor.tint||0),s.WTF&&(t.s.fgColor.raw_rgb=i.themeElements.clrScheme[t.s.fgColor.theme].rgb)),t.s.bgColor&&t.s.bgColor.theme&&(t.s.bgColor.rgb=pn(i.themeElements.clrScheme[t.s.bgColor.theme].rgb,t.s.bgColor.tint||0),s.WTF&&(t.s.bgColor.raw_rgb=i.themeElements.clrScheme[t.s.bgColor.theme].rgb))}catch(v){if(s.WTF&&l.Fills)throw v}}}function Yb(t,r){var a=cr(r);a.s.r<=a.e.r&&a.s.c<=a.e.c&&a.s.r>=0&&a.s.c>=0&&(t["!ref"]=za(a))}var Kb=/<(?:\w:)?mergeCell ref="[A-Z0-9:]+"\s*[\/]?>/g,Qb=/<(?:\w+:)?sheetData[^>]*>([\s\S]*)<\/(?:\w+:)?sheetData>/,Zb=/<(?:\w:)?hyperlink [^>]*>/mg,Jb=/"(\w*:\w*)"/,ew=/<(?:\w:)?col\b[^>]*[\/]?>/g,tw=/<(?:\w:)?autoFilter[^>]*([\/]|>([\s\S]*)<\/(?:\w:)?autoFilter)>/g,aw=/<(?:\w:)?pageMargins[^>]*\/>/g,hd=/<(?:\w:)?sheetPr\b(?:[^>a-z][^>]*)?\/>/,rw=/<(?:\w:)?sheetPr[^>]*(?:[\/]|>([\s\S]*)<\/(?:\w:)?sheetPr)>/,sw=/<(?:\w:)?sheetViews[^>]*(?:[\/]|>([\s\S]*)<\/(?:\w:)?sheetViews)>/;function iw(t,r,a,s,i,l,d){if(!t)return t;s||(s={"!id":{}});var v=r.dense?[]:{},u={s:{r:2e6,c:2e6},e:{r:0,c:0}},f="",h="",_=t.match(Qb);_?(f=t.slice(0,_.index),h=t.slice(_.index+_[0].length)):f=h=t;var x=f.match(hd);x?xo(x[0],v,i,a):(x=f.match(rw))&&nw(x[0],x[1]||"",v,i,a);var T=(f.match(/<(?:\w*:)?dimension/)||{index:-1}).index;if(T>0){var b=f.slice(T,T+50).match(Jb);b&&Yb(v,b[1])}var w=f.match(sw);w&&w[1]&&uw(w[1],i);var A=[];if(r.cellStyles){var C=f.match(ew);C&&cw(A,C)}_&&fw(_[1],v,r,u,l,d);var z=h.match(tw);z&&(v["!autofilter"]=dw(z[0]));var F=[],re=h.match(Kb);if(re)for(T=0;T!=re.length;++T)F[T]=cr(re[T].slice(re[T].indexOf('"')+1));var me=h.match(Zb);me&&ow(v,me,s);var ue=h.match(aw);if(ue&&(v["!margins"]=lw(ba(ue[0]))),!v["!ref"]&&u.e.c>=u.s.c&&u.e.r>=u.s.r&&(v["!ref"]=za(u)),r.sheetRows>0&&v["!ref"]){var D=cr(v["!ref"]);r.sheetRows<=+D.e.r&&(D.e.r=r.sheetRows-1,D.e.r>u.e.r&&(D.e.r=u.e.r),D.e.r<D.s.r&&(D.s.r=D.e.r),D.e.c>u.e.c&&(D.e.c=u.e.c),D.e.c<D.s.c&&(D.s.c=D.e.c),v["!fullref"]=v["!ref"],v["!ref"]=za(D))}return A.length>0&&(v["!cols"]=A),F.length>0&&(v["!merges"]=F),v}function xo(t,r,a,s){var i=ba(t);a.Sheets[s]||(a.Sheets[s]={}),i.codeName&&(a.Sheets[s].CodeName=Ua(Ka(i.codeName)))}function nw(t,r,a,s,i){xo(t.slice(0,t.indexOf(">")),a,s,i)}function ow(t,r,a){for(var s=Array.isArray(t),i=0;i!=r.length;++i){var l=ba(Ka(r[i]),!0);if(!l.ref)return;var d=((a||{})["!id"]||[])[l.id];d?(l.Target=d.Target,l.location&&(l.Target+="#"+Ua(l.location))):(l.Target="#"+Ua(l.location),d={Target:l.Target,TargetMode:"Internal"}),l.Rel=d,l.tooltip&&(l.Tooltip=l.tooltip,delete l.tooltip);for(var v=cr(l.ref),u=v.s.r;u<=v.e.r;++u)for(var f=v.s.c;f<=v.e.c;++f){var h=Ea({c:f,r:u});s?(t[u]||(t[u]=[]),t[u][f]||(t[u][f]={t:"z",v:void 0}),t[u][f].l=l):(t[h]||(t[h]={t:"z",v:void 0}),t[h].l=l)}}}function lw(t){var r={};return["left","right","top","bottom","header","footer"].forEach(function(a){t[a]&&(r[a]=parseFloat(t[a]))}),r}function cw(t,r){for(var a=!1,s=0;s!=r.length;++s){var i=ba(r[s],!0);i.hidden&&(i.hidden=er(i.hidden));var l=parseInt(i.min,10)-1,d=parseInt(i.max,10)-1;for(i.outlineLevel&&(i.level=+i.outlineLevel||0),delete i.min,delete i.max,i.width=+i.width,!a&&i.width&&(a=!0,_o(i.width)),ni(i);l<=d;)t[l++]=kr(i)}}function dw(t){var r={ref:(t.match(/ref="([^"]*)"/)||[])[1]};return r}var vw=/<(?:\w:)?sheetView(?:[^>a-z][^>]*)?\/?>/;function uw(t,r){r.Views||(r.Views=[{}]),(t.match(vw)||[]).forEach(function(a,s){var i=ba(a);r.Views[s]||(r.Views[s]={}),+i.zoomScale&&(r.Views[s].zoom=+i.zoomScale),er(i.rightToLeft)&&(r.Views[s].RTL=!0)})}var fw=function(){var t=/<(?:\w+:)?c[ \/>]/,r=/<\/(?:\w+:)?row>/,a=/r=["']([^"']*)["']/,s=/<(?:\w+:)?is>([\S\s]*?)<\/(?:\w+:)?is>/,i=/ref=["']([^"']*)["']/,l=Ri("v"),d=Ri("f");return function(u,f,h,_,x,T){for(var b=0,w="",A=[],C=[],z=0,F=0,re=0,me="",ue,D,E=0,he=0,xe,K,q=0,ae=0,Me=Array.isArray(T.CellXf),ge,Ne=[],Be=[],be=Array.isArray(f),L=[],Te={},ye=!1,P=!!h.sheetStubs,pe=u.split(r),B=0,j=pe.length;B!=j;++B){w=pe[B].trim();var I=w.length;if(I!==0){var Y=0;e:for(b=0;b<I;++b)switch(w[b]){case">":if(w[b-1]!="/"){++b;break e}if(h&&h.cellStyles){if(D=ba(w.slice(Y,b),!0),E=D.r!=null?parseInt(D.r,10):E+1,he=-1,h.sheetRows&&h.sheetRows<E)continue;Te={},ye=!1,D.ht&&(ye=!0,Te.hpt=parseFloat(D.ht),Te.hpx=Oi(Te.hpt)),D.hidden=="1"&&(ye=!0,Te.hidden=!0),D.outlineLevel!=null&&(ye=!0,Te.level=+D.outlineLevel),ye&&(L[E-1]=Te)}break;case"<":Y=b;break}if(Y>=b)break;if(D=ba(w.slice(Y,b),!0),E=D.r!=null?parseInt(D.r,10):E+1,he=-1,!(h.sheetRows&&h.sheetRows<E)){_.s.r>E-1&&(_.s.r=E-1),_.e.r<E-1&&(_.e.r=E-1),h&&h.cellStyles&&(Te={},ye=!1,D.ht&&(ye=!0,Te.hpt=parseFloat(D.ht),Te.hpx=Oi(Te.hpt)),D.hidden=="1"&&(ye=!0,Te.hidden=!0),D.outlineLevel!=null&&(ye=!0,Te.level=+D.outlineLevel),ye&&(L[E-1]=Te)),A=w.slice(b).split(t);for(var fe=0;fe!=A.length&&A[fe].trim().charAt(0)=="<";++fe);for(A=A.slice(fe),b=0;b!=A.length;++b)if(w=A[b].trim(),w.length!==0){if(C=w.match(a),z=b,F=0,re=0,w="<c "+(w.slice(0,1)=="<"?">":"")+w,C!=null&&C.length===2){for(z=0,me=C[1],F=0;F!=me.length&&!((re=me.charCodeAt(F)-64)<1||re>26);++F)z=26*z+re;--z,he=z}else++he;for(F=0;F!=w.length&&w.charCodeAt(F)!==62;++F);if(++F,D=ba(w.slice(0,F),!0),D.r||(D.r=Ea({r:E-1,c:he})),me=w.slice(F),ue={t:""},(C=me.match(l))!=null&&C[1]!==""&&(ue.v=Ua(C[1])),h.cellFormula){if((C=me.match(d))!=null&&C[1]!==""){if(ue.f=Ua(Ka(C[1])).replace(/\r\n/g,`
`),h.xlfn||(ue.f=yl(ue.f)),C[0].indexOf('t="array"')>-1)ue.F=(me.match(i)||[])[1],ue.F.indexOf(":")>-1&&Ne.push([cr(ue.F),ue.F]);else if(C[0].indexOf('t="shared"')>-1){K=ba(C[0]);var ce=Ua(Ka(C[1]));h.xlfn||(ce=yl(ce)),Be[parseInt(K.si,10)]=[K,ce,D.r]}}else(C=me.match(/<f[^>]*\/>/))&&(K=ba(C[0]),Be[K.si]&&(ue.f=Tx(Be[K.si][1],Be[K.si][2],D.r)));var J=Pr(D.r);for(F=0;F<Ne.length;++F)J.r>=Ne[F][0].s.r&&J.r<=Ne[F][0].e.r&&J.c>=Ne[F][0].s.c&&J.c<=Ne[F][0].e.c&&(ue.F=Ne[F][1])}if(D.t==null&&ue.v===void 0)if(ue.f||ue.F)ue.v=0,ue.t="n";else if(P)ue.t="z";else continue;else ue.t=D.t||"n";switch(_.s.c>he&&(_.s.c=he),_.e.c<he&&(_.e.c=he),ue.t){case"n":if(ue.v==""||ue.v==null){if(!P)continue;ue.t="z"}else ue.v=parseFloat(ue.v);break;case"s":if(typeof ue.v>"u"){if(!P)continue;ue.t="z"}else xe=Si[parseInt(ue.v,10)],ue.v=xe.t,ue.r=xe.r,h.cellHTML&&(ue.h=xe.h);break;case"str":ue.t="s",ue.v=ue.v!=null?Ka(ue.v):"",h.cellHTML&&(ue.h=io(ue.v));break;case"inlineStr":C=me.match(s),ue.t="s",C!=null&&(xe=mo(C[1]))?(ue.v=xe.t,h.cellHTML&&(ue.h=xe.h)):ue.v="";break;case"b":ue.v=er(ue.v);break;case"d":h.cellDates?ue.v=br(ue.v,1):(ue.v=zr(br(ue.v,1)),ue.t="n");break;case"e":(!h||h.cellText!==!1)&&(ue.w=ue.v),ue.v=Lc[ue.v];break}if(q=ae=0,ge=null,Me&&D.s!==void 0&&(ge=T.CellXf[D.s],ge!=null&&(ge.numFmtId!=null&&(q=ge.numFmtId),h.cellStyles&&ge.fillId!=null&&(ae=ge.fillId))),pd(ue,q,ae,h,x,T),h.cellDates&&Me&&ue.t=="n"&&oi(Sa[q])&&(ue.t="d",ue.v=xn(ue.v)),D.cm&&h.xlmeta){var le=(h.xlmeta.Cell||[])[+D.cm-1];le&&le.type=="XLDAPR"&&(ue.D=!0)}if(be){var S=Pr(D.r);f[S.r]||(f[S.r]=[]),f[S.r][S.c]=ue}else f[D.r]=ue}}}}L.length>0&&(f["!rows"]=L)}}();function pw(t,r){var a={},s=t.l+r;a.r=t.read_shift(4),t.l+=4;var i=t.read_shift(2);t.l+=1;var l=t.read_shift(1);return t.l=s,l&7&&(a.level=l&7),l&16&&(a.hidden=!0),l&32&&(a.hpt=i/20),a}var hw=Ys;function mw(){}function _w(t,r){var a={},s=t[t.l];return++t.l,a.above=!(s&64),a.left=!(s&128),t.l+=18,a.name=Bm(t),a}function gw(t){var r=es(t);return[r]}function xw(t){var r=Xs(t);return[r]}function bw(t){var r=es(t),a=t.read_shift(1);return[r,a,"b"]}function ww(t){var r=Xs(t),a=t.read_shift(1);return[r,a,"b"]}function yw(t){var r=es(t),a=t.read_shift(1);return[r,a,"e"]}function kw(t){var r=Xs(t),a=t.read_shift(1);return[r,a,"e"]}function Tw(t){var r=es(t),a=t.read_shift(4);return[r,a,"s"]}function Ew(t){var r=Xs(t),a=t.read_shift(4);return[r,a,"s"]}function Aw(t){var r=es(t),a=Sr(t);return[r,a,"n"]}function md(t){var r=Xs(t),a=Sr(t);return[r,a,"n"]}function Sw(t){var r=es(t),a=fo(t);return[r,a,"n"]}function Cw(t){var r=Xs(t),a=fo(t);return[r,a,"n"]}function Fw(t){var r=es(t),a=vo(t);return[r,a,"is"]}function Dw(t){var r=es(t),a=Fr(t);return[r,a,"str"]}function Mw(t){var r=Xs(t),a=Fr(t);return[r,a,"str"]}function Iw(t,r,a){var s=t.l+r,i=es(t);i.r=a["!row"];var l=t.read_shift(1),d=[i,l,"b"];if(a.cellFormula){t.l+=2;var v=yn(t,s-t.l,a);d[3]=Ar(v,null,i,a.supbooks,a)}else t.l=s;return d}function Rw(t,r,a){var s=t.l+r,i=es(t);i.r=a["!row"];var l=t.read_shift(1),d=[i,l,"e"];if(a.cellFormula){t.l+=2;var v=yn(t,s-t.l,a);d[3]=Ar(v,null,i,a.supbooks,a)}else t.l=s;return d}function Nw(t,r,a){var s=t.l+r,i=es(t);i.r=a["!row"];var l=Sr(t),d=[i,l,"n"];if(a.cellFormula){t.l+=2;var v=yn(t,s-t.l,a);d[3]=Ar(v,null,i,a.supbooks,a)}else t.l=s;return d}function Pw(t,r,a){var s=t.l+r,i=es(t);i.r=a["!row"];var l=Fr(t),d=[i,l,"str"];if(a.cellFormula){t.l+=2;var v=yn(t,s-t.l,a);d[3]=Ar(v,null,i,a.supbooks,a)}else t.l=s;return d}var Lw=Ys;function Ow(t,r){var a=t.l+r,s=Ys(t),i=uo(t),l=Fr(t),d=Fr(t),v=Fr(t);t.l=a;var u={rfx:s,relId:i,loc:l,display:v};return d&&(u.Tooltip=d),u}function zw(){}function Bw(t,r,a){var s=t.l+r,i=Rc(t),l=t.read_shift(1),d=[i];if(d[2]=l,a.cellFormula){var v=Wb(t,s-t.l,a);d[1]=v}else t.l=s;return d}function $w(t,r,a){var s=t.l+r,i=Ys(t),l=[i];if(a.cellFormula){var d=Vb(t,s-t.l,a);l[1]=d,t.l=s}else t.l=s;return l}var Uw=["left","right","top","bottom","header","footer"];function qw(t){var r={};return Uw.forEach(function(a){r[a]=Sr(t)}),r}function jw(t){var r=t.read_shift(2);return t.l+=28,{RTL:r&32}}function Ww(){}function Hw(){}function Vw(t,r,a,s,i,l,d){if(!t)return t;var v=r||{};s||(s={"!id":{}});var u=v.dense?[]:{},f,h={s:{r:2e6,c:2e6},e:{r:0,c:0}},_=!1,x=!1,T,b,w,A,C,z,F,re,me,ue=[];v.biff=12,v["!row"]=0;var D=0,E=!1,he=[],xe={},K=v.supbooks||i.supbooks||[[]];if(K.sharedf=xe,K.arrayf=he,K.SheetNames=i.SheetNames||i.Sheets.map(function(be){return be.name}),!v.supbooks&&(v.supbooks=K,i.Names))for(var q=0;q<i.Names.length;++q)K[0][q+1]=i.Names[q];var ae=[],Me=[],ge=!1;_n[16]={n:"BrtShortReal",f:md};var Ne;if(Ts(t,function(L,Te,ye){if(!x)switch(ye){case 148:f=L;break;case 0:T=L,v.sheetRows&&v.sheetRows<=T.r&&(x=!0),re=Tr(A=T.r),v["!row"]=T.r,(L.hidden||L.hpt||L.level!=null)&&(L.hpt&&(L.hpx=Oi(L.hpt)),Me[L.r]=L);break;case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:case 10:case 11:case 13:case 14:case 15:case 16:case 17:case 18:case 62:switch(b={t:L[2]},L[2]){case"n":b.v=L[1];break;case"s":F=Si[L[1]],b.v=F.t,b.r=F.r;break;case"b":b.v=!!L[1];break;case"e":b.v=L[1],v.cellText!==!1&&(b.w=Ks[b.v]);break;case"str":b.t="s",b.v=L[1];break;case"is":b.t="s",b.v=L[1].t;break}if((w=d.CellXf[L[0].iStyleRef])&&pd(b,w.numFmtId,null,v,l,d),C=L[0].c==-1?C+1:L[0].c,v.dense?(u[A]||(u[A]=[]),u[A][C]=b):u[_r(C)+re]=b,v.cellFormula){for(E=!1,D=0;D<he.length;++D){var P=he[D];T.r>=P[0].s.r&&T.r<=P[0].e.r&&C>=P[0].s.c&&C<=P[0].e.c&&(b.F=za(P[0]),E=!0)}!E&&L.length>3&&(b.f=L[3])}if(h.s.r>T.r&&(h.s.r=T.r),h.s.c>C&&(h.s.c=C),h.e.r<T.r&&(h.e.r=T.r),h.e.c<C&&(h.e.c=C),v.cellDates&&w&&b.t=="n"&&oi(Sa[w.numFmtId])){var pe=zs(b.v);pe&&(b.t="d",b.v=new Date(pe.y,pe.m-1,pe.d,pe.H,pe.M,pe.S,pe.u))}Ne&&(Ne.type=="XLDAPR"&&(b.D=!0),Ne=void 0);break;case 1:case 12:if(!v.sheetStubs||_)break;b={t:"z",v:void 0},C=L[0].c==-1?C+1:L[0].c,v.dense?(u[A]||(u[A]=[]),u[A][C]=b):u[_r(C)+re]=b,h.s.r>T.r&&(h.s.r=T.r),h.s.c>C&&(h.s.c=C),h.e.r<T.r&&(h.e.r=T.r),h.e.c<C&&(h.e.c=C),Ne&&(Ne.type=="XLDAPR"&&(b.D=!0),Ne=void 0);break;case 176:ue.push(L);break;case 49:Ne=((v.xlmeta||{}).Cell||[])[L-1];break;case 494:var B=s["!id"][L.relId];for(B?(L.Target=B.Target,L.loc&&(L.Target+="#"+L.loc),L.Rel=B):L.relId==""&&(L.Target="#"+L.loc),A=L.rfx.s.r;A<=L.rfx.e.r;++A)for(C=L.rfx.s.c;C<=L.rfx.e.c;++C)v.dense?(u[A]||(u[A]=[]),u[A][C]||(u[A][C]={t:"z",v:void 0}),u[A][C].l=L):(z=Ea({c:C,r:A}),u[z]||(u[z]={t:"z",v:void 0}),u[z].l=L);break;case 426:if(!v.cellFormula)break;he.push(L),me=v.dense?u[A][C]:u[_r(C)+re],me.f=Ar(L[1],h,{r:T.r,c:C},K,v),me.F=za(L[0]);break;case 427:if(!v.cellFormula)break;xe[Ea(L[0].s)]=L[1],me=v.dense?u[A][C]:u[_r(C)+re],me.f=Ar(L[1],h,{r:T.r,c:C},K,v);break;case 60:if(!v.cellStyles)break;for(;L.e>=L.s;)ae[L.e--]={width:L.w/256,hidden:!!(L.flags&1),level:L.level},ge||(ge=!0,_o(L.w/256)),ni(ae[L.e+1]);break;case 161:u["!autofilter"]={ref:za(L)};break;case 476:u["!margins"]=L;break;case 147:i.Sheets[a]||(i.Sheets[a]={}),L.name&&(i.Sheets[a].CodeName=L.name),(L.above||L.left)&&(u["!outline"]={above:L.above,left:L.left});break;case 137:i.Views||(i.Views=[{}]),i.Views[0]||(i.Views[0]={}),L.RTL&&(i.Views[0].RTL=!0);break;case 485:break;case 64:case 1053:break;case 151:break;case 152:case 175:case 644:case 625:case 562:case 396:case 1112:case 1146:case 471:case 1050:case 649:case 1105:case 589:case 607:case 564:case 1055:case 168:case 174:case 1180:case 499:case 507:case 550:case 171:case 167:case 1177:case 169:case 1181:case 551:case 552:case 661:case 639:case 478:case 537:case 477:case 536:case 1103:case 680:case 1104:case 1024:case 663:case 535:case 678:case 504:case 1043:case 428:case 170:case 3072:case 50:case 2070:case 1045:break;case 35:_=!0;break;case 36:_=!1;break;case 37:_=!0;break;case 38:_=!1;break;default:if(!Te.T){if(!_||v.WTF)throw new Error("Unexpected record 0x"+ye.toString(16))}}},v),delete v.supbooks,delete v["!row"],!u["!ref"]&&(h.s.r<2e6||f&&(f.e.r>0||f.e.c>0||f.s.r>0||f.s.c>0))&&(u["!ref"]=za(f||h)),v.sheetRows&&u["!ref"]){var Be=cr(u["!ref"]);v.sheetRows<=+Be.e.r&&(Be.e.r=v.sheetRows-1,Be.e.r>h.e.r&&(Be.e.r=h.e.r),Be.e.r<Be.s.r&&(Be.s.r=Be.e.r),Be.e.c>h.e.c&&(Be.e.c=h.e.c),Be.e.c<Be.s.c&&(Be.s.c=Be.e.c),u["!fullref"]=u["!ref"],u["!ref"]=za(Be))}return ue.length>0&&(u["!merges"]=ue),ae.length>0&&(u["!cols"]=ae),Me.length>0&&(u["!rows"]=Me),u}function Gw(t){var r=[],a=t.match(/^<c:numCache>/),s;(t.match(/<c:pt idx="(\d*)">(.*?)<\/c:pt>/mg)||[]).forEach(function(l){var d=l.match(/<c:pt idx="(\d*?)"><c:v>(.*)<\/c:v><\/c:pt>/);d&&(r[+d[1]]=a?+d[2]:d[2])});var i=Ua((t.match(/<c:formatCode>([\s\S]*?)<\/c:formatCode>/)||["","General"])[1]);return(t.match(/<c:f>(.*?)<\/c:f>/mg)||[]).forEach(function(l){s=l.replace(/<.*?>/g,"")}),[r,i,s]}function Xw(t,r,a,s,i,l){var d=l||{"!type":"chart"};if(!t)return l;var v=0,u=0,f="A",h={s:{r:2e6,c:2e6},e:{r:0,c:0}};return(t.match(/<c:numCache>[\s\S]*?<\/c:numCache>/gm)||[]).forEach(function(_){var x=Gw(_);h.s.r=h.s.c=0,h.e.c=v,f=_r(v),x[0].forEach(function(T,b){d[f+Tr(b)]={t:"n",v:T,z:x[1]},u=b}),h.e.r<u&&(h.e.r=u),++v}),v>0&&(d["!ref"]=za(h)),d}function Yw(t,r,a,s,i){if(!t)return t;s||(s={"!id":{}});var l={"!type":"chart","!drawel":null,"!rel":""},d,v=t.match(hd);return v&&xo(v[0],l,i,a),(d=t.match(/drawing r:id="(.*?)"/))&&(l["!rel"]=d[1]),s["!id"][l["!rel"]]&&(l["!drawel"]=s["!id"][l["!rel"]]),l}function Kw(t,r){t.l+=10;var a=Fr(t);return{name:a}}function Qw(t,r,a,s,i){if(!t)return t;s||(s={"!id":{}});var l={"!type":"chart","!drawel":null,"!rel":""},d=!1;return Ts(t,function(u,f,h){switch(h){case 550:l["!rel"]=u;break;case 651:i.Sheets[a]||(i.Sheets[a]={}),u.name&&(i.Sheets[a].CodeName=u.name);break;case 562:case 652:case 669:case 679:case 551:case 552:case 476:case 3072:break;case 35:d=!0;break;case 36:d=!1;break;case 37:break;case 38:break;default:if(!(f.T>0)){if(!(f.T<0)){if(!d||r.WTF)throw new Error("Unexpected record 0x"+h.toString(16))}}}},r),s["!id"][l["!rel"]]&&(l["!drawel"]=s["!id"][l["!rel"]]),l}var _d=[["allowRefreshQuery",!1,"bool"],["autoCompressPictures",!0,"bool"],["backupFile",!1,"bool"],["checkCompatibility",!1,"bool"],["CodeName",""],["date1904",!1,"bool"],["defaultThemeVersion",0,"int"],["filterPrivacy",!1,"bool"],["hidePivotFieldList",!1,"bool"],["promptedSolutions",!1,"bool"],["publishItems",!1,"bool"],["refreshAllConnections",!1,"bool"],["saveExternalLinkValues",!0,"bool"],["showBorderUnselectedTables",!0,"bool"],["showInkAnnotation",!0,"bool"],["showObjects","all"],["showPivotChartFilter",!1,"bool"],["updateLinks","userSet"]],Zw=[["activeTab",0,"int"],["autoFilterDateGrouping",!0,"bool"],["firstSheet",0,"int"],["minimized",!1,"bool"],["showHorizontalScroll",!0,"bool"],["showSheetTabs",!0,"bool"],["showVerticalScroll",!0,"bool"],["tabRatio",600,"int"],["visibility","visible"]],Jw=[],ey=[["calcCompleted","true"],["calcMode","auto"],["calcOnSave","true"],["concurrentCalc","true"],["fullCalcOnLoad","false"],["fullPrecision","true"],["iterate","false"],["iterateCount","100"],["iterateDelta","0.001"],["refMode","A1"]];function Sl(t,r){for(var a=0;a!=t.length;++a)for(var s=t[a],i=0;i!=r.length;++i){var l=r[i];if(s[l[0]]==null)s[l[0]]=l[1];else switch(l[2]){case"bool":typeof s[l[0]]=="string"&&(s[l[0]]=er(s[l[0]]));break;case"int":typeof s[l[0]]=="string"&&(s[l[0]]=parseInt(s[l[0]],10));break}}}function Cl(t,r){for(var a=0;a!=r.length;++a){var s=r[a];if(t[s[0]]==null)t[s[0]]=s[1];else switch(s[2]){case"bool":typeof t[s[0]]=="string"&&(t[s[0]]=er(t[s[0]]));break;case"int":typeof t[s[0]]=="string"&&(t[s[0]]=parseInt(t[s[0]],10));break}}}function gd(t){Cl(t.WBProps,_d),Cl(t.CalcPr,ey),Sl(t.WBView,Zw),Sl(t.Sheets,Jw),si.date1904=er(t.WBProps.date1904)}var ty="][*?/\\".split("");function ay(t,r){if(t.length>31)throw new Error("Sheet names cannot exceed 31 chars");var a=!0;return ty.forEach(function(s){if(t.indexOf(s)!=-1)throw new Error("Sheet name cannot contain : \\ / ? * [ ]")}),a}var ry=/<\w+:workbook/;function sy(t,r){if(!t)throw new Error("Could not find file");var a={AppVersion:{},WBProps:{},WBView:[],Sheets:[],CalcPr:{},Names:[],xmlns:""},s=!1,i="xmlns",l={},d=0;if(t.replace(Mr,function(u,f){var h=ba(u);switch(ps(h[0])){case"<?xml":break;case"<workbook":u.match(ry)&&(i="xmlns"+u.match(/<(\w+):/)[1]),a.xmlns=h[i];break;case"</workbook>":break;case"<fileVersion":delete h[0],a.AppVersion=h;break;case"<fileVersion/>":case"</fileVersion>":break;case"<fileSharing":break;case"<fileSharing/>":break;case"<workbookPr":case"<workbookPr/>":_d.forEach(function(_){if(h[_[0]]!=null)switch(_[2]){case"bool":a.WBProps[_[0]]=er(h[_[0]]);break;case"int":a.WBProps[_[0]]=parseInt(h[_[0]],10);break;default:a.WBProps[_[0]]=h[_[0]]}}),h.codeName&&(a.WBProps.CodeName=Ka(h.codeName));break;case"</workbookPr>":break;case"<workbookProtection":break;case"<workbookProtection/>":break;case"<bookViews":case"<bookViews>":case"</bookViews>":break;case"<workbookView":case"<workbookView/>":delete h[0],a.WBView.push(h);break;case"</workbookView>":break;case"<sheets":case"<sheets>":case"</sheets>":break;case"<sheet":switch(h.state){case"hidden":h.Hidden=1;break;case"veryHidden":h.Hidden=2;break;default:h.Hidden=0}delete h.state,h.name=Ua(Ka(h.name)),delete h[0],a.Sheets.push(h);break;case"</sheet>":break;case"<functionGroups":case"<functionGroups/>":break;case"<functionGroup":break;case"<externalReferences":case"</externalReferences>":case"<externalReferences>":break;case"<externalReference":break;case"<definedNames/>":break;case"<definedNames>":case"<definedNames":s=!0;break;case"</definedNames>":s=!1;break;case"<definedName":l={},l.Name=Ka(h.name),h.comment&&(l.Comment=h.comment),h.localSheetId&&(l.Sheet=+h.localSheetId),er(h.hidden||"0")&&(l.Hidden=!0),d=f+u.length;break;case"</definedName>":l.Ref=Ua(Ka(t.slice(d,f))),a.Names.push(l);break;case"<definedName/>":break;case"<calcPr":delete h[0],a.CalcPr=h;break;case"<calcPr/>":delete h[0],a.CalcPr=h;break;case"</calcPr>":break;case"<oleSize":break;case"<customWorkbookViews>":case"</customWorkbookViews>":case"<customWorkbookViews":break;case"<customWorkbookView":case"</customWorkbookView>":break;case"<pivotCaches>":case"</pivotCaches>":case"<pivotCaches":break;case"<pivotCache":break;case"<smartTagPr":case"<smartTagPr/>":break;case"<smartTagTypes":case"<smartTagTypes>":case"</smartTagTypes>":break;case"<smartTagType":break;case"<webPublishing":case"<webPublishing/>":break;case"<fileRecoveryPr":case"<fileRecoveryPr/>":break;case"<webPublishObjects>":case"<webPublishObjects":case"</webPublishObjects>":break;case"<webPublishObject":break;case"<extLst":case"<extLst>":case"</extLst>":case"<extLst/>":break;case"<ext":s=!0;break;case"</ext>":s=!1;break;case"<ArchID":break;case"<AlternateContent":case"<AlternateContent>":s=!0;break;case"</AlternateContent>":s=!1;break;case"<revisionPtr":break;default:if(!s&&r.WTF)throw new Error("unrecognized "+h[0]+" in workbook")}return u}),ym.indexOf(a.xmlns)===-1)throw new Error("Unknown Namespace: "+a.xmlns);return gd(a),a}function iy(t,r){var a={};return a.Hidden=t.read_shift(4),a.iTabID=t.read_shift(4),a.strRelID=$n(t),a.name=Fr(t),a}function ny(t,r){var a={},s=t.read_shift(4);a.defaultThemeVersion=t.read_shift(4);var i=r>8?Fr(t):"";return i.length>0&&(a.CodeName=i),a.autoCompressPictures=!!(s&65536),a.backupFile=!!(s&64),a.checkCompatibility=!!(s&4096),a.date1904=!!(s&1),a.filterPrivacy=!!(s&8),a.hidePivotFieldList=!!(s&1024),a.promptedSolutions=!!(s&16),a.publishItems=!!(s&2048),a.refreshAllConnections=!!(s&262144),a.saveExternalLinkValues=!!(s&128),a.showBorderUnselectedTables=!!(s&4),a.showInkAnnotation=!!(s&32),a.showObjects=["all","placeholders","none"][s>>13&3],a.showPivotChartFilter=!!(s&32768),a.updateLinks=["userSet","never","always"][s>>8&3],a}function oy(t,r){var a={};return t.read_shift(4),a.ArchID=t.read_shift(4),t.l+=r-8,a}function ly(t,r,a){var s=t.l+r;t.l+=4,t.l+=1;var i=t.read_shift(4),l=$m(t),d=Hb(t,0,a),v=uo(t);t.l=s;var u={Name:l,Ptg:d};return i<268435455&&(u.Sheet=i),v&&(u.Comment=v),u}function cy(t,r){var a={AppVersion:{},WBProps:{},WBView:[],Sheets:[],CalcPr:{},xmlns:""},s=[],i=!1;r||(r={}),r.biff=12;var l=[],d=[[]];return d.SheetNames=[],d.XTI=[],_n[16]={n:"BrtFRTArchID$",f:oy},Ts(t,function(u,f,h){switch(h){case 156:d.SheetNames.push(u.name),a.Sheets.push(u);break;case 153:a.WBProps=u;break;case 39:u.Sheet!=null&&(r.SID=u.Sheet),u.Ref=Ar(u.Ptg,null,null,d,r),delete r.SID,delete u.Ptg,l.push(u);break;case 1036:break;case 357:case 358:case 355:case 667:d[0].length?d.push([h,u]):d[0]=[h,u],d[d.length-1].XTI=[];break;case 362:d.length===0&&(d[0]=[],d[0].XTI=[]),d[d.length-1].XTI=d[d.length-1].XTI.concat(u),d.XTI=d.XTI.concat(u);break;case 361:break;case 2071:case 158:case 143:case 664:case 353:break;case 3072:case 3073:case 534:case 677:case 157:case 610:case 2050:case 155:case 548:case 676:case 128:case 665:case 2128:case 2125:case 549:case 2053:case 596:case 2076:case 2075:case 2082:case 397:case 154:case 1117:case 553:case 2091:break;case 35:s.push(h),i=!0;break;case 36:s.pop(),i=!1;break;case 37:s.push(h),i=!0;break;case 38:s.pop(),i=!1;break;case 16:break;default:if(!f.T){if(!i||r.WTF&&s[s.length-1]!=37&&s[s.length-1]!=35)throw new Error("Unexpected record 0x"+h.toString(16))}}},r),gd(a),a.Names=l,a.supbooks=d,a}function dy(t,r,a){return r.slice(-4)===".bin"?cy(t,a):sy(t,a)}function vy(t,r,a,s,i,l,d,v){return r.slice(-4)===".bin"?Vw(t,s,a,i,l,d,v):iw(t,s,a,i,l,d,v)}function uy(t,r,a,s,i,l,d,v){return r.slice(-4)===".bin"?Qw(t,s,a,i,l):Yw(t,s,a,i,l)}function fy(t,r,a,s,i,l,d,v){return r.slice(-4)===".bin"?wx():yx()}function py(t,r,a,s,i,l,d,v){return r.slice(-4)===".bin"?xx():bx()}function hy(t,r,a,s){return r.slice(-4)===".bin"?L2(t,a,s):D2(t,a,s)}function my(t,r,a){return sd(t,a)}function _y(t,r,a){return r.slice(-4)===".bin"?Zg(t,a):Kg(t,a)}function gy(t,r,a){return r.slice(-4)===".bin"?mx(t,a):vx(t,a)}function xy(t,r,a){return r.slice(-4)===".bin"?lx(t):nx(t)}function by(t,r,a,s){return a.slice(-4)===".bin"?cx(t,r,a,s):void 0}function wy(t,r,a){return r.slice(-4)===".bin"?sx(t,r,a):ix(t,r,a)}var xd=/([\w:]+)=((?:")([^"]*)(?:")|(?:')([^']*)(?:'))/g,bd=/([\w:]+)=((?:")(?:[^"]*)(?:")|(?:')(?:[^']*)(?:'))/;function ts(t,r){var a=t.split(/\s+/),s=[];if(s[0]=a[0],a.length===1)return s;var i=t.match(xd),l,d,v,u;if(i)for(u=0;u!=i.length;++u)l=i[u].match(bd),(d=l[1].indexOf(":"))===-1?s[l[1]]=l[2].slice(1,l[2].length-1):(l[1].slice(0,6)==="xmlns:"?v="xmlns"+l[1].slice(6):v=l[1].slice(d+1),s[v]=l[2].slice(1,l[2].length-1));return s}function yy(t){var r=t.split(/\s+/),a={};if(r.length===1)return a;var s=t.match(xd),i,l,d,v;if(s)for(v=0;v!=s.length;++v)i=s[v].match(bd),(l=i[1].indexOf(":"))===-1?a[i[1]]=i[2].slice(1,i[2].length-1):(i[1].slice(0,6)==="xmlns:"?d="xmlns"+i[1].slice(6):d=i[1].slice(l+1),a[d]=i[2].slice(1,i[2].length-1));return a}var Fi;function ky(t,r){var a=Fi[t]||Ua(t);return a==="General"?js(r):Qr(a,r)}function Ty(t,r,a,s){var i=s;switch((a[0].match(/dt:dt="([\w.]+)"/)||["",""])[1]){case"boolean":i=er(s);break;case"i2":case"int":i=parseInt(s,10);break;case"r4":case"float":i=parseFloat(s);break;case"date":case"dateTime.tz":i=br(s);break;case"i8":case"string":case"fixed":case"uuid":case"bin.base64":break;default:throw new Error("bad custprop:"+a[0])}t[Ua(r)]=i}function Ey(t,r,a){if(t.t!=="z"){if(!a||a.cellText!==!1)try{t.t==="e"?t.w=t.w||Ks[t.v]:r==="General"?t.t==="n"?(t.v|0)===t.v?t.w=t.v.toString(10):t.w=Ii(t.v):t.w=js(t.v):t.w=ky(r||"General",t.v)}catch(l){if(a.WTF)throw l}try{var s=Fi[r]||r||"General";if(a.cellNF&&(t.z=s),a.cellDates&&t.t=="n"&&oi(s)){var i=zs(t.v);i&&(t.t="d",t.v=new Date(i.y,i.m-1,i.d,i.H,i.M,i.S,i.u))}}catch(l){if(a.WTF)throw l}}}function Ay(t,r,a){if(a.cellStyles&&r.Interior){var s=r.Interior;s.Pattern&&(s.patternType=T2[s.Pattern]||s.Pattern)}t[r.ID]=r}function Sy(t,r,a,s,i,l,d,v,u,f){var h="General",_=s.StyleID,x={};f=f||{};var T=[],b=0;for(_===void 0&&v&&(_=v.StyleID),_===void 0&&d&&(_=d.StyleID);l[_]!==void 0&&(l[_].nf&&(h=l[_].nf),l[_].Interior&&T.push(l[_].Interior),!!l[_].Parent);)_=l[_].Parent;switch(a.Type){case"Boolean":s.t="b",s.v=er(t);break;case"String":s.t="s",s.r=Ko(Ua(t)),s.v=t.indexOf("<")>-1?Ua(r||t).replace(/<.*?>/g,""):s.r;break;case"DateTime":t.slice(-1)!="Z"&&(t+="Z"),s.v=(br(t)-new Date(Date.UTC(1899,11,30)))/(24*60*60*1e3),s.v!==s.v?s.v=Ua(t):s.v<60&&(s.v=s.v-1),(!h||h=="General")&&(h="yyyy-mm-dd");case"Number":s.v===void 0&&(s.v=+t),s.t||(s.t="n");break;case"Error":s.t="e",s.v=Lc[t],f.cellText!==!1&&(s.w=t);break;default:t==""&&r==""?s.t="z":(s.t="s",s.v=Ko(r||t));break}if(Ey(s,h,f),f.cellFormula!==!1)if(s.Formula){var w=Ua(s.Formula);w.charCodeAt(0)==61&&(w=w.slice(1)),s.f=ri(w,i),delete s.Formula,s.ArrayRange=="RC"?s.F=ri("RC:RC",i):s.ArrayRange&&(s.F=ri(s.ArrayRange,i),u.push([cr(s.F),s.F]))}else for(b=0;b<u.length;++b)i.r>=u[b][0].s.r&&i.r<=u[b][0].e.r&&i.c>=u[b][0].s.c&&i.c<=u[b][0].e.c&&(s.F=u[b][1]);f.cellStyles&&(T.forEach(function(A){!x.patternType&&A.patternType&&(x.patternType=A.patternType)}),s.s=x),s.StyleID!==void 0&&(s.ixfe=s.StyleID)}function Cy(t){t.t=t.v||"",t.t=t.t.replace(/\r\n/g,`
`).replace(/\r/g,`
`),t.v=t.w=t.ixfe=void 0}function Ln(t,r){var a=r||{};lc();var s=mi(no(t));(a.type=="binary"||a.type=="array"||a.type=="base64")&&(s=Ka(s));var i=s.slice(0,1024).toLowerCase(),l=!1;if(i=i.replace(/".*?"/g,""),(i.indexOf(">")&1023)>Math.min(i.indexOf(",")&1023,i.indexOf(";")&1023)){var d=kr(a);return d.type="string",Pi.to_workbook(s,d)}if(i.indexOf("<?xml")==-1&&["html","table","head","meta","script","style","div"].forEach(function(V){i.indexOf("<"+V)>=0&&(l=!0)}),l)return Oy(s,a);Fi={"General Number":"General","General Date":Sa[22],"Long Date":"dddd, mmmm dd, yyyy","Medium Date":Sa[15],"Short Date":Sa[14],"Long Time":Sa[19],"Medium Time":Sa[18],"Short Time":Sa[20],Currency:'"$"#,##0.00_);[Red]\\("$"#,##0.00\\)',Fixed:Sa[2],Standard:Sa[4],Percent:Sa[10],Scientific:Sa[11],"Yes/No":'"Yes";"Yes";"No";@',"True/False":'"True";"True";"False";@',"On/Off":'"Yes";"Yes";"No";@'};var v,u=[],f,h={},_=[],x=a.dense?[]:{},T="",b={},w={},A=ts('<Data ss:Type="String">'),C=0,z=0,F=0,re={s:{r:2e6,c:2e6},e:{r:0,c:0}},me={},ue={},D="",E=0,he=[],xe={},K={},q=0,ae=[],Me=[],ge={},Ne=[],Be,be=!1,L=[],Te=[],ye={},P=0,pe=0,B={Sheets:[],WBProps:{date1904:!1}},j={};Ni.lastIndex=0,s=s.replace(/<!--([\s\S]*?)-->/mg,"");for(var I="";v=Ni.exec(s);)switch(v[3]=(I=v[3]).toLowerCase()){case"data":if(I=="data"){if(v[1]==="/"){if((f=u.pop())[0]!==v[3])throw new Error("Bad state: "+f.join("|"))}else v[0].charAt(v[0].length-2)!=="/"&&u.push([v[3],!0]);break}if(u[u.length-1][1])break;v[1]==="/"?Sy(s.slice(C,v.index),D,A,u[u.length-1][0]=="comment"?ge:b,{c:z,r:F},me,Ne[z],w,L,a):(D="",A=ts(v[0]),C=v.index+v[0].length);break;case"cell":if(v[1]==="/")if(Me.length>0&&(b.c=Me),(!a.sheetRows||a.sheetRows>F)&&b.v!==void 0&&(a.dense?(x[F]||(x[F]=[]),x[F][z]=b):x[_r(z)+Tr(F)]=b),b.HRef&&(b.l={Target:Ua(b.HRef)},b.HRefScreenTip&&(b.l.Tooltip=b.HRefScreenTip),delete b.HRef,delete b.HRefScreenTip),(b.MergeAcross||b.MergeDown)&&(P=z+(parseInt(b.MergeAcross,10)|0),pe=F+(parseInt(b.MergeDown,10)|0),he.push({s:{c:z,r:F},e:{c:P,r:pe}})),!a.sheetStubs)b.MergeAcross?z=P+1:++z;else if(b.MergeAcross||b.MergeDown){for(var Y=z;Y<=P;++Y)for(var fe=F;fe<=pe;++fe)(Y>z||fe>F)&&(a.dense?(x[fe]||(x[fe]=[]),x[fe][Y]={t:"z"}):x[_r(Y)+Tr(fe)]={t:"z"});z=P+1}else++z;else b=yy(v[0]),b.Index&&(z=+b.Index-1),z<re.s.c&&(re.s.c=z),z>re.e.c&&(re.e.c=z),v[0].slice(-2)==="/>"&&++z,Me=[];break;case"row":v[1]==="/"||v[0].slice(-2)==="/>"?(F<re.s.r&&(re.s.r=F),F>re.e.r&&(re.e.r=F),v[0].slice(-2)==="/>"&&(w=ts(v[0]),w.Index&&(F=+w.Index-1)),z=0,++F):(w=ts(v[0]),w.Index&&(F=+w.Index-1),ye={},(w.AutoFitHeight=="0"||w.Height)&&(ye.hpx=parseInt(w.Height,10),ye.hpt=rd(ye.hpx),Te[F]=ye),w.Hidden=="1"&&(ye.hidden=!0,Te[F]=ye));break;case"worksheet":if(v[1]==="/"){if((f=u.pop())[0]!==v[3])throw new Error("Bad state: "+f.join("|"));_.push(T),re.s.r<=re.e.r&&re.s.c<=re.e.c&&(x["!ref"]=za(re),a.sheetRows&&a.sheetRows<=re.e.r&&(x["!fullref"]=x["!ref"],re.e.r=a.sheetRows-1,x["!ref"]=za(re))),he.length&&(x["!merges"]=he),Ne.length>0&&(x["!cols"]=Ne),Te.length>0&&(x["!rows"]=Te),h[T]=x}else re={s:{r:2e6,c:2e6},e:{r:0,c:0}},F=z=0,u.push([v[3],!1]),f=ts(v[0]),T=Ua(f.Name),x=a.dense?[]:{},he=[],L=[],Te=[],j={name:T,Hidden:0},B.Sheets.push(j);break;case"table":if(v[1]==="/"){if((f=u.pop())[0]!==v[3])throw new Error("Bad state: "+f.join("|"))}else{if(v[0].slice(-2)=="/>")break;u.push([v[3],!1]),Ne=[],be=!1}break;case"style":v[1]==="/"?Ay(me,ue,a):ue=ts(v[0]);break;case"numberformat":ue.nf=Ua(ts(v[0]).Format||"General"),Fi[ue.nf]&&(ue.nf=Fi[ue.nf]);for(var ce=0;ce!=392&&Sa[ce]!=ue.nf;++ce);if(ce==392){for(ce=57;ce!=392;++ce)if(Sa[ce]==null){Bs(ue.nf,ce);break}}break;case"column":if(u[u.length-1][0]!=="table")break;if(Be=ts(v[0]),Be.Hidden&&(Be.hidden=!0,delete Be.Hidden),Be.Width&&(Be.wpx=parseInt(Be.Width,10)),!be&&Be.wpx>10){be=!0,Nr=td;for(var J=0;J<Ne.length;++J)Ne[J]&&ni(Ne[J])}be&&ni(Be),Ne[Be.Index-1||Ne.length]=Be;for(var le=0;le<+Be.Span;++le)Ne[Ne.length]=kr(Be);break;case"namedrange":if(v[1]==="/")break;B.Names||(B.Names=[]);var S=ba(v[0]),De={Name:S.Name,Ref:ri(S.RefersTo.slice(1),{r:0,c:0})};B.Sheets.length>0&&(De.Sheet=B.Sheets.length-1),B.Names.push(De);break;case"namedcell":break;case"b":break;case"i":break;case"u":break;case"s":break;case"em":break;case"h2":break;case"h3":break;case"sub":break;case"sup":break;case"span":break;case"alignment":break;case"borders":break;case"border":break;case"font":if(v[0].slice(-2)==="/>")break;v[1]==="/"?D+=s.slice(E,v.index):E=v.index+v[0].length;break;case"interior":if(!a.cellStyles)break;ue.Interior=ts(v[0]);break;case"protection":break;case"author":case"title":case"description":case"created":case"keywords":case"subject":case"category":case"company":case"lastauthor":case"lastsaved":case"lastprinted":case"version":case"revision":case"totaltime":case"hyperlinkbase":case"manager":case"contentstatus":case"identifier":case"language":case"appname":if(v[0].slice(-2)==="/>")break;v[1]==="/"?v_(xe,I,s.slice(q,v.index)):q=v.index+v[0].length;break;case"paragraphs":break;case"styles":case"workbook":if(v[1]==="/"){if((f=u.pop())[0]!==v[3])throw new Error("Bad state: "+f.join("|"))}else u.push([v[3],!1]);break;case"comment":if(v[1]==="/"){if((f=u.pop())[0]!==v[3])throw new Error("Bad state: "+f.join("|"));Cy(ge),Me.push(ge)}else u.push([v[3],!1]),f=ts(v[0]),ge={a:f.Author};break;case"autofilter":if(v[1]==="/"){if((f=u.pop())[0]!==v[3])throw new Error("Bad state: "+f.join("|"))}else if(v[0].charAt(v[0].length-2)!=="/"){var Ue=ts(v[0]);x["!autofilter"]={ref:ri(Ue.Range).replace(/\$/g,"")},u.push([v[3],!0])}break;case"name":break;case"datavalidation":if(v[1]==="/"){if((f=u.pop())[0]!==v[3])throw new Error("Bad state: "+f.join("|"))}else v[0].charAt(v[0].length-2)!=="/"&&u.push([v[3],!0]);break;case"pixelsperinch":break;case"componentoptions":case"documentproperties":case"customdocumentproperties":case"officedocumentsettings":case"pivottable":case"pivotcache":case"names":case"mapinfo":case"pagebreaks":case"querytable":case"sorting":case"schema":case"conditionalformatting":case"smarttagtype":case"smarttags":case"excelworkbook":case"workbookoptions":case"worksheetoptions":if(v[1]==="/"){if((f=u.pop())[0]!==v[3])throw new Error("Bad state: "+f.join("|"))}else v[0].charAt(v[0].length-2)!=="/"&&u.push([v[3],!0]);break;case"null":break;default:if(u.length==0&&v[3]=="document"||u.length==0&&v[3]=="uof")return Nl(s,a);var We=!0;switch(u[u.length-1][0]){case"officedocumentsettings":switch(v[3]){case"allowpng":break;case"removepersonalinformation":break;case"downloadcomponents":break;case"locationofcomponents":break;case"colors":break;case"color":break;case"index":break;case"rgb":break;case"targetscreensize":break;case"readonlyrecommended":break;default:We=!1}break;case"componentoptions":switch(v[3]){case"toolbar":break;case"hideofficelogo":break;case"spreadsheetautofit":break;case"label":break;case"caption":break;case"maxheight":break;case"maxwidth":break;case"nextsheetnumber":break;default:We=!1}break;case"excelworkbook":switch(v[3]){case"date1904":B.WBProps.date1904=!0;break;case"windowheight":break;case"windowwidth":break;case"windowtopx":break;case"windowtopy":break;case"tabratio":break;case"protectstructure":break;case"protectwindow":break;case"protectwindows":break;case"activesheet":break;case"displayinknotes":break;case"firstvisiblesheet":break;case"supbook":break;case"sheetname":break;case"sheetindex":break;case"sheetindexfirst":break;case"sheetindexlast":break;case"dll":break;case"acceptlabelsinformulas":break;case"donotsavelinkvalues":break;case"iteration":break;case"maxiterations":break;case"maxchange":break;case"path":break;case"xct":break;case"count":break;case"selectedsheets":break;case"calculation":break;case"uncalced":break;case"startupprompt":break;case"crn":break;case"externname":break;case"formula":break;case"colfirst":break;case"collast":break;case"wantadvise":break;case"boolean":break;case"error":break;case"text":break;case"ole":break;case"noautorecover":break;case"publishobjects":break;case"donotcalculatebeforesave":break;case"number":break;case"refmoder1c1":break;case"embedsavesmarttags":break;default:We=!1}break;case"workbookoptions":switch(v[3]){case"owcversion":break;case"height":break;case"width":break;default:We=!1}break;case"worksheetoptions":switch(v[3]){case"visible":if(v[0].slice(-2)!=="/>")if(v[1]==="/")switch(s.slice(q,v.index)){case"SheetHidden":j.Hidden=1;break;case"SheetVeryHidden":j.Hidden=2;break}else q=v.index+v[0].length;break;case"header":x["!margins"]||Ci(x["!margins"]={},"xlml"),isNaN(+ba(v[0]).Margin)||(x["!margins"].header=+ba(v[0]).Margin);break;case"footer":x["!margins"]||Ci(x["!margins"]={},"xlml"),isNaN(+ba(v[0]).Margin)||(x["!margins"].footer=+ba(v[0]).Margin);break;case"pagemargins":var ke=ba(v[0]);x["!margins"]||Ci(x["!margins"]={},"xlml"),isNaN(+ke.Top)||(x["!margins"].top=+ke.Top),isNaN(+ke.Left)||(x["!margins"].left=+ke.Left),isNaN(+ke.Right)||(x["!margins"].right=+ke.Right),isNaN(+ke.Bottom)||(x["!margins"].bottom=+ke.Bottom);break;case"displayrighttoleft":B.Views||(B.Views=[]),B.Views[0]||(B.Views[0]={}),B.Views[0].RTL=!0;break;case"freezepanes":break;case"frozennosplit":break;case"splithorizontal":case"splitvertical":break;case"donotdisplaygridlines":break;case"activerow":break;case"activecol":break;case"toprowbottompane":break;case"leftcolumnrightpane":break;case"unsynced":break;case"print":break;case"printerrors":break;case"panes":break;case"scale":break;case"pane":break;case"number":break;case"layout":break;case"pagesetup":break;case"selected":break;case"protectobjects":break;case"enableselection":break;case"protectscenarios":break;case"validprinterinfo":break;case"horizontalresolution":break;case"verticalresolution":break;case"numberofcopies":break;case"activepane":break;case"toprowvisible":break;case"leftcolumnvisible":break;case"fittopage":break;case"rangeselection":break;case"papersizeindex":break;case"pagelayoutzoom":break;case"pagebreakzoom":break;case"filteron":break;case"fitwidth":break;case"fitheight":break;case"commentslayout":break;case"zoom":break;case"lefttoright":break;case"gridlines":break;case"allowsort":break;case"allowfilter":break;case"allowinsertrows":break;case"allowdeleterows":break;case"allowinsertcols":break;case"allowdeletecols":break;case"allowinserthyperlinks":break;case"allowformatcells":break;case"allowsizecols":break;case"allowsizerows":break;case"nosummaryrowsbelowdetail":x["!outline"]||(x["!outline"]={}),x["!outline"].above=!0;break;case"tabcolorindex":break;case"donotdisplayheadings":break;case"showpagelayoutzoom":break;case"nosummarycolumnsrightdetail":x["!outline"]||(x["!outline"]={}),x["!outline"].left=!0;break;case"blackandwhite":break;case"donotdisplayzeros":break;case"displaypagebreak":break;case"rowcolheadings":break;case"donotdisplayoutline":break;case"noorientation":break;case"allowusepivottables":break;case"zeroheight":break;case"viewablerange":break;case"selection":break;case"protectcontents":break;default:We=!1}break;case"pivottable":case"pivotcache":switch(v[3]){case"immediateitemsondrop":break;case"showpagemultipleitemlabel":break;case"compactrowindent":break;case"location":break;case"pivotfield":break;case"orientation":break;case"layoutform":break;case"layoutsubtotallocation":break;case"layoutcompactrow":break;case"position":break;case"pivotitem":break;case"datatype":break;case"datafield":break;case"sourcename":break;case"parentfield":break;case"ptlineitems":break;case"ptlineitem":break;case"countofsameitems":break;case"item":break;case"itemtype":break;case"ptsource":break;case"cacheindex":break;case"consolidationreference":break;case"filename":break;case"reference":break;case"nocolumngrand":break;case"norowgrand":break;case"blanklineafteritems":break;case"hidden":break;case"subtotal":break;case"basefield":break;case"mapchilditems":break;case"function":break;case"refreshonfileopen":break;case"printsettitles":break;case"mergelabels":break;case"defaultversion":break;case"refreshname":break;case"refreshdate":break;case"refreshdatecopy":break;case"versionlastrefresh":break;case"versionlastupdate":break;case"versionupdateablemin":break;case"versionrefreshablemin":break;case"calculation":break;default:We=!1}break;case"pagebreaks":switch(v[3]){case"colbreaks":break;case"colbreak":break;case"rowbreaks":break;case"rowbreak":break;case"colstart":break;case"colend":break;case"rowend":break;default:We=!1}break;case"autofilter":switch(v[3]){case"autofiltercolumn":break;case"autofiltercondition":break;case"autofilterand":break;case"autofilteror":break;default:We=!1}break;case"querytable":switch(v[3]){case"id":break;case"autoformatfont":break;case"autoformatpattern":break;case"querysource":break;case"querytype":break;case"enableredirections":break;case"refreshedinxl9":break;case"urlstring":break;case"htmltables":break;case"connection":break;case"commandtext":break;case"refreshinfo":break;case"notitles":break;case"nextid":break;case"columninfo":break;case"overwritecells":break;case"donotpromptforfile":break;case"textwizardsettings":break;case"source":break;case"number":break;case"decimal":break;case"thousandseparator":break;case"trailingminusnumbers":break;case"formatsettings":break;case"fieldtype":break;case"delimiters":break;case"tab":break;case"comma":break;case"autoformatname":break;case"versionlastedit":break;case"versionlastrefresh":break;default:We=!1}break;case"datavalidation":switch(v[3]){case"range":break;case"type":break;case"min":break;case"max":break;case"sort":break;case"descending":break;case"order":break;case"casesensitive":break;case"value":break;case"errorstyle":break;case"errormessage":break;case"errortitle":break;case"inputmessage":break;case"inputtitle":break;case"combohide":break;case"inputhide":break;case"condition":break;case"qualifier":break;case"useblank":break;case"value1":break;case"value2":break;case"format":break;case"cellrangelist":break;default:We=!1}break;case"sorting":case"conditionalformatting":switch(v[3]){case"range":break;case"type":break;case"min":break;case"max":break;case"sort":break;case"descending":break;case"order":break;case"casesensitive":break;case"value":break;case"errorstyle":break;case"errormessage":break;case"errortitle":break;case"cellrangelist":break;case"inputmessage":break;case"inputtitle":break;case"combohide":break;case"inputhide":break;case"condition":break;case"qualifier":break;case"useblank":break;case"value1":break;case"value2":break;case"format":break;default:We=!1}break;case"mapinfo":case"schema":case"data":switch(v[3]){case"map":break;case"entry":break;case"range":break;case"xpath":break;case"field":break;case"xsdtype":break;case"filteron":break;case"aggregate":break;case"elementtype":break;case"attributetype":break;case"schema":case"element":case"complextype":case"datatype":case"all":case"attribute":case"extends":break;case"row":break;default:We=!1}break;case"smarttags":break;default:We=!1;break}if(We||v[3].match(/!\[CDATA/))break;if(!u[u.length-1][1])throw"Unrecognized tag: "+v[3]+"|"+u.join("|");if(u[u.length-1][0]==="customdocumentproperties"){if(v[0].slice(-2)==="/>")break;v[1]==="/"?Ty(K,I,ae,s.slice(q,v.index)):(ae=v,q=v.index+v[0].length);break}if(a.WTF)throw"Unrecognized tag: "+v[3]+"|"+u.join("|")}var N={};return!a.bookSheets&&!a.bookProps&&(N.Sheets=h),N.SheetNames=_,N.Workbook=B,N.SSF=kr(Sa),N.Props=xe,N.Custprops=K,N}function Wn(t,r){switch(yo(r=r||{}),r.type||"base64"){case"base64":return Ln(Gr(t),r);case"binary":case"buffer":case"file":return Ln(t,r);case"array":return Ln(Gs(t),r)}}function Fy(t){var r={},a=t.content;if(a.l=28,r.AnsiUserType=a.read_shift(0,"lpstr-ansi"),r.AnsiClipboardFormat=jm(a),a.length-a.l<=4)return r;var s=a.read_shift(4);if(s==0||s>40||(a.l-=4,r.Reserved1=a.read_shift(0,"lpstr-ansi"),a.length-a.l<=4)||(s=a.read_shift(4),s!==1907505652)||(r.UnicodeClipboardFormat=Wm(a),s=a.read_shift(4),s==0||s>40))return r;a.l-=4,r.Reserved2=a.read_shift(0,"lpwstr")}var Dy=[60,1084,2066,2165,2175];function My(t,r,a,s,i){var l=s,d=[],v=a.slice(a.l,a.l+l);if(i&&i.enc&&i.enc.insitu&&v.length>0)switch(t){case 9:case 521:case 1033:case 2057:case 47:case 405:case 225:case 406:case 312:case 404:case 10:break;case 133:break;default:i.enc.insitu(v)}d.push(v),a.l+=l;for(var u=xs(a,a.l),f=Hn[u],h=0;f!=null&&Dy.indexOf(u)>-1;)l=xs(a,a.l+2),h=a.l+4,u==2066?h+=4:(u==2165||u==2175)&&(h+=12),v=a.slice(h,a.l+4+l),d.push(v),a.l+=4+l,f=Hn[u=xs(a,a.l)];var _=Ss(d);wr(_,0);var x=0;_.lens=[];for(var T=0;T<d.length;++T)_.lens.push(x),x+=d[T].length;if(_.length<s)throw"XLS Record 0x"+t.toString(16)+" Truncated: "+_.length+" < "+s;return r.f(_,_.length,i)}function cs(t,r,a){if(t.t!=="z"&&t.XF){var s=0;try{s=t.z||t.XF.numFmtId||0,r.cellNF&&(t.z=Sa[s])}catch(l){if(r.WTF)throw l}if(!r||r.cellText!==!1)try{t.t==="e"?t.w=t.w||Ks[t.v]:s===0||s=="General"?t.t==="n"?(t.v|0)===t.v?t.w=t.v.toString(10):t.w=Ii(t.v):t.w=js(t.v):t.w=Qr(s,t.v,{date1904:!!a,dateNF:r&&r.dateNF})}catch(l){if(r.WTF)throw l}if(r.cellDates&&s&&t.t=="n"&&oi(Sa[s]||String(s))){var i=zs(t.v);i&&(t.t="d",t.v=new Date(i.y,i.m-1,i.d,i.H,i.M,i.S,i.u))}}}function rn(t,r,a){return{v:t,ixfe:r,t:a}}function Iy(t,r){var a={opts:{}},s={},i=r.dense?[]:{},l={},d={},v=null,u=[],f="",h={},_,x="",T,b,w,A,C={},z=[],F,re,me=[],ue=[],D={Sheets:[],WBProps:{date1904:!1},Views:[{}]},E={},he=function(Ae){return Ae<8?$s[Ae]:Ae<64&&ue[Ae-8]||$s[Ae]},xe=function(Ae,He,Ke){var Oe=He.XF.data;if(!(!Oe||!Oe.patternType||!Ke||!Ke.cellStyles)){He.s={},He.s.patternType=Oe.patternType;var Ee;(Ee=Li(he(Oe.icvFore)))&&(He.s.fgColor={rgb:Ee}),(Ee=Li(he(Oe.icvBack)))&&(He.s.bgColor={rgb:Ee})}},K=function(Ae,He,Ke){if(!(ye>1)&&!(Ke.sheetRows&&Ae.r>=Ke.sheetRows)){if(Ke.cellStyles&&He.XF&&He.XF.data&&xe(Ae,He,Ke),delete He.ixfe,delete He.XF,_=Ae,x=Ea(Ae),(!d||!d.s||!d.e)&&(d={s:{r:0,c:0},e:{r:0,c:0}}),Ae.r<d.s.r&&(d.s.r=Ae.r),Ae.c<d.s.c&&(d.s.c=Ae.c),Ae.r+1>d.e.r&&(d.e.r=Ae.r+1),Ae.c+1>d.e.c&&(d.e.c=Ae.c+1),Ke.cellFormula&&He.f){for(var Oe=0;Oe<z.length;++Oe)if(!(z[Oe][0].s.c>Ae.c||z[Oe][0].s.r>Ae.r)&&!(z[Oe][0].e.c<Ae.c||z[Oe][0].e.r<Ae.r)){He.F=za(z[Oe][0]),(z[Oe][0].s.c!=Ae.c||z[Oe][0].s.r!=Ae.r)&&delete He.f,He.f&&(He.f=""+Ar(z[Oe][1],d,Ae,L,q));break}}Ke.dense?(i[Ae.r]||(i[Ae.r]=[]),i[Ae.r][Ae.c]=He):i[x]=He}},q={enc:!1,sbcch:0,snames:[],sharedf:C,arrayf:z,rrtabid:[],lastuser:"",biff:8,codepage:0,winlocked:0,cellStyles:!!r&&!!r.cellStyles,WTF:!!r&&!!r.wtf};r.password&&(q.password=r.password);var ae,Me=[],ge=[],Ne=[],Be=[],be=!1,L=[];L.SheetNames=q.snames,L.sharedf=q.sharedf,L.arrayf=q.arrayf,L.names=[],L.XTI=[];var Te=0,ye=0,P=0,pe=[],B=[],j;q.codepage=1200,ns(1200);for(var I=!1;t.l<t.length-1;){var Y=t.l,fe=t.read_shift(2);if(fe===0&&Te===10)break;var ce=t.l===t.length?0:t.read_shift(2),J=Hn[fe];if(J&&J.f){if(r.bookSheets&&Te===133&&fe!==133)break;if(Te=fe,J.r===2||J.r==12){var le=t.read_shift(2);if(ce-=2,!q.enc&&le!==fe&&((le&255)<<8|le>>8)!==fe)throw new Error("rt mismatch: "+le+"!="+fe);J.r==12&&(t.l+=10,ce-=10)}var S={};if(fe===10?S=J.f(t,ce,q):S=My(fe,J,t,ce,q),ye==0&&[9,521,1033,2057].indexOf(Te)===-1)continue;switch(fe){case 34:a.opts.Date1904=D.WBProps.date1904=S;break;case 134:a.opts.WriteProtect=!0;break;case 47:if(q.enc||(t.l=0),q.enc=S,!r.password)throw new Error("File is password-protected");if(S.valid==null)throw new Error("Encryption scheme unsupported");if(!S.valid)throw new Error("Password is incorrect");break;case 92:q.lastuser=S;break;case 66:var De=Number(S);switch(De){case 21010:De=1200;break;case 32768:De=1e4;break;case 32769:De=1252;break}ns(q.codepage=De),I=!0;break;case 317:q.rrtabid=S;break;case 25:q.winlocked=S;break;case 439:a.opts.RefreshAll=S;break;case 12:a.opts.CalcCount=S;break;case 16:a.opts.CalcDelta=S;break;case 17:a.opts.CalcIter=S;break;case 13:a.opts.CalcMode=S;break;case 14:a.opts.CalcPrecision=S;break;case 95:a.opts.CalcSaveRecalc=S;break;case 15:q.CalcRefMode=S;break;case 2211:a.opts.FullCalc=S;break;case 129:S.fDialog&&(i["!type"]="dialog"),S.fBelow||((i["!outline"]||(i["!outline"]={})).above=!0),S.fRight||((i["!outline"]||(i["!outline"]={})).left=!0);break;case 224:me.push(S);break;case 430:L.push([S]),L[L.length-1].XTI=[];break;case 35:case 547:L[L.length-1].push(S);break;case 24:case 536:j={Name:S.Name,Ref:Ar(S.rgce,d,null,L,q)},S.itab>0&&(j.Sheet=S.itab-1),L.names.push(j),L[0]||(L[0]=[],L[0].XTI=[]),L[L.length-1].push(S),S.Name=="_xlnm._FilterDatabase"&&S.itab>0&&S.rgce&&S.rgce[0]&&S.rgce[0][0]&&S.rgce[0][0][0]=="PtgArea3d"&&(B[S.itab-1]={ref:za(S.rgce[0][0][1][2])});break;case 22:q.ExternCount=S;break;case 23:L.length==0&&(L[0]=[],L[0].XTI=[]),L[L.length-1].XTI=L[L.length-1].XTI.concat(S),L.XTI=L.XTI.concat(S);break;case 2196:if(q.biff<8)break;j!=null&&(j.Comment=S[1]);break;case 18:i["!protect"]=S;break;case 19:S!==0&&q.WTF&&console.error("Password verifier: "+S);break;case 133:l[S.pos]=S,q.snames.push(S.name);break;case 10:{if(--ye)break;if(d.e){if(d.e.r>0&&d.e.c>0){if(d.e.r--,d.e.c--,i["!ref"]=za(d),r.sheetRows&&r.sheetRows<=d.e.r){var Ue=d.e.r;d.e.r=r.sheetRows-1,i["!fullref"]=i["!ref"],i["!ref"]=za(d),d.e.r=Ue}d.e.r++,d.e.c++}Me.length>0&&(i["!merges"]=Me),ge.length>0&&(i["!objects"]=ge),Ne.length>0&&(i["!cols"]=Ne),Be.length>0&&(i["!rows"]=Be),D.Sheets.push(E)}f===""?h=i:s[f]=i,i=r.dense?[]:{}}break;case 9:case 521:case 1033:case 2057:{if(q.biff===8&&(q.biff={9:2,521:3,1033:4}[fe]||{512:2,768:3,1024:4,1280:5,1536:8,2:2,7:2}[S.BIFFVer]||8),q.biffguess=S.BIFFVer==0,S.BIFFVer==0&&S.dt==4096&&(q.biff=5,I=!0,ns(q.codepage=28591)),q.biff==8&&S.BIFFVer==0&&S.dt==16&&(q.biff=2),ye++)break;if(i=r.dense?[]:{},q.biff<8&&!I&&(I=!0,ns(q.codepage=r.codepage||1252)),q.biff<5||S.BIFFVer==0&&S.dt==4096){f===""&&(f="Sheet1"),d={s:{r:0,c:0},e:{r:0,c:0}};var We={pos:t.l-ce,name:f};l[We.pos]=We,q.snames.push(f)}else f=(l[Y]||{name:""}).name;S.dt==32&&(i["!type"]="chart"),S.dt==64&&(i["!type"]="macro"),Me=[],ge=[],q.arrayf=z=[],Ne=[],Be=[],be=!1,E={Hidden:(l[Y]||{hs:0}).hs,name:f}}break;case 515:case 3:case 2:i["!type"]=="chart"&&(r.dense?(i[S.r]||[])[S.c]:i[Ea({c:S.c,r:S.r})])&&++S.c,F={ixfe:S.ixfe,XF:me[S.ixfe]||{},v:S.val,t:"n"},P>0&&(F.z=pe[F.ixfe>>8&63]),cs(F,r,a.opts.Date1904),K({c:S.c,r:S.r},F,r);break;case 5:case 517:F={ixfe:S.ixfe,XF:me[S.ixfe],v:S.val,t:S.t},P>0&&(F.z=pe[F.ixfe>>8&63]),cs(F,r,a.opts.Date1904),K({c:S.c,r:S.r},F,r);break;case 638:F={ixfe:S.ixfe,XF:me[S.ixfe],v:S.rknum,t:"n"},P>0&&(F.z=pe[F.ixfe>>8&63]),cs(F,r,a.opts.Date1904),K({c:S.c,r:S.r},F,r);break;case 189:for(var ke=S.c;ke<=S.C;++ke){var N=S.rkrec[ke-S.c][0];F={ixfe:N,XF:me[N],v:S.rkrec[ke-S.c][1],t:"n"},P>0&&(F.z=pe[F.ixfe>>8&63]),cs(F,r,a.opts.Date1904),K({c:ke,r:S.r},F,r)}break;case 6:case 518:case 1030:{if(S.val=="String"){v=S;break}if(F=rn(S.val,S.cell.ixfe,S.tt),F.XF=me[F.ixfe],r.cellFormula){var V=S.formula;if(V&&V[0]&&V[0][0]&&V[0][0][0]=="PtgExp"){var G=V[0][0][1][0],de=V[0][0][1][1],ve=Ea({r:G,c:de});C[ve]?F.f=""+Ar(S.formula,d,S.cell,L,q):F.F=((r.dense?(i[G]||[])[de]:i[ve])||{}).F}else F.f=""+Ar(S.formula,d,S.cell,L,q)}P>0&&(F.z=pe[F.ixfe>>8&63]),cs(F,r,a.opts.Date1904),K(S.cell,F,r),v=S}break;case 7:case 519:if(v)v.val=S,F=rn(S,v.cell.ixfe,"s"),F.XF=me[F.ixfe],r.cellFormula&&(F.f=""+Ar(v.formula,d,v.cell,L,q)),P>0&&(F.z=pe[F.ixfe>>8&63]),cs(F,r,a.opts.Date1904),K(v.cell,F,r),v=null;else throw new Error("String record expects Formula");break;case 33:case 545:{z.push(S);var Ie=Ea(S[0].s);if(T=r.dense?(i[S[0].s.r]||[])[S[0].s.c]:i[Ie],r.cellFormula&&T){if(!v||!Ie||!T)break;T.f=""+Ar(S[1],d,S[0],L,q),T.F=za(S[0])}}break;case 1212:{if(!r.cellFormula)break;if(x){if(!v)break;C[Ea(v.cell)]=S[0],T=r.dense?(i[v.cell.r]||[])[v.cell.c]:i[Ea(v.cell)],(T||{}).f=""+Ar(S[0],d,_,L,q)}}break;case 253:F=rn(u[S.isst].t,S.ixfe,"s"),u[S.isst].h&&(F.h=u[S.isst].h),F.XF=me[F.ixfe],P>0&&(F.z=pe[F.ixfe>>8&63]),cs(F,r,a.opts.Date1904),K({c:S.c,r:S.r},F,r);break;case 513:r.sheetStubs&&(F={ixfe:S.ixfe,XF:me[S.ixfe],t:"z"},P>0&&(F.z=pe[F.ixfe>>8&63]),cs(F,r,a.opts.Date1904),K({c:S.c,r:S.r},F,r));break;case 190:if(r.sheetStubs)for(var Ye=S.c;Ye<=S.C;++Ye){var oe=S.ixfe[Ye-S.c];F={ixfe:oe,XF:me[oe],t:"z"},P>0&&(F.z=pe[F.ixfe>>8&63]),cs(F,r,a.opts.Date1904),K({c:Ye,r:S.r},F,r)}break;case 214:case 516:case 4:F=rn(S.val,S.ixfe,"s"),F.XF=me[F.ixfe],P>0&&(F.z=pe[F.ixfe>>8&63]),cs(F,r,a.opts.Date1904),K({c:S.c,r:S.r},F,r);break;case 0:case 512:ye===1&&(d=S);break;case 252:u=S;break;case 1054:if(q.biff==4){pe[P++]=S[1];for(var se=0;se<P+163&&Sa[se]!=S[1];++se);se>=163&&Bs(S[1],P+163)}else Bs(S[1],S[0]);break;case 30:{pe[P++]=S;for(var U=0;U<P+163&&Sa[U]!=S;++U);U>=163&&Bs(S,P+163)}break;case 229:Me=Me.concat(S);break;case 93:ge[S.cmo[0]]=q.lastobj=S;break;case 438:q.lastobj.TxO=S;break;case 127:q.lastobj.ImData=S;break;case 440:for(A=S[0].s.r;A<=S[0].e.r;++A)for(w=S[0].s.c;w<=S[0].e.c;++w)T=r.dense?(i[A]||[])[w]:i[Ea({c:w,r:A})],T&&(T.l=S[1]);break;case 2048:for(A=S[0].s.r;A<=S[0].e.r;++A)for(w=S[0].s.c;w<=S[0].e.c;++w)T=r.dense?(i[A]||[])[w]:i[Ea({c:w,r:A})],T&&T.l&&(T.l.Tooltip=S[1]);break;case 28:{if(q.biff<=5&&q.biff>=2)break;T=r.dense?(i[S[0].r]||[])[S[0].c]:i[Ea(S[0])];var W=ge[S[2]];T||(r.dense?(i[S[0].r]||(i[S[0].r]=[]),T=i[S[0].r][S[0].c]={t:"z"}):T=i[Ea(S[0])]={t:"z"},d.e.r=Math.max(d.e.r,S[0].r),d.s.r=Math.min(d.s.r,S[0].r),d.e.c=Math.max(d.e.c,S[0].c),d.s.c=Math.min(d.s.c,S[0].c)),T.c||(T.c=[]),b={a:S[1],t:W.TxO.t},T.c.push(b)}break;case 2173:ex(me[S.ixfe],S.ext);break;case 125:{if(!q.cellStyles)break;for(;S.e>=S.s;)Ne[S.e--]={width:S.w/256,level:S.level||0,hidden:!!(S.flags&1)},be||(be=!0,_o(S.w/256)),ni(Ne[S.e+1])}break;case 520:{var ee={};S.level!=null&&(Be[S.r]=ee,ee.level=S.level),S.hidden&&(Be[S.r]=ee,ee.hidden=!0),S.hpt&&(Be[S.r]=ee,ee.hpt=S.hpt,ee.hpx=Oi(S.hpt))}break;case 38:case 39:case 40:case 41:i["!margins"]||Ci(i["!margins"]={}),i["!margins"][{38:"left",39:"right",40:"top",41:"bottom"}[fe]]=S;break;case 161:i["!margins"]||Ci(i["!margins"]={}),i["!margins"].header=S.header,i["!margins"].footer=S.footer;break;case 574:S.RTL&&(D.Views[0].RTL=!0);break;case 146:ue=S;break;case 2198:ae=S;break;case 140:re=S;break;case 442:f?E.CodeName=S||E.name:D.WBProps.CodeName=S||"ThisWorkbook";break}}else J||console.error("Missing Info for XLS Record 0x"+fe.toString(16)),t.l+=ce}return a.SheetNames=fs(l).sort(function(we,Ae){return Number(we)-Number(Ae)}).map(function(we){return l[we].name}),r.bookSheets||(a.Sheets=s),!a.SheetNames.length&&h["!ref"]?(a.SheetNames.push("Sheet1"),a.Sheets&&(a.Sheets.Sheet1=h)):a.Preamble=h,a.Sheets&&B.forEach(function(we,Ae){a.Sheets[a.SheetNames[Ae]]["!autofilter"]=we}),a.Strings=u,a.SSF=kr(Sa),q.enc&&(a.Encryption=q.enc),ae&&(a.Themes=ae),a.Metadata={},re!==void 0&&(a.Metadata.Country=re),L.names.length>0&&(D.Names=L.names),a.Workbook=D,a}var Fl={SI:"e0859ff2f94f6810ab9108002b27b3d9",DSI:"02d5cdd59c2e1b10939708002b2cf9ae",UDI:"05d5cdd59c2e1b10939708002b2cf9ae"};function Ry(t,r,a){var s=Oa.find(t,"/!DocumentSummaryInformation");if(s&&s.size>0)try{var i=ul(s,Km,Fl.DSI);for(var l in i)r[l]=i[l]}catch(f){if(a.WTF)throw f}var d=Oa.find(t,"/!SummaryInformation");if(d&&d.size>0)try{var v=ul(d,Qm,Fl.SI);for(var u in v)r[u]==null&&(r[u]=v[u])}catch(f){if(a.WTF)throw f}r.HeadingPairs&&r.TitlesOfParts&&(zc(r.HeadingPairs,r.TitlesOfParts,r,a),delete r.HeadingPairs,delete r.TitlesOfParts)}function wd(t,r){r||(r={}),yo(r),Kl(),r.codepage&&Jn(r.codepage);var a,s;if(t.FullPaths){if(Oa.find(t,"/encryption"))throw new Error("File is password-protected");a=Oa.find(t,"!CompObj"),s=Oa.find(t,"/Workbook")||Oa.find(t,"/Book")}else{switch(r.type){case"base64":t=is(Gr(t));break;case"binary":t=is(t);break;case"buffer":break;case"array":Array.isArray(t)||(t=Array.prototype.slice.call(t));break}wr(t,0),s={content:t}}var i,l;if(a&&Fy(a),r.bookProps&&!r.bookSheets)i={};else{var d=Na?"buffer":"array";if(s&&s.content)i=Iy(s.content,r);else if((l=Oa.find(t,"PerfectOffice_MAIN"))&&l.content)i=Ai.to_workbook(l.content,(r.type=d,r));else if((l=Oa.find(t,"NativeContent_MAIN"))&&l.content)i=Ai.to_workbook(l.content,(r.type=d,r));else throw(l=Oa.find(t,"MN0"))&&l.content?new Error("Unsupported Works 4 for Mac file"):new Error("Cannot find Workbook stream");r.bookVBA&&t.FullPaths&&Oa.find(t,"/_VBA_PROJECT_CUR/VBA/dir")&&(i.vbaraw=gx(t))}var v={};return t.FullPaths&&Ry(t,v,r),i.Props=i.Custprops=v,r.bookFiles&&(i.cfb=t),i}var _n={0:{f:pw},1:{f:gw},2:{f:Sw},3:{f:yw},4:{f:bw},5:{f:Aw},6:{f:Dw},7:{f:Tw},8:{f:Pw},9:{f:Nw},10:{f:Iw},11:{f:Rw},12:{f:xw},13:{f:Cw},14:{f:kw},15:{f:ww},16:{f:md},17:{f:Mw},18:{f:Ew},19:{f:vo},20:{},21:{},22:{},23:{},24:{},25:{},26:{},27:{},28:{},29:{},30:{},31:{},32:{},33:{},34:{},35:{T:1},36:{T:-1},37:{T:1},38:{T:-1},39:{f:ly},40:{},42:{},43:{f:I2},44:{f:M2},45:{f:R2},46:{f:P2},47:{f:N2},48:{},49:{f:Lm},50:{},51:{f:ax},52:{T:1},53:{T:-1},54:{T:1},55:{T:-1},56:{T:1},57:{T:-1},58:{},59:{},60:{f:Kc},62:{f:Fw},63:{f:ox},64:{f:Ww},65:{},66:{},67:{},68:{},69:{},70:{},128:{},129:{T:1},130:{T:-1},131:{T:1,f:Dr,p:0},132:{T:-1},133:{T:1},134:{T:-1},135:{T:1},136:{T:-1},137:{T:1,f:jw},138:{T:-1},139:{T:1},140:{T:-1},141:{T:1},142:{T:-1},143:{T:1},144:{T:-1},145:{T:1},146:{T:-1},147:{f:_w},148:{f:hw,p:16},151:{f:zw},152:{},153:{f:ny},154:{},155:{},156:{f:iy},157:{},158:{},159:{T:1,f:Qg},160:{T:-1},161:{T:1,f:Ys},162:{T:-1},163:{T:1},164:{T:-1},165:{T:1},166:{T:-1},167:{},168:{},169:{},170:{},171:{},172:{T:1},173:{T:-1},174:{},175:{},176:{f:Lw},177:{T:1},178:{T:-1},179:{T:1},180:{T:-1},181:{T:1},182:{T:-1},183:{T:1},184:{T:-1},185:{T:1},186:{T:-1},187:{T:1},188:{T:-1},189:{T:1},190:{T:-1},191:{T:1},192:{T:-1},193:{T:1},194:{T:-1},195:{T:1},196:{T:-1},197:{T:1},198:{T:-1},199:{T:1},200:{T:-1},201:{T:1},202:{T:-1},203:{T:1},204:{T:-1},205:{T:1},206:{T:-1},207:{T:1},208:{T:-1},209:{T:1},210:{T:-1},211:{T:1},212:{T:-1},213:{T:1},214:{T:-1},215:{T:1},216:{T:-1},217:{T:1},218:{T:-1},219:{T:1},220:{T:-1},221:{T:1},222:{T:-1},223:{T:1},224:{T:-1},225:{T:1},226:{T:-1},227:{T:1},228:{T:-1},229:{T:1},230:{T:-1},231:{T:1},232:{T:-1},233:{T:1},234:{T:-1},235:{T:1},236:{T:-1},237:{T:1},238:{T:-1},239:{T:1},240:{T:-1},241:{T:1},242:{T:-1},243:{T:1},244:{T:-1},245:{T:1},246:{T:-1},247:{T:1},248:{T:-1},249:{T:1},250:{T:-1},251:{T:1},252:{T:-1},253:{T:1},254:{T:-1},255:{T:1},256:{T:-1},257:{T:1},258:{T:-1},259:{T:1},260:{T:-1},261:{T:1},262:{T:-1},263:{T:1},264:{T:-1},265:{T:1},266:{T:-1},267:{T:1},268:{T:-1},269:{T:1},270:{T:-1},271:{T:1},272:{T:-1},273:{T:1},274:{T:-1},275:{T:1},276:{T:-1},277:{},278:{T:1},279:{T:-1},280:{T:1},281:{T:-1},282:{T:1},283:{T:1},284:{T:-1},285:{T:1},286:{T:-1},287:{T:1},288:{T:-1},289:{T:1},290:{T:-1},291:{T:1},292:{T:-1},293:{T:1},294:{T:-1},295:{T:1},296:{T:-1},297:{T:1},298:{T:-1},299:{T:1},300:{T:-1},301:{T:1},302:{T:-1},303:{T:1},304:{T:-1},305:{T:1},306:{T:-1},307:{T:1},308:{T:-1},309:{T:1},310:{T:-1},311:{T:1},312:{T:-1},313:{T:-1},314:{T:1},315:{T:-1},316:{T:1},317:{T:-1},318:{T:1},319:{T:-1},320:{T:1},321:{T:-1},322:{T:1},323:{T:-1},324:{T:1},325:{T:-1},326:{T:1},327:{T:-1},328:{T:1},329:{T:-1},330:{T:1},331:{T:-1},332:{T:1},333:{T:-1},334:{T:1},335:{f:tx},336:{T:-1},337:{f:rx,T:1},338:{T:-1},339:{T:1},340:{T:-1},341:{T:1},342:{T:-1},343:{T:1},344:{T:-1},345:{T:1},346:{T:-1},347:{T:1},348:{T:-1},349:{T:1},350:{T:-1},351:{},352:{},353:{T:1},354:{T:-1},355:{f:$n},357:{},358:{},359:{},360:{T:1},361:{},362:{f:Yc},363:{},364:{},366:{},367:{},368:{},369:{},370:{},371:{},372:{T:1},373:{T:-1},374:{T:1},375:{T:-1},376:{T:1},377:{T:-1},378:{T:1},379:{T:-1},380:{T:1},381:{T:-1},382:{T:1},383:{T:-1},384:{T:1},385:{T:-1},386:{T:1},387:{T:-1},388:{T:1},389:{T:-1},390:{T:1},391:{T:-1},392:{T:1},393:{T:-1},394:{T:1},395:{T:-1},396:{},397:{},398:{},399:{},400:{},401:{T:1},403:{},404:{},405:{},406:{},407:{},408:{},409:{},410:{},411:{},412:{},413:{},414:{},415:{},416:{},417:{},418:{},419:{},420:{},421:{},422:{T:1},423:{T:1},424:{T:-1},425:{T:-1},426:{f:Bw},427:{f:$w},428:{},429:{T:1},430:{T:-1},431:{T:1},432:{T:-1},433:{T:1},434:{T:-1},435:{T:1},436:{T:-1},437:{T:1},438:{T:-1},439:{T:1},440:{T:-1},441:{T:1},442:{T:-1},443:{T:1},444:{T:-1},445:{T:1},446:{T:-1},447:{T:1},448:{T:-1},449:{T:1},450:{T:-1},451:{T:1},452:{T:-1},453:{T:1},454:{T:-1},455:{T:1},456:{T:-1},457:{T:1},458:{T:-1},459:{T:1},460:{T:-1},461:{T:1},462:{T:-1},463:{T:1},464:{T:-1},465:{T:1},466:{T:-1},467:{T:1},468:{T:-1},469:{T:1},470:{T:-1},471:{},472:{},473:{T:1},474:{T:-1},475:{},476:{f:qw},477:{},478:{},479:{T:1},480:{T:-1},481:{T:1},482:{T:-1},483:{T:1},484:{T:-1},485:{f:mw},486:{T:1},487:{T:-1},488:{T:1},489:{T:-1},490:{T:1},491:{T:-1},492:{T:1},493:{T:-1},494:{f:Ow},495:{T:1},496:{T:-1},497:{T:1},498:{T:-1},499:{},500:{T:1},501:{T:-1},502:{T:1},503:{T:-1},504:{},505:{T:1},506:{T:-1},507:{},508:{T:1},509:{T:-1},510:{T:1},511:{T:-1},512:{},513:{},514:{T:1},515:{T:-1},516:{T:1},517:{T:-1},518:{T:1},519:{T:-1},520:{T:1},521:{T:-1},522:{},523:{},524:{},525:{},526:{},527:{},528:{T:1},529:{T:-1},530:{T:1},531:{T:-1},532:{T:1},533:{T:-1},534:{},535:{},536:{},537:{},538:{T:1},539:{T:-1},540:{T:1},541:{T:-1},542:{T:1},548:{},549:{},550:{f:$n},551:{},552:{},553:{},554:{T:1},555:{T:-1},556:{T:1},557:{T:-1},558:{T:1},559:{T:-1},560:{T:1},561:{T:-1},562:{},564:{},565:{T:1},566:{T:-1},569:{T:1},570:{T:-1},572:{},573:{T:1},574:{T:-1},577:{},578:{},579:{},580:{},581:{},582:{},583:{},584:{},585:{},586:{},587:{},588:{T:-1},589:{},590:{T:1},591:{T:-1},592:{T:1},593:{T:-1},594:{T:1},595:{T:-1},596:{},597:{T:1},598:{T:-1},599:{T:1},600:{T:-1},601:{T:1},602:{T:-1},603:{T:1},604:{T:-1},605:{T:1},606:{T:-1},607:{},608:{T:1},609:{T:-1},610:{},611:{T:1},612:{T:-1},613:{T:1},614:{T:-1},615:{T:1},616:{T:-1},617:{T:1},618:{T:-1},619:{T:1},620:{T:-1},625:{},626:{T:1},627:{T:-1},628:{T:1},629:{T:-1},630:{T:1},631:{T:-1},632:{f:hx},633:{T:1},634:{T:-1},635:{T:1,f:px},636:{T:-1},637:{f:zm},638:{T:1},639:{},640:{T:-1},641:{T:1},642:{T:-1},643:{T:1},644:{},645:{T:-1},646:{T:1},648:{T:1},649:{},650:{T:-1},651:{f:Kw},652:{},653:{T:1},654:{T:-1},655:{T:1},656:{T:-1},657:{T:1},658:{T:-1},659:{},660:{T:1},661:{},662:{T:-1},663:{},664:{T:1},665:{},666:{T:-1},667:{},668:{},669:{},671:{T:1},672:{T:-1},673:{T:1},674:{T:-1},675:{},676:{},677:{},678:{},679:{},680:{},681:{},1024:{},1025:{},1026:{T:1},1027:{T:-1},1028:{T:1},1029:{T:-1},1030:{},1031:{T:1},1032:{T:-1},1033:{T:1},1034:{T:-1},1035:{},1036:{},1037:{},1038:{T:1},1039:{T:-1},1040:{},1041:{T:1},1042:{T:-1},1043:{},1044:{},1045:{},1046:{T:1},1047:{T:-1},1048:{T:1},1049:{T:-1},1050:{},1051:{T:1},1052:{T:1},1053:{f:Hw},1054:{T:1},1055:{},1056:{T:1},1057:{T:-1},1058:{T:1},1059:{T:-1},1061:{},1062:{T:1},1063:{T:-1},1064:{T:1},1065:{T:-1},1066:{T:1},1067:{T:-1},1068:{T:1},1069:{T:-1},1070:{T:1},1071:{T:-1},1072:{T:1},1073:{T:-1},1075:{T:1},1076:{T:-1},1077:{T:1},1078:{T:-1},1079:{T:1},1080:{T:-1},1081:{T:1},1082:{T:-1},1083:{T:1},1084:{T:-1},1085:{},1086:{T:1},1087:{T:-1},1088:{T:1},1089:{T:-1},1090:{T:1},1091:{T:-1},1092:{T:1},1093:{T:-1},1094:{T:1},1095:{T:-1},1096:{},1097:{T:1},1098:{},1099:{T:-1},1100:{T:1},1101:{T:-1},1102:{},1103:{},1104:{},1105:{},1111:{},1112:{},1113:{T:1},1114:{T:-1},1115:{T:1},1116:{T:-1},1117:{},1118:{T:1},1119:{T:-1},1120:{T:1},1121:{T:-1},1122:{T:1},1123:{T:-1},1124:{T:1},1125:{T:-1},1126:{},1128:{T:1},1129:{T:-1},1130:{},1131:{T:1},1132:{T:-1},1133:{T:1},1134:{T:-1},1135:{T:1},1136:{T:-1},1137:{T:1},1138:{T:-1},1139:{T:1},1140:{T:-1},1141:{},1142:{T:1},1143:{T:-1},1144:{T:1},1145:{T:-1},1146:{},1147:{T:1},1148:{T:-1},1149:{T:1},1150:{T:-1},1152:{T:1},1153:{T:-1},1154:{T:-1},1155:{T:-1},1156:{T:-1},1157:{T:1},1158:{T:-1},1159:{T:1},1160:{T:-1},1161:{T:1},1162:{T:-1},1163:{T:1},1164:{T:-1},1165:{T:1},1166:{T:-1},1167:{T:1},1168:{T:-1},1169:{T:1},1170:{T:-1},1171:{},1172:{T:1},1173:{T:-1},1177:{},1178:{T:1},1180:{},1181:{},1182:{},2048:{T:1},2049:{T:-1},2050:{},2051:{T:1},2052:{T:-1},2053:{},2054:{},2055:{T:1},2056:{T:-1},2057:{T:1},2058:{T:-1},2060:{},2067:{},2068:{T:1},2069:{T:-1},2070:{},2071:{},2072:{T:1},2073:{T:-1},2075:{},2076:{},2077:{T:1},2078:{T:-1},2079:{},2080:{T:1},2081:{T:-1},2082:{},2083:{T:1},2084:{T:-1},2085:{T:1},2086:{T:-1},2087:{T:1},2088:{T:-1},2089:{T:1},2090:{T:-1},2091:{},2092:{},2093:{T:1},2094:{T:-1},2095:{},2096:{T:1},2097:{T:-1},2098:{T:1},2099:{T:-1},2100:{T:1},2101:{T:-1},2102:{},2103:{T:1},2104:{T:-1},2105:{},2106:{T:1},2107:{T:-1},2108:{},2109:{T:1},2110:{T:-1},2111:{T:1},2112:{T:-1},2113:{T:1},2114:{T:-1},2115:{},2116:{},2117:{},2118:{T:1},2119:{T:-1},2120:{},2121:{T:1},2122:{T:-1},2123:{T:1},2124:{T:-1},2125:{},2126:{T:1},2127:{T:-1},2128:{},2129:{T:1},2130:{T:-1},2131:{T:1},2132:{T:-1},2133:{T:1},2134:{},2135:{},2136:{},2137:{T:1},2138:{T:-1},2139:{T:1},2140:{T:-1},2141:{},3072:{},3073:{},4096:{T:1},4097:{T:-1},5002:{T:1},5003:{T:-1},5081:{T:1},5082:{T:-1},5083:{},5084:{T:1},5085:{T:-1},5086:{T:1},5087:{T:-1},5088:{},5089:{},5090:{},5092:{T:1},5093:{T:-1},5094:{},5095:{T:1},5096:{T:-1},5097:{},5099:{},65535:{n:""}},Hn={6:{f:Nn},10:{f:As},12:{f:pr},13:{f:pr},14:{f:vr},15:{f:vr},16:{f:Sr},17:{f:vr},18:{f:vr},19:{f:pr},20:{f:ml},21:{f:ml},23:{f:Yc},24:{f:gl},25:{f:vr},26:{},27:{},28:{f:ug},29:{},34:{f:vr},35:{f:_l},38:{f:Sr},39:{f:Sr},40:{f:Sr},41:{f:Sr},42:{f:vr},43:{f:vr},47:{f:m2},49:{f:G_},51:{f:pr},60:{},61:{f:W_},64:{f:vr},65:{f:V_},66:{f:pr},77:{},80:{},81:{},82:{},85:{f:pr},89:{},90:{},91:{},92:{f:L_},93:{f:pg},94:{},95:{f:vr},96:{},97:{},99:{f:vr},125:{f:Kc},128:{f:rg},129:{f:O_},130:{f:pr},131:{f:vr},132:{f:vr},133:{f:z_},134:{},140:{f:bg},141:{f:pr},144:{},146:{f:yg},151:{},152:{},153:{},154:{},155:{},156:{f:pr},157:{},158:{},160:{f:Sg},161:{f:Tg},174:{},175:{},176:{},177:{},178:{},180:{},181:{},182:{},184:{},185:{},189:{f:J_},190:{f:eg},193:{f:As},197:{},198:{},199:{},200:{},201:{},202:{f:vr},203:{},204:{},205:{},206:{},207:{},208:{},209:{},210:{},211:{},213:{},215:{},216:{},217:{},218:{f:pr},220:{},221:{f:vr},222:{},224:{f:ag},225:{f:P_},226:{f:As},227:{},229:{f:fg},233:{},235:{},236:{},237:{},239:{},240:{},241:{},242:{},244:{},245:{},246:{},247:{},248:{},249:{},251:{},252:{f:B_},253:{f:X_},255:{f:$_},256:{},259:{},290:{},311:{},312:{},315:{},317:{f:jc},318:{},319:{},320:{},330:{},331:{},333:{},334:{},335:{},336:{},337:{},338:{},339:{},340:{},351:{},352:{f:vr},353:{f:As},401:{},402:{},403:{},404:{},405:{},406:{},407:{},408:{},425:{},426:{},427:{},428:{},429:{},430:{f:ig},431:{f:vr},432:{},433:{},434:{},437:{},438:{f:_g},439:{f:vr},440:{f:gg},441:{},442:{f:ji},443:{},444:{f:pr},445:{},446:{},448:{f:As},449:{f:j_,r:2},450:{f:As},512:{f:pl},513:{f:Ag},515:{f:sg},516:{f:Y_},517:{f:hl},519:{f:Cg},520:{f:U_},523:{},545:{f:xl},549:{f:fl},566:{},574:{f:H_},638:{f:Z_},659:{},1048:{},1054:{f:K_},1084:{},1212:{f:cg},2048:{f:xg},2049:{},2050:{},2051:{},2052:{},2053:{},2054:{},2055:{},2056:{},2057:{f:en},2058:{},2059:{},2060:{},2061:{},2062:{},2063:{},2064:{},2066:{},2067:{},2128:{},2129:{},2130:{},2131:{},2132:{},2133:{},2134:{},2135:{},2136:{},2137:{},2138:{},2146:{},2147:{r:12},2148:{},2149:{},2150:{},2151:{f:As},2152:{},2154:{},2155:{},2156:{},2161:{},2162:{},2164:{},2165:{},2166:{},2167:{},2168:{},2169:{},2170:{},2171:{},2172:{f:kg,r:12},2173:{f:J2,r:12},2174:{},2175:{},2180:{},2181:{},2182:{},2183:{},2184:{},2185:{},2186:{},2187:{},2188:{f:vr,r:12},2189:{},2190:{r:12},2191:{},2192:{},2194:{},2195:{},2196:{f:lg,r:12},2197:{},2198:{f:G2,r:12},2199:{},2200:{},2201:{},2202:{f:dg,r:12},2203:{f:As},2204:{},2205:{},2206:{},2207:{},2211:{f:q_},2212:{},2213:{},2214:{},2215:{},4097:{},4098:{},4099:{},4102:{},4103:{},4105:{},4106:{},4107:{},4108:{},4109:{},4116:{},4117:{},4118:{},4119:{},4120:{},4121:{},4122:{},4123:{},4124:{},4125:{},4126:{},4127:{},4128:{},4129:{},4130:{},4132:{},4133:{},4134:{f:pr},4135:{},4146:{},4147:{},4148:{},4149:{},4154:{},4156:{},4157:{},4158:{},4159:{},4160:{},4161:{},4163:{},4164:{f:Eg},4165:{},4166:{},4168:{},4170:{},4171:{},4174:{},4175:{},4176:{},4177:{},4187:{},4188:{f:wg},4189:{},4191:{},4192:{},4193:{},4194:{},4195:{},4196:{},4197:{},4198:{},4199:{},4200:{},0:{f:pl},1:{},2:{f:Ig},3:{f:Mg},4:{f:Dg},5:{f:hl},7:{f:Rg},8:{},9:{f:en},11:{},22:{f:pr},30:{f:Q_},31:{},32:{},33:{f:xl},36:{},37:{f:fl},50:{f:Ng},62:{},52:{},67:{},68:{f:pr},69:{},86:{},126:{},127:{f:Fg},135:{},136:{},137:{},145:{},148:{},149:{},150:{},169:{},171:{},188:{},191:{},192:{},194:{},195:{},214:{f:Pg},223:{},234:{},354:{},421:{},518:{f:Nn},521:{f:en},536:{f:gl},547:{f:_l},561:{},579:{},1030:{f:Nn},1033:{f:en},1091:{},2157:{},2163:{},2177:{},2240:{},2241:{},2242:{},2243:{},2244:{},2245:{},2246:{},2247:{},2248:{},2249:{},2250:{},2251:{},2262:{r:12},29282:{}};function as(t,r,a,s){var i=r;if(!isNaN(i)){var l=(a||[]).length||0,d=t.next(4);d.write_shift(2,i),d.write_shift(2,l),l>0&&Dc(a)&&t.push(a)}}function Dl(t,r){var a=r||{},s=a.dense?[]:{};t=t.replace(/<!--.*?-->/g,"");var i=t.match(/<table/i);if(!i)throw new Error("Invalid HTML: could not find <table>");var l=t.match(/<\/table/i),d=i.index,v=l&&l.index||t.length,u=sm(t.slice(d,v),/(:?<tr[^>]*>)/i,"<tr>"),f=-1,h=0,_=0,x=0,T={s:{r:1e7,c:1e7},e:{r:0,c:0}},b=[];for(d=0;d<u.length;++d){var w=u[d].trim(),A=w.slice(0,3).toLowerCase();if(A=="<tr"){if(++f,a.sheetRows&&a.sheetRows<=f){--f;break}h=0;continue}if(!(A!="<td"&&A!="<th")){var C=w.split(/<\/t[dh]>/i);for(v=0;v<C.length;++v){var z=C[v].trim();if(z.match(/<t[dh]/i)){for(var F=z,re=0;F.charAt(0)=="<"&&(re=F.indexOf(">"))>-1;)F=F.slice(re+1);for(var me=0;me<b.length;++me){var ue=b[me];ue.s.c==h&&ue.s.r<f&&f<=ue.e.r&&(h=ue.e.c+1,me=-1)}var D=ba(z.slice(0,z.indexOf(">")));x=D.colspan?+D.colspan:1,((_=+D.rowspan)>1||x>1)&&b.push({s:{r:f,c:h},e:{r:f+(_||1)-1,c:h+x-1}});var E=D.t||D["data-t"]||"";if(!F.length){h+=x;continue}if(F=_c(F),T.s.r>f&&(T.s.r=f),T.e.r<f&&(T.e.r=f),T.s.c>h&&(T.s.c=h),T.e.c<h&&(T.e.c=h),!F.length){h+=x;continue}var he={t:"s",v:F};a.raw||!F.trim().length||E=="s"||(F==="TRUE"?he={t:"b",v:!0}:F==="FALSE"?he={t:"b",v:!1}:isNaN(ls(F))?isNaN(ii(F).getDate())||(he={t:"d",v:br(F)},a.cellDates||(he={t:"n",v:zr(he.v)}),he.z=a.dateNF||Sa[14]):he={t:"n",v:ls(F)}),a.dense?(s[f]||(s[f]=[]),s[f][h]=he):s[Ea({r:f,c:h})]=he,h+=x}}}}return s["!ref"]=za(T),b.length&&(s["!merges"]=b),s}function Ny(t,r,a,s){for(var i=t["!merges"]||[],l=[],d=r.s.c;d<=r.e.c;++d){for(var v=0,u=0,f=0;f<i.length;++f)if(!(i[f].s.r>a||i[f].s.c>d)&&!(i[f].e.r<a||i[f].e.c<d)){if(i[f].s.r<a||i[f].s.c<d){v=-1;break}v=i[f].e.r-i[f].s.r+1,u=i[f].e.c-i[f].s.c+1;break}if(!(v<0)){var h=Ea({r:a,c:d}),_=s.dense?(t[a]||[])[d]:t[h],x=_&&_.v!=null&&(_.h||io(_.w||(ys(_),_.w)||""))||"",T={};v>1&&(T.rowspan=v),u>1&&(T.colspan=u),s.editable?x='<span contenteditable="true">'+x+"</span>":_&&(T["data-t"]=_&&_.t||"z",_.v!=null&&(T["data-v"]=_.v),_.z!=null&&(T["data-z"]=_.z),_.l&&(_.l.Target||"#").charAt(0)!="#"&&(x='<a href="'+_.l.Target+'">'+x+"</a>")),T.id=(s.id||"sjs")+"-"+h,l.push(bm("td",x,T))}}var b="<tr>";return b+l.join("")+"</tr>"}var Py='<html><head><meta charset="utf-8"/><title>SheetJS Table Export</title></head><body>',Ly="</body></html>";function Oy(t,r){var a=t.match(/<table[\s\S]*?>[\s\S]*?<\/table>/gi);if(!a||a.length==0)throw new Error("Invalid HTML: could not find <table>");if(a.length==1)return Ns(Dl(a[0],r),r);var s=To();return a.forEach(function(i,l){Eo(s,Dl(i,r),"Sheet"+(l+1))}),s}function zy(t,r,a){var s=[];return s.join("")+"<table"+(a&&a.id?' id="'+a.id+'"':"")+">"}function By(t,r){var a=r||{},s=a.header!=null?a.header:Py,i=a.footer!=null?a.footer:Ly,l=[s],d=li(t["!ref"]);a.dense=Array.isArray(t),l.push(zy(t,d,a));for(var v=d.s.r;v<=d.e.r;++v)l.push(Ny(t,d,v,a));return l.push("</table>"+i),l.join("")}function yd(t,r,a){var s=a||{},i=0,l=0;if(s.origin!=null)if(typeof s.origin=="number")i=s.origin;else{var d=typeof s.origin=="string"?Pr(s.origin):s.origin;i=d.r,l=d.c}var v=r.getElementsByTagName("tr"),u=Math.min(s.sheetRows||1e7,v.length),f={s:{r:0,c:0},e:{r:i,c:l}};if(t["!ref"]){var h=li(t["!ref"]);f.s.r=Math.min(f.s.r,h.s.r),f.s.c=Math.min(f.s.c,h.s.c),f.e.r=Math.max(f.e.r,h.e.r),f.e.c=Math.max(f.e.c,h.e.c),i==-1&&(f.e.r=i=h.e.r+1)}var _=[],x=0,T=t["!rows"]||(t["!rows"]=[]),b=0,w=0,A=0,C=0,z=0,F=0;for(t["!cols"]||(t["!cols"]=[]);b<v.length&&w<u;++b){var re=v[b];if(Ml(re)){if(s.display)continue;T[w]={hidden:!0}}var me=re.children;for(A=C=0;A<me.length;++A){var ue=me[A];if(!(s.display&&Ml(ue))){var D=ue.hasAttribute("data-v")?ue.getAttribute("data-v"):ue.hasAttribute("v")?ue.getAttribute("v"):_c(ue.innerHTML),E=ue.getAttribute("data-z")||ue.getAttribute("z");for(x=0;x<_.length;++x){var he=_[x];he.s.c==C+l&&he.s.r<w+i&&w+i<=he.e.r&&(C=he.e.c+1-l,x=-1)}F=+ue.getAttribute("colspan")||1,((z=+ue.getAttribute("rowspan")||1)>1||F>1)&&_.push({s:{r:w+i,c:C+l},e:{r:w+i+(z||1)-1,c:C+l+(F||1)-1}});var xe={t:"s",v:D},K=ue.getAttribute("data-t")||ue.getAttribute("t")||"";D!=null&&(D.length==0?xe.t=K||"z":s.raw||D.trim().length==0||K=="s"||(D==="TRUE"?xe={t:"b",v:!0}:D==="FALSE"?xe={t:"b",v:!1}:isNaN(ls(D))?isNaN(ii(D).getDate())||(xe={t:"d",v:br(D)},s.cellDates||(xe={t:"n",v:zr(xe.v)}),xe.z=s.dateNF||Sa[14]):xe={t:"n",v:ls(D)})),xe.z===void 0&&E!=null&&(xe.z=E);var q="",ae=ue.getElementsByTagName("A");if(ae&&ae.length)for(var Me=0;Me<ae.length&&!(ae[Me].hasAttribute("href")&&(q=ae[Me].getAttribute("href"),q.charAt(0)!="#"));++Me);q&&q.charAt(0)!="#"&&(xe.l={Target:q}),s.dense?(t[w+i]||(t[w+i]=[]),t[w+i][C+l]=xe):t[Ea({c:C+l,r:w+i})]=xe,f.e.c<C+l&&(f.e.c=C+l),C+=F}}++w}return _.length&&(t["!merges"]=(t["!merges"]||[]).concat(_)),f.e.r=Math.max(f.e.r,w-1+i),t["!ref"]=za(f),w>=u&&(t["!fullref"]=za((f.e.r=v.length-b+w-1+i,f))),t}function kd(t,r){var a=r||{},s=a.dense?[]:{};return yd(s,t,r)}function $y(t,r){return Ns(kd(t,r),r)}function Ml(t){var r="",a=Uy(t);return a&&(r=a(t).getPropertyValue("display")),r||(r=t.style&&t.style.display),r==="none"}function Uy(t){return t.ownerDocument.defaultView&&typeof t.ownerDocument.defaultView.getComputedStyle=="function"?t.ownerDocument.defaultView.getComputedStyle:typeof getComputedStyle=="function"?getComputedStyle:null}function qy(t){var r=t.replace(/[\t\r\n]/g," ").trim().replace(/ +/g," ").replace(/<text:s\/>/g," ").replace(/<text:s text:c="(\d+)"\/>/g,function(s,i){return Array(parseInt(i,10)+1).join(" ")}).replace(/<text:tab[^>]*\/>/g,"	").replace(/<text:line-break\/>/g,`
`),a=Ua(r.replace(/<[^>]*>/g,""));return[a]}var Il={day:["d","dd"],month:["m","mm"],year:["y","yy"],hours:["h","hh"],minutes:["m","mm"],seconds:["s","ss"],"am-pm":["A/P","AM/PM"],"day-of-week":["ddd","dddd"],era:["e","ee"],quarter:["\\Qm",'m\\"th quarter"']};function Td(t,r){var a=r||{},s=no(t),i=[],l,d,v={name:""},u="",f=0,h,_,x={},T=[],b=a.dense?[]:{},w,A,C={value:""},z="",F=0,re=[],me=-1,ue=-1,D={s:{r:1e6,c:1e7},e:{r:0,c:0}},E=0,he={},xe=[],K={},q=0,ae=0,Me=[],ge=1,Ne=1,Be=[],be={Names:[]},L={},Te=["",""],ye=[],P={},pe="",B=0,j=!1,I=!1,Y=0;for(Ni.lastIndex=0,s=s.replace(/<!--([\s\S]*?)-->/mg,"").replace(/<!DOCTYPE[^\[]*\[[^\]]*\]>/gm,"");w=Ni.exec(s);)switch(w[3]=w[3].replace(/_.*$/,"")){case"table":case"工作表":w[1]==="/"?(D.e.c>=D.s.c&&D.e.r>=D.s.r?b["!ref"]=za(D):b["!ref"]="A1:A1",a.sheetRows>0&&a.sheetRows<=D.e.r&&(b["!fullref"]=b["!ref"],D.e.r=a.sheetRows-1,b["!ref"]=za(D)),xe.length&&(b["!merges"]=xe),Me.length&&(b["!rows"]=Me),h.name=h.名称||h.name,typeof JSON<"u"&&JSON.stringify(h),T.push(h.name),x[h.name]=b,I=!1):w[0].charAt(w[0].length-2)!=="/"&&(h=ba(w[0],!1),me=ue=-1,D.s.r=D.s.c=1e7,D.e.r=D.e.c=0,b=a.dense?[]:{},xe=[],Me=[],I=!0);break;case"table-row-group":w[1]==="/"?--E:++E;break;case"table-row":case"行":if(w[1]==="/"){me+=ge,ge=1;break}if(_=ba(w[0],!1),_.行号?me=_.行号-1:me==-1&&(me=0),ge=+_["number-rows-repeated"]||1,ge<10)for(Y=0;Y<ge;++Y)E>0&&(Me[me+Y]={level:E});ue=-1;break;case"covered-table-cell":w[1]!=="/"&&++ue,a.sheetStubs&&(a.dense?(b[me]||(b[me]=[]),b[me][ue]={t:"z"}):b[Ea({r:me,c:ue})]={t:"z"}),z="",re=[];break;case"table-cell":case"数据":if(w[0].charAt(w[0].length-2)==="/")++ue,C=ba(w[0],!1),Ne=parseInt(C["number-columns-repeated"]||"1",10),A={t:"z",v:null},C.formula&&a.cellFormula!=!1&&(A.f=Al(Ua(C.formula))),(C.数据类型||C["value-type"])=="string"&&(A.t="s",A.v=Ua(C["string-value"]||""),a.dense?(b[me]||(b[me]=[]),b[me][ue]=A):b[Ea({r:me,c:ue})]=A),ue+=Ne-1;else if(w[1]!=="/"){++ue,z="",F=0,re=[],Ne=1;var fe=ge?me+ge-1:me;if(ue>D.e.c&&(D.e.c=ue),ue<D.s.c&&(D.s.c=ue),me<D.s.r&&(D.s.r=me),fe>D.e.r&&(D.e.r=fe),C=ba(w[0],!1),ye=[],P={},A={t:C.数据类型||C["value-type"],v:null},a.cellFormula)if(C.formula&&(C.formula=Ua(C.formula)),C["number-matrix-columns-spanned"]&&C["number-matrix-rows-spanned"]&&(q=parseInt(C["number-matrix-rows-spanned"],10)||0,ae=parseInt(C["number-matrix-columns-spanned"],10)||0,K={s:{r:me,c:ue},e:{r:me+q-1,c:ue+ae-1}},A.F=za(K),Be.push([K,A.F])),C.formula)A.f=Al(C.formula);else for(Y=0;Y<Be.length;++Y)me>=Be[Y][0].s.r&&me<=Be[Y][0].e.r&&ue>=Be[Y][0].s.c&&ue<=Be[Y][0].e.c&&(A.F=Be[Y][1]);switch((C["number-columns-spanned"]||C["number-rows-spanned"])&&(q=parseInt(C["number-rows-spanned"],10)||0,ae=parseInt(C["number-columns-spanned"],10)||0,K={s:{r:me,c:ue},e:{r:me+q-1,c:ue+ae-1}},xe.push(K)),C["number-columns-repeated"]&&(Ne=parseInt(C["number-columns-repeated"],10)),A.t){case"boolean":A.t="b",A.v=er(C["boolean-value"]);break;case"float":A.t="n",A.v=parseFloat(C.value);break;case"percentage":A.t="n",A.v=parseFloat(C.value);break;case"currency":A.t="n",A.v=parseFloat(C.value);break;case"date":A.t="d",A.v=br(C["date-value"]),a.cellDates||(A.t="n",A.v=zr(A.v)),A.z="m/d/yy";break;case"time":A.t="n",A.v=tm(C["time-value"])/86400,a.cellDates&&(A.t="d",A.v=xn(A.v)),A.z="HH:MM:SS";break;case"number":A.t="n",A.v=parseFloat(C.数据数值);break;default:if(A.t==="string"||A.t==="text"||!A.t)A.t="s",C["string-value"]!=null&&(z=Ua(C["string-value"]),re=[]);else throw new Error("Unsupported value type "+A.t)}}else{if(j=!1,A.t==="s"&&(A.v=z||"",re.length&&(A.R=re),j=F==0),L.Target&&(A.l=L),ye.length>0&&(A.c=ye,ye=[]),z&&a.cellText!==!1&&(A.w=z),j&&(A.t="z",delete A.v),(!j||a.sheetStubs)&&!(a.sheetRows&&a.sheetRows<=me))for(var ce=0;ce<ge;++ce){if(Ne=parseInt(C["number-columns-repeated"]||"1",10),a.dense)for(b[me+ce]||(b[me+ce]=[]),b[me+ce][ue]=ce==0?A:kr(A);--Ne>0;)b[me+ce][ue+Ne]=kr(A);else for(b[Ea({r:me+ce,c:ue})]=A;--Ne>0;)b[Ea({r:me+ce,c:ue+Ne})]=kr(A);D.e.c<=ue&&(D.e.c=ue)}Ne=parseInt(C["number-columns-repeated"]||"1",10),ue+=Ne-1,Ne=0,A={},z="",re=[]}L={};break;case"document":case"document-content":case"电子表格文档":case"spreadsheet":case"主体":case"scripts":case"styles":case"font-face-decls":case"master-styles":if(w[1]==="/"){if((l=i.pop())[0]!==w[3])throw"Bad state: "+l}else w[0].charAt(w[0].length-2)!=="/"&&i.push([w[3],!0]);break;case"annotation":if(w[1]==="/"){if((l=i.pop())[0]!==w[3])throw"Bad state: "+l;P.t=z,re.length&&(P.R=re),P.a=pe,ye.push(P)}else w[0].charAt(w[0].length-2)!=="/"&&i.push([w[3],!1]);pe="",B=0,z="",F=0,re=[];break;case"creator":w[1]==="/"?pe=s.slice(B,w.index):B=w.index+w[0].length;break;case"meta":case"元数据":case"settings":case"config-item-set":case"config-item-map-indexed":case"config-item-map-entry":case"config-item-map-named":case"shapes":case"frame":case"text-box":case"image":case"data-pilot-tables":case"list-style":case"form":case"dde-links":case"event-listeners":case"chart":if(w[1]==="/"){if((l=i.pop())[0]!==w[3])throw"Bad state: "+l}else w[0].charAt(w[0].length-2)!=="/"&&i.push([w[3],!1]);z="",F=0,re=[];break;case"scientific-number":break;case"currency-symbol":break;case"currency-style":break;case"number-style":case"percentage-style":case"date-style":case"time-style":if(w[1]==="/"){if(he[v.name]=u,(l=i.pop())[0]!==w[3])throw"Bad state: "+l}else w[0].charAt(w[0].length-2)!=="/"&&(u="",v=ba(w[0],!1),i.push([w[3],!0]));break;case"script":break;case"libraries":break;case"automatic-styles":break;case"default-style":case"page-layout":break;case"style":break;case"map":break;case"font-face":break;case"paragraph-properties":break;case"table-properties":break;case"table-column-properties":break;case"table-row-properties":break;case"table-cell-properties":break;case"number":switch(i[i.length-1][0]){case"time-style":case"date-style":d=ba(w[0],!1),u+=Il[w[3]][d.style==="long"?1:0];break}break;case"fraction":break;case"day":case"month":case"year":case"era":case"day-of-week":case"week-of-year":case"quarter":case"hours":case"minutes":case"seconds":case"am-pm":switch(i[i.length-1][0]){case"time-style":case"date-style":d=ba(w[0],!1),u+=Il[w[3]][d.style==="long"?1:0];break}break;case"boolean-style":break;case"boolean":break;case"text-style":break;case"text":if(w[0].slice(-2)==="/>")break;if(w[1]==="/")switch(i[i.length-1][0]){case"number-style":case"date-style":case"time-style":u+=s.slice(f,w.index);break}else f=w.index+w[0].length;break;case"named-range":d=ba(w[0],!1),Te=Pn(d["cell-range-address"]);var J={Name:d.name,Ref:Te[0]+"!"+Te[1]};I&&(J.Sheet=T.length),be.Names.push(J);break;case"text-content":break;case"text-properties":break;case"embedded-text":break;case"body":case"电子表格":break;case"forms":break;case"table-column":break;case"table-header-rows":break;case"table-rows":break;case"table-column-group":break;case"table-header-columns":break;case"table-columns":break;case"null-date":break;case"graphic-properties":break;case"calculation-settings":break;case"named-expressions":break;case"label-range":break;case"label-ranges":break;case"named-expression":break;case"sort":break;case"sort-by":break;case"sort-groups":break;case"tab":break;case"line-break":break;case"span":break;case"p":case"文本串":if(["master-styles"].indexOf(i[i.length-1][0])>-1)break;if(w[1]==="/"&&(!C||!C["string-value"])){var le=qy(s.slice(F,w.index));z=(z.length>0?z+`
`:"")+le[0]}else ba(w[0],!1),F=w.index+w[0].length;break;case"s":break;case"database-range":if(w[1]==="/")break;try{Te=Pn(ba(w[0])["target-range-address"]),x[Te[0]]["!autofilter"]={ref:Te[1]}}catch{}break;case"date":break;case"object":break;case"title":case"标题":break;case"desc":break;case"binary-data":break;case"table-source":break;case"scenario":break;case"iteration":break;case"content-validations":break;case"content-validation":break;case"help-message":break;case"error-message":break;case"database-ranges":break;case"filter":break;case"filter-and":break;case"filter-or":break;case"filter-condition":break;case"list-level-style-bullet":break;case"list-level-style-number":break;case"list-level-properties":break;case"sender-firstname":case"sender-lastname":case"sender-initials":case"sender-title":case"sender-position":case"sender-email":case"sender-phone-private":case"sender-fax":case"sender-company":case"sender-phone-work":case"sender-street":case"sender-city":case"sender-postal-code":case"sender-country":case"sender-state-or-province":case"author-name":case"author-initials":case"chapter":case"file-name":case"template-name":case"sheet-name":break;case"event-listener":break;case"initial-creator":case"creation-date":case"print-date":case"generator":case"document-statistic":case"user-defined":case"editing-duration":case"editing-cycles":break;case"config-item":break;case"page-number":break;case"page-count":break;case"time":break;case"cell-range-source":break;case"detective":break;case"operation":break;case"highlighted-range":break;case"data-pilot-table":case"source-cell-range":case"source-service":case"data-pilot-field":case"data-pilot-level":case"data-pilot-subtotals":case"data-pilot-subtotal":case"data-pilot-members":case"data-pilot-member":case"data-pilot-display-info":case"data-pilot-sort-info":case"data-pilot-layout-info":case"data-pilot-field-reference":case"data-pilot-groups":case"data-pilot-group":case"data-pilot-group-member":break;case"rect":break;case"dde-connection-decls":case"dde-connection-decl":case"dde-link":case"dde-source":break;case"properties":break;case"property":break;case"a":if(w[1]!=="/"){if(L=ba(w[0],!1),!L.href)break;L.Target=Ua(L.href),delete L.href,L.Target.charAt(0)=="#"&&L.Target.indexOf(".")>-1?(Te=Pn(L.Target.slice(1)),L.Target="#"+Te[0]+"!"+Te[1]):L.Target.match(/^\.\.[\\\/]/)&&(L.Target=L.Target.slice(3))}break;case"table-protection":break;case"data-pilot-grand-total":break;case"office-document-common-attrs":break;default:switch(w[2]){case"dc:":case"calcext:":case"loext:":case"ooo:":case"chartooo:":case"draw:":case"style:":case"chart:":case"form:":case"uof:":case"表:":case"字:":break;default:if(a.WTF)throw new Error(w)}}var S={Sheets:x,SheetNames:T,Workbook:be};return a.bookSheets&&delete S.Sheets,S}function Rl(t,r){r=r||{},Kr(t,"META-INF/manifest.xml")&&s_(fr(t,"META-INF/manifest.xml"),r);var a=Vr(t,"content.xml");if(!a)throw new Error("Missing content.xml in ODS / UOF file");var s=Td(Ka(a),r);return Kr(t,"meta.xml")&&(s.Props=Oc(fr(t,"meta.xml"))),s}function Nl(t,r){return Td(t,r)}/*! sheetjs (C) 2013-present SheetJS -- http://sheetjs.com */function bo(t){return new DataView(t.buffer,t.byteOffset,t.byteLength)}function Vn(t){return typeof TextDecoder<"u"?new TextDecoder().decode(t):Ka(Gs(t))}function Gn(t){var r=t.reduce(function(i,l){return i+l.length},0),a=new Uint8Array(r),s=0;return t.forEach(function(i){a.set(i,s),s+=i.length}),a}function Pl(t){return t-=t>>1&1431655765,t=(t&858993459)+(t>>2&858993459),(t+(t>>4)&252645135)*16843009>>>24}function jy(t,r){for(var a=(t[r+15]&127)<<7|t[r+14]>>1,s=t[r+14]&1,i=r+13;i>=r;--i)s=s*256+t[i];return(t[r+15]&128?-s:s)*Math.pow(10,a-6176)}function zi(t,r){var a=r?r[0]:0,s=t[a]&127;e:if(t[a++]>=128&&(s|=(t[a]&127)<<7,t[a++]<128||(s|=(t[a]&127)<<14,t[a++]<128)||(s|=(t[a]&127)<<21,t[a++]<128)||(s+=(t[a]&127)*Math.pow(2,28),++a,t[a++]<128)||(s+=(t[a]&127)*Math.pow(2,35),++a,t[a++]<128)||(s+=(t[a]&127)*Math.pow(2,42),++a,t[a++]<128)))break e;return r&&(r[0]=a),s}function gr(t){var r=0,a=t[r]&127;e:if(t[r++]>=128){if(a|=(t[r]&127)<<7,t[r++]<128||(a|=(t[r]&127)<<14,t[r++]<128)||(a|=(t[r]&127)<<21,t[r++]<128))break e;a|=(t[r]&127)<<28}return a}function Cr(t){for(var r=[],a=[0];a[0]<t.length;){var s=a[0],i=zi(t,a),l=i&7;i=Math.floor(i/8);var d=0,v;if(i==0)break;switch(l){case 0:{for(var u=a[0];t[a[0]++]>=128;);v=t.slice(u,a[0])}break;case 5:d=4,v=t.slice(a[0],a[0]+d),a[0]+=d;break;case 1:d=8,v=t.slice(a[0],a[0]+d),a[0]+=d;break;case 2:d=zi(t,a),v=t.slice(a[0],a[0]+d),a[0]+=d;break;case 3:case 4:default:throw new Error("PB Type ".concat(l," for Field ").concat(i," at offset ").concat(s))}var f={data:v,type:l};r[i]==null?r[i]=[f]:r[i].push(f)}return r}function wo(t,r){return(t==null?void 0:t.map(function(a){return r(a.data)}))||[]}function Wy(t){for(var r,a=[],s=[0];s[0]<t.length;){var i=zi(t,s),l=Cr(t.slice(s[0],s[0]+i));s[0]+=i;var d={id:gr(l[1][0].data),messages:[]};l[2].forEach(function(v){var u=Cr(v.data),f=gr(u[3][0].data);d.messages.push({meta:u,data:t.slice(s[0],s[0]+f)}),s[0]+=f}),(r=l[3])!=null&&r[0]&&(d.merge=gr(l[3][0].data)>>>0>0),a.push(d)}return a}function Hy(t,r){if(t!=0)throw new Error("Unexpected Snappy chunk type ".concat(t));for(var a=[0],s=zi(r,a),i=[];a[0]<r.length;){var l=r[a[0]]&3;if(l==0){var d=r[a[0]++]>>2;if(d<60)++d;else{var v=d-59;d=r[a[0]],v>1&&(d|=r[a[0]+1]<<8),v>2&&(d|=r[a[0]+2]<<16),v>3&&(d|=r[a[0]+3]<<24),d>>>=0,d++,a[0]+=v}i.push(r.slice(a[0],a[0]+d)),a[0]+=d;continue}else{var u=0,f=0;if(l==1?(f=(r[a[0]]>>2&7)+4,u=(r[a[0]++]&224)<<3,u|=r[a[0]++]):(f=(r[a[0]++]>>2)+1,l==2?(u=r[a[0]]|r[a[0]+1]<<8,a[0]+=2):(u=(r[a[0]]|r[a[0]+1]<<8|r[a[0]+2]<<16|r[a[0]+3]<<24)>>>0,a[0]+=4)),i=[Gn(i)],u==0)throw new Error("Invalid offset 0");if(u>i[0].length)throw new Error("Invalid offset beyond length");if(f>=u)for(i.push(i[0].slice(-u)),f-=u;f>=i[i.length-1].length;)i.push(i[i.length-1]),f-=i[i.length-1].length;i.push(i[0].slice(-u,-u+f))}}var h=Gn(i);if(h.length!=s)throw new Error("Unexpected length: ".concat(h.length," != ").concat(s));return h}function Vy(t){for(var r=[],a=0;a<t.length;){var s=t[a++],i=t[a]|t[a+1]<<8|t[a+2]<<16;a+=3,r.push(Hy(s,t.slice(a,a+i))),a+=i}if(a!==t.length)throw new Error("data is not a valid framed stream!");return Gn(r)}function Gy(t,r,a,s){var i=bo(t),l=i.getUint32(4,!0),d=(s>1?12:8)+Pl(l&(s>1?3470:398))*4,v=-1,u=-1,f=NaN,h=new Date(2001,0,1);l&512&&(v=i.getUint32(d,!0),d+=4),d+=Pl(l&(s>1?12288:4096))*4,l&16&&(u=i.getUint32(d,!0),d+=4),l&32&&(f=i.getFloat64(d,!0),d+=8),l&64&&(h.setTime(h.getTime()+i.getFloat64(d,!0)*1e3),d+=8);var _;switch(t[2]){case 0:break;case 2:_={t:"n",v:f};break;case 3:_={t:"s",v:r[u]};break;case 5:_={t:"d",v:h};break;case 6:_={t:"b",v:f>0};break;case 7:_={t:"n",v:f/86400};break;case 8:_={t:"e",v:0};break;case 9:if(v>-1)_={t:"s",v:a[v]};else if(u>-1)_={t:"s",v:r[u]};else if(!isNaN(f))_={t:"n",v:f};else throw new Error("Unsupported cell type ".concat(t.slice(0,4)));break;default:throw new Error("Unsupported cell type ".concat(t.slice(0,4)))}return _}function Xy(t,r,a){var s=bo(t),i=s.getUint32(8,!0),l=12,d=-1,v=-1,u=NaN,f=NaN,h=new Date(2001,0,1);i&1&&(u=jy(t,l),l+=16),i&2&&(f=s.getFloat64(l,!0),l+=8),i&4&&(h.setTime(h.getTime()+s.getFloat64(l,!0)*1e3),l+=8),i&8&&(v=s.getUint32(l,!0),l+=4),i&16&&(d=s.getUint32(l,!0),l+=4);var _;switch(t[1]){case 0:break;case 2:_={t:"n",v:u};break;case 3:_={t:"s",v:r[v]};break;case 5:_={t:"d",v:h};break;case 6:_={t:"b",v:f>0};break;case 7:_={t:"n",v:f/86400};break;case 8:_={t:"e",v:0};break;case 9:if(d>-1)_={t:"s",v:a[d]};else throw new Error("Unsupported cell type ".concat(t[1]," : ").concat(i&31," : ").concat(t.slice(0,4)));break;case 10:_={t:"n",v:u};break;default:throw new Error("Unsupported cell type ".concat(t[1]," : ").concat(i&31," : ").concat(t.slice(0,4)))}return _}function Yy(t,r,a){switch(t[0]){case 0:case 1:case 2:case 3:return Gy(t,r,a,t[0]);case 5:return Xy(t,r,a);default:throw new Error("Unsupported payload version ".concat(t[0]))}}function Ds(t){var r=Cr(t);return zi(r[1][0].data)}function Ll(t,r){var a=Cr(r.data),s=gr(a[1][0].data),i=a[3],l=[];return(i||[]).forEach(function(d){var v=Cr(d.data),u=gr(v[1][0].data)>>>0;switch(s){case 1:l[u]=Vn(v[3][0].data);break;case 8:{var f=t[Ds(v[9][0].data)][0],h=Cr(f.data),_=t[Ds(h[1][0].data)][0],x=gr(_.meta[1][0].data);if(x!=2001)throw new Error("2000 unexpected reference to ".concat(x));var T=Cr(_.data);l[u]=T[3].map(function(b){return Vn(b.data)}).join("")}break}}),l}function Ky(t,r){var a,s,i,l,d,v,u,f,h,_,x,T,b,w,A=Cr(t),C=gr(A[1][0].data)>>>0,z=gr(A[2][0].data)>>>0,F=((s=(a=A[8])==null?void 0:a[0])==null?void 0:s.data)&&gr(A[8][0].data)>0||!1,re,me;if((l=(i=A[7])==null?void 0:i[0])!=null&&l.data&&r!=0)re=(v=(d=A[7])==null?void 0:d[0])==null?void 0:v.data,me=(f=(u=A[6])==null?void 0:u[0])==null?void 0:f.data;else if((_=(h=A[4])==null?void 0:h[0])!=null&&_.data&&r!=1)re=(T=(x=A[4])==null?void 0:x[0])==null?void 0:T.data,me=(w=(b=A[3])==null?void 0:b[0])==null?void 0:w.data;else throw"NUMBERS Tile missing ".concat(r," cell storage");for(var ue=F?4:1,D=bo(re),E=[],he=0;he<re.length/2;++he){var xe=D.getUint16(he*2,!0);xe<65535&&E.push([he,xe])}if(E.length!=z)throw"Expected ".concat(z," cells, found ").concat(E.length);var K=[];for(he=0;he<E.length-1;++he)K[E[he][0]]=me.subarray(E[he][1]*ue,E[he+1][1]*ue);return E.length>=1&&(K[E[E.length-1][0]]=me.subarray(E[E.length-1][1]*ue)),{R:C,cells:K}}function Qy(t,r){var a,s=Cr(r.data),i=(a=s==null?void 0:s[7])!=null&&a[0]?gr(s[7][0].data)>>>0>0?1:0:-1,l=wo(s[5],function(d){return Ky(d,i)});return{nrows:gr(s[4][0].data)>>>0,data:l.reduce(function(d,v){return d[v.R]||(d[v.R]=[]),v.cells.forEach(function(u,f){if(d[v.R][f])throw new Error("Duplicate cell r=".concat(v.R," c=").concat(f));d[v.R][f]=u}),d},[])}}function Zy(t,r,a){var s,i=Cr(r.data),l={s:{r:0,c:0},e:{r:0,c:0}};if(l.e.r=(gr(i[6][0].data)>>>0)-1,l.e.r<0)throw new Error("Invalid row varint ".concat(i[6][0].data));if(l.e.c=(gr(i[7][0].data)>>>0)-1,l.e.c<0)throw new Error("Invalid col varint ".concat(i[7][0].data));a["!ref"]=za(l);var d=Cr(i[4][0].data),v=Ll(t,t[Ds(d[4][0].data)][0]),u=(s=d[17])!=null&&s[0]?Ll(t,t[Ds(d[17][0].data)][0]):[],f=Cr(d[3][0].data),h=0;f[1].forEach(function(_){var x=Cr(_.data),T=t[Ds(x[2][0].data)][0],b=gr(T.meta[1][0].data);if(b!=6002)throw new Error("6001 unexpected reference to ".concat(b));var w=Qy(t,T);w.data.forEach(function(A,C){A.forEach(function(z,F){var re=Ea({r:h+C,c:F}),me=Yy(z,v,u);me&&(a[re]=me)})}),h+=w.nrows})}function Jy(t,r){var a=Cr(r.data),s={"!ref":"A1"},i=t[Ds(a[2][0].data)],l=gr(i[0].meta[1][0].data);if(l!=6001)throw new Error("6000 unexpected reference to ".concat(l));return Zy(t,i[0],s),s}function ek(t,r){var a,s=Cr(r.data),i={name:(a=s[1])!=null&&a[0]?Vn(s[1][0].data):"",sheets:[]},l=wo(s[2],Ds);return l.forEach(function(d){t[d].forEach(function(v){var u=gr(v.meta[1][0].data);u==6e3&&i.sheets.push(Jy(t,v))})}),i}function tk(t,r){var a=To(),s=Cr(r.data),i=wo(s[1],Ds);if(i.forEach(function(l){t[l].forEach(function(d){var v=gr(d.meta[1][0].data);if(v==2){var u=ek(t,d);u.sheets.forEach(function(f,h){Eo(a,f,h==0?u.name:u.name+"_"+h,!0)})}})}),a.SheetNames.length==0)throw new Error("Empty NUMBERS file");return a}function On(t){var r,a,s,i,l={},d=[];if(t.FullPaths.forEach(function(u){if(u.match(/\.iwpv2/))throw new Error("Unsupported password protection")}),t.FileIndex.forEach(function(u){if(u.name.match(/\.iwa$/)){var f;try{f=Vy(u.content)}catch(_){return console.log("?? "+u.content.length+" "+(_.message||_))}var h;try{h=Wy(f)}catch(_){return console.log("## "+(_.message||_))}h.forEach(function(_){l[_.id]=_.messages,d.push(_.id)})}}),!d.length)throw new Error("File has no messages");var v=((i=(s=(a=(r=l==null?void 0:l[1])==null?void 0:r[0])==null?void 0:a.meta)==null?void 0:s[1])==null?void 0:i[0].data)&&gr(l[1][0].meta[1][0].data)==1&&l[1][0];if(v||d.forEach(function(u){l[u].forEach(function(f){var h=gr(f.meta[1][0].data)>>>0;if(h==1)if(!v)v=f;else throw new Error("Document has multiple roots")})}),!v)throw new Error("Cannot find Document root");return tk(l,v)}function ak(t){return function(a){for(var s=0;s!=t.length;++s){var i=t[s];a[i[0]]===void 0&&(a[i[0]]=i[1]),i[2]==="n"&&(a[i[0]]=Number(a[i[0]]))}}}function yo(t){ak([["cellNF",!1],["cellHTML",!0],["cellFormula",!0],["cellStyles",!1],["cellText",!0],["cellDates",!1],["sheetStubs",!1],["sheetRows",0,"n"],["bookDeps",!1],["bookSheets",!1],["bookProps",!1],["bookFiles",!1],["bookVBA",!1],["password",""],["WTF",!1]])(t)}function rk(t){return ti.WS.indexOf(t)>-1?"sheet":t==ti.CS?"chart":t==ti.DS?"dialog":t==ti.MS?"macro":t&&t.length?t:"sheet"}function sk(t,r){if(!t)return 0;try{t=r.map(function(s){return s.id||(s.id=s.strRelID),[s.name,t["!id"][s.id].Target,rk(t["!id"][s.id].Type)]})}catch{return null}return!t||t.length===0?null:t}function ik(t,r,a,s,i,l,d,v,u,f,h,_){try{l[s]=Ti(Vr(t,a,!0),r);var x=fr(t,r),T;switch(v){case"sheet":T=vy(x,r,i,u,l[s],f,h,_);break;case"chart":if(T=uy(x,r,i,u,l[s],f,h,_),!T||!T["!drawel"])break;var b=gi(T["!drawel"].Target,r),w=Un(b),A=dx(Vr(t,b,!0),Ti(Vr(t,w,!0),b)),C=gi(A,b),z=Un(C);T=Xw(Vr(t,C,!0),C,u,Ti(Vr(t,z,!0),C),f,T);break;case"macro":T=fy(x,r,i,u,l[s],f,h,_);break;case"dialog":T=py(x,r,i,u,l[s],f,h,_);break;default:throw new Error("Unrecognized sheet type "+v)}d[s]=T;var F=[];l&&l[s]&&fs(l[s]).forEach(function(re){var me="";if(l[s][re].Type==ti.CMNT){me=gi(l[s][re].Target,r);var ue=gy(fr(t,me,!0),me,u);if(!ue||!ue.length)return;wl(T,ue,!1)}l[s][re].Type==ti.TCMNT&&(me=gi(l[s][re].Target,r),F=F.concat(ux(fr(t,me,!0),u)))}),F&&F.length&&wl(T,F,!0,u.people||[])}catch(re){if(u.WTF)throw re}}function Xr(t){return t.charAt(0)=="/"?t.slice(1):t}function nk(t,r){if(lc(),r=r||{},yo(r),Kr(t,"META-INF/manifest.xml")||Kr(t,"objectdata.xml"))return Rl(t,r);if(Kr(t,"Index/Document.iwa")){if(typeof Uint8Array>"u")throw new Error("NUMBERS file parsing requires Uint8Array support");if(typeof On<"u"){if(t.FileIndex)return On(t);var a=Oa.utils.cfb_new();return Xo(t).forEach(function(Me){om(a,Me,nm(t,Me))}),On(a)}throw new Error("Unsupported NUMBERS file")}if(!Kr(t,"[Content_Types].xml"))throw Kr(t,"index.xml.gz")?new Error("Unsupported NUMBERS 08 file"):Kr(t,"index.xml")?new Error("Unsupported NUMBERS 09 file"):new Error("Unsupported ZIP file");var s=Xo(t),i=a_(Vr(t,"[Content_Types].xml")),l=!1,d,v;if(i.workbooks.length===0&&(v="xl/workbook.xml",fr(t,v,!0)&&i.workbooks.push(v)),i.workbooks.length===0){if(v="xl/workbook.bin",!fr(t,v,!0))throw new Error("Could not find workbook");i.workbooks.push(v),l=!0}i.workbooks[0].slice(-3)=="bin"&&(l=!0);var u={},f={};if(!r.bookSheets&&!r.bookProps){if(Si=[],i.sst)try{Si=_y(fr(t,Xr(i.sst)),i.sst,r)}catch(Me){if(r.WTF)throw Me}r.cellStyles&&i.themes.length&&(u=my(Vr(t,i.themes[0].replace(/^\//,""),!0)||"",i.themes[0],r)),i.style&&(f=hy(fr(t,Xr(i.style)),i.style,u,r))}i.links.map(function(Me){try{var ge=Ti(Vr(t,Un(Xr(Me))),Me);return by(fr(t,Xr(Me)),ge,Me,r)}catch{}});var h=dy(fr(t,Xr(i.workbooks[0])),i.workbooks[0],r),_={},x="";i.coreprops.length&&(x=fr(t,Xr(i.coreprops[0]),!0),x&&(_=Oc(x)),i.extprops.length!==0&&(x=fr(t,Xr(i.extprops[0]),!0),x&&o_(x,_,r)));var T={};(!r.bookSheets||r.bookProps)&&i.custprops.length!==0&&(x=Vr(t,Xr(i.custprops[0]),!0),x&&(T=c_(x,r)));var b={};if((r.bookSheets||r.bookProps)&&(h.Sheets?d=h.Sheets.map(function(ge){return ge.name}):_.Worksheets&&_.SheetNames.length>0&&(d=_.SheetNames),r.bookProps&&(b.Props=_,b.Custprops=T),r.bookSheets&&typeof d<"u"&&(b.SheetNames=d),r.bookSheets?b.SheetNames:r.bookProps))return b;d={};var w={};r.bookDeps&&i.calcchain&&(w=xy(fr(t,Xr(i.calcchain)),i.calcchain));var A=0,C={},z,F;{var re=h.Sheets;_.Worksheets=re.length,_.SheetNames=[];for(var me=0;me!=re.length;++me)_.SheetNames[me]=re[me].name}var ue=l?"bin":"xml",D=i.workbooks[0].lastIndexOf("/"),E=(i.workbooks[0].slice(0,D+1)+"_rels/"+i.workbooks[0].slice(D+1)+".rels").replace(/^\//,"");Kr(t,E)||(E="xl/_rels/workbook."+ue+".rels");var he=Ti(Vr(t,E,!0),E.replace(/_rels.*/,"s5s"));(i.metadata||[]).length>=1&&(r.xlmeta=wy(fr(t,Xr(i.metadata[0])),i.metadata[0],r)),(i.people||[]).length>=1&&(r.people=fx(fr(t,Xr(i.people[0])),r)),he&&(he=sk(he,h.Sheets));var xe=fr(t,"xl/worksheets/sheet.xml",!0)?1:0;e:for(A=0;A!=_.Worksheets;++A){var K="sheet";if(he&&he[A]?(z="xl/"+he[A][1].replace(/[\/]?xl\//,""),Kr(t,z)||(z=he[A][1]),Kr(t,z)||(z=E.replace(/_rels\/.*$/,"")+he[A][1]),K=he[A][2]):(z="xl/worksheets/sheet"+(A+1-xe)+"."+ue,z=z.replace(/sheet0\./,"sheet.")),F=z.replace(/^(.*)(\/)([^\/]*)$/,"$1/_rels/$3.rels"),r&&r.sheets!=null)switch(typeof r.sheets){case"number":if(A!=r.sheets)continue e;break;case"string":if(_.SheetNames[A].toLowerCase()!=r.sheets.toLowerCase())continue e;break;default:if(Array.isArray&&Array.isArray(r.sheets)){for(var q=!1,ae=0;ae!=r.sheets.length;++ae)typeof r.sheets[ae]=="number"&&r.sheets[ae]==A&&(q=1),typeof r.sheets[ae]=="string"&&r.sheets[ae].toLowerCase()==_.SheetNames[A].toLowerCase()&&(q=1);if(!q)continue e}}ik(t,z,F,_.SheetNames[A],A,C,d,K,r,h,u,f)}return b={Directory:i,Workbook:h,Props:_,Custprops:T,Deps:w,Sheets:d,SheetNames:_.SheetNames,Strings:Si,Styles:f,Themes:u,SSF:kr(Sa)},r&&r.bookFiles&&(t.files?(b.keys=s,b.files=t.files):(b.keys=[],b.files={},t.FullPaths.forEach(function(Me,ge){Me=Me.replace(/^Root Entry[\/]/,""),b.keys.push(Me),b.files[Me]=t.FileIndex[ge]}))),r&&r.bookVBA&&(i.vba.length>0?b.vbaraw=fr(t,Xr(i.vba[0]),!0):i.defaults&&i.defaults.bin===_x&&(b.vbaraw=fr(t,"xl/vbaProject.bin",!0))),b}function ok(t,r){var a=r||{},s="Workbook",i=Oa.find(t,s);try{if(s="/!DataSpaces/Version",i=Oa.find(t,s),!i||!i.content)throw new Error("ECMA-376 Encrypted file missing "+s);if(Jg(i.content),s="/!DataSpaces/DataSpaceMap",i=Oa.find(t,s),!i||!i.content)throw new Error("ECMA-376 Encrypted file missing "+s);var l=t2(i.content);if(l.length!==1||l[0].comps.length!==1||l[0].comps[0].t!==0||l[0].name!=="StrongEncryptionDataSpace"||l[0].comps[0].v!=="EncryptedPackage")throw new Error("ECMA-376 Encrypted file bad "+s);if(s="/!DataSpaces/DataSpaceInfo/StrongEncryptionDataSpace",i=Oa.find(t,s),!i||!i.content)throw new Error("ECMA-376 Encrypted file missing "+s);var d=a2(i.content);if(d.length!=1||d[0]!="StrongEncryptionTransform")throw new Error("ECMA-376 Encrypted file bad "+s);if(s="/!DataSpaces/TransformInfo/StrongEncryptionTransform/!Primary",i=Oa.find(t,s),!i||!i.content)throw new Error("ECMA-376 Encrypted file missing "+s);s2(i.content)}catch{}if(s="/EncryptionInfo",i=Oa.find(t,s),!i||!i.content)throw new Error("ECMA-376 Encrypted file missing "+s);var v=i2(i.content);if(s="/EncryptedPackage",i=Oa.find(t,s),!i||!i.content)throw new Error("ECMA-376 Encrypted file missing "+s);if(v[0]==4&&typeof decrypt_agile<"u")return decrypt_agile(v[1],i.content,a.password||"",a);if(v[0]==2&&typeof decrypt_std76<"u")return decrypt_std76(v[1],i.content,a.password||"",a);throw new Error("File is password-protected")}function ko(t,r){var a="";switch((r||{}).type||"base64"){case"buffer":return[t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7]];case"base64":a=Gr(t.slice(0,12));break;case"binary":a=t;break;case"array":return[t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7]];default:throw new Error("Unrecognized type "+(r&&r.type||"undefined"))}return[a.charCodeAt(0),a.charCodeAt(1),a.charCodeAt(2),a.charCodeAt(3),a.charCodeAt(4),a.charCodeAt(5),a.charCodeAt(6),a.charCodeAt(7)]}function lk(t,r){return Oa.find(t,"EncryptedPackage")?ok(t,r):wd(t,r)}function ck(t,r){var a,s=t,i=r||{};return i.type||(i.type=Na&&Buffer.isBuffer(t)?"buffer":"base64"),a=pc(s,i),nk(a,i)}function Ed(t,r){var a=0;e:for(;a<t.length;)switch(t.charCodeAt(a)){case 10:case 13:case 32:++a;break;case 60:return Wn(t.slice(a),r);default:break e}return Pi.to_workbook(t,r)}function dk(t,r){var a="",s=ko(t,r);switch(r.type){case"base64":a=Gr(t);break;case"binary":a=t;break;case"buffer":a=t.toString("binary");break;case"array":a=Ws(t);break;default:throw new Error("Unrecognized type "+r.type)}return s[0]==239&&s[1]==187&&s[2]==191&&(a=Ka(a)),r.type="binary",Ed(a,r)}function vk(t,r){var a=t;return r.type=="base64"&&(a=Gr(a)),a=Mi.utils.decode(1200,a.slice(2),"str"),r.type="binary",Ed(a,r)}function uk(t){return t.match(/[^\x00-\x7F]/)?xi(t):t}function zn(t,r,a,s){return s?(a.type="string",Pi.to_workbook(t,a)):Pi.to_workbook(r,a)}function gn(t,r){Kl();var a=r||{};if(typeof ArrayBuffer<"u"&&t instanceof ArrayBuffer)return gn(new Uint8Array(t),(a=kr(a),a.type="array",a));typeof Uint8Array<"u"&&t instanceof Uint8Array&&!a.type&&(a.type=typeof Deno<"u"?"buffer":"array");var s=t,i=[0,0,0,0],l=!1;if(a.cellStyles&&(a.cellNF=!0,a.sheetStubs=!0),si={},a.dateNF&&(si.dateNF=a.dateNF),a.type||(a.type=Na&&Buffer.isBuffer(t)?"buffer":"base64"),a.type=="file"&&(a.type=Na?"buffer":"binary",s=Jh(t),typeof Uint8Array<"u"&&!Na&&(a.type="array")),a.type=="string"&&(l=!0,a.type="binary",a.codepage=65001,s=uk(t)),a.type=="array"&&typeof Uint8Array<"u"&&t instanceof Uint8Array&&typeof ArrayBuffer<"u"){var d=new ArrayBuffer(3),v=new Uint8Array(d);if(v.foo="bar",!v.foo)return a=kr(a),a.type="array",gn(eo(s),a)}switch((i=ko(s,a))[0]){case 208:if(i[1]===207&&i[2]===17&&i[3]===224&&i[4]===161&&i[5]===177&&i[6]===26&&i[7]===225)return lk(Oa.read(s,a),a);break;case 9:if(i[1]<=8)return wd(s,a);break;case 60:return Wn(s,a);case 73:if(i[1]===73&&i[2]===42&&i[3]===0)throw new Error("TIFF Image File is not a spreadsheet");if(i[1]===68)return $g(s,a);break;case 84:if(i[1]===65&&i[2]===66&&i[3]===76)return zg.to_workbook(s,a);break;case 80:return i[1]===75&&i[2]<9&&i[3]<9?ck(s,a):zn(t,s,a,l);case 239:return i[3]===60?Wn(s,a):zn(t,s,a,l);case 255:if(i[1]===254)return vk(s,a);if(i[1]===0&&i[2]===2&&i[3]===0)return Ai.to_workbook(s,a);break;case 0:if(i[1]===0&&(i[2]>=2&&i[3]===0||i[2]===0&&(i[3]===8||i[3]===9)))return Ai.to_workbook(s,a);break;case 3:case 131:case 139:case 140:return bl.to_workbook(s,a);case 123:if(i[1]===92&&i[2]===114&&i[3]===116)return _2.to_workbook(s,a);break;case 10:case 13:case 32:return dk(s,a);case 137:if(i[1]===80&&i[2]===78&&i[3]===71)throw new Error("PNG Image File is not a spreadsheet");break}return Lg.indexOf(i[0])>-1&&i[2]<=12&&i[3]<=31?bl.to_workbook(s,a):zn(t,s,a,l)}function fk(t,r,a,s,i,l,d,v){var u=Tr(a),f=v.defval,h=v.raw||!Object.prototype.hasOwnProperty.call(v,"raw"),_=!0,x=i===1?[]:{};if(i!==1)if(Object.defineProperty)try{Object.defineProperty(x,"__rowNum__",{value:a,enumerable:!1})}catch{x.__rowNum__=a}else x.__rowNum__=a;if(!d||t[a])for(var T=r.s.c;T<=r.e.c;++T){var b=d?t[a][T]:t[s[T]+u];if(b===void 0||b.t===void 0){if(f===void 0)continue;l[T]!=null&&(x[l[T]]=f);continue}var w=b.v;switch(b.t){case"z":if(w==null)break;continue;case"e":w=w==0?null:void 0;break;case"s":case"d":case"b":case"n":break;default:throw new Error("unrecognized type "+b.t)}if(l[T]!=null){if(w==null)if(b.t=="e"&&w===null)x[l[T]]=null;else if(f!==void 0)x[l[T]]=f;else if(h&&w===null)x[l[T]]=null;else continue;else x[l[T]]=h&&(b.t!=="n"||b.t==="n"&&v.rawNumbers!==!1)?w:ys(b,w,v);w!=null&&(_=!1)}}return{row:x,isempty:_}}function Xn(t,r){if(t==null||t["!ref"]==null)return[];var a={t:"n",v:0},s=0,i=1,l=[],d=0,v="",u={s:{r:0,c:0},e:{r:0,c:0}},f=r||{},h=f.range!=null?f.range:t["!ref"];switch(f.header===1?s=1:f.header==="A"?s=2:Array.isArray(f.header)?s=3:f.header==null&&(s=0),typeof h){case"string":u=cr(h);break;case"number":u=cr(t["!ref"]),u.s.r=h;break;default:u=h}s>0&&(i=0);var _=Tr(u.s.r),x=[],T=[],b=0,w=0,A=Array.isArray(t),C=u.s.r,z=0,F={};A&&!t[C]&&(t[C]=[]);var re=f.skipHidden&&t["!cols"]||[],me=f.skipHidden&&t["!rows"]||[];for(z=u.s.c;z<=u.e.c;++z)if(!(re[z]||{}).hidden)switch(x[z]=_r(z),a=A?t[C][z]:t[x[z]+_],s){case 1:l[z]=z-u.s.c;break;case 2:l[z]=x[z];break;case 3:l[z]=f.header[z-u.s.c];break;default:if(a==null&&(a={w:"__EMPTY",t:"s"}),v=d=ys(a,null,f),w=F[d]||0,!w)F[d]=1;else{do v=d+"_"+w++;while(F[v]);F[d]=w,F[v]=1}l[z]=v}for(C=u.s.r+i;C<=u.e.r;++C)if(!(me[C]||{}).hidden){var ue=fk(t,u,C,x,s,l,A,f);(ue.isempty===!1||(s===1?f.blankrows!==!1:f.blankrows))&&(T[b++]=ue.row)}return T.length=b,T}var Ol=/"/g;function pk(t,r,a,s,i,l,d,v){for(var u=!0,f=[],h="",_=Tr(a),x=r.s.c;x<=r.e.c;++x)if(s[x]){var T=v.dense?(t[a]||[])[x]:t[s[x]+_];if(T==null)h="";else if(T.v!=null){u=!1,h=""+(v.rawNumbers&&T.t=="n"?T.v:ys(T,null,v));for(var b=0,w=0;b!==h.length;++b)if((w=h.charCodeAt(b))===i||w===l||w===34||v.forceQuotes){h='"'+h.replace(Ol,'""')+'"';break}h=="ID"&&(h='"ID"')}else T.f!=null&&!T.F?(u=!1,h="="+T.f,h.indexOf(",")>=0&&(h='"'+h.replace(Ol,'""')+'"')):h="";f.push(h)}return v.blankrows===!1&&u?null:f.join(d)}function Ad(t,r){var a=[],s=r??{};if(t==null||t["!ref"]==null)return"";var i=cr(t["!ref"]),l=s.FS!==void 0?s.FS:",",d=l.charCodeAt(0),v=s.RS!==void 0?s.RS:`
`,u=v.charCodeAt(0),f=new RegExp((l=="|"?"\\|":l)+"+$"),h="",_=[];s.dense=Array.isArray(t);for(var x=s.skipHidden&&t["!cols"]||[],T=s.skipHidden&&t["!rows"]||[],b=i.s.c;b<=i.e.c;++b)(x[b]||{}).hidden||(_[b]=_r(b));for(var w=0,A=i.s.r;A<=i.e.r;++A)(T[A]||{}).hidden||(h=pk(t,i,A,_,d,u,l,s),h!=null&&(s.strip&&(h=h.replace(f,"")),(h||s.blankrows!==!1)&&a.push((w++?v:"")+h)));return delete s.dense,a.join("")}function hk(t,r){r||(r={}),r.FS="	",r.RS=`
`;var a=Ad(t,r);return a}function mk(t){var r="",a,s="";if(t==null||t["!ref"]==null)return[];var i=cr(t["!ref"]),l="",d=[],v,u=[],f=Array.isArray(t);for(v=i.s.c;v<=i.e.c;++v)d[v]=_r(v);for(var h=i.s.r;h<=i.e.r;++h)for(l=Tr(h),v=i.s.c;v<=i.e.c;++v)if(r=d[v]+l,a=f?(t[h]||[])[v]:t[r],s="",a!==void 0){if(a.F!=null){if(r=a.F,!a.f)continue;s=a.f,r.indexOf(":")==-1&&(r=r+":"+r)}if(a.f!=null)s=a.f;else{if(a.t=="z")continue;if(a.t=="n"&&a.v!=null)s=""+a.v;else if(a.t=="b")s=a.v?"TRUE":"FALSE";else if(a.w!==void 0)s="'"+a.w;else{if(a.v===void 0)continue;a.t=="s"?s="'"+a.v:s=""+a.v}}u[u.length]=r+"="+s}return u}function Sd(t,r,a){var s=a||{},i=+!s.skipHeader,l=t||{},d=0,v=0;if(l&&s.origin!=null)if(typeof s.origin=="number")d=s.origin;else{var u=typeof s.origin=="string"?Pr(s.origin):s.origin;d=u.r,v=u.c}var f,h={s:{c:0,r:0},e:{c:v,r:d+r.length-1+i}};if(l["!ref"]){var _=cr(l["!ref"]);h.e.c=Math.max(h.e.c,_.e.c),h.e.r=Math.max(h.e.r,_.e.r),d==-1&&(d=_.e.r+1,h.e.r=d+r.length-1+i)}else d==-1&&(d=0,h.e.r=r.length-1+i);var x=s.header||[],T=0;r.forEach(function(w,A){fs(w).forEach(function(C){(T=x.indexOf(C))==-1&&(x[T=x.length]=C);var z=w[C],F="z",re="",me=Ea({c:v+T,r:d+A+i});f=Bi(l,me),z&&typeof z=="object"&&!(z instanceof Date)?l[me]=z:(typeof z=="number"?F="n":typeof z=="boolean"?F="b":typeof z=="string"?F="s":z instanceof Date?(F="d",s.cellDates||(F="n",z=zr(z)),re=s.dateNF||Sa[14]):z===null&&s.nullError&&(F="e",z=0),f?(f.t=F,f.v=z,delete f.w,delete f.R,re&&(f.z=re)):l[me]=f={t:F,v:z},re&&(f.z=re))})}),h.e.c=Math.max(h.e.c,v+x.length-1);var b=Tr(d);if(i)for(T=0;T<x.length;++T)l[_r(T+v)+b]={t:"s",v:x[T]};return l["!ref"]=za(h),l}function _k(t,r){return Sd(null,t,r)}function Bi(t,r,a){if(typeof r=="string"){if(Array.isArray(t)){var s=Pr(r);return t[s.r]||(t[s.r]=[]),t[s.r][s.c]||(t[s.r][s.c]={t:"z"})}return t[r]||(t[r]={t:"z"})}return typeof r!="number"?Bi(t,Ea(r)):Bi(t,Ea({r,c:a||0}))}function gk(t,r){if(typeof r=="number"){if(r>=0&&t.SheetNames.length>r)return r;throw new Error("Cannot find sheet # "+r)}else if(typeof r=="string"){var a=t.SheetNames.indexOf(r);if(a>-1)return a;throw new Error("Cannot find sheet name |"+r+"|")}else throw new Error("Cannot find sheet |"+r+"|")}function To(){return{SheetNames:[],Sheets:{}}}function Eo(t,r,a,s){var i=1;if(!a)for(;i<=65535&&t.SheetNames.indexOf(a="Sheet"+i)!=-1;++i,a=void 0);if(!a||t.SheetNames.length>=65535)throw new Error("Too many worksheets");if(s&&t.SheetNames.indexOf(a)>=0){var l=a.match(/(^.*?)(\d+)$/);i=l&&+l[2]||0;var d=l&&l[1]||a;for(++i;i<=65535&&t.SheetNames.indexOf(a=d+i)!=-1;++i);}if(ay(a),t.SheetNames.indexOf(a)>=0)throw new Error("Worksheet with name |"+a+"| already exists!");return t.SheetNames.push(a),t.Sheets[a]=r,a}function xk(t,r,a){t.Workbook||(t.Workbook={}),t.Workbook.Sheets||(t.Workbook.Sheets=[]);var s=gk(t,r);switch(t.Workbook.Sheets[s]||(t.Workbook.Sheets[s]={}),a){case 0:case 1:case 2:break;default:throw new Error("Bad sheet visibility setting "+a)}t.Workbook.Sheets[s].Hidden=a}function bk(t,r){return t.z=r,t}function Cd(t,r,a){return r?(t.l={Target:r},a&&(t.l.Tooltip=a)):delete t.l,t}function wk(t,r,a){return Cd(t,"#"+r,a)}function yk(t,r,a){t.c||(t.c=[]),t.c.push({t:r,a:a||"SheetJS"})}function kk(t,r,a,s){for(var i=typeof r!="string"?r:cr(r),l=typeof r=="string"?r:za(r),d=i.s.r;d<=i.e.r;++d)for(var v=i.s.c;v<=i.e.c;++v){var u=Bi(t,d,v);u.t="n",u.F=l,delete u.v,d==i.s.r&&v==i.s.c&&(u.f=a,s&&(u.D=!0))}return t}var Fd={encode_col:_r,encode_row:Tr,encode_cell:Ea,encode_range:za,decode_col:co,decode_row:lo,split_cell:Pm,decode_cell:Pr,decode_range:li,format_cell:ys,sheet_add_aoa:Ic,sheet_add_json:Sd,sheet_add_dom:yd,aoa_to_sheet:ci,json_to_sheet:_k,table_to_sheet:kd,table_to_book:$y,sheet_to_csv:Ad,sheet_to_txt:hk,sheet_to_json:Xn,sheet_to_html:By,sheet_to_formulae:mk,sheet_to_row_object_array:Xn,sheet_get_cell:Bi,book_new:To,book_append_sheet:Eo,book_set_sheet_visibility:xk,cell_set_number_format:bk,cell_set_hyperlink:Cd,cell_set_internal_link:wk,cell_add_comment:yk,sheet_set_array_formula:kk,consts:{SHEET_VISIBLE:0,SHEET_HIDDEN:1,SHEET_VERY_HIDDEN:2}},Tk=k('<option class="svelte-126vynh"> </option>'),Ek=k('<div class="file-info svelte-126vynh"><div class="file-icon svelte-126vynh">📄</div> <div class="file-details svelte-126vynh"><div class="file-name svelte-126vynh"> </div> <div class="file-size svelte-126vynh"> </div></div> <button class="remove-file svelte-126vynh">×</button></div>'),Ak=k('<div class="upload-prompt svelte-126vynh"><div class="upload-icon svelte-126vynh">📁</div> <h4 class="svelte-126vynh">Drop your Excel file here</h4> <p class="svelte-126vynh">or click to browse files</p> <div class="file-types svelte-126vynh">Supported: .xlsx, .xls</div></div>'),Sk=k('<div class="error-message svelte-126vynh"><strong class="svelte-126vynh">Error:</strong> </div>'),Ck=k('<span class="spinner svelte-126vynh"></span> Uploading...',1),Fk=k('<span class="icon svelte-126vynh">🚀</span> Upload Employees',1),Dk=k('<div class="upload-employees svelte-126vynh"><div class="header svelte-126vynh"><h2 class="title svelte-126vynh">Upload Employees</h2> <p class="subtitle svelte-126vynh">Import employee data from Excel file</p></div> <div class="content svelte-126vynh"><div class="section svelte-126vynh"><h3 class="svelte-126vynh">1. Select Branch</h3> <div class="form-group svelte-126vynh"><label for="branch-select" class="svelte-126vynh">Choose Branch *</label> <select id="branch-select" required class="svelte-126vynh"><option class="svelte-126vynh">Select a branch...</option><!></select></div></div> <div class="section svelte-126vynh"><h3 class="svelte-126vynh">2. Upload Excel File</h3> <div><!></div> <input type="file" accept=".xlsx,.xls" style="display: none;" class="svelte-126vynh"/></div> <div class="section svelte-126vynh"><h3 class="svelte-126vynh">3. Excel Template</h3> <div class="template-info svelte-126vynh"><div class="template-details svelte-126vynh"><h4 class="svelte-126vynh">Required Format</h4> <p class="svelte-126vynh">Your Excel file should contain exactly 2 columns:</p> <ul class="svelte-126vynh"><li class="svelte-126vynh"><strong class="svelte-126vynh">Employee ID</strong> - Unique identifier</li> <li class="svelte-126vynh"><strong class="svelte-126vynh">Name</strong> - Full employee name</li></ul></div> <button type="button" class="template-btn svelte-126vynh"><span class="icon svelte-126vynh">⬇️</span> Download Template</button></div></div> <!> <div class="actions svelte-126vynh"><button type="button" class="upload-btn svelte-126vynh"><!></button></div></div></div>');function Mk(t,r){pa(r,!1);let a=Q(""),s=Q([]),i=Q(!1),l=Q(""),d=Q(null),v=Q(!1),u=Q();Aa(async()=>{await f()});async function f(){p(i,!0),p(l,"");try{const{data:I,error:Y}=await Fa.branches.getAll();if(Y){console.error("Error loading branches:",Y),p(l,"Failed to load branches: "+(Y.message||Y));return}p(s,I||[])}catch(I){console.error("Error in loadBranches:",I),p(l,I.message||"Failed to load branches")}finally{p(i,!1)}}function h(){e(u).click()}function _(I){const Y=I.target.files[0];Y&&x(Y)}function x(I){if(!I.name.endsWith(".xlsx")&&!I.name.endsWith(".xls")){p(l,"Please select an Excel file (.xlsx or .xls)");return}p(d,I),p(l,"")}function T(I){I.preventDefault(),p(v,!0)}function b(){p(v,!1)}function w(I){I.preventDefault(),p(v,!1);const Y=I.dataTransfer.files;Y.length>0&&x(Y[0])}function A(){const I=`Employee ID,Name
EMP001,John Doe
EMP002,Jane Smith`,Y=new Blob([I],{type:"text/csv;charset=utf-8;"}),fe=document.createElement("a"),ce=URL.createObjectURL(Y);fe.setAttribute("href",ce),fe.setAttribute("download","employee_template.csv"),fe.style.visibility="hidden",document.body.appendChild(fe),fe.click(),document.body.removeChild(fe)}async function C(){var I,Y,fe,ce;if(!e(a)){p(l,"Please select a branch");return}if(!e(d)){p(l,"Please select a file to upload");return}p(i,!0),p(l,"");try{const J=await e(d).arrayBuffer(),le=gn(J,{type:"buffer"}),S=le.SheetNames[0],De=le.Sheets[S],Ue=Fd.sheet_to_json(De);if(!Ue||Ue.length===0){p(l,"Excel file is empty or has no valid data");return}const We=Ue[0],N=["Employee ID","Name"].filter(Ye=>!(Ye in We));if(N.length>0){p(l,`Missing required columns: ${N.join(", ")}`);return}let V=0,G=0;const de=[];for(const[Ye,oe]of Ue.entries())try{const se={employee_id:(I=oe["Employee ID"])==null?void 0:I.toString().trim(),name:(Y=oe.Name)==null?void 0:Y.toString().trim(),branch_id:parseInt(e(a)),hire_date:oe["Hire Date"]?new Date(oe["Hire Date"]).toISOString().split("T")[0]:null,status:((fe=oe.Status)==null?void 0:fe.toString().trim())||"active"};if(!se.employee_id||!se.name){de.push(`Row ${Ye+2}: Missing Employee ID or Name`),G++;continue}const{data:U,error:W}=await Fa.hrEmployees.create?await Fa.hrEmployees.create(se):await Tt.from("hr_employees").insert([se]).select().single();W?(de.push(`Row ${Ye+2}: ${W.message}`),G++):V++}catch(se){de.push(`Row ${Ye+2}: ${se.message}`),G++}let Ie=`Upload completed for ${(ce=e(s).find(Ye=>Ye.id==e(a)))==null?void 0:ce.name_en}:
`;Ie+=`✓ Successfully uploaded: ${V} employees
`,G>0&&(Ie+=`✗ Failed: ${G} employees

`,de.length>0&&(Ie+=`Errors:
`+de.slice(0,5).join(`
`),de.length>5&&(Ie+=`
... and ${de.length-5} more errors`))),alert(Ie),V>0&&(p(a,""),p(d,null),e(u)&&$e(u,e(u).value=""))}catch(J){console.error("Upload error:",J),p(l,"Failed to process Excel file: "+J.message)}finally{p(i,!1)}}function z(){p(d,null),e(u)&&$e(u,e(u).value="")}ha();var F=Dk(),re=c(o(F),2),me=o(re),ue=c(o(me),2),D=c(o(ue),2);R(()=>{e(a),Xt(()=>{e(s)})});var E=o(D);E.value=E.__value="";var he=c(E);Mt(he,1,()=>e(s),Lt,(I,Y)=>{var fe=Tk(),ce=o(fe);n(fe);var J={};R(()=>{y(ce,`${e(Y).name_en??""} - ${e(Y).name_ar??""}`),J!==(J=e(Y).id)&&(fe.value=(fe.__value=e(Y).id)??"")}),g(I,fe)}),n(D),n(ue),n(me);var xe=c(me,2),K=c(o(xe),2),q=o(K);{var ae=I=>{var Y=Ek(),fe=c(o(Y),2),ce=o(fe),J=o(ce,!0);n(ce);var le=c(ce,2),S=o(le);n(le),n(fe);var De=c(fe,2);n(Y),R(Ue=>{y(J,e(d).name),y(S,`${Ue??""} KB`)},[()=>(e(d).size/1024).toFixed(1)]),Z("click",De,ir(z)),g(I,Y)},Me=I=>{var Y=Ak();g(I,Y)};X(q,I=>{e(d)?I(ae):I(Me,!1)})}n(K);var ge=c(K,2);Ms(ge,I=>p(u,I),()=>e(u)),n(xe);var Ne=c(xe,2),Be=c(o(Ne),2),be=c(o(Be),2);n(Be),n(Ne);var L=c(Ne,2);{var Te=I=>{var Y=Sk(),fe=c(o(Y));n(Y),R(()=>y(fe,` ${e(l)??""}`)),g(I,Y)};X(L,I=>{e(l)&&I(Te)})}var ye=c(L,2),P=o(ye),pe=o(P);{var B=I=>{var Y=Ck();Et(),g(I,Y)},j=I=>{var Y=Fk();Et(),g(I,Y)};X(pe,I=>{e(i)?I(B):I(j,!1)})}n(P),n(ye),n(re),n(F),R(()=>{wt(K,1,`upload-zone ${e(v)?"drag-over":""} ${e(d)?"has-file":""}`,"svelte-126vynh"),P.disabled=e(i)||!e(a)||!e(d)}),ra(D,()=>e(a),I=>p(a,I)),Z("dragover",K,T),Z("dragleave",K,b),Z("drop",K,w),Z("click",K,h),Z("change",ge,_),Z("click",be,A),Z("click",P,C),g(t,F),ma()}var Ik=k('<div class="error-message svelte-g7wvwh"><strong class="svelte-g7wvwh">Error:</strong> </div>'),Rk=k('<button type="button" class="cancel-btn svelte-g7wvwh">Cancel</button>'),Nk=k('<span class="spinner svelte-g7wvwh"></span> ',1),Pk=k('<span class="icon svelte-g7wvwh"> </span> ',1),Lk=k('<div class="loading-state svelte-g7wvwh"><div class="spinner large svelte-g7wvwh"></div> <p class="svelte-g7wvwh">Loading departments...</p></div>'),Ok=k('<div class="empty-state svelte-g7wvwh"><div class="empty-icon svelte-g7wvwh">🏢</div> <h4 class="svelte-g7wvwh">No Departments Found</h4> <p class="svelte-g7wvwh">Create your first department to get started</p></div>'),zk=k('<tr class="table-row svelte-g7wvwh"><td class="arabic-text svelte-g7wvwh"> </td><td class="svelte-g7wvwh"> </td><td class="date-cell svelte-g7wvwh"> </td><td class="date-cell svelte-g7wvwh"> </td><td class="svelte-g7wvwh"><div class="actions svelte-g7wvwh"><button class="edit-btn svelte-g7wvwh" title="Edit Department">✏️</button> <button class="delete-btn svelte-g7wvwh" title="Delete Department">🗑️</button></div></td></tr>'),Bk=k('<div class="table-container svelte-g7wvwh"><table class="departments-table svelte-g7wvwh"><thead class="svelte-g7wvwh"><tr class="svelte-g7wvwh"><th class="svelte-g7wvwh">Arabic Name</th><th class="svelte-g7wvwh">English Name</th><th class="svelte-g7wvwh">Created Date</th><th class="svelte-g7wvwh">Updated Date</th><th class="svelte-g7wvwh">Actions</th></tr></thead><tbody class="svelte-g7wvwh"></tbody></table></div>'),$k=k('<div class="create-department svelte-g7wvwh"><div class="header svelte-g7wvwh"><h2 class="title svelte-g7wvwh">Department Management</h2> <p class="subtitle svelte-g7wvwh">Create and manage organizational departments</p></div> <div class="content svelte-g7wvwh"><div class="form-section svelte-g7wvwh"><h3 class="svelte-g7wvwh"> </h3> <form class="svelte-g7wvwh"><div class="form-row svelte-g7wvwh"><div class="form-group svelte-g7wvwh"><label for="name-ar" class="svelte-g7wvwh">Arabic Name *</label> <input id="name-ar" type="text" placeholder="اسم القسم بالعربية" required class="svelte-g7wvwh"/></div> <div class="form-group svelte-g7wvwh"><label for="name-en" class="svelte-g7wvwh">English Name *</label> <input id="name-en" type="text" placeholder="Department Name in English" required class="svelte-g7wvwh"/></div></div> <!> <div class="form-actions svelte-g7wvwh"><!> <button type="submit" class="save-btn svelte-g7wvwh"><!></button></div></form></div> <div class="table-section svelte-g7wvwh"><div class="table-header svelte-g7wvwh"><h3 class="svelte-g7wvwh"> </h3> <button class="refresh-btn svelte-g7wvwh"><span class="icon svelte-g7wvwh">🔄</span> Refresh</button></div> <!></div></div></div>');function Uk(t,r){pa(r,!1);let a=Q([]),s=Q(!1),i=Q(""),l=Q(!1),d=null,v=Q({nameAr:"",nameEn:""});Aa(async()=>{await u()});async function u(){p(s,!0),p(i,"");try{const{data:I,error:Y}=await Fa.hrDepartments.getAll();Y?(console.error("Error loading departments:",Y),p(i,"Failed to load departments: "+(Y.message||Y))):p(a,I||[])}catch(I){console.error("Error loading departments:",I),p(i,"Failed to load departments: "+I.message)}finally{p(s,!1)}}async function f(){if(!e(v).nameAr.trim()||!e(v).nameEn.trim()){p(i,"Both Arabic and English names are required");return}p(s,!0),p(i,"");try{const I={department_name_ar:e(v).nameAr.trim(),department_name_en:e(v).nameEn.trim()};if(e(l)){const{data:Y,error:fe}=await Fa.hrDepartments.update(d,I);fe?(console.error("Error updating department:",fe),p(i,"Failed to update department: "+(fe.message||fe))):(p(a,e(a).map(ce=>ce.id===d?Y:ce)),p(l,!1),d=null,p(v,{nameAr:"",nameEn:""}))}else{const{data:Y,error:fe}=await Fa.hrDepartments.create(I);fe?(console.error("Error creating department:",fe),p(i,"Failed to create department: "+(fe.message||fe))):(p(a,[...e(a),Y]),p(v,{nameAr:"",nameEn:""}))}}catch(I){console.error("Error saving department:",I),p(i,`Failed to ${e(l)?"update":"create"} department: `+I.message)}finally{p(s,!1)}}function h(I){p(l,!0),d=I.id,p(v,{nameAr:I.department_name_ar,nameEn:I.department_name_en})}function _(){p(l,!1),d=null,p(v,{nameAr:"",nameEn:""})}async function x(I){if(confirm("Are you sure you want to delete this department?")){p(s,!0),p(i,"");try{const{error:Y}=await Fa.hrDepartments.delete(I);Y?(console.error("Error deleting department:",Y),p(i,"Failed to delete department: "+(Y.message||Y))):p(a,e(a).filter(fe=>fe.id!==I))}catch(Y){console.error("Error deleting department:",Y),p(i,"Failed to delete department: "+Y.message)}finally{p(s,!1)}}}function T(I){return new Date(I).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})}ha();var b=$k(),w=c(o(b),2),A=o(w),C=o(A),z=o(C,!0);n(C);var F=c(C,2),re=o(F),me=o(re),ue=c(o(me),2);At(ue),n(me);var D=c(me,2),E=c(o(D),2);At(E),n(D),n(re);var he=c(re,2);{var xe=I=>{var Y=Ik(),fe=c(o(Y));n(Y),R(()=>y(fe,` ${e(i)??""}`)),g(I,Y)};X(he,I=>{e(i)&&I(xe)})}var K=c(he,2),q=o(K);{var ae=I=>{var Y=Rk();R(()=>Y.disabled=e(s)),Z("click",Y,_),g(I,Y)};X(q,I=>{e(l)&&I(ae)})}var Me=c(q,2),ge=o(Me);{var Ne=I=>{var Y=Nk(),fe=c(Bt(Y));R(()=>y(fe,` ${e(l)?"Updating...":"Creating..."}`)),g(I,Y)},Be=I=>{var Y=Pk(),fe=Bt(Y),ce=o(fe,!0);n(fe);var J=c(fe);R(()=>{y(ce,e(l)?"✏️":"➕"),y(J,` ${e(l)?"Update Department":"Create Department"}`)}),g(I,Y)};X(ge,I=>{e(s)?I(Ne):I(Be,!1)})}n(Me),n(K),n(F),n(A);var be=c(A,2),L=o(be),Te=o(L),ye=o(Te);n(Te);var P=c(Te,2);n(L);var pe=c(L,2);{var B=I=>{var Y=Lk();g(I,Y)},j=I=>{var Y=Ca(),fe=Bt(Y);{var ce=le=>{var S=Ok();g(le,S)},J=le=>{var S=Bk(),De=o(S),Ue=c(o(De));Mt(Ue,5,()=>e(a),We=>We.id,(We,ke)=>{var N=zk(),V=o(N),G=o(V,!0);n(V);var de=c(V),ve=o(de,!0);n(de);var Ie=c(de),Ye=o(Ie,!0);n(Ie);var oe=c(Ie),se=o(oe,!0);n(oe);var U=c(oe),W=o(U),ee=o(W),we=c(ee,2);n(W),n(U),n(N),R((Ae,He)=>{y(G,e(ke).department_name_ar),y(ve,e(ke).department_name_en),y(Ye,Ae),y(se,He),ee.disabled=e(s),we.disabled=e(s)},[()=>T(e(ke).created_at),()=>T(e(ke).updated_at)]),Z("click",ee,()=>h(e(ke))),Z("click",we,()=>x(e(ke).id)),g(We,N)}),n(Ue),n(De),n(S),g(le,S)};X(fe,le=>{e(a).length===0?le(ce):le(J,!1)},!0)}g(I,Y)};X(pe,I=>{e(s)&&e(a).length===0?I(B):I(j,!1)})}n(be),n(w),n(b),R(()=>{y(z,e(l)?"Edit Department":"Create New Department"),ue.disabled=e(s),E.disabled=e(s),Me.disabled=e(s),y(ye,`Existing Departments (${e(a).length??""})`),P.disabled=e(s)}),zt(ue,()=>e(v).nameAr,I=>$e(v,e(v).nameAr=I)),zt(E,()=>e(v).nameEn,I=>$e(v,e(v).nameEn=I)),Z("submit",F,Ur(f)),Z("click",P,u),g(t,b),ma()}var qk=k('<div class="error-message svelte-spifc5"><strong class="svelte-spifc5">Error:</strong> </div>'),jk=k('<button type="button" class="cancel-btn svelte-spifc5">Cancel</button>'),Wk=k('<span class="spinner svelte-spifc5"></span> ',1),Hk=k('<span class="icon svelte-spifc5"> </span> ',1),Vk=k('<div class="loading-state svelte-spifc5"><div class="spinner large svelte-spifc5"></div> <p class="svelte-spifc5">Loading organizational levels...</p></div>'),Gk=k('<div class="empty-state svelte-spifc5"><div class="empty-icon svelte-spifc5">📊</div> <h4 class="svelte-spifc5">No Levels Defined</h4> <p class="svelte-spifc5">Create your first organizational level to get started</p></div>'),Xk=k('<p class="level-description svelte-spifc5"> </p>'),Yk=k('<span class="meta-item svelte-spifc5"><strong class="svelte-spifc5">Updated:</strong> </span>'),Kk=k('<div class="level-item svelte-spifc5" draggable="true"><div class="level-order svelte-spifc5"><div class="order-number svelte-spifc5"> </div> <div> </div></div> <div class="level-content svelte-spifc5"><div class="level-names svelte-spifc5"><h4 class="level-name-en svelte-spifc5"> </h4> <p class="level-name-ar svelte-spifc5"> </p></div> <!> <div class="level-meta svelte-spifc5"><span class="meta-item svelte-spifc5"><strong class="svelte-spifc5">Created:</strong> </span> <!></div></div> <div class="level-actions svelte-spifc5"><div class="move-buttons svelte-spifc5"><button class="move-btn svelte-spifc5" title="Move Up">↑</button> <button class="move-btn svelte-spifc5" title="Move Down">↓</button></div> <div class="action-buttons svelte-spifc5"><button class="edit-btn svelte-spifc5" title="Edit Level">✏️</button> <button class="delete-btn svelte-spifc5" title="Delete Level">🗑️</button></div></div></div>'),Qk=k('<div class="hierarchy-container svelte-spifc5"><div class="hierarchy-info svelte-spifc5"><p class="svelte-spifc5"><strong class="svelte-spifc5">Tip:</strong> Drag levels to reorder them, or use the arrow buttons. Level 1 is the highest in hierarchy.</p></div> <!></div>'),Zk=k('<div class="create-level svelte-spifc5"><div class="header svelte-spifc5"><h2 class="title svelte-spifc5">Organizational Level Management</h2> <p class="subtitle svelte-spifc5">Define hierarchical levels and reporting structure</p></div> <div class="content svelte-spifc5"><div class="form-section svelte-spifc5"><h3 class="svelte-spifc5"> </h3> <form class="svelte-spifc5"><div class="form-grid svelte-spifc5"><div class="form-group svelte-spifc5"><label for="name-ar" class="svelte-spifc5">Arabic Name *</label> <input id="name-ar" type="text" placeholder="اسم المستوى بالعربية" required class="svelte-spifc5"/></div> <div class="form-group svelte-spifc5"><label for="name-en" class="svelte-spifc5">English Name *</label> <input id="name-en" type="text" placeholder="Level Name in English" required class="svelte-spifc5"/></div> <div class="form-group span-2 svelte-spifc5"><label for="description" class="svelte-spifc5">Description</label> <input id="description" type="text" placeholder="Level description and responsibilities" class="svelte-spifc5"/></div> <div class="form-group svelte-spifc5"><label for="level" class="svelte-spifc5">Hierarchy Level *</label> <input id="level" type="number" min="1" max="10" required class="svelte-spifc5"/> <small class="svelte-spifc5">1 = Highest level, 10 = Lowest level</small></div></div> <!> <div class="form-actions svelte-spifc5"><!> <button type="submit" class="save-btn svelte-spifc5"><!></button></div></form></div> <div class="hierarchy-section svelte-spifc5"><div class="section-header svelte-spifc5"><h3 class="svelte-spifc5"> </h3> <div class="section-actions svelte-spifc5"><button class="refresh-btn svelte-spifc5"><span class="icon svelte-spifc5">🔄</span> Refresh</button></div></div> <!></div></div></div>');function Jk(t,r){pa(r,!1);let a=Q([]),s=Q(!1),i=Q(""),l=Q(!1),d=null,v=null,u=Q({nameAr:"",nameEn:"",description:"",level:1});Aa(async()=>{await f()});async function f(){p(s,!0),p(i,"");try{const{data:N,error:V}=await Fa.hrLevels.getAll();V?(console.error("Error loading levels:",V),p(i,"Failed to load organizational levels: "+(V.message||V))):p(a,(N||[]).sort((G,de)=>G.level_order-de.level_order))}catch(N){console.error("Error loading levels:",N),p(i,"Failed to load organizational levels: "+N.message)}finally{p(s,!1)}}async function h(){if(!e(u).nameAr.trim()||!e(u).nameEn.trim()){p(i,"Both Arabic and English names are required");return}if(e(u).level<1||e(u).level>10){p(i,"Level must be between 1 and 10");return}p(s,!0),p(i,"");try{const N={level_name_ar:e(u).nameAr.trim(),level_name_en:e(u).nameEn.trim(),level_order:e(u).level};if(e(l)){const{data:V,error:G}=await Fa.hrLevels.update(d,N);G?(console.error("Error updating level:",G),p(i,"Failed to update level: "+(G.message||G))):(p(a,e(a).map(de=>de.id===d?V:de).sort((de,ve)=>de.level_order-ve.level_order)),p(l,!1),d=null,p(u,{nameAr:"",nameEn:"",description:"",level:1}))}else{const{data:V,error:G}=await Fa.hrLevels.create(N);G?(console.error("Error creating level:",G),p(i,"Failed to create level: "+(G.message||G))):(p(a,[...e(a),V].sort((de,ve)=>de.level_order-ve.level_order)),p(u,{nameAr:"",nameEn:"",description:"",level:1}))}}catch(N){console.error("Error saving level:",N),p(i,`Failed to ${e(l)?"update":"create"} level: `+N.message)}finally{p(s,!1)}}function _(N){p(l,!0),d=N.id,p(u,{nameAr:N.level_name_ar,nameEn:N.level_name_en,description:N.description||"",level:N.level_order})}function x(){p(l,!1),d=null,p(u,{nameAr:"",nameEn:"",description:"",level:1})}async function T(N){if(confirm("Are you sure you want to delete this level?")){p(s,!0),p(i,"");try{const{error:V}=await Fa.hrLevels.delete(N);V?(console.error("Error deleting level:",V),p(i,"Failed to delete level: "+(V.message||V))):p(a,e(a).filter(G=>G.id!==N))}catch(V){console.error("Error deleting level:",V),p(i,"Failed to delete level: "+V.message)}finally{p(s,!1)}}}function b(N,V){v=V,N.dataTransfer.effectAllowed="move"}function w(N){N.preventDefault(),N.dataTransfer.dropEffect="move"}function A(N,V){if(N.preventDefault(),!v||v.id===V.id)return;const G=e(a).findIndex(Ye=>Ye.id===v.id),de=e(a).findIndex(Ye=>Ye.id===V.id),ve=[...e(a)],[Ie]=ve.splice(G,1);ve.splice(de,0,Ie),p(a,ve.map((Ye,oe)=>({...Ye,order:oe+1}))),v=null}function C(N,V){const G=e(a).findIndex(Ie=>Ie.id===N);if(G===-1)return;let de;if(V==="up"&&G>0)de=G-1;else if(V==="down"&&G<e(a).length-1)de=G+1;else return;const ve=[...e(a)];[ve[G],ve[de]]=[ve[de],ve[G]],p(a,ve.map((Ie,Ye)=>({...Ie,order:Ye+1})))}function z(N){return new Date(N).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})}function F(N){return["bg-red-500","bg-orange-500","bg-yellow-500","bg-green-500","bg-blue-500","bg-indigo-500","bg-purple-500","bg-pink-500","bg-gray-500","bg-black"][N-1]||"bg-gray-500"}ha();var re=Zk(),me=c(o(re),2),ue=o(me),D=o(ue),E=o(D,!0);n(D);var he=c(D,2),xe=o(he),K=o(xe),q=c(o(K),2);At(q),n(K);var ae=c(K,2),Me=c(o(ae),2);At(Me),n(ae);var ge=c(ae,2),Ne=c(o(ge),2);At(Ne),n(ge);var Be=c(ge,2),be=c(o(Be),2);At(be),Et(2),n(Be),n(xe);var L=c(xe,2);{var Te=N=>{var V=qk(),G=c(o(V));n(V),R(()=>y(G,` ${e(i)??""}`)),g(N,V)};X(L,N=>{e(i)&&N(Te)})}var ye=c(L,2),P=o(ye);{var pe=N=>{var V=jk();R(()=>V.disabled=e(s)),Z("click",V,x),g(N,V)};X(P,N=>{e(l)&&N(pe)})}var B=c(P,2),j=o(B);{var I=N=>{var V=Wk(),G=c(Bt(V));R(()=>y(G,` ${e(l)?"Updating...":"Creating..."}`)),g(N,V)},Y=N=>{var V=Hk(),G=Bt(V),de=o(G,!0);n(G);var ve=c(G);R(()=>{y(de,e(l)?"✏️":"➕"),y(ve,` ${e(l)?"Update Level":"Create Level"}`)}),g(N,V)};X(j,N=>{e(s)?N(I):N(Y,!1)})}n(B),n(ye),n(he),n(ue);var fe=c(ue,2),ce=o(fe),J=o(ce),le=o(J);n(J);var S=c(J,2),De=o(S);n(S),n(ce);var Ue=c(ce,2);{var We=N=>{var V=Vk();g(N,V)},ke=N=>{var V=Ca(),G=Bt(V);{var de=Ie=>{var Ye=Gk();g(Ie,Ye)},ve=Ie=>{var Ye=Qk(),oe=c(o(Ye),2);Mt(oe,3,()=>e(a),se=>se.id,(se,U,W)=>{var ee=Kk(),we=o(ee),Ae=o(we),He=o(Ae,!0);n(Ae);var Ke=c(Ae,2),Oe=o(Ke);n(Ke),n(we);var Ee=c(we,2),et=o(Ee),dt=o(et),ut=o(dt,!0);n(dt);var Pe=c(dt,2),qe=o(Pe,!0);n(Pe),n(et);var tt=c(et,2);{var lt=vt=>{var xt=Xk(),M=o(xt,!0);n(xt),R(()=>y(M,e(U).description)),g(vt,xt)};X(tt,vt=>{e(U).description&&vt(lt)})}var Xe=c(tt,2),at=o(Xe),Fe=c(o(at));n(at);var rt=c(at,2);{var Ce=vt=>{var xt=Yk(),M=c(o(xt));n(xt),R(H=>y(M,` ${H??""}`),[()=>z(e(U).updated_at)]),g(vt,xt)};X(rt,vt=>{e(U).updated_at!==e(U).created_at&&vt(Ce)})}n(Xe),n(Ee);var _e=c(Ee,2),Ve=o(_e),Je=o(Ve),st=c(Je,2);n(Ve);var ot=c(Ve,2),Le=o(ot),nt=c(Le,2);n(ot),n(_e),n(ee),R((vt,xt)=>{y(He,e(W)+1),wt(Ke,1,`level-badge ${vt??""}`,"svelte-spifc5"),y(Oe,`L${e(U).level_order??""}`),y(ut,e(U).level_name_en),y(qe,e(U).level_name_ar),y(Fe,` ${xt??""}`),Je.disabled=e(s)||e(W)===0,st.disabled=e(s)||e(W)===e(a).length-1,Le.disabled=e(s),nt.disabled=e(s)},[()=>F(e(U).level_order),()=>z(e(U).created_at)]),Z("click",Je,()=>C(e(U).id,"up")),Z("click",st,()=>C(e(U).id,"down")),Z("click",Le,()=>_(e(U))),Z("click",nt,()=>T(e(U).id)),Z("dragstart",ee,vt=>b(vt,e(U))),Z("dragover",ee,w),Z("drop",ee,vt=>A(vt,e(U))),g(se,ee)}),n(Ye),g(Ie,Ye)};X(G,Ie=>{e(a).length===0?Ie(de):Ie(ve,!1)},!0)}g(N,V)};X(Ue,N=>{e(s)&&e(a).length===0?N(We):N(ke,!1)})}n(fe),n(me),n(re),R(()=>{y(E,e(l)?"Edit Level":"Create New Level"),q.disabled=e(s),Me.disabled=e(s),Ne.disabled=e(s),be.disabled=e(s),B.disabled=e(s),y(le,`Organizational Hierarchy (${e(a).length??""} levels)`),De.disabled=e(s)}),zt(q,()=>e(u).nameAr,N=>$e(u,e(u).nameAr=N)),zt(Me,()=>e(u).nameEn,N=>$e(u,e(u).nameEn=N)),zt(Ne,()=>e(u).description,N=>$e(u,e(u).description=N)),zt(be,()=>e(u).level,N=>$e(u,e(u).level=N)),Z("submit",he,Ur(h)),Z("click",De,f),g(t,re),ma()}var e4=k('<option class="svelte-bx8hq8"> </option>'),t4=k('<option class="svelte-bx8hq8"> </option>'),a4=k('<div class="error-message svelte-bx8hq8"><strong class="svelte-bx8hq8">Error:</strong> </div>'),r4=k('<button type="button" class="cancel-btn svelte-bx8hq8">Cancel</button>'),s4=k('<span class="spinner svelte-bx8hq8"></span> ',1),i4=k('<span class="icon svelte-bx8hq8"> </span> ',1),n4=k('<div class="loading-state svelte-bx8hq8"><div class="spinner large svelte-bx8hq8"></div> <p class="svelte-bx8hq8">Loading positions...</p></div>'),o4=k('<div class="empty-state svelte-bx8hq8"><div class="empty-icon svelte-bx8hq8">💼</div> <h4 class="svelte-bx8hq8">No Positions Found</h4> <p class="svelte-bx8hq8">Create your first position to get started</p></div>'),l4=k('<tr class="table-row svelte-bx8hq8"><td class="position-names svelte-bx8hq8"><div class="name-en svelte-bx8hq8"> </div> <div class="name-ar svelte-bx8hq8"> </div></td><td class="department-cell svelte-bx8hq8"><div class="dept-en svelte-bx8hq8"> </div> <div class="dept-ar svelte-bx8hq8"> </div></td><td class="level-cell svelte-bx8hq8"><div> </div> <div class="level-names svelte-bx8hq8"><div class="level-en svelte-bx8hq8"> </div> <div class="level-ar svelte-bx8hq8"> </div></div></td><td class="description-cell svelte-bx8hq8"> </td><td class="date-cell svelte-bx8hq8"> </td><td class="svelte-bx8hq8"><div class="actions svelte-bx8hq8"><button class="edit-btn svelte-bx8hq8" title="Edit Position">✏️</button> <button class="delete-btn svelte-bx8hq8" title="Delete Position">🗑️</button></div></td></tr>'),c4=k('<div class="table-container svelte-bx8hq8"><table class="positions-table svelte-bx8hq8"><thead class="svelte-bx8hq8"><tr class="svelte-bx8hq8"><th class="svelte-bx8hq8">Position Name</th><th class="svelte-bx8hq8">Department</th><th class="svelte-bx8hq8">Level</th><th class="svelte-bx8hq8">Description</th><th class="svelte-bx8hq8">Created Date</th><th class="svelte-bx8hq8">Actions</th></tr></thead><tbody class="svelte-bx8hq8"></tbody></table></div>'),d4=k('<div class="create-position svelte-bx8hq8"><div class="header svelte-bx8hq8"><h2 class="title svelte-bx8hq8">Position Management</h2> <p class="subtitle svelte-bx8hq8">Create and manage job positions with department and level assignments</p></div> <div class="content svelte-bx8hq8"><div class="form-section svelte-bx8hq8"><h3 class="svelte-bx8hq8"> </h3> <form class="svelte-bx8hq8"><div class="form-grid svelte-bx8hq8"><div class="form-group svelte-bx8hq8"><label for="name-ar" class="svelte-bx8hq8">Arabic Name *</label> <input id="name-ar" type="text" placeholder="اسم المنصب بالعربية" required class="svelte-bx8hq8"/></div> <div class="form-group svelte-bx8hq8"><label for="name-en" class="svelte-bx8hq8">English Name *</label> <input id="name-en" type="text" placeholder="Position Name in English" required class="svelte-bx8hq8"/></div> <div class="form-group svelte-bx8hq8"><label for="department" class="svelte-bx8hq8">Department *</label> <select id="department" required class="svelte-bx8hq8"><option class="svelte-bx8hq8">Select Department</option><!></select></div> <div class="form-group svelte-bx8hq8"><label for="level" class="svelte-bx8hq8">Level Number *</label> <select id="level" required class="svelte-bx8hq8"><option class="svelte-bx8hq8">Select Level</option><!></select></div> <div class="form-group span-2 svelte-bx8hq8"><label for="description" class="svelte-bx8hq8">Description</label> <textarea id="description" placeholder="Position responsibilities and requirements" rows="3" class="svelte-bx8hq8"></textarea></div></div> <!> <div class="form-actions svelte-bx8hq8"><!> <button type="submit" class="save-btn svelte-bx8hq8"><!></button></div></form></div> <div class="table-section svelte-bx8hq8"><div class="table-header svelte-bx8hq8"><h3 class="svelte-bx8hq8"> </h3> <button class="refresh-btn svelte-bx8hq8"><span class="icon svelte-bx8hq8">🔄</span> Refresh</button></div> <!></div></div></div>');function v4(t,r){pa(r,!1);let a=Q([]),s=Q([]),i=Q([]),l=Q(!1),d=Q(""),v=Q(!1),u=null,f=Q({nameAr:"",nameEn:"",departmentId:"",levelId:"",description:""});Aa(async()=>{await h()});async function h(){p(l,!0),p(d,"");try{const{data:oe,error:se}=await Fa.hrDepartments.getAll();if(se){console.error("Error loading departments:",se),p(d,"Failed to load departments: "+(se.message||se));return}p(s,oe||[]);const{data:U,error:W}=await Fa.hrLevels.getAll();if(W){console.error("Error loading levels:",W),p(d,"Failed to load levels: "+(W.message||W));return}p(i,U||[]);const{data:ee,error:we}=await Fa.hrPositions.getAll();if(we){console.error("Error loading positions:",we),p(d,"Failed to load positions: "+(we.message||we));return}p(a,ee||[])}catch(oe){console.error("Error loading data:",oe),p(d,"Failed to load data: "+oe.message)}finally{p(l,!1)}}async function _(){if(!e(f).nameAr.trim()||!e(f).nameEn.trim()){p(d,"Both Arabic and English names are required");return}if(!e(f).departmentId||!e(f).levelId){p(d,"Department and Level selection are required");return}p(l,!0),p(d,"");try{const oe={position_title_ar:e(f).nameAr.trim(),position_title_en:e(f).nameEn.trim(),description:e(f).description.trim(),department_id:e(f).departmentId,level_id:e(f).levelId};if(e(v)){const{data:se,error:U}=await Fa.hrPositions.update(u,oe);U?(console.error("Error updating position:",U),p(d,"Failed to update position: "+(U.message||U))):(p(a,e(a).map(W=>W.id===u?se:W)),p(v,!1),u=null,p(f,{nameAr:"",nameEn:"",departmentId:"",levelId:"",description:""}))}else{const{data:se,error:U}=await Fa.hrPositions.create(oe);U?(console.error("Error creating position:",U),p(d,"Failed to create position: "+(U.message||U))):(p(a,[...e(a),se]),p(f,{nameAr:"",nameEn:"",departmentId:"",levelId:"",description:""}))}}catch(oe){console.error("Error saving position:",oe),p(d,`Failed to ${e(v)?"update":"create"} position: `+oe.message)}finally{p(l,!1)}}function x(oe){p(v,!0),u=oe.id,p(f,{nameAr:oe.position_title_ar,nameEn:oe.position_title_en,description:oe.description||"",departmentId:oe.department_id,levelId:oe.level_id})}function T(){p(v,!1),u=null,p(f,{nameAr:"",nameEn:"",departmentId:"",levelId:"",description:""})}async function b(oe){if(confirm("Are you sure you want to delete this position?")){p(l,!0),p(d,"");try{await Fa.hrPositions.delete(oe),await h()}catch(se){p(d,se.message||"Failed to delete position")}finally{p(l,!1)}}}function w(oe){const se=e(s).find(U=>U.id===oe);return se?se.department_name_en:"Unknown Department"}function A(oe){const se=e(s).find(U=>U.id===oe);return se?se.department_name_ar:"قسم غير معروف"}function C(oe){const se=e(i).find(U=>U.id===oe);return se?se.level_name_en:"Unknown Level"}function z(oe){const se=e(i).find(U=>U.id===oe);return se?se.level_name_ar:"مستوى غير معروف"}function F(oe){const se=e(i).find(U=>U.id===oe);return se?se.level:0}function re(oe){return new Date(oe).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})}function me(oe){return["bg-red-500","bg-orange-500","bg-yellow-500","bg-green-500","bg-blue-500"][oe-1]||"bg-gray-500"}ha();var ue=d4(),D=c(o(ue),2),E=o(D),he=o(E),xe=o(he,!0);n(he);var K=c(he,2),q=o(K),ae=o(q),Me=c(o(ae),2);At(Me),n(ae);var ge=c(ae,2),Ne=c(o(ge),2);At(Ne),n(ge);var Be=c(ge,2),be=c(o(Be),2);R(()=>{e(f),Xt(()=>{e(l),e(s)})});var L=o(be);L.value=L.__value="";var Te=c(L);Mt(Te,1,()=>e(s),Lt,(oe,se)=>{var U=e4(),W=o(U);n(U);var ee={};R(()=>{y(W,`${e(se).department_name_en??""} (${e(se).department_name_ar??""})`),ee!==(ee=e(se).id)&&(U.value=(U.__value=e(se).id)??"")}),g(oe,U)}),n(be),n(Be);var ye=c(Be,2),P=c(o(ye),2);R(()=>{e(f),Xt(()=>{e(l),e(i)})});var pe=o(P);pe.value=pe.__value="";var B=c(pe);Mt(B,1,()=>e(i),Lt,(oe,se)=>{var U=t4(),W=o(U);n(U);var ee={};R(()=>{y(W,`Level ${e(se).level??""} - ${e(se).level_name_en??""}`),ee!==(ee=e(se).id)&&(U.value=(U.__value=e(se).id)??"")}),g(oe,U)}),n(P),n(ye);var j=c(ye,2),I=c(o(j),2);ks(I),n(j),n(q);var Y=c(q,2);{var fe=oe=>{var se=a4(),U=c(o(se));n(se),R(()=>y(U,` ${e(d)??""}`)),g(oe,se)};X(Y,oe=>{e(d)&&oe(fe)})}var ce=c(Y,2),J=o(ce);{var le=oe=>{var se=r4();R(()=>se.disabled=e(l)),Z("click",se,T),g(oe,se)};X(J,oe=>{e(v)&&oe(le)})}var S=c(J,2),De=o(S);{var Ue=oe=>{var se=s4(),U=c(Bt(se));R(()=>y(U,` ${e(v)?"Updating...":"Creating..."}`)),g(oe,se)},We=oe=>{var se=i4(),U=Bt(se),W=o(U,!0);n(U);var ee=c(U);R(()=>{y(W,e(v)?"✏️":"💼"),y(ee,` ${e(v)?"Update Position":"Create Position"}`)}),g(oe,se)};X(De,oe=>{e(l)?oe(Ue):oe(We,!1)})}n(S),n(ce),n(K),n(E);var ke=c(E,2),N=o(ke),V=o(N),G=o(V);n(V);var de=c(V,2);n(N);var ve=c(N,2);{var Ie=oe=>{var se=n4();g(oe,se)},Ye=oe=>{var se=Ca(),U=Bt(se);{var W=we=>{var Ae=o4();g(we,Ae)},ee=we=>{var Ae=c4(),He=o(Ae),Ke=c(o(He));Mt(Ke,5,()=>e(a),Oe=>Oe.id,(Oe,Ee)=>{var et=l4(),dt=o(et),ut=o(dt),Pe=o(ut,!0);n(ut);var qe=c(ut,2),tt=o(qe,!0);n(qe),n(dt);var lt=c(dt),Xe=o(lt),at=o(Xe,!0);n(Xe);var Fe=c(Xe,2),rt=o(Fe,!0);n(Fe),n(lt);var Ce=c(lt),_e=o(Ce),Ve=o(_e);n(_e);var Je=c(_e,2),st=o(Je),ot=o(st,!0);n(st);var Le=c(st,2),nt=o(Le,!0);n(Le),n(Je),n(Ce);var vt=c(Ce),xt=o(vt,!0);n(vt);var M=c(vt),H=o(M,!0);n(M);var O=c(M),te=o(O),ne=o(te),ie=c(ne,2);n(te),n(O),n(et),R((Se,Qe,je,ze,Re,it,ft)=>{y(Pe,e(Ee).position_title_en),y(tt,e(Ee).position_title_ar),y(at,Se),y(rt,Qe),wt(_e,1,`level-badge ${je??""}`,"svelte-bx8hq8"),y(Ve,`L${ze??""}`),y(ot,Re),y(nt,it),y(xt,e(Ee).description||"No description"),y(H,ft),ne.disabled=e(l),ie.disabled=e(l)},[()=>w(e(Ee).department_id),()=>A(e(Ee).department_id),()=>me(F(e(Ee).level_id)),()=>F(e(Ee).level_id),()=>C(e(Ee).level_id),()=>z(e(Ee).level_id),()=>re(e(Ee).created_at)]),Z("click",ne,()=>x(e(Ee))),Z("click",ie,()=>b(e(Ee).id)),g(Oe,et)}),n(Ke),n(He),n(Ae),g(we,Ae)};X(U,we=>{e(a).length===0?we(W):we(ee,!1)},!0)}g(oe,se)};X(ve,oe=>{e(l)&&e(a).length===0?oe(Ie):oe(Ye,!1)})}n(ke),n(D),n(ue),R(()=>{y(xe,e(v)?"Edit Position":"Create New Position"),Me.disabled=e(l),Ne.disabled=e(l),be.disabled=e(l),P.disabled=e(l),I.disabled=e(l),S.disabled=e(l),y(G,`Available Positions (${e(a).length??""})`),de.disabled=e(l)}),zt(Me,()=>e(f).nameAr,oe=>$e(f,e(f).nameAr=oe)),zt(Ne,()=>e(f).nameEn,oe=>$e(f,e(f).nameEn=oe)),ra(be,()=>e(f).departmentId,oe=>$e(f,e(f).departmentId=oe)),ra(P,()=>e(f).levelId,oe=>$e(f,e(f).levelId=oe)),zt(I,()=>e(f).description,oe=>$e(f,e(f).description=oe)),Z("submit",K,Ur(_)),Z("click",de,h),g(t,ue),ma()}var u4=k('<option class="svelte-5l4itz"> </option>'),f4=k('<option class="svelte-5l4itz"> </option>'),p4=k('<div class="slot-group svelte-5l4itz"><label class="svelte-5l4itz"></label> <select class="svelte-5l4itz"><option class="svelte-5l4itz">Select position...</option><!></select></div>'),h4=k('<div class="error-message svelte-5l4itz"><strong class="svelte-5l4itz">Error:</strong> </div>'),m4=k('<button type="button" class="cancel-btn svelte-5l4itz">Cancel</button>'),_4=k('<span class="spinner svelte-5l4itz"></span> ',1),g4=k('<span class="icon svelte-5l4itz"> </span> ',1),x4=k('<div class="loading-state svelte-5l4itz"><div class="spinner large svelte-5l4itz"></div> <p class="svelte-5l4itz">Loading reporting maps...</p></div>'),b4=k('<div class="empty-state svelte-5l4itz"><div class="empty-icon svelte-5l4itz">📈</div> <h4 class="svelte-5l4itz">No Reporting Maps Found</h4> <p class="svelte-5l4itz">Create your first reporting map to define organizational hierarchy</p></div>'),w4=k('<div class="report-item svelte-5l4itz"><span class="report-number svelte-5l4itz"></span> <div class="report-position svelte-5l4itz"><div class="report-name-en svelte-5l4itz"> </div> <div class="report-name-ar svelte-5l4itz"> </div></div></div>'),y4=k('<tr class="table-row svelte-5l4itz"><td class="position-cell svelte-5l4itz"><div class="position-names svelte-5l4itz"><div class="name-en svelte-5l4itz"> </div> <div class="name-ar svelte-5l4itz"> </div></div></td><td class="department-cell svelte-5l4itz"> </td><td class="level-cell svelte-5l4itz"><div> </div></td><td class="reports-to-cell svelte-5l4itz"><div class="reports-to-list svelte-5l4itz"></div></td><td class="date-cell svelte-5l4itz"> </td><td class="svelte-5l4itz"><div class="actions svelte-5l4itz"><button class="edit-btn svelte-5l4itz" title="Edit Reporting Map">✏️</button> <button class="delete-btn svelte-5l4itz" title="Delete Reporting Map">🗑️</button></div></td></tr>'),k4=k('<div class="table-container svelte-5l4itz"><table class="reporting-table svelte-5l4itz"><thead class="svelte-5l4itz"><tr class="svelte-5l4itz"><th class="svelte-5l4itz">Position</th><th class="svelte-5l4itz">Department</th><th class="svelte-5l4itz">Level</th><th class="svelte-5l4itz">Reports To</th><th class="svelte-5l4itz">Created Date</th><th class="svelte-5l4itz">Actions</th></tr></thead><tbody class="svelte-5l4itz"></tbody></table></div>'),T4=k('<div class="reporting-map svelte-5l4itz"><div class="header svelte-5l4itz"><h2 class="title svelte-5l4itz">Reporting Map Management</h2> <p class="subtitle svelte-5l4itz">Define organizational reporting relationships and hierarchy structure</p></div> <div class="content svelte-5l4itz"><div class="form-section svelte-5l4itz"><h3 class="svelte-5l4itz"> </h3> <form class="svelte-5l4itz"><div class="form-grid svelte-5l4itz"><div class="form-group span-full svelte-5l4itz"><label for="position" class="svelte-5l4itz">Select Position *</label> <select id="position" required class="svelte-5l4itz"><option class="svelte-5l4itz">Choose a position...</option><!></select></div> <div class="reporting-slots svelte-5l4itz"><h4 class="svelte-5l4itz">Reports To (Select up to 5 positions)</h4> <div class="slots-grid svelte-5l4itz"></div></div></div> <!> <div class="form-actions svelte-5l4itz"><!> <button type="submit" class="save-btn svelte-5l4itz"><!></button></div></form></div> <div class="table-section svelte-5l4itz"><div class="table-header svelte-5l4itz"><h3 class="svelte-5l4itz"> </h3> <button class="refresh-btn svelte-5l4itz"><span class="icon svelte-5l4itz">🔄</span> Refresh</button></div> <!></div></div></div>');function E4(t,r){pa(r,!1);let a=Q([]),s=Q([]),i=Q(!1),l=Q(""),d=Q(!1),v=null,u=Q({positionId:"",reportsTo:["","","","",""]});Aa(async()=>{await f()});async function f(){p(i,!0),p(l,"");try{const{data:ke,error:N}=await Fa.hrPositions.getAll();if(N){console.error("Error loading positions:",N),p(l,"Failed to load positions: "+(N.message||N));return}p(a,ke||[]);const{data:V,error:G}=await Fa.hrReporting.getAll();if(G){console.error("Error loading reporting maps:",G),p(l,"Failed to load reporting maps: "+(G.message||G));return}p(s,V||[])}catch(ke){console.error("Error in loadData:",ke),p(l,ke.message||"Failed to load data")}finally{p(i,!1)}}async function h(){if(!e(u).positionId){p(l,"Please select a position");return}const ke=e(u).reportsTo.filter(N=>N!=="").map(N=>parseInt(N));if(ke.length===0){p(l,"Please select at least one position to report to");return}if(ke.includes(parseInt(e(u).positionId))){p(l,"A position cannot report to itself");return}p(i,!0),p(l,"");try{if(e(d)){const{data:N,error:V}=await Fa.hrReporting.update(v,{manager_positions:ke.map(G=>G.toString())});if(V){p(l,"Failed to update reporting map: "+(V.message||V));return}p(d,!1),v=null,await f()}else{if(e(s).find(de=>de.subordinate_position_id===e(u).positionId)){p(l,"Reporting map already exists for this position. Please edit the existing one."),p(i,!1);return}const{data:V,error:G}=await Fa.hrReporting.create({subordinate_position_id:e(u).positionId,manager_positions:ke.map(de=>de.toString())});if(G){p(l,"Failed to create reporting map: "+(G.message||G));return}await f()}p(u,{positionId:"",reportsTo:["","","","",""]})}catch{p(l,`Failed to ${e(d)?"update":"create"} reporting map`)}finally{p(i,!1)}}function _(ke){p(d,!0),v=ke.id;const N=["","","","",""];[ke.manager_position_1,ke.manager_position_2,ke.manager_position_3,ke.manager_position_4,ke.manager_position_5].forEach((G,de)=>{G&&de<5&&(N[de]=G.toString())}),p(u,{positionId:ke.subordinate_position_id.toString(),reportsTo:N})}function x(){p(d,!1),v=null,p(u,{positionId:"",reportsTo:["","","","",""]})}async function T(ke){if(confirm("Are you sure you want to delete this reporting map?")){p(i,!0),p(l,"");try{const{error:N}=await Fa.hrReporting.delete(ke);if(N){p(l,"Failed to delete reporting map: "+(N.message||N));return}await f()}catch(N){p(l,N.message||"Failed to delete reporting map")}finally{p(i,!1)}}}function b(ke){const N=e(a).find(V=>V.id===ke);return N?N.position_title_en:"Unknown Position"}function w(ke){const N=e(a).find(V=>V.id===ke);return N?N.position_title_ar:"منصب غير معروف"}function A(ke){var V;const N=e(a).find(G=>G.id===ke);return N&&((V=N.hr_departments)==null?void 0:V.department_name_en)||"Unknown Department"}function C(ke){const N=e(a).find(V=>V.id===ke);return N?N.level:0}function z(ke){return new Date(ke).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})}function F(ke){return["bg-red-500","bg-orange-500","bg-yellow-500","bg-green-500","bg-blue-500"][ke-1]||"bg-gray-500"}function re(ke=null){const N=ke?parseInt(ke):null;return e(a).filter(V=>V.id!==N)}function me(ke){const N=e(u).reportsTo[ke];N&&$e(u,e(u).reportsTo=e(u).reportsTo.map((V,G)=>G!==ke&&V===N?"":V))}ha();var ue=T4(),D=c(o(ue),2),E=o(D),he=o(E),xe=o(he,!0);n(he);var K=c(he,2),q=o(K),ae=o(q),Me=c(o(ae),2);R(()=>{e(u),Xt(()=>{e(i),e(a)})});var ge=o(Me);ge.value=ge.__value="";var Ne=c(ge);Mt(Ne,1,()=>e(a),Lt,(ke,N)=>{var V=u4(),G=o(V);n(V);var de={};R(()=>{var ve,Ie;y(G,`${e(N).position_title_en??""} (${e(N).position_title_ar??""}) - ${((ve=e(N).hr_departments)==null?void 0:ve.department_name_en)||"Unknown Department"} - Level ${((Ie=e(N).hr_levels)==null?void 0:Ie.level_order)||"N/A"}`),de!==(de=e(N).id)&&(V.value=(V.__value=e(N).id)??"")}),g(ke,V)}),n(Me),n(ae);var Be=c(ae,2),be=c(o(Be),2);Mt(be,5,()=>e(u).reportsTo,Lt,(ke,N,V)=>{var G=p4(),de=o(G);na(de,"for",`reports-to-${V}`),de.textContent=`Slot ${V+1}`;var ve=c(de,2);R(()=>{e(u),Xt(()=>{e(i)})}),na(ve,"id",`reports-to-${V}`);var Ie=o(ve);Ie.value=Ie.__value="";var Ye=c(Ie);Mt(Ye,1,()=>re(e(u).positionId),Lt,(oe,se)=>{var U=f4(),W=o(U);n(U);var ee={};R(we=>{var Ae;U.disabled=we,y(W,`${e(se).position_title_en??""} - L${((Ae=e(se).hr_levels)==null?void 0:Ae.level_order)||"N/A"}`),ee!==(ee=e(se).id)&&(U.value=(U.__value=e(se).id)??"")},[()=>e(u).reportsTo.includes(e(se).id.toString())&&e(u).reportsTo[V]!==e(se).id.toString()]),g(oe,U)}),n(ve),n(G),R(()=>ve.disabled=e(i)),ra(ve,()=>e(u).reportsTo[V],oe=>$e(u,e(u).reportsTo[V]=oe)),Z("change",ve,()=>me(V)),g(ke,G)}),n(be),n(Be),n(q);var L=c(q,2);{var Te=ke=>{var N=h4(),V=c(o(N));n(N),R(()=>y(V,` ${e(l)??""}`)),g(ke,N)};X(L,ke=>{e(l)&&ke(Te)})}var ye=c(L,2),P=o(ye);{var pe=ke=>{var N=m4();R(()=>N.disabled=e(i)),Z("click",N,x),g(ke,N)};X(P,ke=>{e(d)&&ke(pe)})}var B=c(P,2),j=o(B);{var I=ke=>{var N=_4(),V=c(Bt(N));R(()=>y(V,` ${e(d)?"Updating...":"Creating..."}`)),g(ke,N)},Y=ke=>{var N=g4(),V=Bt(N),G=o(V,!0);n(V);var de=c(V);R(()=>{y(G,e(d)?"✏️":"📈"),y(de,` ${e(d)?"Update Reporting Map":"Save Reporting Map"}`)}),g(ke,N)};X(j,ke=>{e(i)?ke(I):ke(Y,!1)})}n(B),n(ye),n(K),n(E);var fe=c(E,2),ce=o(fe),J=o(ce),le=o(J);n(J);var S=c(J,2);n(ce);var De=c(ce,2);{var Ue=ke=>{var N=x4();g(ke,N)},We=ke=>{var N=Ca(),V=Bt(N);{var G=ve=>{var Ie=b4();g(ve,Ie)},de=ve=>{var Ie=k4(),Ye=o(Ie),oe=c(o(Ye));Mt(oe,5,()=>e(s),se=>se.id,(se,U)=>{var W=y4(),ee=o(W),we=o(ee),Ae=o(we),He=o(Ae,!0);n(Ae);var Ke=c(Ae,2),Oe=o(Ke,!0);n(Ke),n(we),n(ee);var Ee=c(ee),et=o(Ee,!0);n(Ee);var dt=c(Ee),ut=o(dt),Pe=o(ut);n(ut),n(dt);var qe=c(dt),tt=o(qe);Mt(tt,5,()=>[e(U).manager_position_1,e(U).manager_position_2,e(U).manager_position_3,e(U).manager_position_4,e(U).manager_position_5].filter(_e=>_e),Lt,(_e,Ve,Je)=>{var st=w4(),ot=o(st);ot.textContent=`${Je+1}.`;var Le=c(ot,2),nt=o(Le),vt=o(nt,!0);n(nt);var xt=c(nt,2),M=o(xt,!0);n(xt),n(Le),n(st),R((H,O)=>{y(vt,H),y(M,O)},[()=>b(e(Ve)),()=>w(e(Ve))]),g(_e,st)}),n(tt),n(qe);var lt=c(qe),Xe=o(lt,!0);n(lt);var at=c(lt),Fe=o(at),rt=o(Fe),Ce=c(rt,2);n(Fe),n(at),n(W),R((_e,Ve,Je,st,ot,Le)=>{y(He,_e),y(Oe,Ve),y(et,Je),wt(ut,1,`level-badge ${st??""}`,"svelte-5l4itz"),y(Pe,`L${ot??""}`),y(Xe,Le),rt.disabled=e(i),Ce.disabled=e(i)},[()=>b(e(U).subordinate_position_id),()=>w(e(U).subordinate_position_id),()=>A(e(U).subordinate_position_id),()=>F(C(e(U).subordinate_position_id)),()=>C(e(U).subordinate_position_id),()=>z(e(U).created_at)]),Z("click",rt,()=>_(e(U))),Z("click",Ce,()=>T(e(U).id)),g(se,W)}),n(oe),n(Ye),n(Ie),g(ve,Ie)};X(V,ve=>{e(s).length===0?ve(G):ve(de,!1)},!0)}g(ke,N)};X(De,ke=>{e(i)&&e(s).length===0?ke(Ue):ke(We,!1)})}n(fe),n(D),n(ue),R(()=>{y(xe,e(d)?"Edit Reporting Map":"Create New Reporting Map"),Me.disabled=e(i),B.disabled=e(i),y(le,`Reporting Maps (${e(s).length??""})`),S.disabled=e(i)}),ra(Me,()=>e(u).positionId,ke=>$e(u,e(u).positionId=ke)),Z("submit",K,Ur(h)),Z("click",S,f),g(t,ue),ma()}var A4=k('<option class="svelte-13dc3ky"> </option>'),S4=k('<button class="clear-search svelte-13dc3ky" title="Clear search">×</button>'),C4=k('<div class="search-results-info svelte-13dc3ky"> <!></div>'),F4=k('<div class="search-section svelte-13dc3ky"><div class="search-header svelte-13dc3ky"><h4 class="svelte-13dc3ky">Search Employees</h4> <p class="svelte-13dc3ky">Search by name or employee ID</p></div> <div class="search-controls svelte-13dc3ky"><div class="search-criteria svelte-13dc3ky"><label for="search-criteria" class="svelte-13dc3ky">Search by:</label> <select id="search-criteria" class="criteria-select svelte-13dc3ky"><option class="svelte-13dc3ky">All Fields</option><option class="svelte-13dc3ky">Name Only</option><option class="svelte-13dc3ky">Employee ID Only</option></select></div> <div class="search-input-container svelte-13dc3ky"><input type="text" class="search-input svelte-13dc3ky"/> <div class="search-icon svelte-13dc3ky">🔍</div> <!></div></div> <!></div>'),D4=k('<div class="error-message svelte-13dc3ky"><strong class="svelte-13dc3ky">Error:</strong> </div>'),M4=k('<div class="success-message svelte-13dc3ky"><strong class="svelte-13dc3ky">Success:</strong> </div>'),I4=k('<div class="loading-state svelte-13dc3ky"><div class="spinner large svelte-13dc3ky"></div> <p class="svelte-13dc3ky">Loading employees...</p></div>'),R4=k('<div class="empty-state svelte-13dc3ky"><div class="empty-icon svelte-13dc3ky">👥</div> <h4 class="svelte-13dc3ky">No Employees Found</h4> <p class="svelte-13dc3ky">No employees found in the selected branch</p></div>'),N4=k('<div class="position-info svelte-13dc3ky"><div class="position-name svelte-13dc3ky"> </div> <div class="position-details svelte-13dc3ky"><span> </span> <span class="department-name svelte-13dc3ky"> </span></div></div>'),P4=k('<span class="no-position svelte-13dc3ky">No position assigned</span>'),L4=k('<option class="svelte-13dc3ky"> </option>'),O4=k('<tr class="table-row svelte-13dc3ky"><td class="employee-id svelte-13dc3ky"> </td><td class="employee-name svelte-13dc3ky"> </td><td class="branch svelte-13dc3ky"> </td><td class="current-position svelte-13dc3ky"><!></td><td class="assign-action svelte-13dc3ky"><select class="position-select svelte-13dc3ky"><option class="svelte-13dc3ky">Select position...</option><!></select></td></tr>'),z4=k('<div class="table-container svelte-13dc3ky"><table class="employees-table svelte-13dc3ky"><thead class="svelte-13dc3ky"><tr class="svelte-13dc3ky"><th class="svelte-13dc3ky">Employee ID</th><th class="svelte-13dc3ky">Name</th><th class="svelte-13dc3ky">Branch</th><th class="svelte-13dc3ky">Current Position</th><th class="svelte-13dc3ky">Assign Position</th></tr></thead><tbody class="svelte-13dc3ky"></tbody></table></div>'),B4=k('<div class="employees-section svelte-13dc3ky"><div class="section-header svelte-13dc3ky"><h3 class="svelte-13dc3ky"> </h3> <div class="employee-count svelte-13dc3ky"><!></div></div> <!></div>'),$4=k('<div class="assign-positions svelte-13dc3ky"><div class="header svelte-13dc3ky"><h2 class="title svelte-13dc3ky">Assign Positions</h2> <p class="subtitle svelte-13dc3ky">Assign employees to positions and manage existing assignments</p></div> <div class="content svelte-13dc3ky"><div class="branch-selection svelte-13dc3ky"><div class="selection-header svelte-13dc3ky"><h3 class="svelte-13dc3ky">Select Branch</h3> <p class="svelte-13dc3ky">Choose a branch to view and manage employee position assignments</p></div> <select class="branch-select svelte-13dc3ky"><option class="svelte-13dc3ky">Choose a branch...</option><!></select></div> <!> <!> <!> <!></div></div>');function U4(t,r){pa(r,!1);let a=Q([]),s=Q([]),i=Q([]),l=[],d=Q(""),v=Q(""),u=Q("all"),f=Q([]),h=Q(!1),_=Q(""),x=Q("");Aa(async()=>{await T()});async function T(){p(h,!0),p(_,"");try{const{data:be,error:L}=await Fa.branches.getAll();if(L){console.error("Error loading branches:",L),p(_,"Failed to load branches: "+(L.message||L));return}p(a,be||[]);const{data:Te,error:ye}=await Fa.hrPositions.getAll();if(ye){console.error("Error loading positions:",ye),p(_,"Failed to load positions: "+(ye.message||ye));return}p(i,Te||[])}catch(be){console.error("Error in loadInitialData:",be),p(_,be.message||"Failed to load initial data")}finally{p(h,!1)}}async function b(be){if(!be){p(s,[]),l=[];return}p(h,!0),p(_,"");try{const[L,Te]=await Promise.all([Fa.hrEmployees.getByBranch(be),Fa.hrAssignments.getByBranch(be)]);if(L.error){console.error("Error loading employees:",L.error),p(_,"Failed to load employees: "+(L.error.message||L.error)),p(s,[]);return}p(s,L.data||[]),Te.error?(l=[],console.error("Error loading branch assignments:",Te.error)):(l=Te.data||[],console.log("Loaded branch assignments:",l.length,l))}catch(L){console.error("Error loading employees by branch:",L),p(_,L.message||"Failed to load employees"),p(s,[]),l=[]}finally{p(h,!1)}}async function w(be,L){var Te,ye;if(L){p(h,!0),p(_,""),p(x,"");try{const P=e(i).find(fe=>fe.id===L);if(!P){p(_,"Position not found"),p(h,!1);return}if(l.find(fe=>fe.employee_id===be&&fe.position_id===L&&fe.is_current===!0)){p(_,"Employee already assigned to this position"),p(h,!1);return}const B={employee_id:be,position_id:L,department_id:P.department_id||((Te=P.hr_departments)==null?void 0:Te.id),level_id:P.level_id||((ye=P.hr_levels)==null?void 0:ye.id),branch_id:parseInt(e(d))};if(console.log("Creating assignment with data:",B),console.log("Position object:",P),!B.department_id){p(_,"Position is missing department information"),p(h,!1);return}if(!B.level_id){p(_,"Position is missing level information"),p(h,!1);return}const{data:j,error:I}=await Fa.hrAssignments.create(B);if(I){console.error("Assignment creation error:",I),p(_,`Failed to assign position: ${I.message||I}`),I.details&&p(_,e(_)+` Details: ${I.details}`),p(h,!1);return}await b(e(d));const Y=e(s).find(fe=>fe.id===be);p(x,`Successfully assigned ${(Y==null?void 0:Y.name)||"Employee"} to ${P.position_title_en}`),setTimeout(()=>{p(x,"")},3e3)}catch{p(_,"Failed to assign position")}finally{p(h,!1)}}}function A(be){const L=l.find(Te=>Te.employee_id===be&&Te.is_current===!0);return L&&e(i).find(ye=>ye.id===L.position_id)||null}function C(be){return["bg-red-500","bg-orange-500","bg-yellow-500","bg-green-500","bg-blue-500"][be-1]||"bg-gray-500"}function z(be){const L=e(a).find(Te=>Te.id===be);return L?L.name_en:"Unknown Branch"}function F(){if(!e(s)||e(s).length===0||!e(v)||!e(v).trim())return e(s)||[];const be=e(v).toLowerCase().trim();return e(s).filter(L=>{const Te=(L.name||"").toString().toLowerCase(),ye=(L.employee_id||"").toString().toLowerCase();switch(e(u)){case"name":return Te.includes(be);case"employee_id":return ye.includes(be);case"all":default:return Te.includes(be)||ye.includes(be)}})}Nt(()=>(e(s),e(v)),()=>{!e(s)||e(s).length===0?p(f,[]):!e(v)||!e(v).trim()?p(f,e(s)):p(f,F())}),Nt(()=>e(d),()=>{e(d)&&b(e(d))}),Va(),ha();var re=$4(),me=c(o(re),2),ue=o(me),D=c(o(ue),2);R(()=>{e(d),Xt(()=>{e(h),e(a)})});var E=o(D);E.value=E.__value="";var he=c(E);Mt(he,1,()=>e(a),Lt,(be,L)=>{var Te=A4(),ye=o(Te);n(Te);var P={};R(()=>{y(ye,`${e(L),m(()=>e(L).name_en)??""} - ${e(L),m(()=>e(L).location_en||"")??""}`),P!==(P=(e(L),m(()=>e(L).id)))&&(Te.value=(Te.__value=(e(L),m(()=>e(L).id)))??"")}),g(be,Te)}),n(D),n(ue);var xe=c(ue,2);{var K=be=>{var L=F4(),Te=c(o(L),2),ye=o(Te),P=c(o(ye),2);R(()=>{e(u),Xt(()=>{})});var pe=o(P);pe.value=pe.__value="all";var B=c(pe);B.value=B.__value="name";var j=c(B);j.value=j.__value="employee_id",n(P),n(ye);var I=c(ye,2),Y=o(I);At(Y);var fe=c(Y,4);{var ce=S=>{var De=S4();Z("click",De,()=>p(v,"")),g(S,De)};X(fe,S=>{e(v),m(()=>e(v).trim())&&S(ce)})}n(I),n(Te);var J=c(Te,2);{var le=S=>{var De=C4(),Ue=o(De),We=c(Ue);{var ke=N=>{var V=Ya();R(()=>y(V,`(searching by ${e(u)==="employee_id"?"Employee ID":"Name"})`)),g(N,V)};X(We,N=>{e(u)!=="all"&&N(ke)})}n(De),R(()=>y(Ue,`Showing ${e(f),m(()=>e(f).length)??""} of ${e(s),m(()=>e(s).length)??""} employees `)),g(S,De)};X(J,S=>{e(v),m(()=>e(v)&&e(v).trim())&&S(le)})}n(L),R(()=>na(Y,"placeholder",e(u)==="name"?"Search by name...":e(u)==="employee_id"?"Search by employee ID...":"Search employees...")),ra(P,()=>e(u),S=>p(u,S)),zt(Y,()=>e(v),S=>p(v,S)),g(be,L)};X(xe,be=>{e(d),e(s),m(()=>e(d)&&e(s).length>0)&&be(K)})}var q=c(xe,2);{var ae=be=>{var L=D4(),Te=c(o(L));n(L),R(()=>y(Te,` ${e(_)??""}`)),g(be,L)};X(q,be=>{e(_)&&be(ae)})}var Me=c(q,2);{var ge=be=>{var L=M4(),Te=c(o(L));n(L),R(()=>y(Te,` ${e(x)??""}`)),g(be,L)};X(Me,be=>{e(x)&&be(ge)})}var Ne=c(Me,2);{var Be=be=>{var L=B4(),Te=o(L),ye=o(Te),P=o(ye);n(ye);var pe=c(ye,2),B=o(pe);{var j=J=>{var le=Ya();R(()=>y(le,`${e(f),m(()=>e(f).length)??""} of ${e(s),m(()=>e(s).length)??""} employee${e(s),m(()=>e(s).length!==1?"s":"")??""}`)),g(J,le)},I=J=>{var le=Ya();R(()=>y(le,`${e(s),m(()=>e(s).length)??""} employee${e(s),m(()=>e(s).length!==1?"s":"")??""}`)),g(J,le)};X(B,J=>{e(v),m(()=>e(v)&&e(v).trim())?J(j):J(I,!1)})}n(pe),n(Te);var Y=c(Te,2);{var fe=J=>{var le=I4();g(J,le)},ce=J=>{var le=Ca(),S=Bt(le);{var De=We=>{var ke=R4();g(We,ke)},Ue=We=>{var ke=z4(),N=o(ke),V=c(o(N));Mt(V,5,()=>e(f),G=>G.id,(G,de)=>{const ve=$i(()=>(e(de),m(()=>A(e(de).id))));var Ie=O4(),Ye=o(Ie),oe=o(Ye,!0);n(Ye);var se=c(Ye),U=o(se,!0);n(se);var W=c(se),ee=o(W,!0);n(W);var we=c(W),Ae=o(we);{var He=ut=>{var Pe=N4(),qe=o(Pe),tt=o(qe,!0);n(qe);var lt=c(qe,2),Xe=o(lt),at=o(Xe);n(Xe);var Fe=c(Xe,2),rt=o(Fe,!0);n(Fe),n(lt),n(Pe),R(Ce=>{y(tt,(kt(e(ve)),m(()=>e(ve).position_title_en))),wt(Xe,1,`level-badge ${Ce??""}`,"svelte-13dc3ky"),y(at,`L${kt(e(ve)),m(()=>e(ve).level)??""}`),y(rt,(kt(e(ve)),m(()=>e(ve).department_name)))},[()=>(kt(e(ve)),m(()=>C(e(ve).level)))]),g(ut,Pe)},Ke=ut=>{var Pe=P4();g(ut,Pe)};X(Ae,ut=>{e(ve)?ut(He):ut(Ke,!1)})}n(we);var Oe=c(we),Ee=o(Oe),et=o(Ee);et.value=et.__value="";var dt=c(et);Mt(dt,1,()=>e(i),Lt,(ut,Pe)=>{var qe=L4(),tt=o(qe);n(qe);var lt={};R(()=>{Bd(qe,(kt(e(ve)),e(Pe),m(()=>{var Xe;return((Xe=e(ve))==null?void 0:Xe.id)===e(Pe).id}))),y(tt,`${e(Pe),m(()=>e(Pe).position_title_en)??""} - ${e(Pe),m(()=>{var Xe;return((Xe=e(Pe).hr_departments)==null?void 0:Xe.department_name_en)||e(Pe).department_name})??""}`),lt!==(lt=(e(Pe),m(()=>e(Pe).id)))&&(qe.value=(qe.__value=(e(Pe),m(()=>e(Pe).id)))??"")}),g(ut,qe)}),n(Ee),n(Oe),n(Ie),R(ut=>{y(oe,(e(de),m(()=>e(de).employee_id))),y(U,(e(de),m(()=>e(de).name))),y(ee,ut),Ee.disabled=e(h)},[()=>(e(de),m(()=>z(e(de).branch_id)))]),Z("change",Ee,ut=>w(e(de).id,ut.target.value)),g(G,Ie)}),n(V),n(N),n(ke),g(We,ke)};X(S,We=>{e(s),m(()=>e(s).length===0)?We(De):We(Ue,!1)},!0)}g(J,le)};X(Y,J=>{e(h),e(s),m(()=>e(h)&&e(s).length===0)?J(fe):J(ce,!1)})}n(L),R(J=>y(P,`Employees in ${J??""}`),[()=>(e(d),m(()=>z(parseInt(e(d)))))]),g(be,L)};X(Ne,be=>{e(d)&&be(Be)})}n(me),n(re),R(()=>D.disabled=e(h)),ra(D,()=>e(d),be=>p(d,be)),g(t,re),ma()}var q4=k('<option class="svelte-7pkqkm"> </option>'),j4=k('<div class="upload-placeholder svelte-7pkqkm"><div class="upload-icon svelte-7pkqkm">📊</div> <h4 class="svelte-7pkqkm">Drop your Excel file here</h4> <p class="svelte-7pkqkm">or click to browse files</p> <p class="file-types svelte-7pkqkm">Supports: .xlsx, .xls, .csv (max 10MB)</p> <button class="browse-btn svelte-7pkqkm">Browse Files</button></div>'),W4=k('<div class="file-info svelte-7pkqkm"><div class="file-icon svelte-7pkqkm">📊</div> <div class="file-details svelte-7pkqkm"><div class="file-name svelte-7pkqkm"> </div> <div class="file-size svelte-7pkqkm"> </div> <div class="file-type svelte-7pkqkm"> </div></div> <button class="remove-file-btn svelte-7pkqkm" title="Remove file">❌</button></div>'),H4=k('<div class="error-message svelte-7pkqkm"><strong class="svelte-7pkqkm">Error:</strong> </div>'),V4=k('<div class="progress-section svelte-7pkqkm"><div class="progress-header svelte-7pkqkm"><span class="svelte-7pkqkm">Processing file...</span> <span class="svelte-7pkqkm"> </span></div> <div class="progress-bar svelte-7pkqkm"><div class="progress-fill svelte-7pkqkm"></div></div></div>'),G4=k('<span class="spinner svelte-7pkqkm"></span> Processing...',1),X4=k('<span class="icon svelte-7pkqkm">⚙️</span> Process File',1),Y4=k('<div class="actions svelte-7pkqkm"><button class="process-btn svelte-7pkqkm"><!></button></div>'),K4=k('<div class="stat-item svelte-7pkqkm"><span class="stat-label svelte-7pkqkm">Invalid Records:</span> <span class="stat-value text-red-600 svelte-7pkqkm"> </span></div>'),Q4=k('<div class="stat-item svelte-7pkqkm"><span class="stat-label svelte-7pkqkm">Duplicate Records:</span> <span class="stat-value text-yellow-600 svelte-7pkqkm"> </span></div>'),Z4=k('<span class="spinner svelte-7pkqkm"></span> Saving...',1),J4=k('<span class="icon svelte-7pkqkm">💾</span> Save Transactions',1),e3=k('<button class="save-btn svelte-7pkqkm"><!></button>'),t3=k('<div class="saved-message svelte-7pkqkm"><span class="icon svelte-7pkqkm">✅</span> Transactions saved successfully!</div>'),a3=k('<div class="result-success svelte-7pkqkm"><div class="result-header svelte-7pkqkm"><span class="result-icon svelte-7pkqkm">✅</span> <h4 class="svelte-7pkqkm">File Processed Successfully</h4></div> <div class="result-stats svelte-7pkqkm"><div class="stat-item svelte-7pkqkm"><span class="stat-label svelte-7pkqkm">Total Records:</span> <span class="stat-value svelte-7pkqkm"> </span></div> <div class="stat-item svelte-7pkqkm"><span class="stat-label svelte-7pkqkm">Valid Records:</span> <span class="stat-value text-green-600 svelte-7pkqkm"> </span></div> <!> <!></div> <div class="result-actions svelte-7pkqkm"><!> <button class="reset-btn svelte-7pkqkm"><span class="icon svelte-7pkqkm">🔄</span> Upload New File</button></div></div>'),r3=k('<div class="result-error svelte-7pkqkm"><div class="result-header svelte-7pkqkm"><span class="result-icon svelte-7pkqkm">❌</span> <h4 class="svelte-7pkqkm">File Processing Failed</h4></div> <p class="svelte-7pkqkm">Please check your file format and try again.</p></div>'),s3=k('<div class="result-section svelte-7pkqkm"><!></div>'),i3=k('<tr class="table-row svelte-7pkqkm"><td class="employee-id svelte-7pkqkm"> </td><td class="employee-name svelte-7pkqkm"> </td><td class="date svelte-7pkqkm"> </td><td class="time svelte-7pkqkm"> </td><td class="punch-state svelte-7pkqkm"><span> </span></td></tr>'),n3=k('<div class="more-records svelte-7pkqkm"><p class="svelte-7pkqkm"> </p></div>'),o3=k('<div class="preview-section svelte-7pkqkm"><div class="preview-header svelte-7pkqkm"><h3 class="svelte-7pkqkm">Data Preview</h3> <p class="section-description svelte-7pkqkm"> </p></div> <div class="preview-info svelte-7pkqkm"><div class="info-item svelte-7pkqkm"><strong class="svelte-7pkqkm">Branch:</strong> </div> <div class="info-item svelte-7pkqkm"><strong class="svelte-7pkqkm">File:</strong> </div> <div class="info-item svelte-7pkqkm"><strong class="svelte-7pkqkm">Processed:</strong> </div></div> <div class="table-container svelte-7pkqkm"><table class="preview-table svelte-7pkqkm"><thead class="svelte-7pkqkm"><tr class="svelte-7pkqkm"><th class="svelte-7pkqkm">Employee ID</th><th class="svelte-7pkqkm">Name</th><th class="svelte-7pkqkm">Date</th><th class="svelte-7pkqkm">Time</th><th class="svelte-7pkqkm">Punch State</th></tr></thead><tbody class="svelte-7pkqkm"></tbody></table></div> <!></div>'),l3=k(`<div class="upload-fingerprint svelte-7pkqkm"><div class="header svelte-7pkqkm"><h2 class="title svelte-7pkqkm">Upload Fingerprint Transactions</h2> <p class="subtitle svelte-7pkqkm">Upload employee attendance data from fingerprint devices</p></div> <div class="content svelte-7pkqkm"><div class="branch-section svelte-7pkqkm"><h3 class="svelte-7pkqkm">Select Branch</h3> <p class="section-description svelte-7pkqkm">Choose the branch for which you're uploading fingerprint transactions</p> <select class="branch-select svelte-7pkqkm"><option class="svelte-7pkqkm">Choose a branch...</option><!></select></div> <div class="template-section svelte-7pkqkm"><div class="template-header svelte-7pkqkm"><div class="svelte-7pkqkm"><h3 class="svelte-7pkqkm">Excel Template</h3> <p class="section-description svelte-7pkqkm">Download the template to ensure your data is in the correct format</p></div> <button class="download-btn svelte-7pkqkm"><span class="icon svelte-7pkqkm">📥</span> Download Template</button></div> <div class="template-info svelte-7pkqkm"><h4 class="svelte-7pkqkm">Template Format:</h4> <div class="format-details svelte-7pkqkm"><div class="format-item svelte-7pkqkm"><strong class="svelte-7pkqkm">Employee ID:</strong> <code class="svelte-7pkqkm">EMP001</code></div> <div class="format-item svelte-7pkqkm"><strong class="svelte-7pkqkm">Name:</strong> <code class="svelte-7pkqkm">Ahmed Mohammed Ali</code></div> <div class="format-item svelte-7pkqkm"><strong class="svelte-7pkqkm">Date:</strong> <code class="svelte-7pkqkm">yyyy-mm-dd</code> (e.g., 2024-09-25)</div> <div class="format-item svelte-7pkqkm"><strong class="svelte-7pkqkm">Time:</strong> <code class="svelte-7pkqkm">hh:mm AM/PM</code> (e.g., 08:00 AM, 05:30 PM)</div> <div class="format-item svelte-7pkqkm"><strong class="svelte-7pkqkm">Punch State:</strong> <code class="svelte-7pkqkm">Check In</code> or <code class="svelte-7pkqkm">Check Out</code></div></div></div></div> <div class="upload-section svelte-7pkqkm"><h3 class="svelte-7pkqkm">Upload File</h3> <p class="section-description svelte-7pkqkm">Drag and drop your Excel file or click to browse</p> <div role="button" tabindex="0"><!></div> <input type="file" accept=".xlsx,.xls,.csv" style="display: none;" class="svelte-7pkqkm"/></div> <!> <!> <!> <!> <!></div></div>`);function c3(t,r){pa(r,!1);let a=Q([]),s=Q(""),i=Q(null),l=Q(!1),d=Q(!1),v=Q(0),u=Q(null),f=Q(""),h=Q([]),_=Q(!1),x=Q();Aa(async()=>{await T()});async function T(){try{const{data:V,error:G}=await Fa.branches.getAll();if(G){console.error("Error loading branches:",G),p(f,"Failed to load branches: "+(G.message||G));return}p(a,V||[])}catch(V){console.error("Error in loadBranches:",V),p(f,V.message||"Failed to load branches")}}function b(){const V=["Employee ID,Name,Date,Time,Punch State","EMP001,Ahmed Mohammed Ali,2024-09-25,08:00 AM,Check In","EMP001,Ahmed Mohammed Ali,2024-09-25,05:30 PM,Check Out","EMP002,Fatima Ahmed Salem,2024-09-25,08:15 AM,Check In","EMP002,Fatima Ahmed Salem,2024-09-25,05:45 PM,Check Out","EMP003,Khalid Abdullah Al-Mutairi,2024-09-25,09:00 AM,Check In","EMP003,Khalid Abdullah Al-Mutairi,2024-09-25,06:00 PM,Check Out"].join(`
`),G=new Blob([V],{type:"text/csv;charset=utf-8;"}),de=document.createElement("a"),ve=URL.createObjectURL(G);de.setAttribute("href",ve),de.setAttribute("download","fingerprint_transactions_template.csv"),de.style.visibility="hidden",document.body.appendChild(de),de.click(),document.body.removeChild(de),URL.revokeObjectURL(ve)}function w(V){V.preventDefault(),p(l,!0)}function A(V){V.preventDefault(),p(l,!1)}function C(V){V.preventDefault(),p(l,!1);const G=V.dataTransfer.files;F(G)}function z(V){const G=V.target.files;F(G)}function F(V){if(V.length===0)return;const G=V[0];if(!["application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/vnd.ms-excel","text/csv"].includes(G.type)){p(f,"Please select an Excel file (.xlsx, .xls) or CSV file (.csv)");return}if(G.size>10*1024*1024){p(f,"File size must be less than 10MB");return}p(i,G),p(f,""),p(u,null),p(_,!1)}function re(){p(i,null),p(u,null),p(f,""),p(_,!1),e(x)&&$e(x,e(x).value="")}async function me(){if(!e(i)){p(f,"Please select a file first");return}if(!e(s)){p(f,"Please select a branch first");return}p(d,!0),p(v,0),p(f,"");try{p(v,20);const V=await e(i).arrayBuffer(),G=gn(V,{type:"buffer"}),de=G.SheetNames[0],ve=G.Sheets[de],Ie=Fd.sheet_to_json(ve);if(p(v,50),!Ie||Ie.length===0){p(f,"Excel file is empty or has no valid data");return}const Ye=Ie[0],se=["Employee ID","Name","Date","Time","Punch State"].filter(U=>!(U in Ye));if(se.length>0){p(f,`Missing required columns: ${se.join(", ")}`);return}p(v,80),p(h,Ie.map((U,W)=>{var ee,we,Ae,He,Ke;return{employeeId:(ee=U["Employee ID"])==null?void 0:ee.toString().trim(),name:(we=U.Name)==null?void 0:we.toString().trim(),date:U.Date,time:(Ae=U.Time)==null?void 0:Ae.toString().trim(),punchState:(He=U["Punch State"])==null?void 0:He.toString().trim(),deviceId:((Ke=U["Device ID"])==null?void 0:Ke.toString().trim())||null,rowIndex:W+2}}).filter(U=>U.employeeId&&U.name&&U.date&&U.time&&U.punchState)),p(v,100),p(u,{success:!0,totalRecords:e(h).length,validRecords:e(h).length,invalidRecords:0,duplicateRecords:0,processedAt:new Date().toISOString()}),p(_,!0)}catch{p(f,"Failed to process file. Please check the file format and try again."),p(u,{success:!1,error:"File processing failed"})}finally{p(d,!1),p(v,0)}}async function ue(){if(e(h).length){p(d,!0),p(f,"");try{const V=e(h).map(de=>{let ve;try{const Ie=new Date(de.date);if(isNaN(Ie.getTime()))throw new Error("Invalid date");ve=Ie.toISOString().split("T")[0]}catch(Ie){console.error("Date conversion error for:",de.date,Ie),ve=new Date().toISOString().split("T")[0]}return{employee_id:de.employeeId,name:de.name,branch_id:e(s),transaction_date:ve,transaction_time:de.time,punch_state:de.punchState,device_id:de.deviceId||"DEFAULT"}}),G=await Fa.hrFingerprint.createMany(V);G.error&&G.errorCount>0?(p(u,{...e(u),saved:!0,savedAt:new Date().toISOString(),successCount:G.successCount,errorCount:G.errorCount,errors:G.errors,hasErrors:!0}),G.errors.length>0&&p(f,`${G.errorCount} transactions failed. First error: ${G.errors[0]}`)):p(u,{...e(u),saved:!0,savedAt:new Date().toISOString(),successCount:G.successCount,errorCount:0,hasErrors:!1})}catch(V){console.error("Error saving fingerprint transactions:",V),p(f,V.message||"Failed to save fingerprint transactions")}finally{p(d,!1)}}}function D(){p(i,null),p(u,null),p(f,""),p(_,!1),p(h,[]),p(v,0),e(x)&&$e(x,e(x).value="")}function E(V){if(V===0)return"0 Bytes";const G=1024,de=["Bytes","KB","MB","GB"],ve=Math.floor(Math.log(V)/Math.log(G));return parseFloat((V/Math.pow(G,ve)).toFixed(2))+" "+de[ve]}function he(V){return new Date(V).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})}function xe(V){return V}function K(V){return V==="Check In"?"text-green-600 bg-green-50":"text-red-600 bg-red-50"}function q(V){const G=e(a).find(de=>de.id===parseInt(V));return G?`${G.name_en} (${G.location_en})`:"Unknown Branch"}ha();var ae=l3(),Me=c(o(ae),2),ge=o(Me),Ne=c(o(ge),4);R(()=>{e(s),Xt(()=>{e(d),e(a)})});var Be=o(Ne);Be.value=Be.__value="";var be=c(Be);Mt(be,1,()=>e(a),Lt,(V,G)=>{var de=q4(),ve=o(de);n(de);var Ie={};R(()=>{y(ve,`${e(G).name_en??""} (${e(G).name_ar??""}) - ${e(G).location_en??""}`),Ie!==(Ie=e(G).id)&&(de.value=(de.__value=e(G).id)??"")}),g(V,de)}),n(Ne),n(ge);var L=c(ge,2),Te=o(L),ye=c(o(Te),2);n(Te),Et(2),n(L);var P=c(L,2),pe=c(o(P),4),B=o(pe);{var j=V=>{var G=j4(),de=c(o(G),8);n(G),R(()=>de.disabled=e(d)),Z("click",de,()=>{var ve;return(ve=e(x))==null?void 0:ve.click()}),g(V,G)},I=V=>{var G=W4(),de=c(o(G),2),ve=o(de),Ie=o(ve,!0);n(ve);var Ye=c(ve,2),oe=o(Ye,!0);n(Ye);var se=c(Ye,2),U=o(se,!0);n(se),n(de);var W=c(de,2);n(G),R(ee=>{y(Ie,e(i).name),y(oe,ee),y(U,e(i).type||"Unknown type"),W.disabled=e(d)},[()=>E(e(i).size)]),Z("click",W,re),g(V,G)};X(B,V=>{e(i)?V(I,!1):V(j)})}n(pe);var Y=c(pe,2);Ms(Y,V=>p(x,V),()=>e(x)),n(P);var fe=c(P,2);{var ce=V=>{var G=H4(),de=c(o(G));n(G),R(()=>y(de,` ${e(f)??""}`)),g(V,G)};X(fe,V=>{e(f)&&V(ce)})}var J=c(fe,2);{var le=V=>{var G=V4(),de=o(G),ve=c(o(de),2),Ie=o(ve);n(ve),n(de);var Ye=c(de,2),oe=o(Ye);n(Ye),n(G),R(()=>{y(Ie,`${e(v)??""}%`),$r(oe,`width: ${e(v)??""}%`)}),g(V,G)};X(J,V=>{e(d)&&e(v)>0&&V(le)})}var S=c(J,2);{var De=V=>{var G=Y4(),de=o(G),ve=o(de);{var Ie=oe=>{var se=G4();Et(),g(oe,se)},Ye=oe=>{var se=X4();Et(),g(oe,se)};X(ve,oe=>{e(d)?oe(Ie):oe(Ye,!1)})}n(de),n(G),R(()=>de.disabled=e(d)||!e(s)),Z("click",de,me),g(V,G)};X(S,V=>{e(i)&&!e(_)&&V(De)})}var Ue=c(S,2);{var We=V=>{var G=s3(),de=o(G);{var ve=Ye=>{var oe=a3(),se=c(o(oe),2),U=o(se),W=c(o(U),2),ee=o(W,!0);n(W),n(U);var we=c(U,2),Ae=c(o(we),2),He=o(Ae,!0);n(Ae),n(we);var Ke=c(we,2);{var Oe=lt=>{var Xe=K4(),at=c(o(Xe),2),Fe=o(at,!0);n(at),n(Xe),R(()=>y(Fe,e(u).invalidRecords)),g(lt,Xe)};X(Ke,lt=>{e(u).invalidRecords>0&&lt(Oe)})}var Ee=c(Ke,2);{var et=lt=>{var Xe=Q4(),at=c(o(Xe),2),Fe=o(at,!0);n(at),n(Xe),R(()=>y(Fe,e(u).duplicateRecords)),g(lt,Xe)};X(Ee,lt=>{e(u).duplicateRecords>0&&lt(et)})}n(se);var dt=c(se,2),ut=o(dt);{var Pe=lt=>{var Xe=e3(),at=o(Xe);{var Fe=Ce=>{var _e=Z4();Et(),g(Ce,_e)},rt=Ce=>{var _e=J4();Et(),g(Ce,_e)};X(at,Ce=>{e(d)?Ce(Fe):Ce(rt,!1)})}n(Xe),R(()=>Xe.disabled=e(d)),Z("click",Xe,ue),g(lt,Xe)},qe=lt=>{var Xe=t3();g(lt,Xe)};X(ut,lt=>{e(u).saved?lt(qe,!1):lt(Pe)})}var tt=c(ut,2);n(dt),n(oe),R(()=>{y(ee,e(u).totalRecords),y(He,e(u).validRecords),tt.disabled=e(d)}),Z("click",tt,D),g(Ye,oe)},Ie=Ye=>{var oe=r3();g(Ye,oe)};X(de,Ye=>{e(u).success?Ye(ve):Ye(Ie,!1)})}n(G),g(V,G)};X(Ue,V=>{e(u)&&V(We)})}var ke=c(Ue,2);{var N=V=>{var G=o3(),de=o(G),ve=c(o(de),2),Ie=o(ve);n(ve),n(de);var Ye=c(de,2),oe=o(Ye),se=c(o(oe));n(oe);var U=c(oe,2),W=c(o(U));n(U);var ee=c(U,2),we=c(o(ee));n(ee),n(Ye);var Ae=c(Ye,2),He=o(Ae),Ke=c(o(He));Mt(Ke,5,()=>e(h).slice(0,10),Lt,(et,dt)=>{var ut=i3(),Pe=o(ut),qe=o(Pe,!0);n(Pe);var tt=c(Pe),lt=o(tt,!0);n(tt);var Xe=c(tt),at=o(Xe,!0);n(Xe);var Fe=c(Xe),rt=o(Fe,!0);n(Fe);var Ce=c(Fe),_e=o(Ce),Ve=o(_e,!0);n(_e),n(Ce),n(ut),R((Je,st,ot)=>{y(qe,e(dt).employeeId),y(lt,e(dt).name),y(at,Je),y(rt,st),wt(_e,1,`punch-badge ${ot??""}`,"svelte-7pkqkm"),y(Ve,e(dt).punchState)},[()=>he(e(dt).date),()=>e(dt).time,()=>K(e(dt).punchState)]),g(et,ut)}),n(Ke),n(He),n(Ae);var Oe=c(Ae,2);{var Ee=et=>{var dt=n3(),ut=o(dt),Pe=o(ut);n(ut),n(dt),R(()=>y(Pe,`... and ${e(h).length-10} more records`)),g(et,dt)};X(Oe,et=>{e(h).length>10&&et(Ee)})}n(G),R((et,dt,ut)=>{y(Ie,`Showing ${et??""} of ${e(h).length??""} records`),y(se,` ${dt??""}`),y(W,` ${e(i).name??""}`),y(we,` ${ut??""}`)},[()=>Math.min(10,e(h).length),()=>q(e(s)),()=>he(e(u).processedAt)]),g(V,G)};X(ke,V=>{e(_)&&e(h).length>0&&V(N)})}n(Me),n(ae),R(()=>{Ne.disabled=e(d),ye.disabled=e(d),wt(pe,1,`upload-area ${e(l)?"drag-active":""} ${e(i)?"has-file":""}`,"svelte-7pkqkm")}),ra(Ne,()=>e(s),V=>p(s,V)),Z("click",ye,b),Z("dragover",pe,w),Z("dragleave",pe,A),Z("drop",pe,C),Z("change",Y,z),g(t,ae),ma()}var d3=k('<div class="update-error svelte-jaic27"><p> </p></div>'),v3=k('<div class="info-item full-width svelte-jaic27"><label class="svelte-jaic27">Task Description:</label> <div class="task-description svelte-jaic27"> </div></div>'),u3=k('<div class="section svelte-jaic27"><h3 class="section-title svelte-jaic27">Task Information</h3> <div class="info-grid svelte-jaic27"><div class="info-item svelte-jaic27"><label class="svelte-jaic27">Task Title:</label> <span class="svelte-jaic27"> </span></div> <div class="info-item svelte-jaic27"><label class="svelte-jaic27">Total Assigned:</label> <span class="svelte-jaic27"> </span></div> <div class="info-item svelte-jaic27"><label class="svelte-jaic27">Completed:</label> <span class="svelte-jaic27"> </span></div> <div class="info-item svelte-jaic27"><label class="svelte-jaic27">Overdue:</label> <span class="svelte-jaic27"> </span></div> <div class="info-item svelte-jaic27"><label class="svelte-jaic27">Completion Rate:</label> <span class="svelte-jaic27"> </span></div></div> <!></div>'),f3=k('<div class="fine-actions svelte-jaic27"><button class="btn btn-success svelte-jaic27"> </button></div>'),p3=k('<div class="section svelte-jaic27"><h3 class="section-title svelte-jaic27">Fine Information</h3> <div class="info-grid svelte-jaic27"><div class="info-item svelte-jaic27"><label class="svelte-jaic27">Fine Amount:</label> <span class="fine-amount svelte-jaic27"> </span></div> <div class="info-item svelte-jaic27"><label class="svelte-jaic27">Fine Status:</label> <select class="status-select svelte-jaic27"><option>Pending</option><option>Paid</option><option>Waived</option><option>Cancelled</option></select></div> <div class="info-item svelte-jaic27"><label class="svelte-jaic27">Due Date:</label> <span class="svelte-jaic27"> </span></div> <div class="info-item svelte-jaic27"><label class="svelte-jaic27">Paid Date:</label> <span class="svelte-jaic27"> </span></div></div> <!></div>'),h3=k('<div class="timeline-item svelte-jaic27"><strong class="svelte-jaic27">Acknowledged:</strong> </div>'),m3=k('<div class="timeline-item svelte-jaic27"><strong class="svelte-jaic27">Resolved:</strong> </div>'),_3=k('<div class="warning-details-modal svelte-jaic27"><div class="modal-header svelte-jaic27"><h2 class="modal-title svelte-jaic27">Warning Details</h2> <button class="close-btn svelte-jaic27"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg></button></div> <div class="modal-body svelte-jaic27"><!> <!> <div class="section svelte-jaic27"><h3 class="section-title svelte-jaic27">Employee Information</h3> <div class="info-grid svelte-jaic27"><div class="info-item svelte-jaic27"><label class="svelte-jaic27">Employee Name:</label> <span class="svelte-jaic27"> </span></div> <div class="info-item svelte-jaic27"><label class="svelte-jaic27">Employee ID:</label> <span class="svelte-jaic27"> </span></div> <div class="info-item svelte-jaic27"><label class="svelte-jaic27">Username:</label> <span class="svelte-jaic27"> </span></div> <div class="info-item svelte-jaic27"><label class="svelte-jaic27">Branch:</label> <span class="svelte-jaic27"> </span></div></div></div> <div class="section svelte-jaic27"><h3 class="section-title svelte-jaic27">Warning Details</h3> <div class="info-grid svelte-jaic27"><div class="info-item svelte-jaic27"><label class="svelte-jaic27">Warning Reference:</label> <span class="reference svelte-jaic27"> </span></div> <div class="info-item svelte-jaic27"><label class="svelte-jaic27">Warning Type:</label> <span> </span></div> <div class="info-item svelte-jaic27"><label class="svelte-jaic27">Severity Level:</label> <span> </span></div> <div class="info-item svelte-jaic27"><label class="svelte-jaic27">Language:</label> <span class="svelte-jaic27"> </span></div></div> <div class="info-item full-width svelte-jaic27"><label class="svelte-jaic27">Warning Text:</label> <div class="warning-text svelte-jaic27"> </div></div></div> <!> <!> <div class="section svelte-jaic27"><h3 class="section-title svelte-jaic27">Status Management</h3> <div class="info-grid svelte-jaic27"><div class="info-item svelte-jaic27"><label class="svelte-jaic27">Current Status:</label> <select class="status-select svelte-jaic27"><option>Active</option><option>Acknowledged</option><option>Resolved</option><option>Escalated</option><option>Cancelled</option></select></div> <div class="info-item svelte-jaic27"><label class="svelte-jaic27">Issued By:</label> <span class="svelte-jaic27"> </span></div> <div class="info-item svelte-jaic27"><label class="svelte-jaic27">Issued Date:</label> <span class="svelte-jaic27"> </span></div> <div class="info-item svelte-jaic27"><label class="svelte-jaic27">Last Updated:</label> <span class="svelte-jaic27"> </span></div></div> <div class="info-item full-width svelte-jaic27"><label class="svelte-jaic27">Resolution Notes:</label> <textarea class="notes-textarea svelte-jaic27" placeholder="Add resolution notes..." rows="3"></textarea></div> <div class="status-actions svelte-jaic27"><button class="btn btn-primary svelte-jaic27"> </button></div></div> <div class="section svelte-jaic27"><h3 class="section-title svelte-jaic27">Timeline</h3> <div class="timeline svelte-jaic27"><div class="timeline-item svelte-jaic27"><strong class="svelte-jaic27">Created:</strong> </div> <!> <!></div></div></div></div>');function g3(t,r){pa(r,!1);let a=Ra(r,"warning",12);const s=Jr();let i=Q(null),l=Q(!1),d=Q(a().warning_status),v=Q(a().resolution_notes||""),u=Q(a().fine_status||"pending");function f(Le){return Le?new Date(Le).toLocaleString():"N/A"}function h(Le,nt="USD"){return Le?new Intl.NumberFormat("en-US",{style:"currency",currency:nt}).format(Le):"N/A"}function _(Le){return{overall_performance_no_fine:{class:"bg-blue-100 text-blue-800",label:"Performance"},overall_performance_fine_threat:{class:"bg-orange-100 text-orange-800",label:"Performance + Threat"},overall_performance_with_fine:{class:"bg-red-100 text-red-800",label:"Performance + Fine"},task_specific_no_fine:{class:"bg-purple-100 text-purple-800",label:"Task Specific"},task_specific_fine_threat:{class:"bg-pink-100 text-pink-800",label:"Task + Threat"},task_specific_with_fine:{class:"bg-red-100 text-red-800",label:"Task + Fine"}}[Le]||{class:"bg-gray-100 text-gray-800",label:Le}}async function x(){if(!e(l)){p(l,!0),p(i,null);try{const Le={warning_status:e(d),resolution_notes:e(v),fine_status:e(u)};e(d)==="resolved"&&a().warning_status!=="resolved"&&(Le.resolved_at=new Date().toISOString(),Le.resolved_by="current-user-id"),e(d)==="acknowledged"&&a().warning_status!=="acknowledged"&&(Le.acknowledged_at=new Date().toISOString(),Le.acknowledged_by="current-user-id");const{error:nt}=await Tt.from("employee_warnings").update(Le).eq("id",a().id);if(nt)throw nt;a({...a(),...Le}),alert("Warning updated successfully!")}catch(Le){console.error("Error updating warning:",Le),p(i,"Failed to update warning: "+Le.message)}finally{p(l,!1)}}}async function T(){if(!e(l)){p(l,!0),p(i,null);try{const Le={fine_status:"paid",fine_paid_date:new Date().toISOString(),fine_paid_at:new Date().toISOString()},{error:nt}=await Tt.from("employee_warnings").update(Le).eq("id",a().id);if(nt)throw nt;a({...a(),...Le}),p(u,"paid"),alert("Fine marked as paid successfully!")}catch(Le){console.error("Error updating fine status:",Le),p(i,"Failed to update fine status: "+Le.message)}finally{p(l,!1)}}}function b(){s("close")}ha();var w=_3(),A=o(w),C=c(o(A),2);n(A);var z=c(A,2),F=o(z);X(F,Le=>{});var re=c(F,2);{var me=Le=>{var nt=d3(),vt=o(nt),xt=o(vt,!0);n(vt),n(nt),R(()=>y(xt,e(i))),g(Le,nt)};X(re,Le=>{e(i)&&Le(me)})}var ue=c(re,2),D=c(o(ue),2),E=o(D),he=c(o(E),2),xe=o(he,!0);n(he),n(E);var K=c(E,2),q=c(o(K),2),ae=o(q,!0);n(q),n(K);var Me=c(K,2),ge=c(o(Me),2),Ne=o(ge,!0);n(ge),n(Me);var Be=c(Me,2),be=c(o(Be),2),L=o(be,!0);n(be),n(Be),n(D),n(ue);var Te=c(ue,2),ye=c(o(Te),2),P=o(ye),pe=c(o(P),2),B=o(pe,!0);n(pe),n(P);var j=c(P,2),I=c(o(j),2),Y=o(I,!0);n(I),n(j);var fe=c(j,2),ce=c(o(fe),2),J=o(ce,!0);n(ce),n(fe);var le=c(fe,2),S=c(o(le),2),De=o(S,!0);n(S),n(le),n(ye);var Ue=c(ye,2),We=c(o(Ue),2),ke=o(We,!0);n(We),n(Ue),n(Te);var N=c(Te,2);{var V=Le=>{var nt=u3(),vt=c(o(nt),2),xt=o(vt),M=c(o(xt),2),H=o(M,!0);n(M),n(xt);var O=c(xt,2),te=c(o(O),2),ne=o(te,!0);n(te),n(O);var ie=c(O,2),Se=c(o(ie),2),Qe=o(Se,!0);n(Se),n(ie);var je=c(ie,2),ze=c(o(je),2),Re=o(ze,!0);n(ze),n(je);var it=c(je,2),ft=c(o(it),2),mt=o(ft);n(ft),n(it),n(vt);var ht=c(vt,2);{var pt=_t=>{var Ge=v3(),ct=c(o(Ge),2),Ze=o(ct,!0);n(ct),n(Ge),R(()=>y(Ze,(kt(a()),m(()=>a().task_description)))),g(_t,Ge)};X(ht,_t=>{kt(a()),m(()=>a().task_description)&&_t(pt)})}n(nt),R(()=>{y(H,(kt(a()),m(()=>a().task_title||"N/A"))),y(ne,(kt(a()),m(()=>a().total_tasks_assigned||0))),y(Qe,(kt(a()),m(()=>a().total_tasks_completed||0))),y(Re,(kt(a()),m(()=>a().total_tasks_overdue||0))),y(mt,`${kt(a()),m(()=>a().completion_rate||0)??""}%`)}),g(Le,nt)};X(N,Le=>{kt(a()),m(()=>a().task_id||a().assignment_id)&&Le(V)})}var G=c(N,2);{var de=Le=>{var nt=p3(),vt=c(o(nt),2),xt=o(vt),M=c(o(xt),2),H=o(M,!0);n(M),n(xt);var O=c(xt,2),te=c(o(O),2);R(()=>{e(u),Xt(()=>{})});var ne=o(te);ne.value=ne.__value="pending";var ie=c(ne);ie.value=ie.__value="paid";var Se=c(ie);Se.value=Se.__value="waived";var Qe=c(Se);Qe.value=Qe.__value="cancelled",n(te),n(O);var je=c(O,2),ze=c(o(je),2),Re=o(ze,!0);n(ze),n(je);var it=c(je,2),ft=c(o(it),2),mt=o(ft,!0);n(ft),n(it),n(vt);var ht=c(vt,2);{var pt=_t=>{var Ge=f3(),ct=o(Ge),Ze=o(ct,!0);n(ct),n(Ge),R(()=>{ct.disabled=e(l),y(Ze,e(l)?"Processing...":"Mark as Paid")}),Z("click",ct,T),g(_t,Ge)};X(ht,_t=>{kt(a()),m(()=>a().fine_status!=="paid")&&_t(pt)})}n(nt),R((_t,Ge,ct)=>{y(H,_t),y(Re,Ge),y(mt,ct)},[()=>(kt(a()),m(()=>h(a().fine_amount,a().fine_currency))),()=>(kt(a()),m(()=>a().fine_due_date?f(a().fine_due_date):"N/A")),()=>(kt(a()),m(()=>a().fine_paid_date?f(a().fine_paid_date):"N/A"))]),ra(te,()=>e(u),_t=>p(u,_t)),g(Le,nt)};X(G,Le=>{kt(a()),m(()=>a().has_fine)&&Le(de)})}var ve=c(G,2),Ie=c(o(ve),2),Ye=o(Ie),oe=c(o(Ye),2);R(()=>{e(d),Xt(()=>{})});var se=o(oe);se.value=se.__value="active";var U=c(se);U.value=U.__value="acknowledged";var W=c(U);W.value=W.__value="resolved";var ee=c(W);ee.value=ee.__value="escalated";var we=c(ee);we.value=we.__value="cancelled",n(oe),n(Ye);var Ae=c(Ye,2),He=c(o(Ae),2),Ke=o(He,!0);n(He),n(Ae);var Oe=c(Ae,2),Ee=c(o(Oe),2),et=o(Ee,!0);n(Ee),n(Oe);var dt=c(Oe,2),ut=c(o(dt),2),Pe=o(ut,!0);n(ut),n(dt),n(Ie);var qe=c(Ie,2),tt=c(o(qe),2);ks(tt),n(qe);var lt=c(qe,2),Xe=o(lt),at=o(Xe,!0);n(Xe),n(lt),n(ve);var Fe=c(ve,2),rt=c(o(Fe),2),Ce=o(rt),_e=c(o(Ce));n(Ce);var Ve=c(Ce,2);{var Je=Le=>{var nt=h3(),vt=c(o(nt));n(nt),R(xt=>y(vt,` ${xt??""}`),[()=>(kt(a()),m(()=>f(a().acknowledged_at)))]),g(Le,nt)};X(Ve,Le=>{kt(a()),m(()=>a().acknowledged_at)&&Le(Je)})}var st=c(Ve,2);{var ot=Le=>{var nt=m3(),vt=c(o(nt));n(nt),R(xt=>y(vt,` ${xt??""}`),[()=>(kt(a()),m(()=>f(a().resolved_at)))]),g(Le,nt)};X(st,Le=>{kt(a()),m(()=>a().resolved_at)&&Le(ot)})}n(rt),n(Fe),n(z),n(w),R((Le,nt,vt,xt,M)=>{y(xe,(kt(a()),m(()=>{var H;return((H=a().hr_employees)==null?void 0:H.name)||"N/A"}))),y(ae,(kt(a()),m(()=>{var H;return((H=a().hr_employees)==null?void 0:H.employee_id)||"N/A"}))),y(Ne,(kt(a()),m(()=>a().username||"N/A"))),y(L,(kt(a()),m(()=>{var H;return((H=a().branches)==null?void 0:H.name_en)||"N/A"}))),y(B,(kt(a()),m(()=>a().warning_reference||"N/A"))),wt(I,1,`badge ${Le??""}`,"svelte-jaic27"),y(Y,nt),wt(ce,1,`severity severity-${kt(a()),m(()=>a().severity_level)??""}`,"svelte-jaic27"),y(J,(kt(a()),m(()=>a().severity_level||"medium"))),y(De,(kt(a()),m(()=>a().language_code||"en"))),y(ke,(kt(a()),m(()=>a().warning_text||"No warning text available"))),y(Ke,(kt(a()),m(()=>a().issued_by_username||"N/A"))),y(et,vt),y(Pe,xt),Xe.disabled=e(l),y(at,e(l)?"Updating...":"Update Warning"),y(_e,` ${M??""}`)},[()=>(kt(a()),m(()=>_(a().warning_type).class)),()=>(kt(a()),m(()=>_(a().warning_type).label)),()=>(kt(a()),m(()=>f(a().issued_at))),()=>(kt(a()),m(()=>f(a().updated_at))),()=>(kt(a()),m(()=>f(a().created_at)))]),Z("click",C,b),ra(oe,()=>e(d),Le=>p(d,Le)),zt(tt,()=>e(v),Le=>p(v,Le)),Z("click",Xe,x),g(t,w),ma()}var x3=k('<option class="svelte-17cfg5d"> </option>'),b3=k('<div class="error-message svelte-17cfg5d"> </div>'),w3=k('<div class="loading-section svelte-17cfg5d"><div class="loading-spinner svelte-17cfg5d"></div> <p class="svelte-17cfg5d">Loading warnings...</p></div>'),y3=k('<div class="empty-state svelte-17cfg5d"><div class="empty-icon svelte-17cfg5d">⚠️</div> <h3 class="svelte-17cfg5d">No warnings found</h3> <p class="svelte-17cfg5d">No warning records match your current filters.</p></div>'),k3=k('<span class="fine-amount svelte-17cfg5d"> </span> <span> </span>',1),T3=k('<span class="no-fine svelte-17cfg5d">No Fine</span>'),E3=k('<tr class="svelte-17cfg5d"><td class="svelte-17cfg5d"><div class="employee-info svelte-17cfg5d"><div class="employee-name svelte-17cfg5d"> </div> <div class="employee-id svelte-17cfg5d"> </div></div></td><td class="svelte-17cfg5d"><span> </span></td><td class="svelte-17cfg5d"><span> </span></td><td class="svelte-17cfg5d"><!></td><td class="svelte-17cfg5d"> </td><td class="svelte-17cfg5d"> </td><td class="svelte-17cfg5d"><button class="view-btn svelte-17cfg5d" title="View Details"><svg class="w-4 h-4 svelte-17cfg5d" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" class="svelte-17cfg5d"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" class="svelte-17cfg5d"></path></svg> View</button></td></tr>'),A3=k("<button> </button>"),S3=k('<div class="pagination svelte-17cfg5d"><button class="page-btn svelte-17cfg5d">Previous</button> <!> <button class="page-btn svelte-17cfg5d">Next</button></div>'),C3=k('<div class="table-container svelte-17cfg5d"><table class="warnings-table svelte-17cfg5d"><thead class="svelte-17cfg5d"><tr class="svelte-17cfg5d"><th class="svelte-17cfg5d">Employee</th><th class="svelte-17cfg5d">Warning Type</th><th class="svelte-17cfg5d">Status</th><th class="svelte-17cfg5d">Fine Amount</th><th class="svelte-17cfg5d">Issued Date</th><th class="svelte-17cfg5d">Branch</th><th class="svelte-17cfg5d">Actions</th></tr></thead><tbody class="svelte-17cfg5d"></tbody></table></div> <!>',1),F3=k('<div class="warning-list-view svelte-17cfg5d"><div class="header svelte-17cfg5d"><div class="title-section svelte-17cfg5d"><h1 class="title svelte-17cfg5d">Warning Records</h1> <p class="subtitle svelte-17cfg5d">Manage and track all employee warnings</p></div> <button class="refresh-btn svelte-17cfg5d"><svg class="w-4 h-4 svelte-17cfg5d" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" class="svelte-17cfg5d"></path></svg> Refresh</button></div> <div class="filters svelte-17cfg5d"><div class="search-box svelte-17cfg5d"><input type="text" placeholder="Search warnings..." class="search-input svelte-17cfg5d"/> <svg class="search-icon w-5 h-5 svelte-17cfg5d" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" class="svelte-17cfg5d"></path></svg></div> <select class="filter-select svelte-17cfg5d"><option class="svelte-17cfg5d">All Statuses</option><option class="svelte-17cfg5d">Active</option><option class="svelte-17cfg5d">Acknowledged</option><option class="svelte-17cfg5d">Resolved</option><option class="svelte-17cfg5d">Escalated</option><option class="svelte-17cfg5d">Cancelled</option></select> <select class="filter-select svelte-17cfg5d"><option class="svelte-17cfg5d">All Branches</option><!></select></div> <!> <!></div>');function D3(t,r){pa(r,!1);const a=Q();let s=Q([]),i=Q(!0),l=Q(null),d=Q(""),v=Q("all"),u=Q("all"),f=Q([]),h=Q(1),_=10,x=Q(0);Aa(()=>{T(),b()});async function T(){try{const{data:ce,error:J}=await Tt.from("branches").select("id, name_en").order("name_en");if(J)throw J;p(f,ce||[])}catch(ce){console.error("Error loading branches:",ce)}}async function b(){try{p(i,!0),p(l,null);let ce=Tt.from("employee_warnings").select(`
					*,
					users!user_id(username),
					hr_employees(name, employee_id),
					branches!branch_id(name_en)
				`).eq("is_deleted",!1);e(v)!=="all"&&(ce=ce.eq("warning_status",e(v))),e(u)!=="all"&&(ce=ce.eq("branch_id",e(u))),e(d)&&(ce=ce.or(`warning_text.ilike.%${e(d)}%,username.ilike.%${e(d)}%`));let J=Tt.from("employee_warnings").select("id",{count:"exact",head:!0}).eq("is_deleted",!1);e(v)!=="all"&&(J=J.eq("warning_status",e(v))),e(u)!=="all"&&(J=J.eq("branch_id",e(u))),e(d)&&(J=J.or(`warning_text.ilike.%${e(d)}%,username.ilike.%${e(d)}%`));const{count:le}=await J;p(x,le||0);const{data:S,error:De}=await ce.order("issued_at",{ascending:!1}).range((e(h)-1)*_,e(h)*_-1);if(De)throw De;p(s,S||[])}catch(ce){console.error("Error loading warnings:",ce),p(l,ce.message)}finally{p(i,!1)}}function w(ce){const J={active:{class:"bg-yellow-100 text-yellow-800",label:"Active"},acknowledged:{class:"bg-blue-100 text-blue-800",label:"Acknowledged"},resolved:{class:"bg-green-100 text-green-800",label:"Resolved"},escalated:{class:"bg-red-100 text-red-800",label:"Escalated"},cancelled:{class:"bg-gray-100 text-gray-800",label:"Cancelled"}};return J[ce]||J.active}function A(ce){return{overall_performance_no_fine:{class:"bg-blue-100 text-blue-800",label:"Performance"},overall_performance_fine_threat:{class:"bg-orange-100 text-orange-800",label:"Performance + Threat"},overall_performance_with_fine:{class:"bg-red-100 text-red-800",label:"Performance + Fine"}}[ce]||{class:"bg-gray-100 text-gray-800",label:"Unknown"}}function C(ce,J=""){return ce?`${parseFloat(ce).toFixed(2)}`:"-"}function z(ce){return ce?new Date(ce).toLocaleDateString("en-GB"):"-"}function F(ce){var le;const J=`warning-details-${ce.id}`;Kt.openWindow({id:J,title:`Warning Details - ${((le=ce.hr_employees)==null?void 0:le.name)||ce.username}`,component:g3,props:{warning:ce},icon:"⚠️",size:{width:800,height:700},position:{x:100+Math.random()*200,y:50+Math.random()*100},resizable:!0,minimizable:!0,maximizable:!0,closable:!0})}function re(){p(h,1),b()}function me(){p(h,1),b()}function ue(){p(h,1),b()}function D(ce){p(h,ce),b()}Nt(()=>e(x),()=>{p(a,Math.ceil(e(x)/_))}),Va(),ha();var E=F3(),he=o(E),xe=c(o(he),2);n(he);var K=c(he,2),q=o(K),ae=o(q);At(ae),Et(2),n(q);var Me=c(q,2);R(()=>{e(v),Xt(()=>{})});var ge=o(Me);ge.value=ge.__value="all";var Ne=c(ge);Ne.value=Ne.__value="active";var Be=c(Ne);Be.value=Be.__value="acknowledged";var be=c(Be);be.value=be.__value="resolved";var L=c(be);L.value=L.__value="escalated";var Te=c(L);Te.value=Te.__value="cancelled",n(Me);var ye=c(Me,2);R(()=>{e(u),Xt(()=>{e(f)})});var P=o(ye);P.value=P.__value="all";var pe=c(P);Mt(pe,1,()=>e(f),Lt,(ce,J)=>{var le=x3(),S=o(le,!0);n(le);var De={};R(()=>{y(S,(e(J),m(()=>e(J).name_en))),De!==(De=(e(J),m(()=>e(J).id)))&&(le.value=(le.__value=(e(J),m(()=>e(J).id)))??"")}),g(ce,le)}),n(ye),n(K);var B=c(K,2);{var j=ce=>{var J=b3(),le=o(J);n(J),R(()=>y(le,`Error: ${e(l)??""}`)),g(ce,J)};X(B,ce=>{e(l)&&ce(j)})}var I=c(B,2);{var Y=ce=>{var J=w3();g(ce,J)},fe=ce=>{var J=Ca(),le=Bt(J);{var S=Ue=>{var We=y3();g(Ue,We)},De=Ue=>{var We=C3(),ke=Bt(We),N=o(ke),V=c(o(N));Mt(V,5,()=>e(s),Lt,(ve,Ie)=>{var Ye=E3(),oe=o(Ye),se=o(oe),U=o(se),W=o(U,!0);n(U);var ee=c(U,2),we=o(ee,!0);n(ee),n(se),n(oe);var Ae=c(oe),He=o(Ae),Ke=o(He,!0);n(He),n(Ae);var Oe=c(Ae),Ee=o(Oe),et=o(Ee,!0);n(Ee),n(Oe);var dt=c(Oe),ut=o(dt);{var Pe=Ce=>{var _e=k3(),Ve=Bt(_e),Je=o(Ve,!0);n(Ve);var st=c(Ve,2),ot=o(st);n(st),R(Le=>{y(Je,Le),wt(st,1,`fine-status ${e(Ie),m(()=>e(Ie).fine_status)??""}`,"svelte-17cfg5d"),y(ot,`(${e(Ie),m(()=>e(Ie).fine_status)??""})`)},[()=>(e(Ie),m(()=>C(e(Ie).fine_amount,e(Ie).fine_currency)))]),g(Ce,_e)},qe=Ce=>{var _e=T3();g(Ce,_e)};X(ut,Ce=>{e(Ie),m(()=>e(Ie).has_fine)?Ce(Pe):Ce(qe,!1)})}n(dt);var tt=c(dt),lt=o(tt,!0);n(tt);var Xe=c(tt),at=o(Xe,!0);n(Xe);var Fe=c(Xe),rt=o(Fe);n(Fe),n(Ye),R((Ce,_e,Ve,Je,st)=>{y(W,(e(Ie),m(()=>{var ot;return((ot=e(Ie).hr_employees)==null?void 0:ot.name)||e(Ie).username||"Unknown"}))),y(we,(e(Ie),m(()=>{var ot,Le;return((ot=e(Ie).hr_employees)==null?void 0:ot.employee_id)||((Le=e(Ie).users)==null?void 0:Le.username)||"-"}))),wt(He,1,`badge ${Ce??""}`,"svelte-17cfg5d"),y(Ke,_e),wt(Ee,1,`badge ${Ve??""}`,"svelte-17cfg5d"),y(et,Je),y(lt,st),y(at,(e(Ie),m(()=>{var ot;return((ot=e(Ie).branches)==null?void 0:ot.name_en)||"-"})))},[()=>(e(Ie),m(()=>A(e(Ie).warning_type).class)),()=>(e(Ie),m(()=>A(e(Ie).warning_type).label)),()=>(e(Ie),m(()=>w(e(Ie).warning_status).class)),()=>(e(Ie),m(()=>w(e(Ie).warning_status).label)),()=>(e(Ie),m(()=>z(e(Ie).issued_at)))]),Z("click",rt,()=>F(e(Ie))),g(ve,Ye)}),n(V),n(N),n(ke);var G=c(ke,2);{var de=ve=>{var Ie=S3(),Ye=o(Ie),oe=c(Ye,2);Mt(oe,1,()=>(e(a),m(()=>Array.from({length:e(a)},(U,W)=>W+1))),Lt,(U,W)=>{var ee=A3(),we=o(ee,!0);n(ee),R(()=>{wt(ee,1,`page-btn ${e(W)===e(h)?"active":""}`,"svelte-17cfg5d"),y(we,e(W))}),Z("click",ee,()=>D(e(W))),g(U,ee)});var se=c(oe,2);n(Ie),R(()=>{Ye.disabled=e(h)===1,se.disabled=e(h)===e(a)}),Z("click",Ye,()=>D(e(h)-1)),Z("click",se,()=>D(e(h)+1)),g(ve,Ie)};X(G,ve=>{e(a)>1&&ve(de)})}g(Ue,We)};X(le,Ue=>{e(s),m(()=>e(s).length===0)?Ue(S):Ue(De,!1)},!0)}g(ce,J)};X(I,ce=>{e(i)?ce(Y):ce(fe,!1)})}n(E),R(()=>xe.disabled=e(i)),Z("click",xe,b),zt(ae,()=>e(d),ce=>p(d,ce)),Z("input",ae,re),ra(Me,()=>e(v),ce=>p(v,ce)),Z("change",Me,me),ra(ye,()=>e(u),ce=>p(u,ce)),Z("change",ye,ue),g(t,E),ma()}var M3=k('<option class="svelte-14dso1f"> </option>'),I3=k('<div class="error-message svelte-14dso1f"> </div>'),R3=k('<div class="loading-section svelte-14dso1f"><div class="loading-spinner svelte-14dso1f"></div> <p class="svelte-14dso1f">Loading statistics...</p></div>'),N3=k('<div class="stat-item svelte-14dso1f"><span> </span> <div class="stat-values svelte-14dso1f"><span class="count svelte-14dso1f"> </span> <span class="percentage svelte-14dso1f"> </span></div></div>'),P3=k('<div class="stat-item svelte-14dso1f"><span class="type-label svelte-14dso1f"> </span> <div class="stat-values svelte-14dso1f"><span class="count svelte-14dso1f"> </span> <span class="percentage svelte-14dso1f"> </span></div></div>'),L3=k('<div class="stat-item svelte-14dso1f"><span class="branch-label svelte-14dso1f"> </span> <div class="stat-values svelte-14dso1f"><span class="count svelte-14dso1f"> </span> <span class="percentage svelte-14dso1f"> </span></div></div>'),O3=k('<div class="trend-bar svelte-14dso1f"><div class="bar-container svelte-14dso1f"><div class="bar warnings-bar svelte-14dso1f"></div> <div class="bar fines-bar svelte-14dso1f"></div></div> <div class="day-label svelte-14dso1f"> </div> <div class="day-values svelte-14dso1f"><span class="warnings-count svelte-14dso1f"> </span> <span class="fines-count svelte-14dso1f"> </span></div></div>'),z3=k('<div class="stats-grid svelte-14dso1f"><div class="stat-card svelte-14dso1f"><h3 class="card-title svelte-14dso1f"><span class="icon svelte-14dso1f">📊</span> Warnings by Status</h3> <div class="stat-list svelte-14dso1f"></div></div> <div class="stat-card svelte-14dso1f"><h3 class="card-title svelte-14dso1f"><span class="icon svelte-14dso1f">📋</span> Warnings by Type</h3> <div class="stat-list svelte-14dso1f"></div></div> <div class="stat-card svelte-14dso1f"><h3 class="card-title svelte-14dso1f"><span class="icon svelte-14dso1f">🏢</span> Warnings by Branch</h3> <div class="stat-list svelte-14dso1f"></div></div> <div class="stat-card svelte-14dso1f"><h3 class="card-title svelte-14dso1f"><span class="icon svelte-14dso1f">💰</span> Fine Statistics</h3> <div class="fine-stats svelte-14dso1f"><div class="fine-row svelte-14dso1f"><span class="label svelte-14dso1f">Total Fines:</span> <span class="value svelte-14dso1f"> </span></div> <div class="fine-row svelte-14dso1f"><span class="label svelte-14dso1f">Total Amount:</span> <span class="value svelte-14dso1f"> </span></div> <div class="fine-row svelte-14dso1f"><span class="label svelte-14dso1f">Paid:</span> <span class="value text-green-600 svelte-14dso1f"> </span></div> <div class="fine-row svelte-14dso1f"><span class="label svelte-14dso1f">Pending:</span> <span class="value text-red-600 svelte-14dso1f"> </span></div> <div class="fine-row svelte-14dso1f"><span class="label svelte-14dso1f">Collection Rate:</span> <span class="value font-bold svelte-14dso1f"> </span></div></div></div></div> <div class="trends-section svelte-14dso1f"><h3 class="section-title svelte-14dso1f"><span class="icon svelte-14dso1f">📈</span> 7-Day Trend</h3> <div class="trend-chart svelte-14dso1f"></div> <div class="chart-legend svelte-14dso1f"><div class="legend-item svelte-14dso1f"><div class="legend-color warnings-color svelte-14dso1f"></div> <span class="svelte-14dso1f">Warnings</span></div> <div class="legend-item svelte-14dso1f"><div class="legend-color fines-color svelte-14dso1f"></div> <span class="svelte-14dso1f">Fines</span></div></div></div>',1),B3=k('<div class="warning-statistics svelte-14dso1f"><div class="header svelte-14dso1f"><div class="title-section svelte-14dso1f"><h1 class="title svelte-14dso1f">Warning Statistics & Reports</h1> <p class="subtitle svelte-14dso1f">Analyze warning trends and generate reports</p></div> <div class="header-actions svelte-14dso1f"><button class="export-btn svelte-14dso1f"><svg class="w-4 h-4 svelte-14dso1f" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" class="svelte-14dso1f"></path></svg> Export Report</button> <button class="refresh-btn svelte-14dso1f"><svg class="w-4 h-4 svelte-14dso1f" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" class="svelte-14dso1f"></path></svg> Refresh</button></div></div> <div class="filters svelte-14dso1f"><select class="filter-select svelte-14dso1f"><option class="svelte-14dso1f">Last 7 days</option><option class="svelte-14dso1f">Last 30 days</option><option class="svelte-14dso1f">Last 3 months</option><option class="svelte-14dso1f">Last year</option></select> <select class="filter-select svelte-14dso1f"><option class="svelte-14dso1f">All Branches</option><!></select></div> <!> <!></div>');function $3(t,r){pa(r,!1);let a=Q(!0),s=Q(null),i=Q({byStatus:[],byType:[],byBranch:[],fineStats:{},trends:[]}),l=Q("30"),d=Q("all"),v=Q([]);Aa(()=>{u(),f()});async function u(){try{const{data:be,error:L}=await Tt.from("branches").select("id, name_en").order("name_en");if(L)throw L;p(v,be||[])}catch(be){console.error("Error loading branches:",be)}}async function f(){try{p(a,!0),p(s,null);const be=new Date,L=new Date;L.setDate(L.getDate()-parseInt(e(l)));let Te=Tt.from("employee_warnings").select(`
					*,
					branches!branch_id(name_en)
				`).eq("is_deleted",!1).gte("issued_at",L.toISOString()).lte("issued_at",be.toISOString());e(d)!=="all"&&(Te=Te.eq("branch_id",e(d)));const{data:ye,error:P}=await Te;if(P)throw P;h(ye||[])}catch(be){console.error("Error loading statistics:",be),p(s,be.message)}finally{p(a,!1)}}function h(be){const L={};be.forEach(Y=>{L[Y.warning_status]=(L[Y.warning_status]||0)+1}),$e(i,e(i).byStatus=Object.entries(L).map(([Y,fe])=>({status:Y,count:fe,percentage:(fe/be.length*100).toFixed(1)})));const Te={};be.forEach(Y=>{Te[Y.warning_type]=(Te[Y.warning_type]||0)+1}),$e(i,e(i).byType=Object.entries(Te).map(([Y,fe])=>({type:_(Y),count:fe,percentage:(fe/be.length*100).toFixed(1)})));const ye={};be.forEach(Y=>{var ce;const fe=((ce=Y.branches)==null?void 0:ce.name_en)||"Unknown";ye[fe]=(ye[fe]||0)+1}),$e(i,e(i).byBranch=Object.entries(ye).map(([Y,fe])=>({branch:Y,count:fe,percentage:(fe/be.length*100).toFixed(1)})));const P=be.filter(Y=>Y.has_fine),pe=P.reduce((Y,fe)=>Y+(parseFloat(fe.fine_amount)||0),0),B=P.filter(Y=>Y.fine_status==="paid"),j=B.reduce((Y,fe)=>Y+(parseFloat(fe.fine_amount)||0),0);$e(i,e(i).fineStats={totalFines:P.length,totalAmount:pe,paidFines:B.length,paidAmount:j,pendingFines:P.filter(Y=>Y.fine_status==="pending").length,pendingAmount:pe-j,collectionRate:P.length>0?(B.length/P.length*100).toFixed(1):0});const I=[];for(let Y=6;Y>=0;Y--){const fe=new Date;fe.setDate(fe.getDate()-Y);const ce=fe.toISOString().split("T")[0],J=be.filter(le=>le.issued_at.split("T")[0]===ce);I.push({date:ce,count:J.length,fines:J.filter(le=>le.has_fine).length})}$e(i,e(i).trends=I)}function _(be){return{overall_performance_no_fine:"Performance Warning",overall_performance_fine_threat:"Performance + Fine Threat",overall_performance_with_fine:"Performance + Fine"}[be]||be}function x(be){const L={active:"text-yellow-600 bg-yellow-100",acknowledged:"text-blue-600 bg-blue-100",resolved:"text-green-600 bg-green-100",escalated:"text-red-600 bg-red-100",cancelled:"text-gray-600 bg-gray-100"};return L[be]||L.active}function T(){f()}function b(){const L=[["Status","Count","Percentage"],...e(i).byStatus.map(pe=>[pe.status,pe.count,pe.percentage+"%"])].map(pe=>pe.join(",")).join(`
`),Te=new Blob([L],{type:"text/csv"}),ye=window.URL.createObjectURL(Te),P=document.createElement("a");P.href=ye,P.download=`warning-statistics-${new Date().toISOString().split("T")[0]}.csv`,P.click(),window.URL.revokeObjectURL(ye)}ha();var w=B3(),A=o(w),C=c(o(A),2),z=o(C),F=c(z,2);n(C),n(A);var re=c(A,2),me=o(re);R(()=>{e(l),Xt(()=>{})});var ue=o(me);ue.value=ue.__value="7";var D=c(ue);D.value=D.__value="30";var E=c(D);E.value=E.__value="90";var he=c(E);he.value=he.__value="365",n(me);var xe=c(me,2);R(()=>{e(d),Xt(()=>{e(v)})});var K=o(xe);K.value=K.__value="all";var q=c(K);Mt(q,1,()=>e(v),Lt,(be,L)=>{var Te=M3(),ye=o(Te,!0);n(Te);var P={};R(()=>{y(ye,e(L).name_en),P!==(P=e(L).id)&&(Te.value=(Te.__value=e(L).id)??"")}),g(be,Te)}),n(xe),n(re);var ae=c(re,2);{var Me=be=>{var L=I3(),Te=o(L);n(L),R(()=>y(Te,`Error: ${e(s)??""}`)),g(be,L)};X(ae,be=>{e(s)&&be(Me)})}var ge=c(ae,2);{var Ne=be=>{var L=R3();g(be,L)},Be=be=>{var L=z3(),Te=Bt(L),ye=o(Te),P=c(o(ye),2);Mt(P,5,()=>e(i).byStatus,Lt,(U,W)=>{var ee=N3(),we=o(ee),Ae=o(we,!0);n(we);var He=c(we,2),Ke=o(He),Oe=o(Ke,!0);n(Ke);var Ee=c(Ke,2),et=o(Ee);n(Ee),n(He),n(ee),R(dt=>{wt(we,1,`badge ${dt??""}`,"svelte-14dso1f"),y(Ae,e(W).status),y(Oe,e(W).count),y(et,`(${e(W).percentage??""}%)`)},[()=>x(e(W).status)]),g(U,ee)}),n(P),n(ye);var pe=c(ye,2),B=c(o(pe),2);Mt(B,5,()=>e(i).byType,Lt,(U,W)=>{var ee=P3(),we=o(ee),Ae=o(we,!0);n(we);var He=c(we,2),Ke=o(He),Oe=o(Ke,!0);n(Ke);var Ee=c(Ke,2),et=o(Ee);n(Ee),n(He),n(ee),R(()=>{y(Ae,e(W).type),y(Oe,e(W).count),y(et,`(${e(W).percentage??""}%)`)}),g(U,ee)}),n(B),n(pe);var j=c(pe,2),I=c(o(j),2);Mt(I,5,()=>e(i).byBranch,Lt,(U,W)=>{var ee=L3(),we=o(ee),Ae=o(we,!0);n(we);var He=c(we,2),Ke=o(He),Oe=o(Ke,!0);n(Ke);var Ee=c(Ke,2),et=o(Ee);n(Ee),n(He),n(ee),R(()=>{y(Ae,e(W).branch),y(Oe,e(W).count),y(et,`(${e(W).percentage??""}%)`)}),g(U,ee)}),n(I),n(j);var Y=c(j,2),fe=c(o(Y),2),ce=o(fe),J=c(o(ce),2),le=o(J,!0);n(J),n(ce);var S=c(ce,2),De=c(o(S),2),Ue=o(De,!0);n(De),n(S);var We=c(S,2),ke=c(o(We),2),N=o(ke);n(ke),n(We);var V=c(We,2),G=c(o(V),2),de=o(G);n(G),n(V);var ve=c(V,2),Ie=c(o(ve),2),Ye=o(Ie);n(Ie),n(ve),n(fe),n(Y),n(Te);var oe=c(Te,2),se=c(o(oe),2);Mt(se,5,()=>e(i).trends,Lt,(U,W)=>{var ee=O3(),we=o(ee),Ae=o(we),He=c(Ae,2);n(we);var Ke=c(we,2),Oe=o(Ke,!0);n(Ke);var Ee=c(Ke,2),et=o(Ee),dt=o(et,!0);n(et);var ut=c(et,2),Pe=o(ut,!0);n(ut),n(Ee),n(ee),R((qe,tt,lt)=>{$r(Ae,`height: ${qe??""}px`),na(Ae,"title",`${e(W).count??""} warnings`),$r(He,`height: ${tt??""}px`),na(He,"title",`${e(W).fines??""} fines`),y(Oe,lt),y(dt,e(W).count),y(Pe,e(W).fines)},[()=>e(W).count>0?Math.max(e(W).count*20,10):0,()=>e(W).fines>0?Math.max(e(W).fines*20,5):0,()=>new Date(e(W).date).toLocaleDateString("en-GB",{weekday:"short",day:"numeric"})]),g(U,ee)}),n(se),Et(2),n(oe),R((U,W,ee)=>{y(le,e(i).fineStats.totalFines),y(Ue,U),y(N,`${e(i).fineStats.paidFines??""} (${W??""})`),y(de,`${e(i).fineStats.pendingFines??""} (${ee??""})`),y(Ye,`${e(i).fineStats.collectionRate??""}%`)},[()=>{var U;return((U=e(i).fineStats.totalAmount)==null?void 0:U.toFixed(2))||"0.00"},()=>{var U;return((U=e(i).fineStats.paidAmount)==null?void 0:U.toFixed(2))||"0.00"},()=>{var U;return((U=e(i).fineStats.pendingAmount)==null?void 0:U.toFixed(2))||"0.00"}]),g(be,L)};X(ge,be=>{e(a)?be(Ne):be(Be,!1)})}n(w),R(()=>F.disabled=e(a)),Z("click",z,b),Z("click",F,f),ra(me,()=>e(l),be=>p(l,be)),Z("change",me,T),ra(xe,()=>e(d),be=>p(d,be)),Z("change",xe,T),g(t,w),ma()}var U3=k('<option class="svelte-ddwnwk"> </option>'),q3=k('<div class="error-message svelte-ddwnwk"> </div>'),j3=k('<div class="loading-section svelte-ddwnwk"><div class="loading-spinner svelte-ddwnwk"></div> <p class="svelte-ddwnwk">Loading active fines...</p></div>'),W3=k('<span class="overdue-badge svelte-ddwnwk"> </span>'),H3=k('<tr class="fine-row svelte-ddwnwk"><td class="employee-cell svelte-ddwnwk"><div class="employee-info svelte-ddwnwk"><div class="employee-name svelte-ddwnwk"> </div> <div class="employee-id svelte-ddwnwk"> </div></div></td><td class="svelte-ddwnwk"> </td><td class="svelte-ddwnwk"> </td><td class="amount-cell svelte-ddwnwk"> </td><td class="svelte-ddwnwk"><span> </span> <!></td><td class="svelte-ddwnwk"> </td><td class="actions-cell svelte-ddwnwk"><button class="action-btn view-btn svelte-ddwnwk" title="View Warning Details"><svg class="w-4 h-4 svelte-ddwnwk" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" class="svelte-ddwnwk"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" class="svelte-ddwnwk"></path></svg></button> <button class="action-btn payment-btn svelte-ddwnwk" title="Record Payment"><svg class="w-4 h-4 svelte-ddwnwk" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z" class="svelte-ddwnwk"></path></svg></button></td></tr>'),V3=k('<div class="no-data svelte-ddwnwk"><svg class="w-12 h-12 text-gray-400 svelte-ddwnwk" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" class="svelte-ddwnwk"></path></svg> <p class="svelte-ddwnwk">No active fines found</p></div>'),G3=k("<button></button>"),X3=k('<div class="pagination svelte-ddwnwk"><button class="pagination-btn svelte-ddwnwk">Previous</button> <!> <button class="pagination-btn svelte-ddwnwk">Next</button></div>'),Y3=k('<div class="summary-stats svelte-ddwnwk"><div class="stat-card svelte-ddwnwk"><h3 class="svelte-ddwnwk">Total Active Fines</h3> <p class="stat-value svelte-ddwnwk"> </p></div> <div class="stat-card svelte-ddwnwk"><h3 class="svelte-ddwnwk">Total Amount</h3> <p class="stat-value svelte-ddwnwk"> </p></div> <div class="stat-card svelte-ddwnwk"><h3 class="svelte-ddwnwk">Overdue Fines</h3> <p class="stat-value text-red-600 svelte-ddwnwk"> </p></div></div> <div class="table-container svelte-ddwnwk"><table class="fines-table svelte-ddwnwk"><thead class="svelte-ddwnwk"><tr class="svelte-ddwnwk"><th class="svelte-ddwnwk">Employee</th><th class="svelte-ddwnwk">Branch</th><th class="svelte-ddwnwk">Warning Date</th><th class="svelte-ddwnwk">Fine Amount</th><th class="svelte-ddwnwk">Status</th><th class="svelte-ddwnwk">Days Outstanding</th><th class="svelte-ddwnwk">Actions</th></tr></thead><tbody class="svelte-ddwnwk"></tbody></table> <!></div> <!>',1),K3=k('<div class="modal-overlay svelte-ddwnwk"><div class="modal-content svelte-ddwnwk"><div class="modal-header svelte-ddwnwk"><h2 class="svelte-ddwnwk">Record Fine Payment</h2> <button class="close-btn svelte-ddwnwk"><svg class="w-6 h-6 svelte-ddwnwk" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" class="svelte-ddwnwk"></path></svg></button></div> <div class="modal-body svelte-ddwnwk"><div class="fine-details svelte-ddwnwk"><h3 class="svelte-ddwnwk">Fine Details</h3> <p class="svelte-ddwnwk"><strong class="svelte-ddwnwk">Employee:</strong> </p> <p class="svelte-ddwnwk"><strong class="svelte-ddwnwk">Employee ID:</strong> </p> <p class="svelte-ddwnwk"><strong class="svelte-ddwnwk">Fine Amount:</strong> </p> <p class="svelte-ddwnwk"><strong class="svelte-ddwnwk">Issued Date:</strong> </p></div> <div class="payment-form svelte-ddwnwk"><div class="form-group svelte-ddwnwk"><label for="payment-amount" class="svelte-ddwnwk">Payment Amount</label> <input id="payment-amount" type="number" step="0.01" min="0" class="form-input svelte-ddwnwk" placeholder="Enter payment amount"/></div> <div class="form-group svelte-ddwnwk"><label for="payment-note" class="svelte-ddwnwk">Payment Note (Optional)</label> <textarea id="payment-note" class="form-textarea svelte-ddwnwk" placeholder="Add any notes about the payment..." rows="3"></textarea></div></div></div> <div class="modal-footer svelte-ddwnwk"><button class="cancel-btn svelte-ddwnwk">Cancel</button> <button class="confirm-btn svelte-ddwnwk"><!></button></div></div></div>'),Q3=k('<div class="active-fines svelte-ddwnwk"><div class="header svelte-ddwnwk"><div class="title-section svelte-ddwnwk"><h1 class="title svelte-ddwnwk">Active Fines Management</h1> <p class="subtitle svelte-ddwnwk">Track and manage pending fine payments</p></div> <div class="header-actions svelte-ddwnwk"><button class="refresh-btn svelte-ddwnwk"><svg class="w-4 h-4 svelte-ddwnwk" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" class="svelte-ddwnwk"></path></svg> Refresh</button></div></div> <div class="filters svelte-ddwnwk"><div class="search-box svelte-ddwnwk"><svg class="search-icon svelte-ddwnwk" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" class="svelte-ddwnwk"></path></svg> <input type="text" placeholder="Search by employee ID, name, or branch..." class="search-input svelte-ddwnwk"/></div> <select class="filter-select svelte-ddwnwk"><option class="svelte-ddwnwk">All Branches</option><!></select> <select class="filter-select svelte-ddwnwk"><option class="svelte-ddwnwk">All Statuses</option><option class="svelte-ddwnwk">Pending</option><option class="svelte-ddwnwk">Overdue</option><option class="svelte-ddwnwk">Partial Payment</option></select> <select class="filter-select svelte-ddwnwk"><option class="svelte-ddwnwk">Amount (High to Low)</option><option class="svelte-ddwnwk">Amount (Low to High)</option><option class="svelte-ddwnwk">Date (Newest)</option><option class="svelte-ddwnwk">Date (Oldest)</option><option class="svelte-ddwnwk">Employee Name</option></select></div> <!> <!></div> <!>',1);function Z3(t,r){pa(r,!1);let a=Q(!0),s=Q(null),i=[],l=Q([]),d=Q(""),v=Q("all"),u=Q("all"),f=Q("amount_desc"),h=Q([]),_=Q(1),x=10,T=0,b=Q(!1),w=Q(null),A=Q(""),C=Q(""),z=Q(!1);Aa(()=>{F(),re()});async function F(){try{const{data:W,error:ee}=await Tt.from("branches").select("id, name_en").order("name_en");if(ee)throw ee;p(h,W||[])}catch(W){console.error("Error loading branches:",W)}}async function re(){try{p(a,!0),p(s,null);let W=Tt.from("employee_warnings").select(`
					*,
					branches!branch_id(name_en),
					hr_employees(name, employee_id)
				`).eq("has_fine",!0).eq("is_deleted",!1).neq("fine_status","paid");e(v)!=="all"&&(W=W.eq("branch_id",e(v))),e(u)!=="all"&&(W=W.eq("fine_status",e(u)));const{data:ee,error:we}=await W.order("issued_at",{ascending:!1});if(we)throw we;i=ee||[],me()}catch(W){console.error("Error loading active fines:",W),p(s,W.message)}finally{p(a,!1)}}function me(){let W=[...i];if(e(d).trim()){const ee=e(d).toLowerCase();W=W.filter(we=>{var Ae,He,Ke,Oe,Ee,et;return((He=(Ae=we.hr_employees)==null?void 0:Ae.employee_id)==null?void 0:He.toLowerCase().includes(ee))||((Oe=(Ke=we.hr_employees)==null?void 0:Ke.name)==null?void 0:Oe.toLowerCase().includes(ee))||((et=(Ee=we.branches)==null?void 0:Ee.name_en)==null?void 0:et.toLowerCase().includes(ee))})}W.sort((ee,we)=>{var Ae,He;switch(e(f)){case"amount_desc":return parseFloat(we.fine_amount||0)-parseFloat(ee.fine_amount||0);case"amount_asc":return parseFloat(ee.fine_amount||0)-parseFloat(we.fine_amount||0);case"date_desc":return new Date(we.issued_at).getTime()-new Date(ee.issued_at).getTime();case"date_asc":return new Date(ee.issued_at).getTime()-new Date(we.issued_at).getTime();case"employee":const Ke=((Ae=ee.hr_employees)==null?void 0:Ae.name)||"",Oe=((He=we.hr_employees)==null?void 0:He.name)||"";return Ke.localeCompare(Oe);default:return 0}}),p(l,W),T=W.length,p(_,1)}function ue(){const W=(e(_)-1)*x,ee=W+x;return e(l).slice(W,ee)}function D(){return Math.ceil(T/x)}function E(W){W>=1&&W<=D()&&p(_,W)}function he(){me()}function xe(W){p(w,W),p(A,W.fine_amount),p(C,""),p(b,!0)}function K(){p(b,!1),p(w,null),p(A,""),p(C,""),p(z,!1)}async function q(){if(!(!e(w)||!e(A)))try{p(z,!0);const{error:W}=await Tt.from("employee_warnings").update({fine_status:"paid",fine_paid_amount:parseFloat(e(A)),fine_paid_at:new Date().toISOString(),fine_payment_note:e(C)||null,warning_status:"resolved",updated_at:new Date().toISOString()}).eq("id",e(w).id);if(W)throw W;await re(),K()}catch(W){console.error("Error processing payment:",W),alert("Error processing payment: "+W.message)}finally{p(z,!1)}}function ae(W){var we;const ee=`warning-details-${Date.now()}`;Kt.openWindow({id:ee,title:`Warning Details - ${((we=W.hr_employees)==null?void 0:we.employee_id)||"Unknown"}`,component:null,icon:"⚠️",size:{width:800,height:600},position:{x:100,y:100},resizable:!0,minimizable:!0,maximizable:!0,closable:!0})}function Me(W){return new Intl.NumberFormat("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}).format(parseFloat(W)||0)}function ge(W){return new Date(W).toLocaleDateString("en-GB",{day:"2-digit",month:"2-digit",year:"numeric"})}function Ne(W){const ee={pending:"text-yellow-700 bg-yellow-100 border-yellow-200",overdue:"text-red-700 bg-red-100 border-red-200",partial:"text-blue-700 bg-blue-100 border-blue-200"};return ee[W]||ee.pending}function Be(W){const ee=new Date(W),Ae=new Date().getTime()-ee.getTime(),He=Math.floor(Ae/(1e3*60*60*24));return He>30?He-30:0}Nt(()=>(e(d),e(v),e(u),e(f)),()=>{(e(d)!==void 0||e(v)!==void 0||e(u)!==void 0||e(f)!==void 0)&&me()}),Va(),ha();var be=Q3(),L=Bt(be),Te=o(L),ye=c(o(Te),2),P=o(ye);n(ye),n(Te);var pe=c(Te,2),B=o(pe),j=c(o(B),2);At(j),n(B);var I=c(B,2);R(()=>{e(v),Xt(()=>{e(h)})});var Y=o(I);Y.value=Y.__value="all";var fe=c(Y);Mt(fe,1,()=>e(h),Lt,(W,ee)=>{var we=U3(),Ae=o(we,!0);n(we);var He={};R(()=>{y(Ae,(e(ee),m(()=>e(ee).name_en))),He!==(He=(e(ee),m(()=>e(ee).id)))&&(we.value=(we.__value=(e(ee),m(()=>e(ee).id)))??"")}),g(W,we)}),n(I);var ce=c(I,2);R(()=>{e(u),Xt(()=>{})});var J=o(ce);J.value=J.__value="all";var le=c(J);le.value=le.__value="pending";var S=c(le);S.value=S.__value="overdue";var De=c(S);De.value=De.__value="partial",n(ce);var Ue=c(ce,2);R(()=>{e(f),Xt(()=>{})});var We=o(Ue);We.value=We.__value="amount_desc";var ke=c(We);ke.value=ke.__value="amount_asc";var N=c(ke);N.value=N.__value="date_desc";var V=c(N);V.value=V.__value="date_asc";var G=c(V);G.value=G.__value="employee",n(Ue),n(pe);var de=c(pe,2);{var ve=W=>{var ee=q3(),we=o(ee);n(ee),R(()=>y(we,`Error: ${e(s)??""}`)),g(W,ee)};X(de,W=>{e(s)&&W(ve)})}var Ie=c(de,2);{var Ye=W=>{var ee=j3();g(W,ee)},oe=W=>{var ee=Y3(),we=Bt(ee),Ae=o(we),He=c(o(Ae),2),Ke=o(He,!0);n(He),n(Ae);var Oe=c(Ae,2),Ee=c(o(Oe),2),et=o(Ee,!0);n(Ee),n(Oe);var dt=c(Oe,2),ut=c(o(dt),2),Pe=o(ut,!0);n(ut),n(dt),n(we);var qe=c(we,2),tt=o(qe),lt=c(o(tt));Mt(lt,5,()=>m(ue),Lt,(Ce,_e)=>{var Ve=H3(),Je=o(Ve),st=o(Je),ot=o(st),Le=o(ot,!0);n(ot);var nt=c(ot,2),vt=o(nt);n(nt),n(st),n(Je);var xt=c(Je),M=o(xt,!0);n(xt);var H=c(xt),O=o(H,!0);n(H);var te=c(H),ne=o(te,!0);n(te);var ie=c(te),Se=o(ie),Qe=o(Se,!0);n(Se);var je=c(Se,2);{var ze=pt=>{var _t=W3(),Ge=o(_t);n(_t),R(ct=>y(Ge,`${ct??""} days overdue`),[()=>(e(_e),m(()=>Be(e(_e).issued_at)))]),g(pt,_t)};X(je,pt=>{e(_e),m(()=>Be(e(_e).issued_at)>0)&&pt(ze)})}n(ie);var Re=c(ie),it=o(Re);n(Re);var ft=c(Re),mt=o(ft),ht=c(mt,2);n(ft),n(Ve),R((pt,_t,Ge,ct)=>{y(Le,(e(_e),m(()=>{var Ze;return((Ze=e(_e).hr_employees)==null?void 0:Ze.name)||"Unknown"}))),y(vt,`ID: ${e(_e),m(()=>{var Ze;return((Ze=e(_e).hr_employees)==null?void 0:Ze.employee_id)||"N/A"})??""}`),y(M,(e(_e),m(()=>{var Ze;return((Ze=e(_e).branches)==null?void 0:Ze.name_en)||"Unknown"}))),y(O,pt),y(ne,_t),wt(Se,1,`status-badge ${Ge??""}`,"svelte-ddwnwk"),y(Qe,(e(_e),m(()=>e(_e).fine_status))),y(it,`${ct??""} days`)},[()=>(e(_e),m(()=>ge(e(_e).issued_at))),()=>(e(_e),m(()=>Me(e(_e).fine_amount))),()=>(e(_e),m(()=>Ne(e(_e).fine_status))),()=>(e(_e),m(()=>Math.floor((new Date().getTime()-new Date(e(_e).issued_at).getTime())/864e5)))]),Z("click",mt,()=>ae(e(_e))),Z("click",ht,()=>xe(e(_e))),g(Ce,Ve)}),n(lt),n(tt);var Xe=c(tt,2);{var at=Ce=>{var _e=V3();g(Ce,_e)};X(Xe,Ce=>{e(l),m(()=>e(l).length===0)&&Ce(at)})}n(qe);var Fe=c(qe,2);{var rt=Ce=>{var _e=X3(),Ve=o(_e),Je=c(Ve,2);Mt(Je,1,()=>m(()=>Array(D()).fill(0)),Lt,(ot,Le,nt)=>{var vt=G3();vt.textContent=nt+1,R(()=>wt(vt,1,`pagination-btn ${e(_)===nt+1?"active":""}`,"svelte-ddwnwk")),Z("click",vt,()=>E(nt+1)),g(ot,vt)});var st=c(Je,2);n(_e),R(ot=>{Ve.disabled=e(_)===1,st.disabled=ot},[()=>(e(_),m(()=>e(_)===D()))]),Z("click",Ve,()=>E(e(_)-1)),Z("click",st,()=>E(e(_)+1)),g(Ce,_e)};X(Fe,Ce=>{m(()=>D()>1)&&Ce(rt)})}R((Ce,_e)=>{y(Ke,(e(l),m(()=>e(l).length))),y(et,Ce),y(Pe,_e)},[()=>(e(l),m(()=>Me(e(l).reduce((Ce,_e)=>Ce+parseFloat(_e.fine_amount||0),0)))),()=>(e(l),m(()=>e(l).filter(Ce=>Be(Ce.issued_at)>0).length))]),g(W,ee)};X(Ie,W=>{e(a)?W(Ye):W(oe,!1)})}n(L);var se=c(L,2);{var U=W=>{var ee=K3(),we=o(ee),Ae=o(we),He=c(o(Ae),2);n(Ae);var Ke=c(Ae,2),Oe=o(Ke),Ee=c(o(Oe),2),et=c(o(Ee));n(Ee);var dt=c(Ee,2),ut=c(o(dt));n(dt);var Pe=c(dt,2),qe=c(o(Pe));n(Pe);var tt=c(Pe,2),lt=c(o(tt));n(tt),n(Oe);var Xe=c(Oe,2),at=o(Xe),Fe=c(o(at),2);At(Fe),n(at);var rt=c(at,2),Ce=c(o(rt),2);ks(Ce),n(rt),n(Xe),n(Ke);var _e=c(Ke,2),Ve=o(_e),Je=c(Ve,2),st=o(Je);{var ot=nt=>{var vt=Ya("Processing...");g(nt,vt)},Le=nt=>{var vt=Ya("Record Payment");g(nt,vt)};X(st,nt=>{e(z)?nt(ot):nt(Le,!1)})}n(Je),n(_e),n(we),n(ee),R((nt,vt,xt)=>{y(et,` ${e(w),m(()=>{var M;return((M=e(w).hr_employees)==null?void 0:M.name)||"Unknown"})??""}`),y(ut,` ${e(w),m(()=>{var M;return(M=e(w).hr_employees)==null?void 0:M.employee_id})??""}`),y(qe,` ${nt??""}`),y(lt,` ${vt??""}`),na(Fe,"max",(e(w),m(()=>e(w).fine_amount))),Ve.disabled=e(z),Je.disabled=xt},[()=>(e(w),m(()=>Me(e(w).fine_amount))),()=>(e(w),m(()=>ge(e(w).issued_at))),()=>(e(z),e(A),m(()=>e(z)||!e(A)||parseFloat(e(A))<=0))]),Z("click",He,K),zt(Fe,()=>e(A),nt=>p(A,nt)),zt(Ce,()=>e(C),nt=>p(C,nt)),Z("click",Ve,K),Z("click",Je,q),Z("click",we,ir(function(nt){Or.call(this,r,nt)})),Z("click",ee,K),g(W,ee)};X(se,W=>{e(b)&&e(w)&&W(U)})}R(()=>P.disabled=e(a)),Z("click",P,re),zt(j,()=>e(d),W=>p(d,W)),Z("input",j,he),ra(I,()=>e(v),W=>p(v,W)),Z("change",I,he),ra(ce,()=>e(u),W=>p(u,W)),Z("change",ce,he),ra(Ue,()=>e(f),W=>p(f,W)),Z("change",Ue,he),g(t,be),ma()}var J3=k('<div class="warning-master-dashboard svelte-sbcx1c"><div class="header svelte-sbcx1c"><div class="title-section svelte-sbcx1c"><div class="flex items-center justify-center space-x-3 mb-4"><div class="bg-orange-100 p-3 rounded-lg"><svg class="w-8 h-8 text-orange-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.082 18.5c-.77.833.192 2.5 1.732 2.5z"></path></svg></div></div> <h1 class="title svelte-sbcx1c">Warning Master Dashboard</h1> <p class="subtitle svelte-sbcx1c">Employee Warning Management System</p> <button class="refresh-btn svelte-sbcx1c" title="Refresh Data"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg> Refresh</button></div></div> <div class="stats-grid svelte-sbcx1c"><div class="stat-card svelte-sbcx1c"><div class="stat-icon bg-blue-100 svelte-sbcx1c"><span class="icon text-blue-600">📋</span></div> <div class="stat-content svelte-sbcx1c"><div class="stat-value svelte-sbcx1c"> </div> <div class="stat-label svelte-sbcx1c">Total Warnings</div></div></div> <div class="stat-card svelte-sbcx1c"><div class="stat-icon bg-yellow-100 svelte-sbcx1c"><span class="icon text-yellow-600">🟡</span></div> <div class="stat-content svelte-sbcx1c"><div class="stat-value svelte-sbcx1c"> </div> <div class="stat-label svelte-sbcx1c">Active Warnings</div></div></div> <div class="stat-card svelte-sbcx1c"><div class="stat-icon bg-green-100 svelte-sbcx1c"><span class="icon text-green-600">✅</span></div> <div class="stat-content svelte-sbcx1c"><div class="stat-value svelte-sbcx1c"> </div> <div class="stat-label svelte-sbcx1c">Resolved Warnings</div></div></div> <div class="stat-card svelte-sbcx1c"><div class="stat-icon bg-red-100 svelte-sbcx1c"><span class="icon text-red-600">💰</span></div> <div class="stat-content svelte-sbcx1c"><div class="stat-value svelte-sbcx1c"> </div> <div class="stat-label svelte-sbcx1c">Total Fines</div></div></div> <div class="stat-card svelte-sbcx1c"><div class="stat-icon bg-purple-100 svelte-sbcx1c"><span class="icon text-purple-600">💵</span></div> <div class="stat-content svelte-sbcx1c"><div class="stat-value svelte-sbcx1c"> </div> <div class="stat-label svelte-sbcx1c">Total Fine Amount</div></div></div> <div class="stat-card svelte-sbcx1c"><div class="stat-icon bg-orange-100 svelte-sbcx1c"><span class="icon text-orange-600">⏳</span></div> <div class="stat-content svelte-sbcx1c"><div class="stat-value svelte-sbcx1c"> </div> <div class="stat-label svelte-sbcx1c">Pending Fines</div></div></div></div> <div class="dashboard-grid svelte-sbcx1c"><div class="dashboard-card svelte-sbcx1c"><div class="card-icon bg-blue-100 svelte-sbcx1c"><span class="icon text-blue-600">📋</span></div> <div class="card-content svelte-sbcx1c"><h3 class="card-title svelte-sbcx1c">Warning Records</h3> <p class="card-description svelte-sbcx1c">View, manage, and track all employee warnings</p></div> <div class="card-arrow svelte-sbcx1c"><span>→</span></div></div> <div class="dashboard-card svelte-sbcx1c"><div class="card-icon bg-purple-100 svelte-sbcx1c"><span class="icon text-purple-600">📊</span></div> <div class="card-content svelte-sbcx1c"><h3 class="card-title svelte-sbcx1c">Statistics & Reports</h3> <p class="card-description svelte-sbcx1c">Generate reports and analyze warning trends</p></div> <div class="card-arrow svelte-sbcx1c"><span>→</span></div></div> <div class="dashboard-card svelte-sbcx1c"><div class="card-icon bg-red-100 svelte-sbcx1c"><span class="icon text-red-600">💰</span></div> <div class="card-content svelte-sbcx1c"><h3 class="card-title svelte-sbcx1c">Fine Management</h3> <p class="card-description svelte-sbcx1c">Track and manage employee fines and payments</p></div> <div class="card-arrow svelte-sbcx1c"><span>→</span></div></div> <div class="dashboard-card svelte-sbcx1c"><div class="card-icon bg-indigo-100 svelte-sbcx1c"><span class="icon text-indigo-600">📊</span></div> <div class="card-content svelte-sbcx1c"><h3 class="card-title svelte-sbcx1c">Task Status</h3> <p class="card-description svelte-sbcx1c">Monitor task progress, send reminders, and generate warnings</p></div> <div class="card-arrow svelte-sbcx1c"><span>→</span></div></div></div> <div class="features-section svelte-sbcx1c"><div class="features-header svelte-sbcx1c"><h3 class="svelte-sbcx1c">Warning System Features</h3></div> <div class="features-grid svelte-sbcx1c"><div class="feature-item svelte-sbcx1c"><div class="feature-icon svelte-sbcx1c">⚠️</div> <div class="feature-content svelte-sbcx1c"><h4 class="svelte-sbcx1c">Performance Warnings</h4> <p class="svelte-sbcx1c">Track employee performance warnings with detailed records</p></div></div> <div class="feature-item svelte-sbcx1c"><div class="feature-icon svelte-sbcx1c">💰</div> <div class="feature-content svelte-sbcx1c"><h4 class="svelte-sbcx1c">Fine Management</h4> <p class="svelte-sbcx1c">Manage financial penalties, record payments, and generate receipts</p></div></div> <div class="feature-item svelte-sbcx1c"><div class="feature-icon svelte-sbcx1c">📊</div> <div class="feature-content svelte-sbcx1c"><h4 class="svelte-sbcx1c">Analytics & Reports</h4> <p class="svelte-sbcx1c">Generate comprehensive reports and trend analysis</p></div></div> <div class="feature-item svelte-sbcx1c"><div class="feature-icon svelte-sbcx1c">🔄</div> <div class="feature-content svelte-sbcx1c"><h4 class="svelte-sbcx1c">Status Tracking</h4> <p class="svelte-sbcx1c">Monitor warning resolution and follow-up actions</p></div></div></div></div></div>');function e5(t,r){pa(r,!1);let a=Q({total_warnings:0,active_warnings:0,resolved_warnings:0,total_fines:0,total_fine_amount:0,pending_fines:0,paid_fines:0}),s=!0;function i(ce){return`${ce}-${Date.now()}-${Math.random().toString(36).substr(2,9)}`}async function l(){try{s=!0;const{data:ce,error:J}=await Tt.from("employee_warnings").select("warning_status, has_fine, fine_amount, fine_status").eq("is_deleted",!1);if(J){console.error("Error fetching warnings:",J);return}const le={total_warnings:ce.length,active_warnings:ce.filter(S=>S.warning_status==="active").length,resolved_warnings:ce.filter(S=>S.warning_status==="resolved").length,total_fines:ce.filter(S=>S.has_fine===!0).length,total_fine_amount:ce.filter(S=>S.has_fine===!0&&S.fine_amount).reduce((S,De)=>S+(parseFloat(De.fine_amount)||0),0),pending_fines:ce.filter(S=>S.has_fine===!0&&S.fine_status==="pending").length,paid_fines:ce.filter(S=>S.has_fine===!0&&S.fine_status==="paid").length};p(a,le)}catch(ce){console.error("Error fetching warning statistics:",ce)}finally{s=!1}}Aa(()=>{l();const ce=setInterval(l,6e4);return()=>clearInterval(ce)});function d(){const ce=i("warning-list");Kt.openWindow({id:ce,title:"Warning Records",component:D3,icon:"📋",size:{width:1200,height:800},position:{x:50+Math.random()*100,y:50+Math.random()*100},resizable:!0,minimizable:!0,maximizable:!0,closable:!0})}function v(){const ce=i("warning-stats");Kt.openWindow({id:ce,title:"Warning Statistics & Reports",component:$3,icon:"📊",size:{width:1e3,height:700},position:{x:100+Math.random()*100,y:100+Math.random()*100},resizable:!0,minimizable:!0,maximizable:!0,closable:!0})}function u(){const ce=i("active-fines");Kt.openWindow({id:ce,title:"Active Fines Management",component:Z3,icon:"💰",size:{width:1100,height:750},position:{x:80+Math.random()*100,y:80+Math.random()*100},resizable:!0,minimizable:!0,maximizable:!0,closable:!0})}function f(){l()}function h(){const ce=i("task-status"),J=Math.floor(Math.random()*1e3)+1;Kt.openWindow({id:ce,title:`Task Status #${J}`,component:Xl,icon:"📊",size:{width:1200,height:800},position:{x:50+Math.random()*100,y:50+Math.random()*100},resizable:!0,minimizable:!0,maximizable:!0,closable:!0})}ha();var _=J3(),x=o(_),T=o(x),b=c(o(T),6);n(T),n(x);var w=c(x,2),A=o(w),C=c(o(A),2),z=o(C),F=o(z,!0);n(z),Et(2),n(C),n(A);var re=c(A,2),me=c(o(re),2),ue=o(me),D=o(ue,!0);n(ue),Et(2),n(me),n(re);var E=c(re,2),he=c(o(E),2),xe=o(he),K=o(xe,!0);n(xe),Et(2),n(he),n(E);var q=c(E,2),ae=c(o(q),2),Me=o(ae),ge=o(Me,!0);n(Me),Et(2),n(ae),n(q);var Ne=c(q,2),Be=c(o(Ne),2),be=o(Be),L=o(be,!0);n(be),Et(2),n(Be),n(Ne);var Te=c(Ne,2),ye=c(o(Te),2),P=o(ye),pe=o(P,!0);n(P),Et(2),n(ye),n(Te),n(w);var B=c(w,2),j=o(B),I=c(j,2),Y=c(I,2),fe=c(Y,2);n(B),Et(2),n(_),R(ce=>{y(F,e(a).total_warnings),y(D,e(a).active_warnings),y(K,e(a).resolved_warnings),y(ge,e(a).total_fines),y(L,ce),y(pe,e(a).pending_fines)},[()=>e(a).total_fine_amount.toFixed(2)]),Z("click",b,f),Z("click",j,d),Z("click",I,v),Z("click",Y,u),Z("click",fe,h),g(t,_),ma()}var t5=k('<div class="dashboard-card svelte-1iqxf2w"><div><span class="icon"> </span></div> <div class="card-content svelte-1iqxf2w"><h3 class="card-title svelte-1iqxf2w"> </h3> <p class="card-description svelte-1iqxf2w"> </p></div> <div class="card-arrow svelte-1iqxf2w"><span>→</span></div></div>'),a5=k('<div class="hr-master svelte-1iqxf2w"><div class="header svelte-1iqxf2w"><div class="title-section svelte-1iqxf2w"><h1 class="title svelte-1iqxf2w">HR Master Dashboard</h1> <p class="subtitle svelte-1iqxf2w">Complete Human Resources Management System</p></div></div> <div class="dashboard-grid svelte-1iqxf2w"></div></div>');function r5(t,r){pa(r,!1);const a=[{id:"upload-employees",title:"Upload Employees",icon:"👥",description:"Import employees from Excel file",color:"bg-green-500"},{id:"create-department",title:"Create Department",icon:"🏢",description:"Add new organizational departments",color:"bg-blue-500"},{id:"create-level",title:"Create Level",icon:"📊",description:"Define organizational hierarchy levels",color:"bg-purple-500"},{id:"create-position",title:"Create Position",icon:"💼",description:"Set up job positions and roles",color:"bg-orange-500"},{id:"reporting-map",title:"Reporting Map",icon:"📈",description:"Define reporting relationships and hierarchy",color:"bg-indigo-500"},{id:"assign-positions",title:"Assign Positions",icon:"🎯",description:"Assign positions to employees",color:"bg-teal-500"},{id:"upload-fingerprint",title:"Upload Fingerprint Transactions",icon:"👆",description:"Import fingerprint attendance data",color:"bg-red-500"},{id:"contact-management",title:"Contact Management",icon:"📞",description:"Manage employee contact information",color:"bg-yellow-500"},{id:"document-management",title:"Document Management",icon:"📄",description:"Manage employee documents and certificates",color:"bg-pink-500"},{id:"salary-management",title:"Salary & Wage Management",icon:"💰",description:"Manage employee salaries, allowances, and deductions",color:"bg-emerald-500"},{id:"warning-master",title:"Warning Master",icon:"⚠️",description:"Comprehensive warning management system",color:"bg-amber-500"}];function s(v){return`${v}-${Date.now()}-${Math.random().toString(36).substr(2,9)}`}function i(v){const u=a.find(x=>x.id===v),f=s(v),h=Math.floor(Math.random()*1e3)+1;let _;switch(v){case"upload-employees":_=Mk;break;case"create-department":_=Uk;break;case"create-level":_=Jk;break;case"create-position":_=v4;break;case"reporting-map":_=E4;break;case"assign-positions":_=U4;break;case"upload-fingerprint":_=c3;break;case"contact-management":_=A1;break;case"document-management":_=Z1;break;case"salary-management":_=yh;break;case"warning-master":_=e5;break;default:return}Kt.openWindow({id:f,title:`${u.title} #${h}`,component:_,icon:u.icon,size:{width:1e3,height:700},position:{x:50+Math.random()*100,y:50+Math.random()*100},resizable:!0,minimizable:!0,maximizable:!0,closable:!0})}ha();var l=a5(),d=c(o(l),2);Mt(d,5,()=>a,Lt,(v,u)=>{var f=t5(),h=o(f),_=o(h),x=o(_,!0);n(_),n(h);var T=c(h,2),b=o(T),w=o(b,!0);n(b);var A=c(b,2),C=o(A,!0);n(A),n(T),Et(2),n(f),R(()=>{wt(h,1,`card-icon ${e(u).color??""}`,"svelte-1iqxf2w"),y(x,e(u).icon),y(w,e(u).title),y(C,e(u).description)}),Z("click",f,()=>i(e(u).id)),g(v,f)}),n(d),n(l),g(t,l),ma()}var s5=k('<div class="p-6 bg-white h-full"><h2 class="text-2xl font-bold text-gray-800 mb-6">Vendor Master</h2></div>');function i5(t){var r=s5();g(t,r)}class n5{async getAllUsers(){const{data:r,error:a}=await Tt.from("user_management_view").select("*").order("created_at",{ascending:!1});if(a)throw console.error("Error fetching users:",a),new Error("Failed to fetch users");return r||[]}async getUserById(r){const{data:a,error:s}=await Tt.from("user_management_view").select("*").eq("id",r).single();if(s){if(s.code==="PGRST116")return null;throw console.error("Error fetching user:",s),new Error("Failed to fetch user")}return a}async createUser(r){try{const{data:a,error:s}=await Tt.rpc("create_user",{p_username:r.username,p_password:r.password,p_role_type:r.roleType,p_user_type:r.userType,p_branch_id:r.branchId||null,p_employee_id:r.employeeId||null,p_position_id:r.positionId||null,p_quick_access_code:r.quickAccessCode||null});if(s)throw console.error("Error creating user:",s),new Error(s.message||"Failed to create user");if(a&&a.success)return{success:!0,user:a,quickAccessCode:a.quick_access_code};throw new Error("User creation failed")}catch(a){throw console.error("Create user error:",a),a}}async updateUser(r,a){try{const{error:s}=await Tt.from("users").update(a).eq("id",r);if(s)throw console.error("Error updating user:",s),new Error("Failed to update user");return!0}catch(s){throw console.error("Update user error:",s),s}}async deleteUser(r){try{const{error:a}=await Tt.from("users").update({status:"inactive"}).eq("id",r);if(a)throw console.error("Error deactivating user:",a),new Error("Failed to deactivate user");return!0}catch(a){throw console.error("Delete user error:",a),a}}async resetUserPassword(r,a){try{const{data:s,error:i}=await Tt.rpc("generate_salt");if(i)throw new Error("Failed to generate password salt");const{data:l,error:d}=await Tt.rpc("hash_password",{password:a,salt:s});if(d)throw new Error("Failed to hash password");const{error:v}=await Tt.from("users").update({password_hash:l,salt:s,is_first_login:!0,failed_login_attempts:0,last_password_change:new Date().toISOString()}).eq("id",r);if(v)throw console.error("Error resetting password:",v),new Error("Failed to reset password");return!0}catch(s){throw console.error("Reset password error:",s),s}}async generateQuickAccessCode(r){try{const{data:a,error:s}=await Tt.rpc("generate_unique_quick_access_code");if(s)throw new Error("Failed to generate quick access code");const{data:i,error:l}=await Tt.rpc("generate_salt");if(l)throw new Error("Failed to generate code salt");const{data:d,error:v}=await Tt.rpc("hash_password",{password:a,salt:i});if(v)throw new Error("Failed to hash quick access code");const{error:u}=await Tt.from("users").update({quick_access_code:a,quick_access_salt:d}).eq("id",r);if(u)throw console.error("Error updating quick access code:",u),new Error("Failed to update quick access code");return a}catch(a){throw console.error("Generate quick access code error:",a),a}}async isUsernameAvailable(r,a){try{let s=Tt.from("users").select("id").eq("username",r);a&&(s=s.neq("id",a));const{data:i,error:l}=await s.limit(1);return l?(console.error("Error checking username availability:",l),!1):!i||i.length===0}catch(s){return console.error("Username availability check error:",s),!1}}async isQuickAccessCodeAvailable(r){try{const{data:a,error:s}=await Tt.rpc("is_quick_access_code_available",{p_quick_access_code:r});return s?(console.error("Error checking quick access code availability:",s),!1):a}catch(a){return console.error("Quick access code availability check error:",a),!1}}async getUserRoles(){const{data:r,error:a}=await Tt.from("user_roles").select("id, role_name, role_code, is_system_role").eq("is_active",!0).order("is_system_role",{ascending:!1}).order("role_name");return a?(console.error("Error fetching user roles:",a),[]):r||[]}async getBranches(){const{data:r,error:a}=await Tt.from("branches").select("id, name_en, name_ar").eq("is_active",!0).order("name_en");return a?(console.error("Error fetching branches:",a),[]):r||[]}async getEmployees(){const{data:r,error:a}=await Tt.from("hr_employees").select(`
				id, 
				employee_id,
				name,
				branch_id,
				hr_position_assignments!inner(
					hr_positions(position_title_en)
				)
			`).order("name");if(a){console.error("Error fetching employees:",a);const{data:s,error:i}=await Tt.from("hr_employees").select(`
					id, 
					employee_id,
					name,
					branch_id
				`).order("name");return i?(console.error("Error fetching employees (simple query):",i),[]):(s==null?void 0:s.map(l=>({id:l.id,employee_id:l.employee_id,name:l.name,branch_id:l.branch_id,position_title_en:null})))||[]}return(r==null?void 0:r.map(s=>{var i,l,d;return{id:s.id,employee_id:s.employee_id,name:s.name,branch_id:s.branch_id,position_title_en:(d=(l=(i=s.hr_position_assignments)==null?void 0:i[0])==null?void 0:l.hr_positions)==null?void 0:d.position_title_en}}))||[]}async getPositions(){const{data:r,error:a}=await Tt.from("hr_positions").select("id, position_title_en, position_title_ar").order("position_title_en");return a?(console.error("Error fetching positions:",a),[]):r||[]}async getQuickAccessStats(){try{const{data:r,error:a}=await Tt.rpc("get_quick_access_stats");return a?(console.error("Error fetching quick access stats:",a),null):r}catch(r){return console.error("Quick access stats error:",r),null}}}const yr=new n5;var o5=k('<div class="loading-container svelte-1kn1paz"><div class="loading-spinner svelte-1kn1paz"></div> <p class="svelte-1kn1paz">Loading form data...</p></div>'),l5=k('<div class="error-container svelte-1kn1paz"><div class="error-message svelte-1kn1paz"><h3 class="svelte-1kn1paz">Error Loading Data</h3> <p class="svelte-1kn1paz"> </p> <button class="retry-btn svelte-1kn1paz">🔄 Retry</button></div></div>'),c5=k('<span class="error-message svelte-1kn1paz"> </span>'),d5=k('<span class="error-message svelte-1kn1paz"> </span>'),v5=k('<span class="error-message svelte-1kn1paz"> </span>'),u5=k('<span class="error-message svelte-1kn1paz"> </span>'),f5=k('<span class="error-message svelte-1kn1paz"> </span>'),p5=k('<option class="svelte-1kn1paz"> </option>'),h5=k('<span class="error-message svelte-1kn1paz"> </span>'),m5=k('<div class="form-group full-width svelte-1kn1paz"><label for="branchId" class="form-label svelte-1kn1paz">Branch *</label> <select id="branchId"><option class="svelte-1kn1paz">Select Branch</option><!></select> <!></div>'),_5=k('<span class="employee-position svelte-1kn1paz"> </span>'),g5=k('<div class="selected-employee-info svelte-1kn1paz"><span class="selected-badge svelte-1kn1paz">Selected:</span> <span class="employee-name svelte-1kn1paz"> </span> <span class="employee-id svelte-1kn1paz"> </span> <!> <button type="button" class="clear-selection svelte-1kn1paz">×</button></div>'),x5=k('<tr class="employee-row svelte-1kn1paz"><td class="employee-id-cell svelte-1kn1paz"> </td><td class="employee-name-cell svelte-1kn1paz"> </td><td class="employee-position-cell svelte-1kn1paz"> </td><td class="employee-action-cell svelte-1kn1paz"><button type="button" class="select-btn svelte-1kn1paz">Select</button></td></tr>'),b5=k('<table class="employee-table svelte-1kn1paz"><thead class="svelte-1kn1paz"><tr class="svelte-1kn1paz"><th class="svelte-1kn1paz">Employee ID</th><th class="svelte-1kn1paz">Name</th><th class="svelte-1kn1paz">Position</th><th class="svelte-1kn1paz">Action</th></tr></thead><tbody class="svelte-1kn1paz"></tbody></table>'),w5=k('<div class="no-results svelte-1kn1paz"><p class="svelte-1kn1paz"> </p></div>'),y5=k('<div class="no-results svelte-1kn1paz"><p class="svelte-1kn1paz">No employees found in the selected branch</p></div>'),k5=k('<div class="no-results svelte-1kn1paz"><p class="svelte-1kn1paz">Please select a branch to view employees</p></div>'),T5=k('<div class="employee-search svelte-1kn1paz"><input type="text" placeholder="Search employees by name, ID, or position..." class="search-input svelte-1kn1paz"/> <span class="search-icon svelte-1kn1paz">🔍</span></div> <div class="employee-table-container svelte-1kn1paz"><!></div>',1),E5=k('<span class="error-message svelte-1kn1paz"> </span>'),A5=k('<div class="employee-selection svelte-1kn1paz"><div class="selection-header svelte-1kn1paz"><h3 class="selection-title svelte-1kn1paz">Select Employee *</h3> <!></div> <!></div> <!>',1),S5=k('<option class="svelte-1kn1paz"> </option>'),C5=k('<span class="error-message svelte-1kn1paz"> </span>'),F5=k('<div class="form-group svelte-1kn1paz"><label for="positionId" class="form-label svelte-1kn1paz">Position *</label> <select id="positionId"><option class="svelte-1kn1paz">Select Position</option><!></select> <!></div>'),D5=k('<option class="svelte-1kn1paz"> </option>'),M5=k('<span class="error-message svelte-1kn1paz"> </span>'),I5=k('<div class="form-group svelte-1kn1paz"><label for="roleId" class="form-label svelte-1kn1paz">Role *</label> <select id="roleId"><option class="svelte-1kn1paz">Select Role</option><!></select> <!></div>'),R5=k('<img alt="Avatar Preview" class="avatar-image svelte-1kn1paz"/> <button type="button" class="remove-avatar svelte-1kn1paz">×</button>',1),N5=k('<div class="avatar-placeholder svelte-1kn1paz"><span class="avatar-icon svelte-1kn1paz">👤</span> <span class="avatar-text svelte-1kn1paz">No Avatar</span></div>'),P5=k('<span class="error-message svelte-1kn1paz"> </span>'),L5=k('<div class="error-banner svelte-1kn1paz"><strong class="svelte-1kn1paz">Error:</strong> </div>'),O5=k('<div class="success-banner svelte-1kn1paz"><strong class="svelte-1kn1paz">Success:</strong> </div>'),z5=k('<span class="spinner svelte-1kn1paz"></span> Creating User...',1),B5=k('<span class="icon svelte-1kn1paz">👤</span> Create User',1),$5=k('<form class="user-form svelte-1kn1paz"><div class="form-section svelte-1kn1paz"><h2 class="section-title svelte-1kn1paz">Basic Information</h2> <div class="form-row svelte-1kn1paz"><div class="form-group svelte-1kn1paz"><label for="username" class="form-label svelte-1kn1paz">Username *</label> <input type="text" id="username" placeholder="Enter username" required/> <!></div> <div class="form-group svelte-1kn1paz"><label for="userType" class="form-label svelte-1kn1paz">User Type *</label> <select id="userType"><option class="svelte-1kn1paz">Global Access</option><option class="svelte-1kn1paz">Branch Specific</option></select></div></div></div> <div class="form-section svelte-1kn1paz"><h2 class="section-title svelte-1kn1paz">Security</h2> <div class="form-row svelte-1kn1paz"><div class="form-group svelte-1kn1paz"><label for="password" class="form-label svelte-1kn1paz">Password *</label> <input type="password" id="password" placeholder="Enter password" required/> <!></div> <div class="form-group svelte-1kn1paz"><label for="confirmPassword" class="form-label svelte-1kn1paz">Confirm Password *</label> <input type="password" id="confirmPassword" placeholder="Confirm password" required/> <!></div></div> <div class="password-checklist svelte-1kn1paz"><h3 class="checklist-title svelte-1kn1paz">Password Requirements:</h3> <div class="checklist-items svelte-1kn1paz"><div><span class="check-icon svelte-1kn1paz"> </span> At least 8 characters</div> <div><span class="check-icon svelte-1kn1paz"> </span> One uppercase letter</div> <div><span class="check-icon svelte-1kn1paz"> </span> One lowercase letter</div> <div><span class="check-icon svelte-1kn1paz"> </span> One number</div> <div><span class="check-icon svelte-1kn1paz"> </span> One special character</div></div></div> <div class="form-row svelte-1kn1paz"><div class="form-group svelte-1kn1paz"><label for="quickAccessCode" class="form-label svelte-1kn1paz">Quick Access Code (6 digits) *</label> <div class="input-with-button svelte-1kn1paz"><input type="text" id="quickAccessCode" placeholder="123456" maxlength="6" inputmode="numeric"/> <button type="button" class="generate-btn svelte-1kn1paz" title="Generate Random Code">🎲</button></div> <!></div> <div class="form-group svelte-1kn1paz"><label for="confirmQuickAccessCode" class="form-label svelte-1kn1paz">Confirm Quick Access Code *</label> <input type="text" id="confirmQuickAccessCode" placeholder="123456" maxlength="6" inputmode="numeric"/> <!></div></div></div> <div class="form-section svelte-1kn1paz"><h2 class="section-title svelte-1kn1paz">Assignment</h2> <!> <!> <div class="form-row role-selection svelte-1kn1paz"><div class="form-group svelte-1kn1paz"><label for="roleType" class="form-label svelte-1kn1paz">Role Type *</label> <select id="roleType"><option class="svelte-1kn1paz">Position-based</option><option class="svelte-1kn1paz">Admin</option><option class="svelte-1kn1paz">Master Admin</option></select></div> <!></div></div> <div class="form-section svelte-1kn1paz"><h2 class="section-title svelte-1kn1paz">Avatar (Optional)</h2> <div class="avatar-upload svelte-1kn1paz"><div class="avatar-preview svelte-1kn1paz"><!></div> <div class="upload-controls svelte-1kn1paz"><input type="file" id="avatar-input" accept=".png,.jpg,.jpeg,.webp" class="file-input svelte-1kn1paz" hidden/> <label for="avatar-input" class="upload-btn svelte-1kn1paz">📷 Choose Image</label> <div class="upload-info svelte-1kn1paz"><p class="svelte-1kn1paz">PNG, JPEG, WEBP • Max 5MB • Min 256×256px</p></div></div></div> <!></div> <!> <!> <div class="form-actions svelte-1kn1paz"><button type="button" class="cancel-btn svelte-1kn1paz">Cancel</button> <button type="submit" class="submit-btn svelte-1kn1paz"><!></button></div></form>'),U5=k('<div class="create-user svelte-1kn1paz"><div class="header svelte-1kn1paz"><h1 class="title svelte-1kn1paz">Create New User</h1> <p class="subtitle svelte-1kn1paz">Add a new user account to the system</p></div> <!></div>');function q5(t,r){pa(r,!1);const a=Q(),s=Q(),i=Q(),l=Q(),d=Jr();let v=Ra(r,"onDataChanged",8,null),u=Q({username:"",password:"",confirmPassword:"",quickAccessCode:"",confirmQuickAccessCode:"",userType:"branch_specific",branchId:"",employeeId:"",roleType:"Position-based",roleId:"",positionId:"",avatar:null}),f=Q([]),h=Q([]),_=Q([]),x=Q([]),T=Q(!1),b=Q(!0),w=Q({}),A=Q(""),C=Q("");Aa(async()=>{await z()});async function z(){try{p(b,!0),p(C,"");const[L,Te,ye,P]=await Promise.all([yr.getBranches(),yr.getUserRoles(),yr.getEmployees(),yr.getPositions()]);p(f,L),p(_,Te),p(h,ye),p(x,P),console.log("CreateUser - Loaded branches:",e(f)),console.log("CreateUser - Loaded roles:",e(_)),console.log("CreateUser - Loaded employees:",e(h)),console.log("CreateUser - Loaded positions:",e(x))}catch(L){console.error("Error loading create user data:",L),p(C,L.message)}finally{p(b,!1)}}let F=Q(null),re=Q({minLength:!1,hasUppercase:!1,hasLowercase:!1,hasNumber:!1,hasSpecialChar:!1}),me=Q(""),ue=Q(null);function D(L){p(ue,L),$e(u,e(u).employeeId=L.id),$e(w,e(w).employeeId="")}function E(){const L=Math.floor(1e5+Math.random()*9e5).toString();$e(u,e(u).quickAccessCode=L),$e(u,e(u).confirmQuickAccessCode=L)}function he(L){const Te=L.target.files[0];if(Te){if(!["image/png","image/jpeg","image/webp"].includes(Te.type)){$e(w,e(w).avatar="Please select a PNG, JPEG, or WEBP image");return}if(Te.size>5*1024*1024){$e(w,e(w).avatar="Image size must be less than 5MB");return}$e(w,e(w).avatar="");const P=new FileReader;P.onload=pe=>{p(F,pe.target.result)},P.readAsDataURL(Te)}}function xe(){p(F,null),$e(u,e(u).avatar=null);const L=document.getElementById("avatar-input");L&&(L.value="")}function K(){return p(w,{}),e(u).username.trim()?e(u).username.length<3&&$e(w,e(w).username="Username must be at least 3 characters"):$e(w,e(w).username="Username is required"),e(u).password?e(i)||$e(w,e(w).password="Password does not meet requirements"):$e(w,e(w).password="Password is required"),e(u).password!==e(u).confirmPassword&&$e(w,e(w).confirmPassword="Passwords do not match"),e(u).quickAccessCode?e(l)||$e(w,e(w).quickAccessCode="Quick Access Code must be 6 digits"):$e(w,e(w).quickAccessCode="Quick Access Code is required"),e(u).quickAccessCode!==e(u).confirmQuickAccessCode&&$e(w,e(w).confirmQuickAccessCode="Quick Access Codes do not match"),e(u).userType==="branch_specific"&&!e(u).branchId&&$e(w,e(w).branchId="Branch is required for branch-specific users"),e(u).employeeId||$e(w,e(w).employeeId="Employee selection is required"),e(u).roleType==="Position-based"&&!e(u).positionId?$e(w,e(w).positionId="Position is required for position-based roles"):e(u).roleType!=="Position-based"&&!e(u).roleId&&$e(w,e(w).roleId="Role is required"),Object.keys(e(w)).length===0}async function q(){if(K()){p(T,!0),p(A,""),p(w,{});try{if(!await yr.isUsernameAvailable(e(u).username)){$e(w,e(w).username="Username is already taken");return}if(e(u).quickAccessCode&&!await yr.isQuickAccessCodeAvailable(e(u).quickAccessCode)){$e(w,e(w).quickAccessCode="Quick access code is already in use");return}const Te={username:e(u).username,password:e(u).password,roleType:e(u).roleType,userType:e(u).userType,branchId:e(u).branchId?parseInt(e(u).branchId):null,employeeId:e(u).employeeId||null,positionId:e(u).positionId||null,quickAccessCode:e(u).quickAccessCode||null},ye=await yr.createUser(Te);ye.success?(p(A,`User created successfully! Quick Access Code: ${ye.quick_access_code}`),v()&&await v()(),setTimeout(()=>{ae()},3e3)):$e(w,e(w).submit=ye.message||"Failed to create user")}catch(L){console.error("Error creating user:",L),$e(w,e(w).submit=L.message||"Failed to create user")}finally{p(T,!1)}}}function ae(){p(u,{username:"",password:"",confirmPassword:"",quickAccessCode:"",confirmQuickAccessCode:"",userType:"branch_specific",branchId:"",employeeId:"",roleType:"Position-based",roleId:"",positionId:"",avatar:null}),p(w,{}),p(A,""),p(F,"")}function Me(){d("close")}Nt(()=>(e(u),e(h)),()=>{p(a,e(u).branchId?e(h).filter(L=>L.branch_id===parseInt(e(u).branchId)):e(h))}),Nt(()=>e(u),()=>{e(u).branchId&&(p(ue,null),$e(u,e(u).employeeId=""),p(me,""))}),Nt(()=>(e(a),e(me)),()=>{p(s,e(a).filter(L=>{var Te,ye;return L.name.toLowerCase().includes(e(me).toLowerCase())||((Te=L.employee_id)==null?void 0:Te.toLowerCase().includes(e(me).toLowerCase()))||((ye=L.position_title_en)==null?void 0:ye.toLowerCase().includes(e(me).toLowerCase()))}))}),Nt(()=>e(u),()=>{e(u).roleType&&(e(u).roleType==="Position-based"?$e(u,e(u).roleId=""):$e(u,e(u).positionId=""))}),Nt(()=>e(u),()=>{const L=e(u).password;p(re,{minLength:L.length>=8,hasUppercase:/[A-Z]/.test(L),hasLowercase:/[a-z]/.test(L),hasNumber:/[0-9]/.test(L),hasSpecialChar:/[^A-Za-z0-9]/.test(L)})}),Nt(()=>e(re),()=>{p(i,Object.values(e(re)).every(L=>L))}),Nt(()=>e(u),()=>{p(l,e(u).quickAccessCode.length===6&&/^[0-9]{6}$/.test(e(u).quickAccessCode))}),Va(),ha();var ge=U5(),Ne=c(o(ge),2);{var Be=L=>{var Te=o5();g(L,Te)},be=L=>{var Te=Ca(),ye=Bt(Te);{var P=B=>{var j=l5(),I=o(j),Y=c(o(I),2),fe=o(Y,!0);n(Y);var ce=c(Y,2);n(I),n(j),R(()=>y(fe,e(C))),Z("click",ce,z),g(B,j)},pe=B=>{var j=$5(),I=o(j),Y=c(o(I),2),fe=o(Y),ce=c(o(fe),2);At(ce);let J;var le=c(ce,2);{var S=Rt=>{var Ut=c5(),Jt=o(Ut,!0);n(Ut),R(()=>y(Jt,(e(w),m(()=>e(w).username)))),g(Rt,Ut)};X(le,Rt=>{e(w),m(()=>e(w).username)&&Rt(S)})}n(fe);var De=c(fe,2),Ue=c(o(De),2);R(()=>{e(u),Xt(()=>{e(w)})});let We;var ke=o(Ue);ke.value=ke.__value="global";var N=c(ke);N.value=N.__value="branch_specific",n(Ue),n(De),n(Y),n(I);var V=c(I,2),G=c(o(V),2),de=o(G),ve=c(o(de),2);At(ve);let Ie;var Ye=c(ve,2);{var oe=Rt=>{var Ut=d5(),Jt=o(Ut,!0);n(Ut),R(()=>y(Jt,(e(w),m(()=>e(w).password)))),g(Rt,Ut)};X(Ye,Rt=>{e(w),m(()=>e(w).password)&&Rt(oe)})}n(de);var se=c(de,2),U=c(o(se),2);At(U);let W;var ee=c(U,2);{var we=Rt=>{var Ut=v5(),Jt=o(Ut,!0);n(Ut),R(()=>y(Jt,(e(w),m(()=>e(w).confirmPassword)))),g(Rt,Ut)};X(ee,Rt=>{e(w),m(()=>e(w).confirmPassword)&&Rt(we)})}n(se),n(G);var Ae=c(G,2),He=c(o(Ae),2),Ke=o(He);let Oe;var Ee=o(Ke),et=o(Ee,!0);n(Ee),Et(),n(Ke);var dt=c(Ke,2);let ut;var Pe=o(dt),qe=o(Pe,!0);n(Pe),Et(),n(dt);var tt=c(dt,2);let lt;var Xe=o(tt),at=o(Xe,!0);n(Xe),Et(),n(tt);var Fe=c(tt,2);let rt;var Ce=o(Fe),_e=o(Ce,!0);n(Ce),Et(),n(Fe);var Ve=c(Fe,2);let Je;var st=o(Ve),ot=o(st,!0);n(st),Et(),n(Ve),n(He),n(Ae);var Le=c(Ae,2),nt=o(Le),vt=c(o(nt),2),xt=o(vt);At(xt);let M;var H=c(xt,2);n(vt);var O=c(vt,2);{var te=Rt=>{var Ut=u5(),Jt=o(Ut,!0);n(Ut),R(()=>y(Jt,(e(w),m(()=>e(w).quickAccessCode)))),g(Rt,Ut)};X(O,Rt=>{e(w),m(()=>e(w).quickAccessCode)&&Rt(te)})}n(nt);var ne=c(nt,2),ie=c(o(ne),2);At(ie);let Se;var Qe=c(ie,2);{var je=Rt=>{var Ut=f5(),Jt=o(Ut,!0);n(Ut),R(()=>y(Jt,(e(w),m(()=>e(w).confirmQuickAccessCode)))),g(Rt,Ut)};X(Qe,Rt=>{e(w),m(()=>e(w).confirmQuickAccessCode)&&Rt(je)})}n(ne),n(Le),n(V);var ze=c(V,2),Re=c(o(ze),2);{var it=Rt=>{var Ut=m5(),Jt=c(o(Ut),2);R(()=>{e(u),Xt(()=>{e(w),e(f)})});let Ma;var qa=o(Jt);qa.value=qa.__value="";var ar=c(qa);Mt(ar,1,()=>e(f),Lt,(_a,Gt)=>{var Yt=p5(),ia=o(Yt,!0);n(Yt);var ga={};R(()=>{y(ia,(e(Gt),m(()=>e(Gt).name_en||e(Gt).name))),ga!==(ga=(e(Gt),m(()=>e(Gt).id)))&&(Yt.value=(Yt.__value=(e(Gt),m(()=>e(Gt).id)))??"")}),g(_a,Yt)}),n(Jt);var Ga=c(Jt,2);{var Qa=_a=>{var Gt=h5(),Yt=o(Gt,!0);n(Gt),R(()=>y(Yt,(e(w),m(()=>e(w).branchId)))),g(_a,Gt)};X(Ga,_a=>{e(w),m(()=>e(w).branchId)&&_a(Qa)})}n(Ut),R(_a=>Ma=wt(Jt,1,"form-select svelte-1kn1paz",null,Ma,_a),[()=>({error:e(w).branchId})]),ra(Jt,()=>e(u).branchId,_a=>$e(u,e(u).branchId=_a)),g(Rt,Ut)};X(Re,Rt=>{e(u),m(()=>e(u).userType==="branch_specific")&&Rt(it)})}var ft=c(Re,2);{var mt=Rt=>{var Ut=A5(),Jt=Bt(Ut),Ma=o(Jt),qa=c(o(Ma),2);{var ar=Yt=>{var ia=g5(),ga=c(o(ia),2),aa=o(ga,!0);n(ga);var jt=c(ga,2),Vt=o(jt);n(jt);var ca=c(jt,2);{var ya=va=>{var Ta=_5(),Ha=o(Ta);n(Ta),R(()=>y(Ha,`- ${e(ue),m(()=>e(ue).position_title_en)??""}`)),g(va,Ta)};X(ca,va=>{e(ue),m(()=>e(ue).position_title_en)&&va(ya)})}var ua=c(ca,2);n(ia),R(()=>{y(aa,(e(ue),m(()=>e(ue).name))),y(Vt,`(${e(ue),m(()=>e(ue).employee_id||e(ue).id)??""})`)}),Z("click",ua,()=>{p(ue,null),$e(u,e(u).employeeId="")}),g(Yt,ia)};X(qa,Yt=>{e(ue)&&Yt(ar)})}n(Ma);var Ga=c(Ma,2);{var Qa=Yt=>{var ia=T5(),ga=Bt(ia),aa=o(ga);At(aa),Et(2),n(ga);var jt=c(ga,2),Vt=o(jt);{var ca=ua=>{var va=b5(),Ta=c(o(va));Mt(Ta,5,()=>e(s),Lt,(Ha,xa)=>{var wa=x5(),Pa=o(wa),Xa=o(Pa,!0);n(Pa);var Za=c(Pa),Ja=o(Za,!0);n(Za);var nr=c(Za),Wa=o(nr,!0);n(nr);var rr=c(nr),Ir=o(rr);n(rr),n(wa),R(()=>{y(Xa,(e(xa),m(()=>e(xa).employee_id||e(xa).id))),y(Ja,(e(xa),m(()=>e(xa).name))),y(Wa,(e(xa),m(()=>e(xa).position_title_en||"No Position")))}),Z("click",Ir,ir(()=>D(e(xa)))),Z("click",wa,()=>D(e(xa))),g(Ha,wa)}),n(Ta),n(va),g(ua,va)},ya=ua=>{var va=Ca(),Ta=Bt(va);{var Ha=wa=>{var Pa=w5(),Xa=o(Pa),Za=o(Xa);n(Xa),n(Pa),R(()=>y(Za,`No employees found matching "${e(me)??""}"`)),g(wa,Pa)},xa=wa=>{var Pa=Ca(),Xa=Bt(Pa);{var Za=nr=>{var Wa=y5();g(nr,Wa)},Ja=nr=>{var Wa=k5();g(nr,Wa)};X(Xa,nr=>{e(u),m(()=>e(u).branchId)?nr(Za):nr(Ja,!1)},!0)}g(wa,Pa)};X(Ta,wa=>{e(me)?wa(Ha):wa(xa,!1)},!0)}g(ua,va)};X(Vt,ua=>{e(s),m(()=>e(s).length>0)?ua(ca):ua(ya,!1)})}n(jt),zt(aa,()=>e(me),ua=>p(me,ua)),g(Yt,ia)};X(Ga,Yt=>{e(ue)||Yt(Qa)})}n(Jt);var _a=c(Jt,2);{var Gt=Yt=>{var ia=E5(),ga=o(ia,!0);n(ia),R(()=>y(ga,(e(w),m(()=>e(w).employeeId)))),g(Yt,ia)};X(_a,Yt=>{e(w),m(()=>e(w).employeeId)&&Yt(Gt)})}g(Rt,Ut)};X(ft,Rt=>{e(u),m(()=>e(u).branchId||e(u).userType==="global")&&Rt(mt)})}var ht=c(ft,2),pt=o(ht),_t=c(o(pt),2);R(()=>{e(u),Xt(()=>{e(w)})});let Ge;var ct=o(_t);ct.value=ct.__value="Position-based";var Ze=c(ct);Ze.value=Ze.__value="Admin";var bt=c(Ze);bt.value=bt.__value="Master Admin",n(_t),n(pt);var It=c(pt,2);{var Ot=Rt=>{var Ut=F5(),Jt=c(o(Ut),2);R(()=>{e(u),Xt(()=>{e(w),e(x)})});let Ma;var qa=o(Jt);qa.value=qa.__value="";var ar=c(qa);Mt(ar,1,()=>e(x),Lt,(_a,Gt)=>{var Yt=S5(),ia=o(Yt,!0);n(Yt);var ga={};R(()=>{y(ia,(e(Gt),m(()=>e(Gt).position_title_en))),ga!==(ga=(e(Gt),m(()=>e(Gt).id)))&&(Yt.value=(Yt.__value=(e(Gt),m(()=>e(Gt).id)))??"")}),g(_a,Yt)}),n(Jt);var Ga=c(Jt,2);{var Qa=_a=>{var Gt=C5(),Yt=o(Gt,!0);n(Gt),R(()=>y(Yt,(e(w),m(()=>e(w).positionId)))),g(_a,Gt)};X(Ga,_a=>{e(w),m(()=>e(w).positionId)&&_a(Qa)})}n(Ut),R(_a=>Ma=wt(Jt,1,"form-select svelte-1kn1paz",null,Ma,_a),[()=>({error:e(w).positionId})]),ra(Jt,()=>e(u).positionId,_a=>$e(u,e(u).positionId=_a)),g(Rt,Ut)},Pt=Rt=>{var Ut=I5(),Jt=c(o(Ut),2);R(()=>{e(u),Xt(()=>{e(w),e(_)})});let Ma;var qa=o(Jt);qa.value=qa.__value="";var ar=c(qa);Mt(ar,1,()=>e(_),Lt,(_a,Gt)=>{var Yt=D5(),ia=o(Yt,!0);n(Yt);var ga={};R(()=>{y(ia,(e(Gt),m(()=>e(Gt).role_name))),ga!==(ga=(e(Gt),m(()=>e(Gt).id)))&&(Yt.value=(Yt.__value=(e(Gt),m(()=>e(Gt).id)))??"")}),g(_a,Yt)}),n(Jt);var Ga=c(Jt,2);{var Qa=_a=>{var Gt=M5(),Yt=o(Gt,!0);n(Gt),R(()=>y(Yt,(e(w),m(()=>e(w).roleId)))),g(_a,Gt)};X(Ga,_a=>{e(w),m(()=>e(w).roleId)&&_a(Qa)})}n(Ut),R(_a=>Ma=wt(Jt,1,"form-select svelte-1kn1paz",null,Ma,_a),[()=>({error:e(w).roleId})]),ra(Jt,()=>e(u).roleId,_a=>$e(u,e(u).roleId=_a)),g(Rt,Ut)};X(It,Rt=>{e(u),m(()=>e(u).roleType==="Position-based")?Rt(Ot):Rt(Pt,!1)})}n(ht),n(ze);var gt=c(ze,2),yt=c(o(gt),2),qt=o(yt),sa=o(qt);{var oa=Rt=>{var Ut=R5(),Jt=Bt(Ut),Ma=c(Jt,2);R(()=>na(Jt,"src",e(F))),Z("click",Ma,xe),g(Rt,Ut)},Ia=Rt=>{var Ut=N5();g(Rt,Ut)};X(sa,Rt=>{e(F)?Rt(oa):Rt(Ia,!1)})}n(qt);var ka=c(qt,2),St=o(ka);Et(4),n(ka),n(yt);var Dt=c(yt,2);{var Wt=Rt=>{var Ut=P5(),Jt=o(Ut,!0);n(Ut),R(()=>y(Jt,(e(w),m(()=>e(w).avatar)))),g(Rt,Ut)};X(Dt,Rt=>{e(w),m(()=>e(w).avatar)&&Rt(Wt)})}n(gt);var ea=c(gt,2);{var Ht=Rt=>{var Ut=L5(),Jt=c(o(Ut));n(Ut),R(()=>y(Jt,` ${e(w),m(()=>e(w).submit)??""}`)),g(Rt,Ut)};X(ea,Rt=>{e(w),m(()=>e(w).submit)&&Rt(Ht)})}var Qt=c(ea,2);{var la=Rt=>{var Ut=O5(),Jt=c(o(Ut));n(Ut),R(()=>y(Jt,` ${e(A)??""}`)),g(Rt,Ut)};X(Qt,Rt=>{e(A)&&Rt(la)})}var Ft=c(Qt,2),Ct=o(Ft),$t=c(Ct,2),Zt=o($t);{var Da=Rt=>{var Ut=z5();Et(),g(Rt,Ut)},ta=Rt=>{var Ut=B5();Et(),g(Rt,Ut)};X(Zt,Rt=>{e(T)?Rt(Da):Rt(ta,!1)})}n($t),n(Ft),n(j),R((Rt,Ut,Jt,Ma,qa,ar,Ga,Qa,_a,Gt,Yt,ia)=>{J=wt(ce,1,"form-input svelte-1kn1paz",null,J,Rt),We=wt(Ue,1,"form-select svelte-1kn1paz",null,We,Ut),Ie=wt(ve,1,"form-input svelte-1kn1paz",null,Ie,Jt),W=wt(U,1,"form-input svelte-1kn1paz",null,W,Ma),Oe=wt(Ke,1,"check-item svelte-1kn1paz",null,Oe,qa),y(et,(e(re),m(()=>e(re).minLength?"✅":"❌"))),ut=wt(dt,1,"check-item svelte-1kn1paz",null,ut,ar),y(qe,(e(re),m(()=>e(re).hasUppercase?"✅":"❌"))),lt=wt(tt,1,"check-item svelte-1kn1paz",null,lt,Ga),y(at,(e(re),m(()=>e(re).hasLowercase?"✅":"❌"))),rt=wt(Fe,1,"check-item svelte-1kn1paz",null,rt,Qa),y(_e,(e(re),m(()=>e(re).hasNumber?"✅":"❌"))),Je=wt(Ve,1,"check-item svelte-1kn1paz",null,Je,_a),y(ot,(e(re),m(()=>e(re).hasSpecialChar?"✅":"❌"))),M=wt(xt,1,"form-input svelte-1kn1paz",null,M,Gt),Se=wt(ie,1,"form-input svelte-1kn1paz",null,Se,Yt),Ge=wt(_t,1,"form-select svelte-1kn1paz",null,Ge,ia),Ct.disabled=e(T),$t.disabled=e(T)||!e(i)||!e(l)},[()=>({error:e(w).username}),()=>({error:e(w).userType}),()=>({error:e(w).password}),()=>({error:e(w).confirmPassword}),()=>({valid:e(re).minLength}),()=>({valid:e(re).hasUppercase}),()=>({valid:e(re).hasLowercase}),()=>({valid:e(re).hasNumber}),()=>({valid:e(re).hasSpecialChar}),()=>({error:e(w).quickAccessCode}),()=>({error:e(w).confirmQuickAccessCode}),()=>({error:e(w).roleType})]),zt(ce,()=>e(u).username,Rt=>$e(u,e(u).username=Rt)),ra(Ue,()=>e(u).userType,Rt=>$e(u,e(u).userType=Rt)),zt(ve,()=>e(u).password,Rt=>$e(u,e(u).password=Rt)),zt(U,()=>e(u).confirmPassword,Rt=>$e(u,e(u).confirmPassword=Rt)),zt(xt,()=>e(u).quickAccessCode,Rt=>$e(u,e(u).quickAccessCode=Rt)),Z("click",H,E),zt(ie,()=>e(u).confirmQuickAccessCode,Rt=>$e(u,e(u).confirmQuickAccessCode=Rt)),ra(_t,()=>e(u).roleType,Rt=>$e(u,e(u).roleType=Rt)),Z("change",St,he),Z("click",Ct,Me),Z("submit",j,Ur(q)),g(B,j)};X(ye,B=>{e(C)?B(P):B(pe,!1)},!0)}g(L,Te)};X(Ne,L=>{e(b)?L(Be):L(be,!1)})}n(ge),g(t,ge),ma()}var j5=k('<span class="error-message svelte-xi2q1j"> </span>'),W5=k('<span class="error-message svelte-xi2q1j"> </span>'),H5=k('<div class="form-row svelte-xi2q1j"><div class="form-group svelte-xi2q1j"><label for="status" class="form-label svelte-xi2q1j">Status *</label> <select id="status"><option class="svelte-xi2q1j">Active</option><option class="svelte-xi2q1j">Inactive</option><option class="svelte-xi2q1j">Locked</option></select> <!></div></div>'),V5=k('<button type="button" class="reset-btn svelte-xi2q1j">🔐 Reset Password</button>'),G5=k('<button type="button" class="cancel-reset-btn svelte-xi2q1j">Cancel Reset</button>'),X5=k('<button type="button" class="reset-btn svelte-xi2q1j">🎯 Reset Quick Access</button>'),Y5=k('<button type="button" class="cancel-reset-btn svelte-xi2q1j">Cancel Reset</button>'),K5=k('<span class="error-message svelte-xi2q1j"> </span>'),Q5=k('<span class="error-message svelte-xi2q1j"> </span>'),Z5=k('<div class="form-row svelte-xi2q1j"><div class="form-group svelte-xi2q1j"><label for="password" class="form-label svelte-xi2q1j">New Password *</label> <input type="password" id="password" placeholder="Enter new password" required/> <!></div> <div class="form-group svelte-xi2q1j"><label for="confirmPassword" class="form-label svelte-xi2q1j">Confirm New Password *</label> <input type="password" id="confirmPassword" placeholder="Confirm new password" required/> <!></div></div> <div class="password-checklist svelte-xi2q1j"><h3 class="checklist-title svelte-xi2q1j">Password Requirements:</h3> <div class="checklist-items svelte-xi2q1j"><div><span class="check-icon svelte-xi2q1j"> </span> At least 8 characters</div> <div><span class="check-icon svelte-xi2q1j"> </span> One uppercase letter</div> <div><span class="check-icon svelte-xi2q1j"> </span> One lowercase letter</div> <div><span class="check-icon svelte-xi2q1j"> </span> One number</div> <div><span class="check-icon svelte-xi2q1j"> </span> One special character</div></div></div>',1),J5=k('<span class="error-message svelte-xi2q1j"> </span>'),eT=k('<span class="error-message svelte-xi2q1j"> </span>'),tT=k('<div class="form-row svelte-xi2q1j"><div class="form-group svelte-xi2q1j"><label for="quickAccessCode" class="form-label svelte-xi2q1j">New Quick Access Code (6 digits) *</label> <div class="input-with-button svelte-xi2q1j"><input type="text" id="quickAccessCode" placeholder="123456" maxlength="6" required/> <button type="button" class="generate-btn svelte-xi2q1j" title="Generate Random Code">🎲</button></div> <!></div> <div class="form-group svelte-xi2q1j"><label for="confirmQuickAccessCode" class="form-label svelte-xi2q1j">Confirm New Quick Access Code *</label> <input type="text" id="confirmQuickAccessCode" placeholder="123456" maxlength="6" required/> <!></div></div>'),aT=k('<option class="svelte-xi2q1j"> </option>'),rT=k('<span class="error-message svelte-xi2q1j"> </span>'),sT=k('<div class="form-group svelte-xi2q1j"><label for="branchId" class="form-label svelte-xi2q1j">Branch *</label> <select id="branchId"><option class="svelte-xi2q1j">Select Branch</option><!></select> <!></div>'),iT=k('<option class="svelte-xi2q1j"> </option>'),nT=k('<span class="error-message svelte-xi2q1j"> </span>'),oT=k('<option class="svelte-xi2q1j"> </option>'),lT=k('<span class="error-message svelte-xi2q1j"> </span>'),cT=k('<div class="form-group svelte-xi2q1j"><label for="positionId" class="form-label svelte-xi2q1j">Position *</label> <select id="positionId"><option class="svelte-xi2q1j">Select Position</option><!></select> <!></div>'),dT=k('<option class="svelte-xi2q1j"> </option>'),vT=k('<span class="error-message svelte-xi2q1j"> </span>'),uT=k('<div class="form-group svelte-xi2q1j"><label for="roleId" class="form-label svelte-xi2q1j">Role *</label> <select id="roleId"><option class="svelte-xi2q1j">Select Role</option><!></select> <!></div>'),fT=k('<img alt="Avatar Preview" class="avatar-image svelte-xi2q1j"/> <button type="button" class="remove-avatar svelte-xi2q1j">×</button>',1),pT=k('<div class="avatar-placeholder svelte-xi2q1j"><span class="avatar-icon svelte-xi2q1j">👤</span> <span class="avatar-text svelte-xi2q1j">No Avatar</span></div>'),hT=k('<span class="error-message svelte-xi2q1j"> </span>'),mT=k('<div class="error-banner svelte-xi2q1j"><strong class="svelte-xi2q1j">Error:</strong> </div>'),_T=k('<div class="success-banner svelte-xi2q1j"><strong class="svelte-xi2q1j">Success:</strong> </div>'),gT=k('<span class="spinner svelte-xi2q1j"></span> Updating User...',1),xT=k('<span class="icon svelte-xi2q1j">✏️</span> Update User',1),bT=k('<form class="user-form svelte-xi2q1j"><div class="form-section svelte-xi2q1j"><h2 class="section-title svelte-xi2q1j">Basic Information</h2> <div class="form-row svelte-xi2q1j"><div class="form-group svelte-xi2q1j"><label for="username" class="form-label svelte-xi2q1j">Username *</label> <input type="text" id="username" placeholder="Enter username" required/> <!></div> <div class="form-group svelte-xi2q1j"><label for="userType" class="form-label svelte-xi2q1j">User Type *</label> <select id="userType"><option class="svelte-xi2q1j">Global Access</option><option class="svelte-xi2q1j">Branch Specific</option></select></div></div> <!></div> <div class="form-section svelte-xi2q1j"><h2 class="section-title svelte-xi2q1j">Security</h2> <div class="security-actions svelte-xi2q1j"><div class="security-item svelte-xi2q1j"><h3 class="svelte-xi2q1j">Password</h3> <p class="svelte-xi2q1j"> </p> <!></div> <div class="security-item svelte-xi2q1j"><h3 class="svelte-xi2q1j">Quick Access Code</h3> <p class="svelte-xi2q1j">Current code: ••••••</p> <!></div></div> <!> <!></div> <div class="form-section svelte-xi2q1j"><h2 class="section-title svelte-xi2q1j">Assignment</h2> <div class="form-row svelte-xi2q1j"><!> <div class="form-group svelte-xi2q1j"><label for="employeeId" class="form-label svelte-xi2q1j">Employee *</label> <select id="employeeId"><option class="svelte-xi2q1j">Select Employee</option><!></select> <!></div></div> <div class="form-row svelte-xi2q1j"><div class="form-group svelte-xi2q1j"><label for="roleType" class="form-label svelte-xi2q1j">Role Type *</label> <select id="roleType"><option class="svelte-xi2q1j">Position-based</option><option class="svelte-xi2q1j">Admin</option><option class="svelte-xi2q1j">Master Admin</option></select></div> <!></div></div> <div class="form-section svelte-xi2q1j"><h2 class="section-title svelte-xi2q1j">Avatar</h2> <div class="avatar-upload svelte-xi2q1j"><div class="avatar-preview svelte-xi2q1j"><!></div> <div class="upload-controls svelte-xi2q1j"><input type="file" id="avatar-input" accept=".png,.jpg,.jpeg,.webp" class="file-input svelte-xi2q1j" hidden/> <label for="avatar-input" class="upload-btn svelte-xi2q1j"> </label> <div class="upload-info svelte-xi2q1j"><p class="svelte-xi2q1j">PNG, JPEG, WEBP • Max 5MB • Min 256×256px</p></div></div></div> <!></div> <!> <!> <div class="form-actions svelte-xi2q1j"><button type="button" class="cancel-btn svelte-xi2q1j">Cancel</button> <button type="submit" class="submit-btn svelte-xi2q1j"><!></button></div></form>'),wT=k('<div class="edit-user svelte-xi2q1j"><div class="header svelte-xi2q1j"><h1 class="title svelte-xi2q1j"> </h1> <p class="subtitle svelte-xi2q1j">Update user account information and permissions</p></div> <!></div>');function yT(t,r){var Te,ye,P,pe,B,j,I,Y,fe,ce,J,le;pa(r,!1);const a=Q(),s=Q(),i=Q(),l=Jr();let d=Ra(r,"user",8,null),v=Q({id:((Te=d())==null?void 0:Te.id)||"",username:((ye=d())==null?void 0:ye.username)||"",password:"",confirmPassword:"",quickAccessCode:((P=d())==null?void 0:P.quick_access_code)||"",confirmQuickAccessCode:((pe=d())==null?void 0:pe.quick_access_code)||"",userType:((B=d())==null?void 0:B.user_type)||"branch_specific",branchId:((j=d())==null?void 0:j.branch_id)||"",employeeId:((I=d())==null?void 0:I.employee_id)||"",roleType:((Y=d())==null?void 0:Y.role_type)||"position_based",roleId:((fe=d())==null?void 0:fe.role_id)||"",positionId:((ce=d())==null?void 0:ce.position_id)||"",status:((J=d())==null?void 0:J.status)||"active",avatar:null}),u=Q([]),f=[],h=Q([]),_=[];async function x(){try{const S=await yr.getBranches();p(u,S.map(Ue=>({id:Ue.id.toString(),name:Ue.name})));const De=await yr.getUserRoles();p(h,De.map(Ue=>({id:Ue.id,name:Ue.role_name,code:Ue.role_code})))}catch(S){console.error("Error loading initial data:",S)}}Aa(()=>{x()});let T=Q(!1),b=Q({}),w=Q(""),A=Q(((le=d())==null?void 0:le.avatar_url)||null),C=null,z=Q(!1),F=Q(!1),re=Q({minLength:!1,hasUppercase:!1,hasLowercase:!1,hasNumber:!1,hasSpecialChar:!1});function me(){const S=Math.floor(1e5+Math.random()*9e5).toString();$e(v,e(v).quickAccessCode=S),$e(v,e(v).confirmQuickAccessCode=S)}function ue(S){const De=S.target.files[0];if(De){if(!["image/png","image/jpeg","image/webp"].includes(De.type)){$e(b,e(b).avatar="Please select a PNG, JPEG, or WEBP image");return}if(De.size>5*1024*1024){$e(b,e(b).avatar="Image size must be less than 5MB");return}C=De,$e(b,e(b).avatar="");const We=new FileReader;We.onload=ke=>{p(A,ke.target.result)},We.readAsDataURL(De)}}function D(){C=null,p(A,null),$e(v,e(v).avatar=null);const S=document.getElementById("avatar-input");S&&(S.value="")}function E(){p(z,!0),$e(v,e(v).password=""),$e(v,e(v).confirmPassword="")}function he(){p(F,!0),$e(v,e(v).quickAccessCode=""),$e(v,e(v).confirmQuickAccessCode="")}function xe(){return p(b,{}),e(v).username.trim()?e(v).username.length<3&&$e(b,e(b).username="Username must be at least 3 characters"):$e(b,e(b).username="Username is required"),e(z)&&(e(v).password?e(s)||$e(b,e(b).password="Password does not meet requirements"):$e(b,e(b).password="Password is required"),e(v).password!==e(v).confirmPassword&&$e(b,e(b).confirmPassword="Passwords do not match")),e(F)&&(e(v).quickAccessCode?e(i)||$e(b,e(b).quickAccessCode="Quick Access Code must be 6 digits"):$e(b,e(b).quickAccessCode="Quick Access Code is required"),e(v).quickAccessCode!==e(v).confirmQuickAccessCode&&$e(b,e(b).confirmQuickAccessCode="Quick Access Codes do not match")),e(v).userType==="branch_specific"&&!e(v).branchId&&$e(b,e(b).branchId="Branch is required for branch-specific users"),e(v).employeeId||$e(b,e(b).employeeId="Employee selection is required"),e(v).roleType==="position_based"&&!e(v).positionId?$e(b,e(b).positionId="Position is required for position-based roles"):e(v).roleType!=="position_based"&&!e(v).roleId&&$e(b,e(b).roleId="Role is required"),Object.keys(e(b)).length===0}async function K(){if(xe()){p(T,!0),p(w,"");try{await new Promise(De=>setTimeout(De,2e3));const S={...e(v),avatar:C,passwordChanged:e(z),quickAccessChanged:e(F)};console.log("Updating user with data:",S),p(w,"User updated successfully!")}catch(S){$e(b,e(b).submit=S.message||"Failed to update user")}finally{p(T,!1)}}}function q(){l("close")}function ae(){var S;return((S=d())==null?void 0:S.role_type)==="Master Admin"&&e(v).status==="inactive"?($e(b,e(b).status="Cannot deactivate the last active Master Admin"),$e(v,e(v).status="active"),!1):!0}Nt(()=>e(v),()=>{p(a,e(v).branchId?f.filter(S=>S.branch_id===e(v).branchId):f)}),Nt(()=>(e(z),e(v)),()=>{if(e(z)){const S=e(v).password;p(re,{minLength:S.length>=8,hasUppercase:/[A-Z]/.test(S),hasLowercase:/[a-z]/.test(S),hasNumber:/[0-9]/.test(S),hasSpecialChar:/[^A-Za-z0-9]/.test(S)})}}),Nt(()=>(e(z),e(re)),()=>{p(s,!e(z)||Object.values(e(re)).every(S=>S))}),Nt(()=>(e(F),e(v)),()=>{p(i,!e(F)||e(v).quickAccessCode.length===6&&/^[0-9]{6}$/.test(e(v).quickAccessCode))}),Nt(()=>e(v),()=>{e(v).status&&ae()}),Va(),ha();var Me=wT(),ge=o(Me),Ne=o(ge),Be=o(Ne);n(Ne),Et(2),n(ge);var be=c(ge,2);{var L=S=>{var De=bT(),Ue=o(De),We=c(o(Ue),2),ke=o(We),N=c(o(ke),2);At(N);let V;var G=c(N,2);{var de=St=>{var Dt=j5(),Wt=o(Dt,!0);n(Dt),R(()=>y(Wt,(e(b),m(()=>e(b).username)))),g(St,Dt)};X(G,St=>{e(b),m(()=>e(b).username)&&St(de)})}n(ke);var ve=c(ke,2),Ie=c(o(ve),2);R(()=>{e(v),Xt(()=>{e(b)})});let Ye;var oe=o(Ie);oe.value=oe.__value="global";var se=c(oe);se.value=se.__value="branch_specific",n(Ie),n(ve),n(We);var U=c(We,2);{var W=St=>{var Dt=H5(),Wt=o(Dt),ea=c(o(Wt),2);R(()=>{e(v),Xt(()=>{e(b)})});let Ht;var Qt=o(ea);Qt.value=Qt.__value="active";var la=c(Qt);la.value=la.__value="inactive";var Ft=c(la);Ft.value=Ft.__value="locked",n(ea);var Ct=c(ea,2);{var $t=Zt=>{var Da=W5(),ta=o(Da,!0);n(Da),R(()=>y(ta,(e(b),m(()=>e(b).status)))),g(Zt,Da)};X(Ct,Zt=>{e(b),m(()=>e(b).status)&&Zt($t)})}n(Wt),n(Dt),R(Zt=>Ht=wt(ea,1,"form-select svelte-xi2q1j",null,Ht,Zt),[()=>({error:e(b).status})]),ra(ea,()=>e(v).status,Zt=>$e(v,e(v).status=Zt)),g(St,Dt)};X(U,St=>{St(W)})}n(Ue);var ee=c(Ue,2),we=c(o(ee),2),Ae=o(we),He=c(o(Ae),2),Ke=o(He);n(He);var Oe=c(He,2);{var Ee=St=>{var Dt=V5();Z("click",Dt,E),g(St,Dt)},et=St=>{var Dt=G5();Z("click",Dt,()=>p(z,!1)),g(St,Dt)};X(Oe,St=>{e(z)?St(et,!1):St(Ee)})}n(Ae);var dt=c(Ae,2),ut=c(o(dt),4);{var Pe=St=>{var Dt=X5();Z("click",Dt,he),g(St,Dt)},qe=St=>{var Dt=Y5();Z("click",Dt,()=>p(F,!1)),g(St,Dt)};X(ut,St=>{e(F)?St(qe,!1):St(Pe)})}n(dt),n(we);var tt=c(we,2);{var lt=St=>{var Dt=Z5(),Wt=Bt(Dt),ea=o(Wt),Ht=c(o(ea),2);At(Ht);let Qt;var la=c(Ht,2);{var Ft=xa=>{var wa=K5(),Pa=o(wa,!0);n(wa),R(()=>y(Pa,(e(b),m(()=>e(b).password)))),g(xa,wa)};X(la,xa=>{e(b),m(()=>e(b).password)&&xa(Ft)})}n(ea);var Ct=c(ea,2),$t=c(o(Ct),2);At($t);let Zt;var Da=c($t,2);{var ta=xa=>{var wa=Q5(),Pa=o(wa,!0);n(wa),R(()=>y(Pa,(e(b),m(()=>e(b).confirmPassword)))),g(xa,wa)};X(Da,xa=>{e(b),m(()=>e(b).confirmPassword)&&xa(ta)})}n(Ct),n(Wt);var Rt=c(Wt,2),Ut=c(o(Rt),2),Jt=o(Ut);let Ma;var qa=o(Jt),ar=o(qa,!0);n(qa),Et(),n(Jt);var Ga=c(Jt,2);let Qa;var _a=o(Ga),Gt=o(_a,!0);n(_a),Et(),n(Ga);var Yt=c(Ga,2);let ia;var ga=o(Yt),aa=o(ga,!0);n(ga),Et(),n(Yt);var jt=c(Yt,2);let Vt;var ca=o(jt),ya=o(ca,!0);n(ca),Et(),n(jt);var ua=c(jt,2);let va;var Ta=o(ua),Ha=o(Ta,!0);n(Ta),Et(),n(ua),n(Ut),n(Rt),R((xa,wa,Pa,Xa,Za,Ja,nr)=>{Qt=wt(Ht,1,"form-input svelte-xi2q1j",null,Qt,xa),Zt=wt($t,1,"form-input svelte-xi2q1j",null,Zt,wa),Ma=wt(Jt,1,"check-item svelte-xi2q1j",null,Ma,Pa),y(ar,(e(re),m(()=>e(re).minLength?"✅":"❌"))),Qa=wt(Ga,1,"check-item svelte-xi2q1j",null,Qa,Xa),y(Gt,(e(re),m(()=>e(re).hasUppercase?"✅":"❌"))),ia=wt(Yt,1,"check-item svelte-xi2q1j",null,ia,Za),y(aa,(e(re),m(()=>e(re).hasLowercase?"✅":"❌"))),Vt=wt(jt,1,"check-item svelte-xi2q1j",null,Vt,Ja),y(ya,(e(re),m(()=>e(re).hasNumber?"✅":"❌"))),va=wt(ua,1,"check-item svelte-xi2q1j",null,va,nr),y(Ha,(e(re),m(()=>e(re).hasSpecialChar?"✅":"❌")))},[()=>({error:e(b).password}),()=>({error:e(b).confirmPassword}),()=>({valid:e(re).minLength}),()=>({valid:e(re).hasUppercase}),()=>({valid:e(re).hasLowercase}),()=>({valid:e(re).hasNumber}),()=>({valid:e(re).hasSpecialChar})]),zt(Ht,()=>e(v).password,xa=>$e(v,e(v).password=xa)),zt($t,()=>e(v).confirmPassword,xa=>$e(v,e(v).confirmPassword=xa)),g(St,Dt)};X(tt,St=>{e(z)&&St(lt)})}var Xe=c(tt,2);{var at=St=>{var Dt=tT(),Wt=o(Dt),ea=c(o(Wt),2),Ht=o(ea);At(Ht);let Qt;na(Ht,"pattern","[0-9]6");var la=c(Ht,2);n(ea);var Ft=c(ea,2);{var Ct=Ut=>{var Jt=J5(),Ma=o(Jt,!0);n(Jt),R(()=>y(Ma,(e(b),m(()=>e(b).quickAccessCode)))),g(Ut,Jt)};X(Ft,Ut=>{e(b),m(()=>e(b).quickAccessCode)&&Ut(Ct)})}n(Wt);var $t=c(Wt,2),Zt=c(o($t),2);At(Zt);let Da;na(Zt,"pattern","[0-9]6");var ta=c(Zt,2);{var Rt=Ut=>{var Jt=eT(),Ma=o(Jt,!0);n(Jt),R(()=>y(Ma,(e(b),m(()=>e(b).confirmQuickAccessCode)))),g(Ut,Jt)};X(ta,Ut=>{e(b),m(()=>e(b).confirmQuickAccessCode)&&Ut(Rt)})}n($t),n(Dt),R((Ut,Jt)=>{Qt=wt(Ht,1,"form-input svelte-xi2q1j",null,Qt,Ut),Da=wt(Zt,1,"form-input svelte-xi2q1j",null,Da,Jt)},[()=>({error:e(b).quickAccessCode}),()=>({error:e(b).confirmQuickAccessCode})]),zt(Ht,()=>e(v).quickAccessCode,Ut=>$e(v,e(v).quickAccessCode=Ut)),Z("click",la,me),zt(Zt,()=>e(v).confirmQuickAccessCode,Ut=>$e(v,e(v).confirmQuickAccessCode=Ut)),g(St,Dt)};X(Xe,St=>{e(F)&&St(at)})}n(ee);var Fe=c(ee,2),rt=c(o(Fe),2),Ce=o(rt);{var _e=St=>{var Dt=sT(),Wt=c(o(Dt),2);R(()=>{e(v),Xt(()=>{e(b),e(u)})});let ea;var Ht=o(Wt);Ht.value=Ht.__value="";var Qt=c(Ht);Mt(Qt,1,()=>e(u),Lt,(Ct,$t)=>{var Zt=aT(),Da=o(Zt,!0);n(Zt);var ta={};R(()=>{y(Da,(e($t),m(()=>e($t).name))),ta!==(ta=(e($t),m(()=>e($t).id)))&&(Zt.value=(Zt.__value=(e($t),m(()=>e($t).id)))??"")}),g(Ct,Zt)}),n(Wt);var la=c(Wt,2);{var Ft=Ct=>{var $t=rT(),Zt=o($t,!0);n($t),R(()=>y(Zt,(e(b),m(()=>e(b).branchId)))),g(Ct,$t)};X(la,Ct=>{e(b),m(()=>e(b).branchId)&&Ct(Ft)})}n(Dt),R(Ct=>ea=wt(Wt,1,"form-select svelte-xi2q1j",null,ea,Ct),[()=>({error:e(b).branchId})]),ra(Wt,()=>e(v).branchId,Ct=>$e(v,e(v).branchId=Ct)),g(St,Dt)};X(Ce,St=>{e(v),m(()=>e(v).userType==="branch_specific")&&St(_e)})}var Ve=c(Ce,2),Je=c(o(Ve),2);R(()=>{e(v),Xt(()=>{e(b),e(a)})});let st;var ot=o(Je);ot.value=ot.__value="";var Le=c(ot);Mt(Le,1,()=>e(a),Lt,(St,Dt)=>{var Wt=iT(),ea=o(Wt,!0);n(Wt);var Ht={};R(()=>{y(ea,(e(Dt),m(()=>e(Dt).name))),Ht!==(Ht=(e(Dt),m(()=>e(Dt).id)))&&(Wt.value=(Wt.__value=(e(Dt),m(()=>e(Dt).id)))??"")}),g(St,Wt)}),n(Je);var nt=c(Je,2);{var vt=St=>{var Dt=nT(),Wt=o(Dt,!0);n(Dt),R(()=>y(Wt,(e(b),m(()=>e(b).employeeId)))),g(St,Dt)};X(nt,St=>{e(b),m(()=>e(b).employeeId)&&St(vt)})}n(Ve),n(rt);var xt=c(rt,2),M=o(xt),H=c(o(M),2);R(()=>{e(v),Xt(()=>{e(b)})});let O;var te=o(H);te.value=te.__value="position_based";var ne=c(te);ne.value=ne.__value="admin";var ie=c(ne);ie.value=ie.__value="master_admin",n(H),n(M);var Se=c(M,2);{var Qe=St=>{var Dt=cT(),Wt=c(o(Dt),2);R(()=>{e(v),Xt(()=>{e(b)})});let ea;var Ht=o(Wt);Ht.value=Ht.__value="";var Qt=c(Ht);Mt(Qt,1,()=>_,Lt,(Ct,$t)=>{var Zt=oT(),Da=o(Zt,!0);n(Zt);var ta={};R(()=>{y(Da,(e($t),m(()=>e($t).name))),ta!==(ta=(e($t),m(()=>e($t).id)))&&(Zt.value=(Zt.__value=(e($t),m(()=>e($t).id)))??"")}),g(Ct,Zt)}),n(Wt);var la=c(Wt,2);{var Ft=Ct=>{var $t=lT(),Zt=o($t,!0);n($t),R(()=>y(Zt,(e(b),m(()=>e(b).positionId)))),g(Ct,$t)};X(la,Ct=>{e(b),m(()=>e(b).positionId)&&Ct(Ft)})}n(Dt),R(Ct=>ea=wt(Wt,1,"form-select svelte-xi2q1j",null,ea,Ct),[()=>({error:e(b).positionId})]),ra(Wt,()=>e(v).positionId,Ct=>$e(v,e(v).positionId=Ct)),g(St,Dt)},je=St=>{var Dt=uT(),Wt=c(o(Dt),2);R(()=>{e(v),Xt(()=>{e(b),e(h)})});let ea;var Ht=o(Wt);Ht.value=Ht.__value="";var Qt=c(Ht);Mt(Qt,1,()=>e(h),Lt,(Ct,$t)=>{var Zt=dT(),Da=o(Zt,!0);n(Zt);var ta={};R(()=>{y(Da,(e($t),m(()=>e($t).name))),ta!==(ta=(e($t),m(()=>e($t).id)))&&(Zt.value=(Zt.__value=(e($t),m(()=>e($t).id)))??"")}),g(Ct,Zt)}),n(Wt);var la=c(Wt,2);{var Ft=Ct=>{var $t=vT(),Zt=o($t,!0);n($t),R(()=>y(Zt,(e(b),m(()=>e(b).roleId)))),g(Ct,$t)};X(la,Ct=>{e(b),m(()=>e(b).roleId)&&Ct(Ft)})}n(Dt),R(Ct=>ea=wt(Wt,1,"form-select svelte-xi2q1j",null,ea,Ct),[()=>({error:e(b).roleId})]),ra(Wt,()=>e(v).roleId,Ct=>$e(v,e(v).roleId=Ct)),g(St,Dt)};X(Se,St=>{e(v),m(()=>e(v).roleType==="position_based")?St(Qe):St(je,!1)})}n(xt),n(Fe);var ze=c(Fe,2),Re=c(o(ze),2),it=o(Re),ft=o(it);{var mt=St=>{var Dt=fT(),Wt=Bt(Dt),ea=c(Wt,2);R(()=>na(Wt,"src",e(A))),Z("click",ea,D),g(St,Dt)},ht=St=>{var Dt=pT();g(St,Dt)};X(ft,St=>{e(A)?St(mt):St(ht,!1)})}n(it);var pt=c(it,2),_t=o(pt),Ge=c(_t,2),ct=o(Ge);n(Ge),Et(2),n(pt),n(Re);var Ze=c(Re,2);{var bt=St=>{var Dt=hT(),Wt=o(Dt,!0);n(Dt),R(()=>y(Wt,(e(b),m(()=>e(b).avatar)))),g(St,Dt)};X(Ze,St=>{e(b),m(()=>e(b).avatar)&&St(bt)})}n(ze);var It=c(ze,2);{var Ot=St=>{var Dt=mT(),Wt=c(o(Dt));n(Dt),R(()=>y(Wt,` ${e(b),m(()=>e(b).submit)??""}`)),g(St,Dt)};X(It,St=>{e(b),m(()=>e(b).submit)&&St(Ot)})}var Pt=c(It,2);{var gt=St=>{var Dt=_T(),Wt=c(o(Dt));n(Dt),R(()=>y(Wt,` ${e(w)??""}`)),g(St,Dt)};X(Pt,St=>{e(w)&&St(gt)})}var yt=c(Pt,2),qt=o(yt),sa=c(qt,2),oa=o(sa);{var Ia=St=>{var Dt=gT();Et(),g(St,Dt)},ka=St=>{var Dt=xT();Et(),g(St,Dt)};X(oa,St=>{e(T)?St(Ia):St(ka,!1)})}n(sa),n(yt),n(De),R((St,Dt,Wt,ea)=>{V=wt(N,1,"form-input svelte-xi2q1j",null,V,St),Ye=wt(Ie,1,"form-select svelte-xi2q1j",null,Ye,Dt),y(Ke,`Last changed: ${kt(d()),m(()=>{var Ht;return((Ht=d())==null?void 0:Ht.last_password_change)||"Unknown"})??""}`),st=wt(Je,1,"form-select svelte-xi2q1j",null,st,Wt),O=wt(H,1,"form-select svelte-xi2q1j",null,O,ea),y(ct,`📷 ${e(A)?"Change Image":"Upload Image"}`),qt.disabled=e(T),sa.disabled=e(T)||!e(s)||!e(i)},[()=>({error:e(b).username}),()=>({error:e(b).userType}),()=>({error:e(b).employeeId}),()=>({error:e(b).roleType})]),zt(N,()=>e(v).username,St=>$e(v,e(v).username=St)),ra(Ie,()=>e(v).userType,St=>$e(v,e(v).userType=St)),ra(Je,()=>e(v).employeeId,St=>$e(v,e(v).employeeId=St)),ra(H,()=>e(v).roleType,St=>$e(v,e(v).roleType=St)),Z("change",_t,ue),Z("click",qt,q),Z("submit",De,Ur(K)),g(S,De)};X(be,S=>{S(L,!1)})}n(Me),R(()=>y(Be,`Edit User: ${kt(d()),m(()=>{var S;return((S=d())==null?void 0:S.username)||"Unknown"})??""}`)),g(t,Me),ma()}var kT=k('<div class="permission-error svelte-ill6da"><h2 class="svelte-ill6da">Access Denied</h2> <p class="svelte-ill6da">You do not have permission to assign roles to this user.</p> <button class="close-btn svelte-ill6da">Close</button></div>'),TT=k('<img alt="User Avatar" class="avatar-image svelte-ill6da"/>'),ET=k('<div class="avatar-placeholder svelte-ill6da"><span class="avatar-icon svelte-ill6da">👤</span></div>'),AT=k('<label><input type="radio" name="role" class="role-radio svelte-ill6da"/> <div class="role-card svelte-ill6da"><div class="role-header svelte-ill6da"><h3 class="role-name svelte-ill6da"> </h3> <span class="role-level svelte-ill6da"> </span></div> <p class="role-description svelte-ill6da"> </p> <div class="role-meta svelte-ill6da"><span class="role-category svelte-ill6da"> </span> <span class="role-code svelte-ill6da"> </span></div></div></label>'),ST=k('<span class="error-message svelte-ill6da"> </span>'),CT=k('<div class="form-section svelte-ill6da"><div class="section-header svelte-ill6da"><h2 class="section-title svelte-ill6da">Permission Presets</h2> <button type="button" class="advanced-toggle svelte-ill6da"> </button></div> <div class="preset-buttons svelte-ill6da"><button type="button" class="preset-btn svelte-ill6da">📋 Minimal Access</button> <button type="button" class="preset-btn svelte-ill6da">🎯 Standard User</button> <button type="button" class="preset-btn svelte-ill6da">👔 Manager Level</button> <button type="button" class="preset-btn svelte-ill6da">⚙️ Admin Level</button></div></div>'),FT=k('<option class="svelte-ill6da"> </option>'),DT=k('<span class="status-badge inherited svelte-ill6da">Inherited</span>'),MT=k('<span class="status-badge custom svelte-ill6da">Custom</span>'),IT=k('<span class="status-badge both svelte-ill6da">Both</span>'),RT=k('<label><div class="permission-check svelte-ill6da"><input type="checkbox" class="permission-checkbox svelte-ill6da"/> <div class="permission-status svelte-ill6da"><!></div></div> <div class="permission-details svelte-ill6da"><h4 class="permission-name svelte-ill6da"> </h4> <p class="permission-description svelte-ill6da"> </p></div></label>'),NT=k('<div class="permission-category svelte-ill6da"><h3 class="category-title svelte-ill6da"> </h3> <div class="permission-items svelte-ill6da"></div></div>'),PT=k('<div class="form-section svelte-ill6da"><div class="section-header svelte-ill6da"><h2 class="section-title svelte-ill6da">Detailed Permissions</h2> <div class="permission-controls svelte-ill6da"><div class="search-box svelte-ill6da"><input type="text" placeholder="Search permissions..." class="search-input svelte-ill6da"/> <span class="search-icon svelte-ill6da">🔍</span></div> <select class="category-filter svelte-ill6da"></select></div></div> <div class="permissions-grid svelte-ill6da"></div></div>'),LT=k('<div class="form-section svelte-ill6da"><h2 class="section-title svelte-ill6da">Assignment Summary</h2> <div class="assignment-summary svelte-ill6da"><div class="summary-card svelte-ill6da"><h3 class="svelte-ill6da">Selected Role</h3> <div class="summary-role svelte-ill6da"><span class="role-name svelte-ill6da"> </span> <span class="role-level svelte-ill6da"> </span></div> <p class="role-description svelte-ill6da"> </p></div> <div class="summary-card svelte-ill6da"><h3 class="svelte-ill6da">Permission Count</h3> <div class="permission-counts svelte-ill6da"><div class="count-item svelte-ill6da"><span class="count svelte-ill6da"> </span> <span class="label svelte-ill6da">Inherited</span></div> <div class="count-item svelte-ill6da"><span class="count svelte-ill6da"> </span> <span class="label svelte-ill6da">Custom</span></div> <div class="count-item svelte-ill6da"><span class="count svelte-ill6da"> </span> <span class="label svelte-ill6da">Total</span></div></div></div></div></div>'),OT=k('<div class="error-banner svelte-ill6da"><strong class="svelte-ill6da">Error:</strong> </div>'),zT=k('<div class="success-banner svelte-ill6da"><strong class="svelte-ill6da">Success:</strong> </div>'),BT=k('<span class="spinner svelte-ill6da"></span> Assigning Role...',1),$T=k('<span class="icon svelte-ill6da">🎭</span> Assign Role & Permissions',1),UT=k('<form class="assignment-form svelte-ill6da"><div class="user-info svelte-ill6da"><div class="user-card svelte-ill6da"><div class="user-avatar svelte-ill6da"><!></div> <div class="user-details svelte-ill6da"><h3 class="svelte-ill6da"> </h3> <p class="current-role svelte-ill6da">Current Role: <span class="role-badge svelte-ill6da"> </span></p> <p class="user-status svelte-ill6da"> </p></div></div></div> <div class="form-section svelte-ill6da"><h2 class="section-title svelte-ill6da">Select Role</h2> <div class="role-selection svelte-ill6da"></div> <!></div> <!> <!> <!> <!> <!> <div class="form-actions svelte-ill6da"><button type="button" class="cancel-btn svelte-ill6da">Cancel</button> <button type="submit" class="submit-btn svelte-ill6da"><!></button></div></form>'),qT=k('<div class="assign-roles svelte-ill6da"><div class="header svelte-ill6da"><h1 class="title svelte-ill6da">Assign Roles & Permissions</h1> <p class="subtitle svelte-ill6da"> </p></div> <!></div>');function jT(t,r){var B,j;pa(r,!1);const a=Q(),s=Q(),i=Q(),l=Q(),d=[],v=Jr();let u=Ra(r,"user",8,null),f=Q([]),h=[{category:"User Management",items:[{id:"user_create",name:"Create Users",description:"Create new user accounts"},{id:"user_edit",name:"Edit Users",description:"Modify existing user information"},{id:"user_delete",name:"Delete Users",description:"Remove user accounts"},{id:"user_view",name:"View Users",description:"Access user information"}]},{category:"Employee Management",items:[{id:"employee_create",name:"Create Employees",description:"Add new employee records"},{id:"employee_edit",name:"Edit Employees",description:"Update employee information"},{id:"employee_delete",name:"Delete Employees",description:"Remove employee records"},{id:"employee_view",name:"View Employees",description:"Access employee data"}]},{category:"Payroll",items:[{id:"payroll_process",name:"Process Payroll",description:"Generate and process payroll"},{id:"payroll_approve",name:"Approve Payroll",description:"Approve payroll runs"},{id:"payroll_view",name:"View Payroll",description:"Access payroll information"},{id:"payroll_reports",name:"Payroll Reports",description:"Generate payroll reports"}]},{category:"Reports",items:[{id:"reports_generate",name:"Generate Reports",description:"Create system reports"},{id:"reports_view",name:"View Reports",description:"Access existing reports"},{id:"reports_export",name:"Export Reports",description:"Download and export reports"},{id:"reports_schedule",name:"Schedule Reports",description:"Set up automated reports"}]},{category:"System Administration",items:[{id:"system_settings",name:"System Settings",description:"Configure system settings"},{id:"system_backup",name:"System Backup",description:"Manage system backups"},{id:"system_logs",name:"System Logs",description:"Access system audit logs"},{id:"system_maintenance",name:"System Maintenance",description:"Perform system maintenance"}]}];async function _(){try{const I=await yr.getUserRoles();p(f,I.map(Y=>({id:Y.id,name:Y.role_name,code:Y.role_code,description:x(Y.role_code),level:T(Y.role_code),category:b(Y.role_code)})))}catch(I){console.error("Error loading roles data:",I)}}function x(I){return{MASTER_ADMIN:"Full system access and control",ADMIN:"System administration with limited controls",HR_MANAGER:"Human resources management and oversight",BRANCH_MANAGER:"Complete branch operations management",PAYROLL_MANAGER:"Payroll processing and management",SUPERVISOR:"Team supervision and daily operations",EMPLOYEE:"Basic employee access and functions"}[I]||"Role-based access and functions"}function T(I){return{MASTER_ADMIN:100,ADMIN:90,HR_MANAGER:80,BRANCH_MANAGER:70,PAYROLL_MANAGER:60,SUPERVISOR:50,EMPLOYEE:10}[I]||30}function b(I){return{MASTER_ADMIN:"system",ADMIN:"system",HR_MANAGER:"hr",BRANCH_MANAGER:"branch",PAYROLL_MANAGER:"finance",SUPERVISOR:"operations",EMPLOYEE:"basic"}[I]||"general"}Aa(()=>{_()});let w={role_type:"Master Admin",level:100},A=Q(!1),C=Q({}),z=Q(""),F=Q(((B=u())==null?void 0:B.role_id)||""),re=Q(new Set(((j=u())==null?void 0:j.custom_permissions)||[])),me=Q(new Set),ue=Q(""),D=Q("all"),E=Q(!1);function he(){e(me).clear(),e(i)&&(e(me).add("employee_view"),e(me).add("reports_view"),e(i).level>=50&&(e(me).add("employee_edit"),e(me).add("reports_generate")),e(i).level>=70&&(e(me).add("employee_create"),e(me).add("payroll_view"),e(me).add("user_view")),e(i).level>=80&&(e(me).add("employee_delete"),e(me).add("payroll_process"),e(me).add("user_create"),e(me).add("user_edit")),e(i).level>=90&&(e(me).add("payroll_approve"),e(me).add("user_delete"),e(me).add("system_settings"),e(me).add("system_logs")),e(i).level>=100&&(e(me).add("system_backup"),e(me).add("system_maintenance"))),p(me,new Set(e(me)))}function xe(I){e(re).has(I)?e(re).delete(I):e(re).add(I),p(re,new Set(e(re)))}function K(I){const Y=e(me).has(I),fe=e(re).has(I);return Y&&fe?"both":Y?"inherited":fe?"custom":"none"}function q(I){switch(e(re).clear(),I){case"minimal":e(re).add("employee_view"),e(re).add("reports_view");break;case"standard":e(re).add("employee_view"),e(re).add("employee_edit"),e(re).add("reports_view"),e(re).add("reports_generate");break;case"manager":e(re).add("employee_view"),e(re).add("employee_edit"),e(re).add("employee_create"),e(re).add("reports_view"),e(re).add("reports_generate"),e(re).add("payroll_view");break;case"admin":h.forEach(Y=>{Y.items.forEach(fe=>{fe.id.includes("system_")||e(re).add(fe.id)})});break}p(re,new Set(e(re)))}function ae(){return p(C,{}),e(F)?e(i)&&e(i).level>=w.level?($e(C,e(C).role="You cannot assign a role equal to or higher than your own"),!1):!0:($e(C,e(C).role="Please select a role"),!1)}async function Me(){var I,Y,fe;if(ae()){p(A,!0),p(z,"");try{await new Promise(J=>setTimeout(J,2e3));const ce={userId:(I=u())==null?void 0:I.id,roleId:e(F),customPermissions:Array.from(e(re)),assignedBy:"current_user_id"};console.log("Assigning role with data:",ce),p(z,`Role "${(Y=e(i))==null?void 0:Y.name}" successfully assigned to ${(fe=u())==null?void 0:fe.username}!`)}catch(ce){$e(C,e(C).submit=ce.message||"Failed to assign role")}finally{p(A,!1)}}}function ge(){v("close")}let Ne=Q(!0);u()&&w.role_type,Nt(()=>{},()=>{p(a,["all",...new Set(h.map(I=>I.category))])}),Nt(()=>e(f),()=>{p(s,e(f).filter(I=>!0))}),Nt(()=>(e(s),e(F)),()=>{p(i,e(s).find(I=>I.id===e(F)))}),Nt(()=>e(i),()=>{e(i)&&he()}),Nt(()=>(e(D),e(ue)),()=>{p(l,h.filter(I=>e(D)==="all"||I.category===e(D)).map(I=>({...I,items:I.items.filter(Y=>e(ue)===""||Y.name.toLowerCase().includes(e(ue).toLowerCase())||Y.description.toLowerCase().includes(e(ue).toLowerCase()))})).filter(I=>I.items.length>0))}),Va(),ha();var Be=qT(),be=o(Be),L=c(o(be),2),Te=o(L);n(L),n(be);var ye=c(be,2);{var P=I=>{var Y=kT(),fe=c(o(Y),4);n(Y),Z("click",fe,ge),g(I,Y)},pe=I=>{var Y=UT(),fe=o(Y),ce=o(fe),J=o(ce),le=o(J);{var S=Xe=>{var at=TT();R(()=>na(at,"src",(kt(u()),m(()=>u().avatar_url)))),g(Xe,at)},De=Xe=>{var at=ET();g(Xe,at)};X(le,Xe=>{kt(u()),m(()=>{var at;return(at=u())==null?void 0:at.avatar_url})?Xe(S):Xe(De,!1)})}n(J);var Ue=c(J,2),We=o(Ue),ke=o(We,!0);n(We);var N=c(We,2),V=c(o(N)),G=o(V,!0);n(V),n(N);var de=c(N,2),ve=o(de);n(de),n(Ue),n(ce),n(fe);var Ie=c(fe,2),Ye=c(o(Ie),2);Mt(Ye,5,()=>e(s),Lt,(Xe,at)=>{var Fe=AT();let rt;var Ce=o(Fe);At(Ce);var _e,Ve=c(Ce,2),Je=o(Ve),st=o(Je),ot=o(st,!0);n(st);var Le=c(st,2),nt=o(Le);n(Le),n(Je);var vt=c(Je,2),xt=o(vt,!0);n(vt);var M=c(vt,2),H=o(M),O=o(H,!0);n(H);var te=c(H,2),ne=o(te,!0);n(te),n(M),n(Ve),n(Fe),R(ie=>{rt=wt(Fe,1,"role-option svelte-ill6da",null,rt,ie),_e!==(_e=(e(at),m(()=>e(at).id)))&&(Ce.value=(Ce.__value=(e(at),m(()=>e(at).id)))??""),y(ot,(e(at),m(()=>e(at).name))),y(nt,`Level ${e(at),m(()=>e(at).level)??""}`),y(xt,(e(at),m(()=>e(at).description))),y(O,(e(at),m(()=>e(at).category))),y(ne,(e(at),m(()=>e(at).code)))},[()=>({selected:e(F)===e(at).id})]),gs(d,[],Ce,()=>(e(at),m(()=>e(at).id),e(F)),ie=>p(F,ie)),g(Xe,Fe)}),n(Ye);var oe=c(Ye,2);{var se=Xe=>{var at=ST(),Fe=o(at,!0);n(at),R(()=>y(Fe,(e(C),m(()=>e(C).role)))),g(Xe,at)};X(oe,Xe=>{e(C),m(()=>e(C).role)&&Xe(se)})}n(Ie);var U=c(Ie,2);{var W=Xe=>{var at=CT(),Fe=o(at),rt=c(o(Fe),2),Ce=o(rt,!0);n(rt),n(Fe);var _e=c(Fe,2),Ve=o(_e),Je=c(Ve,2),st=c(Je,2),ot=c(st,2);n(_e),n(at),R(()=>y(Ce,e(E)?"🔧 Hide Advanced":"⚡ Quick Setup")),Z("click",rt,()=>p(E,!e(E))),Z("click",Ve,()=>q("minimal")),Z("click",Je,()=>q("standard")),Z("click",st,()=>q("manager")),Z("click",ot,()=>q("admin")),g(Xe,at)};X(U,Xe=>{e(i)&&Xe(W)})}var ee=c(U,2);{var we=Xe=>{var at=PT(),Fe=o(at),rt=c(o(Fe),2),Ce=o(rt),_e=o(Ce);At(_e),Et(2),n(Ce);var Ve=c(Ce,2);R(()=>{e(D),Xt(()=>{e(a)})}),Mt(Ve,5,()=>e(a),Lt,(st,ot)=>{var Le=FT(),nt=o(Le,!0);n(Le);var vt={};R(()=>{y(nt,e(ot)==="all"?"All Categories":e(ot)),vt!==(vt=e(ot))&&(Le.value=(Le.__value=e(ot))??"")}),g(st,Le)}),n(Ve),n(rt),n(Fe);var Je=c(Fe,2);Mt(Je,5,()=>e(l),Lt,(st,ot)=>{var Le=NT(),nt=o(Le),vt=o(nt,!0);n(nt);var xt=c(nt,2);Mt(xt,5,()=>(e(ot),m(()=>e(ot).items)),Lt,(M,H)=>{const O=$i(()=>(e(H),m(()=>K(e(H).id))));var te=RT();let ne;var ie=o(te),Se=o(ie);At(Se);var Qe=c(Se,2),je=o(Qe);{var ze=_t=>{var Ge=DT();g(_t,Ge)},Re=_t=>{var Ge=Ca(),ct=Bt(Ge);{var Ze=It=>{var Ot=MT();g(It,Ot)},bt=It=>{var Ot=Ca(),Pt=Bt(Ot);{var gt=yt=>{var qt=IT();g(yt,qt)};X(Pt,yt=>{e(O)==="both"&&yt(gt)},!0)}g(It,Ot)};X(ct,It=>{e(O)==="custom"?It(Ze):It(bt,!1)},!0)}g(_t,Ge)};X(je,_t=>{e(O)==="inherited"?_t(ze):_t(Re,!1)})}n(Qe),n(ie);var it=c(ie,2),ft=o(it),mt=o(ft,!0);n(ft);var ht=c(ft,2),pt=o(ht,!0);n(ht),n(it),n(te),R(_t=>{ne=wt(te,1,"permission-item svelte-ill6da",null,ne,_t),vs(Se,e(O)==="custom"||e(O)==="both"),Se.disabled=e(O)==="inherited",y(mt,(e(H),m(()=>e(H).name))),y(pt,(e(H),m(()=>e(H).description)))},[()=>({inherited:e(O)==="inherited",custom:e(O)==="custom",both:e(O)==="both"})]),Z("change",Se,()=>xe(e(H).id)),g(M,te)}),n(xt),n(Le),R(()=>y(vt,(e(ot),m(()=>e(ot).category)))),g(st,Le)}),n(Je),n(at),zt(_e,()=>e(ue),st=>p(ue,st)),ra(Ve,()=>e(D),st=>p(D,st)),g(Xe,at)};X(ee,Xe=>{e(i)&&e(E)&&Xe(we)})}var Ae=c(ee,2);{var He=Xe=>{var at=LT(),Fe=c(o(at),2),rt=o(Fe),Ce=c(o(rt),2),_e=o(Ce),Ve=o(_e,!0);n(_e);var Je=c(_e,2),st=o(Je);n(Je),n(Ce);var ot=c(Ce,2),Le=o(ot,!0);n(ot),n(rt);var nt=c(rt,2),vt=c(o(nt),2),xt=o(vt),M=o(xt),H=o(M,!0);n(M),Et(2),n(xt);var O=c(xt,2),te=o(O),ne=o(te,!0);n(te),Et(2),n(O);var ie=c(O,2),Se=o(ie),Qe=o(Se,!0);n(Se),Et(2),n(ie),n(vt),n(nt),n(Fe),n(at),R(()=>{y(Ve,(e(i),m(()=>e(i).name))),y(st,`Level ${e(i),m(()=>e(i).level)??""}`),y(Le,(e(i),m(()=>e(i).description))),y(H,(e(me),m(()=>e(me).size))),y(ne,(e(re),m(()=>e(re).size))),y(Qe,(e(me),e(re),m(()=>e(me).size+e(re).size)))}),g(Xe,at)};X(Ae,Xe=>{e(i)&&Xe(He)})}var Ke=c(Ae,2);{var Oe=Xe=>{var at=OT(),Fe=c(o(at));n(at),R(()=>y(Fe,` ${e(C),m(()=>e(C).submit)??""}`)),g(Xe,at)};X(Ke,Xe=>{e(C),m(()=>e(C).submit)&&Xe(Oe)})}var Ee=c(Ke,2);{var et=Xe=>{var at=zT(),Fe=c(o(at));n(at),R(()=>y(Fe,` ${e(z)??""}`)),g(Xe,at)};X(Ee,Xe=>{e(z)&&Xe(et)})}var dt=c(Ee,2),ut=o(dt),Pe=c(ut,2),qe=o(Pe);{var tt=Xe=>{var at=BT();Et(),g(Xe,at)},lt=Xe=>{var at=$T();Et(),g(Xe,at)};X(qe,Xe=>{e(A)?Xe(tt):Xe(lt,!1)})}n(Pe),n(dt),n(Y),R(()=>{y(ke,(kt(u()),m(()=>{var Xe;return((Xe=u())==null?void 0:Xe.username)||"Unknown User"}))),y(G,(kt(u()),m(()=>{var Xe;return((Xe=u())==null?void 0:Xe.role_name)||"No Role"}))),y(ve,`Status: ${kt(u()),m(()=>{var Xe;return((Xe=u())==null?void 0:Xe.status)||"Unknown"})??""}`),ut.disabled=e(A),Pe.disabled=e(A)||!e(F)}),Z("click",ut,ge),Z("submit",Y,Ur(Me)),g(I,Y)};X(ye,I=>{e(Ne)?I(pe,!1):I(P)})}n(Be),R(()=>y(Te,`Manage access rights for ${kt(u()),m(()=>{var I;return((I=u())==null?void 0:I.username)||"Unknown User"})??""}`)),g(t,Be),ma()}var WT=k('<div class="access-denied svelte-rlh958"><div class="access-denied-content svelte-rlh958"><span class="access-denied-icon svelte-rlh958">🚫</span> <h2 class="svelte-rlh958">Access Denied</h2> <p class="svelte-rlh958">Only Admins and Master Admins can create user roles.</p></div></div>'),HT=k('<span class="error-message svelte-rlh958"> </span>'),VT=k("<option> </option>"),GT=k('<span class="error-message svelte-rlh958"> </span>'),XT=k('<div class="error-banner svelte-rlh958"><span class="error-icon">⚠️</span> <span> </span></div>'),YT=k('<th class="permission-col svelte-rlh958"><div class="permission-header svelte-rlh958"><span class="permission-name svelte-rlh958"> </span> <span class="permission-desc svelte-rlh958"> </span></div></th>'),KT=k('<td class="permission-cell svelte-rlh958"><label class="permission-checkbox svelte-rlh958"><input type="checkbox" class="svelte-rlh958"/> <span class="checkmark svelte-rlh958"></span></label></td>'),QT=k('<tr class="function-row svelte-rlh958"><td class="function-cell svelte-rlh958"><div class="function-info svelte-rlh958"><div class="function-name svelte-rlh958"> </div> <div class="function-desc svelte-rlh958"> </div></div></td><!><td class="actions-cell svelte-rlh958"><div class="row-actions svelte-rlh958"><button type="button" class="row-btn select-all svelte-rlh958" title="Select all permissions for this function">All</button> <button type="button" class="row-btn clear-all svelte-rlh958" title="Clear all permissions for this function">None</button></div></td></tr>'),ZT=k('<div class="success-banner svelte-rlh958"><span class="success-icon">✅</span> <div class="success-content"><strong>Success!</strong> </div></div>'),JT=k('<div class="error-banner svelte-rlh958"><span class="error-icon">❌</span> <div class="error-content"><strong>Error:</strong> </div></div>'),e6=k('<span class="loading-spinner svelte-rlh958"></span> Creating Role...',1),t6=k('<div class="content svelte-rlh958"><form class="role-form svelte-rlh958"><div class="form-section svelte-rlh958"><h2 class="section-title svelte-rlh958">Role Information</h2> <div class="form-grid svelte-rlh958"><div class="form-group svelte-rlh958"><label for="role-name" class="svelte-rlh958">Role Name *</label> <input type="text" id="role-name" placeholder="Enter role name (e.g., Store Manager)"/> <!></div> <div class="form-group svelte-rlh958"><label for="position" class="svelte-rlh958">Position *</label> <select id="position"><option>Select Position</option><!></select> <!></div></div> <div class="form-group svelte-rlh958"><label for="role-description" class="svelte-rlh958">Role Description</label> <textarea id="role-description" placeholder="Optional description of the role and its responsibilities" class="form-textarea svelte-rlh958" rows="3"></textarea></div></div> <div class="form-section svelte-rlh958"><div class="permissions-header svelte-rlh958"><h2 class="section-title svelte-rlh958">Permissions Matrix <span class="permission-count svelte-rlh958"> </span></h2> <div class="bulk-actions svelte-rlh958"><button type="button" class="bulk-btn select-all svelte-rlh958">Select All</button> <button type="button" class="bulk-btn clear-all svelte-rlh958">Clear All</button></div></div> <!> <div class="permissions-table-container svelte-rlh958"><table class="permissions-table svelte-rlh958"><thead><tr><th class="function-col svelte-rlh958">System Function</th><!><th class="actions-col svelte-rlh958">Actions</th></tr></thead><tbody></tbody></table></div></div> <!> <!> <div class="form-actions svelte-rlh958"><button type="button" class="cancel-btn svelte-rlh958">Reset Form</button> <button type="submit" class="submit-btn svelte-rlh958"><!></button></div></form></div>'),a6=k('<div class="create-user-roles svelte-rlh958"><div class="header svelte-rlh958"><div class="header-content svelte-rlh958"><div class="title-section svelte-rlh958"><h1 class="title svelte-rlh958">Create User Role</h1> <p class="subtitle svelte-rlh958">Define custom roles and permissions for different positions</p></div> <button class="close-btn svelte-rlh958" title="Close Window"><span class="close-icon svelte-rlh958">✕</span></button></div></div> <!></div>');function r6(t,r){pa(r,!1);const a=Q(),s=Q(),i=Jr();let l=Q({roleName:"",roleDescription:"",position:"",permissions:{}}),d=[{id:"cashier",name:"Cashier"},{id:"supervisor",name:"Supervisor"},{id:"inventory_manager",name:"Inventory Manager"},{id:"branch_manager",name:"Branch Manager"},{id:"accountant",name:"Accountant"},{id:"hr_coordinator",name:"HR Coordinator"},{id:"sales_representative",name:"Sales Representative"},{id:"customer_service",name:"Customer Service"},{id:"security_officer",name:"Security Officer"},{id:"maintenance_staff",name:"Maintenance Staff"}],v=[{id:"user_management",name:"User Management",description:"Manage user accounts and permissions"},{id:"inventory_management",name:"Inventory Management",description:"Track and manage inventory items"},{id:"sales_transactions",name:"Sales Transactions",description:"Process sales and customer transactions"},{id:"financial_reports",name:"Financial Reports",description:"Access financial reports and analytics"},{id:"customer_management",name:"Customer Management",description:"Manage customer information and relationships"},{id:"supplier_management",name:"Supplier Management",description:"Manage supplier information and orders"},{id:"branch_operations",name:"Branch Operations",description:"Manage branch-specific operations"},{id:"hr_management",name:"HR Management",description:"Human resources management functions"},{id:"system_settings",name:"System Settings",description:"Configure system-wide settings"},{id:"audit_logs",name:"Audit Logs",description:"View system audit logs and activity"},{id:"backup_restore",name:"Backup & Restore",description:"Manage system backups and restoration"},{id:"master_data",name:"Master Data",description:"Manage master data and configurations"}],u=[{id:"view",name:"View",description:"View and read data"},{id:"add",name:"Add",description:"Create new records"},{id:"edit",name:"Edit",description:"Modify existing records"},{id:"delete",name:"Delete",description:"Remove records"},{id:"export",name:"Export",description:"Export data to external formats"}],f=Q(!1),h=Q({}),_=Q(""),x={role_type:"Master Admin"};function T(){const Me={};v.forEach(ge=>{Me[ge.id]={view:!1,add:!1,edit:!1,delete:!1,export:!1}}),$e(l,e(l).permissions=Me)}T();function b(){return p(h,{}),e(l).roleName.trim()?e(l).roleName.length<3&&$e(h,e(h).roleName="Role name must be at least 3 characters"):$e(h,e(h).roleName="Role name is required"),e(l).position||$e(h,e(h).position="Position selection is required"),Object.values(e(l).permissions).some(ge=>Object.values(ge).some(Ne=>Ne===!0))||$e(h,e(h).permissions="At least one permission must be granted"),Object.keys(e(h)).length===0}function w(Me,ge){e(l).permissions[Me]||$e(l,e(l).permissions[Me]={}),$e(l,e(l).permissions[Me][ge]=!e(l).permissions[Me][ge]),e(l).permissions[Me][ge]&&delete e(h).permissions}function A(Me){e(l).permissions[Me]||$e(l,e(l).permissions[Me]={}),u.forEach(ge=>{$e(l,e(l).permissions[Me][ge.id]=!0)}),delete e(h).permissions}function C(Me){e(l).permissions[Me]||$e(l,e(l).permissions[Me]={}),u.forEach(ge=>{$e(l,e(l).permissions[Me][ge.id]=!1)})}function z(){v.forEach(Me=>{e(l).permissions[Me.id]||$e(l,e(l).permissions[Me.id]={}),u.forEach(ge=>{$e(l,e(l).permissions[Me.id][ge.id]=!0)})}),delete e(h).permissions}function F(){v.forEach(Me=>{e(l).permissions[Me.id]||$e(l,e(l).permissions[Me.id]={}),u.forEach(ge=>{$e(l,e(l).permissions[Me.id][ge.id]=!1)})})}async function re(){if(b()){p(f,!0),p(_,""),p(h,{});try{await new Promise(Me=>setTimeout(Me,1500)),console.log("Creating role with data:",e(l)),p(_,`User role "${e(l).roleName}" created successfully!`),console.log("Audit Log: Role created",{action:"create_user_role",role_name:e(l).roleName,position:e(l).position,created_by:x.role_type,timestamp:new Date().toISOString(),permissions_count:Object.values(e(l).permissions).reduce((Me,ge)=>Me+Object.values(ge).filter(Ne=>Ne===!0).length,0)}),setTimeout(()=>{me(),p(_,"")},3e3)}catch(Me){console.error("Error creating role:",Me),$e(h,e(h).submit=Me.message||"Failed to create user role")}finally{p(f,!1)}}}function me(){p(l,{roleName:"",roleDescription:"",position:"",permissions:{}}),T(),p(h,{}),p(_,"")}function ue(){i("close")}Nt(()=>{},()=>{p(a,x.role_type==="Master Admin")}),Nt(()=>e(l),()=>{p(s,Object.values(e(l).permissions).reduce((Me,ge)=>Me+Object.values(ge).filter(Ne=>Ne===!0).length,0))}),Va(),ha();var D=a6(),E=o(D),he=o(E),xe=c(o(he),2);n(he),n(E);var K=c(E,2);{var q=Me=>{var ge=WT();g(Me,ge)},ae=Me=>{var ge=t6(),Ne=o(ge),Be=o(Ne),be=c(o(Be),2),L=o(be),Te=c(o(L),2);At(Te);let ye;var P=c(Te,2);{var pe=qe=>{var tt=HT(),lt=o(tt,!0);n(tt),R(()=>y(lt,(e(h),m(()=>e(h).roleName)))),g(qe,tt)};X(P,qe=>{e(h),m(()=>e(h).roleName)&&qe(pe)})}n(L);var B=c(L,2),j=c(o(B),2);R(()=>{e(l),Xt(()=>{e(h),e(f)})});let I;var Y=o(j);Y.value=Y.__value="";var fe=c(Y);Mt(fe,1,()=>d,Lt,(qe,tt)=>{var lt=VT(),Xe=o(lt,!0);n(lt);var at={};R(()=>{y(Xe,(e(tt),m(()=>e(tt).name))),at!==(at=(e(tt),m(()=>e(tt).id)))&&(lt.value=(lt.__value=(e(tt),m(()=>e(tt).id)))??"")}),g(qe,lt)}),n(j);var ce=c(j,2);{var J=qe=>{var tt=GT(),lt=o(tt,!0);n(tt),R(()=>y(lt,(e(h),m(()=>e(h).position)))),g(qe,tt)};X(ce,qe=>{e(h),m(()=>e(h).position)&&qe(J)})}n(B),n(be);var le=c(be,2),S=c(o(le),2);ks(S),n(le),n(Be);var De=c(Be,2),Ue=o(De),We=o(Ue),ke=c(o(We)),N=o(ke);n(ke),n(We);var V=c(We,2),G=o(V),de=c(G,2);n(V),n(Ue);var ve=c(Ue,2);{var Ie=qe=>{var tt=XT(),lt=c(o(tt),2),Xe=o(lt,!0);n(lt),n(tt),R(()=>y(Xe,(e(h),m(()=>e(h).permissions)))),g(qe,tt)};X(ve,qe=>{e(h),m(()=>e(h).permissions)&&qe(Ie)})}var Ye=c(ve,2),oe=o(Ye),se=o(oe),U=o(se),W=c(o(U));Mt(W,1,()=>u,Lt,(qe,tt)=>{var lt=YT(),Xe=o(lt),at=o(Xe),Fe=o(at,!0);n(at);var rt=c(at,2),Ce=o(rt,!0);n(rt),n(Xe),n(lt),R(()=>{y(Fe,(e(tt),m(()=>e(tt).name))),y(Ce,(e(tt),m(()=>e(tt).description)))}),g(qe,lt)}),Et(),n(U),n(se);var ee=c(se);Mt(ee,5,()=>v,Lt,(qe,tt)=>{var lt=QT(),Xe=o(lt),at=o(Xe),Fe=o(at),rt=o(Fe,!0);n(Fe);var Ce=c(Fe,2),_e=o(Ce,!0);n(Ce),n(at),n(Xe);var Ve=c(Xe);Mt(Ve,1,()=>u,Lt,(nt,vt)=>{var xt=KT(),M=o(xt),H=o(M);At(H),Et(2),n(M),n(xt),R(()=>{vs(H,(e(l),e(tt),e(vt),m(()=>{var O;return((O=e(l).permissions[e(tt).id])==null?void 0:O[e(vt).id])||!1}))),H.disabled=e(f)}),Z("change",H,()=>w(e(tt).id,e(vt).id)),g(nt,xt)});var Je=c(Ve),st=o(Je),ot=o(st),Le=c(ot,2);n(st),n(Je),n(lt),R(()=>{y(rt,(e(tt),m(()=>e(tt).name))),y(_e,(e(tt),m(()=>e(tt).description))),ot.disabled=e(f),Le.disabled=e(f)}),Z("click",ot,()=>A(e(tt).id)),Z("click",Le,()=>C(e(tt).id)),g(qe,lt)}),n(ee),n(oe),n(Ye),n(De);var we=c(De,2);{var Ae=qe=>{var tt=ZT(),lt=c(o(tt),2),Xe=c(o(lt));n(lt),n(tt),R(()=>y(Xe,` ${e(_)??""}`)),g(qe,tt)};X(we,qe=>{e(_)&&qe(Ae)})}var He=c(we,2);{var Ke=qe=>{var tt=JT(),lt=c(o(tt),2),Xe=c(o(lt));n(lt),n(tt),R(()=>y(Xe,` ${e(h),m(()=>e(h).submit)??""}`)),g(qe,tt)};X(He,qe=>{e(h),m(()=>e(h).submit)&&qe(Ke)})}var Oe=c(He,2),Ee=o(Oe),et=c(Ee,2),dt=o(et);{var ut=qe=>{var tt=e6();Et(),g(qe,tt)},Pe=qe=>{var tt=Ya("Create Role");g(qe,tt)};X(dt,qe=>{e(f)?qe(ut):qe(Pe,!1)})}n(et),n(Oe),n(Ne),n(ge),R((qe,tt)=>{ye=wt(Te,1,"form-input svelte-rlh958",null,ye,qe),Te.disabled=e(f),I=wt(j,1,"form-select svelte-rlh958",null,I,tt),j.disabled=e(f),S.disabled=e(f),y(N,`(${e(s)??""} permissions selected)`),G.disabled=e(f),de.disabled=e(f),Ee.disabled=e(f),et.disabled=e(f)},[()=>({error:e(h).roleName}),()=>({error:e(h).position})]),zt(Te,()=>e(l).roleName,qe=>$e(l,e(l).roleName=qe)),ra(j,()=>e(l).position,qe=>$e(l,e(l).position=qe)),zt(S,()=>e(l).roleDescription,qe=>$e(l,e(l).roleDescription=qe)),Z("click",G,z),Z("click",de,F),Z("click",Ee,me),Z("submit",Ne,Ur(re)),g(Me,ge)};X(K,Me=>{e(a)?Me(ae,!1):Me(q)})}n(D),Z("click",xe,ue),g(t,D),ma()}var s6=k('<option class="svelte-1fk8ioe"> </option>'),i6=k('<option class="svelte-1fk8ioe"> </option>'),n6=k('<option class="svelte-1fk8ioe"> </option>'),o6=k('<option class="svelte-1fk8ioe"> </option>'),l6=k('<span class="spinner svelte-1fk8ioe"></span>'),c6=k('<div class="bulk-actions-bar svelte-1fk8ioe"><div class="selection-info svelte-1fk8ioe"><span class="selected-count svelte-1fk8ioe"> </span> <button class="clear-selection svelte-1fk8ioe">Clear</button></div> <div class="bulk-controls svelte-1fk8ioe"><select class="bulk-select svelte-1fk8ioe"><option class="svelte-1fk8ioe">Choose Action</option><!></select> <button class="bulk-apply-btn svelte-1fk8ioe"><!></button></div></div>'),d6=k('<img alt="Avatar" class="avatar-image svelte-1fk8ioe"/>'),v6=k('<div class="avatar-placeholder svelte-1fk8ioe"><span class="avatar-icon svelte-1fk8ioe">👤</span></div>'),u6=k('<button class="svelte-1fk8ioe">❌ Deactivate</button>'),f6=k('<button class="svelte-1fk8ioe">✅ Activate</button>'),p6=k('<button class="svelte-1fk8ioe">🔓 Unlock</button>'),h6=k('<button class="svelte-1fk8ioe">🔒 Lock</button>'),m6=k('<button class="danger svelte-1fk8ioe">🗑️ Delete</button>'),_6=k('<div><div class="table-cell checkbox-cell svelte-1fk8ioe"><input type="checkbox" class="select-checkbox svelte-1fk8ioe"/></div> <div class="table-cell svelte-1fk8ioe"><div class="user-avatar svelte-1fk8ioe"><!></div></div> <div class="table-cell svelte-1fk8ioe"><div class="user-info svelte-1fk8ioe"><h3 class="username svelte-1fk8ioe"> </h3> <p class="full-name svelte-1fk8ioe"> </p> <p class="email svelte-1fk8ioe"> </p> <p class="branch svelte-1fk8ioe"> </p></div></div> <div class="table-cell svelte-1fk8ioe"><div class="role-status svelte-1fk8ioe"><div> </div> <div class="status-badge svelte-1fk8ioe"> </div></div></div> <div class="table-cell svelte-1fk8ioe"><div class="activity-info svelte-1fk8ioe"><div class="activity-item svelte-1fk8ioe"><span class="label svelte-1fk8ioe">Last Login:</span> <span class="value svelte-1fk8ioe"> </span></div> <div class="activity-item svelte-1fk8ioe"><span class="label svelte-1fk8ioe">Created:</span> <span class="value svelte-1fk8ioe"> </span></div></div></div> <div class="table-cell svelte-1fk8ioe"><div class="security-info svelte-1fk8ioe"><div><span class="label svelte-1fk8ioe">Login Attempts:</span> <span class="value svelte-1fk8ioe"> </span></div> <div><span class="label svelte-1fk8ioe">Account:</span> <span class="value svelte-1fk8ioe"> </span></div></div></div> <div class="table-cell svelte-1fk8ioe"><div class="user-actions svelte-1fk8ioe"><div class="action-group svelte-1fk8ioe"><button class="action-btn small edit svelte-1fk8ioe" title="Edit User">✏️</button> <button class="action-btn small roles svelte-1fk8ioe" title="Assign Roles">🎭</button></div> <div class="dropdown svelte-1fk8ioe"><button class="dropdown-btn svelte-1fk8ioe">⋮</button> <div class="dropdown-content svelte-1fk8ioe"><!> <!> <button class="svelte-1fk8ioe">🔐 Reset Password</button> <!></div></div></div></div></div>'),g6=k('<div class="empty-state svelte-1fk8ioe"><div class="empty-icon svelte-1fk8ioe">👥</div> <h3 class="svelte-1fk8ioe">No administrators found</h3> <p class="svelte-1fk8ioe">No users match your current search and filter criteria.</p> <button class="action-btn create svelte-1fk8ioe">Create First Admin User</button></div>'),x6=k('<div class="error-banner svelte-1fk8ioe"><strong class="svelte-1fk8ioe">Error:</strong> </div>'),b6=k('<div class="success-banner svelte-1fk8ioe"><strong class="svelte-1fk8ioe">Success:</strong> </div>'),w6=k('<div class="manage-admin-users svelte-1fk8ioe"><div class="header svelte-1fk8ioe"><h1 class="title svelte-1fk8ioe">Manage Administrator Users</h1> <p class="subtitle svelte-1fk8ioe">Monitor and manage all administrative user accounts</p></div> <div class="controls-bar svelte-1fk8ioe"><div class="search-section svelte-1fk8ioe"><div class="search-box svelte-1fk8ioe"><input type="text" placeholder="Search users..." class="search-input svelte-1fk8ioe"/> <span class="search-icon svelte-1fk8ioe">🔍</span></div></div> <div class="filters-section svelte-1fk8ioe"><select class="filter-select svelte-1fk8ioe"></select> <select class="filter-select svelte-1fk8ioe"></select> <select class="filter-select svelte-1fk8ioe"></select> <button class="sort-order-btn svelte-1fk8ioe" title="Toggle sort order"> </button></div> <div class="actions-section svelte-1fk8ioe"><button class="action-btn export svelte-1fk8ioe">📊 Export</button> <button class="action-btn create svelte-1fk8ioe">➕ Create Admin</button></div></div> <!> <div class="users-container svelte-1fk8ioe"><div class="users-table svelte-1fk8ioe"><div class="table-header svelte-1fk8ioe"><div class="header-cell checkbox-cell svelte-1fk8ioe"><input type="checkbox" class="select-checkbox svelte-1fk8ioe"/></div> <div class="header-cell svelte-1fk8ioe">Avatar</div> <div class="header-cell svelte-1fk8ioe">User Info</div> <div class="header-cell svelte-1fk8ioe">Role & Status</div> <div class="header-cell svelte-1fk8ioe">Activity</div> <div class="header-cell svelte-1fk8ioe">Security</div> <div class="header-cell svelte-1fk8ioe">Actions</div></div> <div class="table-body svelte-1fk8ioe"></div></div> <!></div> <!> <!> <div class="stats-bar svelte-1fk8ioe"><div class="stat-item svelte-1fk8ioe"><span class="stat-value svelte-1fk8ioe"> </span> <span class="stat-label svelte-1fk8ioe">Active</span></div> <div class="stat-item svelte-1fk8ioe"><span class="stat-value svelte-1fk8ioe"> </span> <span class="stat-label svelte-1fk8ioe">Inactive</span></div> <div class="stat-item svelte-1fk8ioe"><span class="stat-value svelte-1fk8ioe"> </span> <span class="stat-label svelte-1fk8ioe">Locked</span></div> <div class="stat-item svelte-1fk8ioe"><span class="stat-value svelte-1fk8ioe"> </span> <span class="stat-label svelte-1fk8ioe">Master Admins</span></div> <div class="stat-item svelte-1fk8ioe"><span class="stat-value svelte-1fk8ioe"> </span> <span class="stat-label svelte-1fk8ioe">Showing</span></div></div> <div class="window-actions svelte-1fk8ioe"><button class="close-window-btn svelte-1fk8ioe">Close Window</button></div></div>');function y6(t,r){pa(r,!1);const a=Q(),s=Q(),i=Q(),l=Jr();let d=Q([]);async function v(){try{const Ce=await yr.getAllUsers();p(d,Ce.filter(_e=>_e.role_type==="Master Admin"||_e.role_type==="Admin"))}catch(Ce){console.error("Error loading admin users:",Ce)}}Aa(()=>{v()});let u={id:"1",role_type:"Master Admin",role_level:100},f=Q(!1),h=Q({}),_=Q(""),x=Q(""),T=Q("all"),b=Q("all"),w=Q("username"),A=Q("asc"),C=Q(new Set),z=Q(""),F=[{value:"all",label:"All Statuses"},{value:"active",label:"Active"},{value:"inactive",label:"Inactive"},{value:"locked",label:"Locked"}],re=[{value:"all",label:"All Roles"},{value:"Master Admin",label:"Master Admin"},{value:"Admin",label:"Admin"}],me=[{value:"username",label:"Username"},{value:"full_name",label:"Full Name"},{value:"role_type",label:"Role"},{value:"status",label:"Status"},{value:"last_login",label:"Last Login"},{value:"created_at",label:"Created Date"}],ue=[{value:"activate",label:"✅ Activate Users",color:"#059669"},{value:"deactivate",label:"❌ Deactivate Users",color:"#dc2626"},{value:"unlock",label:"🔓 Unlock Users",color:"#0891b2"},{value:"reset_password",label:"🔐 Reset Passwords",color:"#f59e0b"},{value:"delete",label:"🗑️ Delete Users",color:"#dc2626"}];function D(Ce){const _e=new Date(Ce);return _e.toLocaleDateString()+" "+_e.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}function E(Ce){switch(Ce){case"active":return"#059669";case"inactive":return"#6b7280";case"locked":return"#dc2626";default:return"#6b7280"}}function he(Ce){switch(Ce){case"active":return"✅";case"inactive":return"⏸️";case"locked":return"🔒";default:return"❓"}}function xe(Ce){e(C).has(Ce)?e(C).delete(Ce):e(C).add(Ce),p(C,new Set(e(C)))}function K(){e(C).size===e(a).length?e(C).clear():p(C,new Set(e(a).map(Ce=>Ce.id))),p(C,new Set(e(C)))}function q(){e(C).clear(),p(C,new Set(e(C)))}async function ae(Ce,_e){if(!e(i)(Ce)){$e(h,e(h).action="You do not have permission to modify this user");return}p(f,!0),p(h,{}),p(_,"");try{switch(await new Promise(Ve=>setTimeout(Ve,1e3)),_e){case"activate":Ce.status="active",Ce.is_locked=!1,Ce.login_attempts=0,p(_,`${Ce.username} has been activated`);break;case"deactivate":Ce.status="inactive",p(_,`${Ce.username} has been deactivated`);break;case"unlock":Ce.status="active",Ce.is_locked=!1,Ce.login_attempts=0,p(_,`${Ce.username} has been unlocked`);break;case"lock":Ce.status="locked",Ce.is_locked=!0,p(_,`${Ce.username} has been locked`);break;case"reset_password":p(_,`Password reset email sent to ${Ce.email}`);break;case"delete":p(d,e(d).filter(Ve=>Ve.id!==Ce.id)),p(_,`${Ce.username} has been deleted`);break}setTimeout(()=>p(_,""),3e3)}catch(Ve){$e(h,e(h).action=Ve.message||"Action failed")}finally{p(f,!1)}}async function Me(){if(!(!e(z)||e(C).size===0)){p(f,!0),p(h,{}),p(_,"");try{await new Promise(Ve=>setTimeout(Ve,2e3));const Ce=e(d).filter(Ve=>e(C).has(Ve.id));let _e=0;for(const Ve of Ce)if(e(i)(Ve))switch(e(z)){case"activate":Ve.status="active",Ve.is_locked=!1,Ve.login_attempts=0,_e++;break;case"deactivate":Ve.status="inactive",_e++;break;case"unlock":Ve.status="active",Ve.is_locked=!1,Ve.login_attempts=0,_e++;break;case"reset_password":_e++;break;case"delete":p(d,e(d).filter(Je=>Je.id!==Ve.id)),_e++;break}p(_,`Bulk action completed on ${_e} users`),q(),p(z,""),setTimeout(()=>p(_,""),3e3)}catch(Ce){$e(h,e(h).bulk=Ce.message||"Bulk action failed")}finally{p(f,!1)}}}function ge(Ce){l("editUser",Ce)}function Ne(Ce){l("assignRoles",Ce)}function Be(){l("createUser")}function be(){l("close")}function L(){const _e=`data:text/csv;charset=utf-8,Username,Email,Full Name,Role,Status,Last Login,Created At
`+e(a).map(Je=>({username:Je.username,email:Je.email,full_name:Je.full_name,role:Je.role_type,status:Je.status,last_login:Je.last_login,created_at:Je.created_at})).map(Je=>Object.values(Je).join(",")).join(`
`),Ve=document.createElement("a");Ve.setAttribute("href",encodeURI(_e)),Ve.setAttribute("download","admin_users.csv"),Ve.click()}Nt(()=>(e(d),e(x),e(T),e(b),e(w),e(A)),()=>{p(a,e(d).filter(Ce=>{const _e=e(x)===""||Ce.username.toLowerCase().includes(e(x).toLowerCase())||Ce.full_name.toLowerCase().includes(e(x).toLowerCase())||Ce.email.toLowerCase().includes(e(x).toLowerCase()),Ve=e(T)==="all"||Ce.status===e(T),Je=e(b)==="all"||Ce.role_type===e(b);return _e&&Ve&&Je}).sort((Ce,_e)=>{let Ve=Ce[e(w)],Je=_e[e(w)];return(e(w)==="last_login"||e(w)==="created_at")&&(Ve=new Date(Ve).getTime(),Je=new Date(Je).getTime()),typeof Ve=="string"&&(Ve=Ve.toLowerCase(),Je=Je.toLowerCase()),e(A)==="asc"?Ve>Je?1:-1:Ve<Je?1:-1}))}),Nt(()=>e(C),()=>{p(s,e(C).size)}),Nt(()=>e(d),()=>{p(i,Ce=>{{if(Ce.role_type==="Master Admin"&&Ce.id!==u.id||Ce.role_type==="Admin")return!0;if(Ce.id===u.id)return e(d).filter(Ve=>Ve.role_type==="Master Admin"&&Ve.status==="active").length>1}return!1})}),Va(),ha();var Te=w6(),ye=c(o(Te),2),P=o(ye),pe=o(P),B=o(pe);At(B),Et(2),n(pe),n(P);var j=c(P,2),I=o(j);R(()=>{e(T),Xt(()=>{})}),Mt(I,5,()=>F,Lt,(Ce,_e)=>{var Ve=s6(),Je=o(Ve,!0);n(Ve);var st={};R(()=>{y(Je,(e(_e),m(()=>e(_e).label))),st!==(st=(e(_e),m(()=>e(_e).value)))&&(Ve.value=(Ve.__value=(e(_e),m(()=>e(_e).value)))??"")}),g(Ce,Ve)}),n(I);var Y=c(I,2);R(()=>{e(b),Xt(()=>{})}),Mt(Y,5,()=>re,Lt,(Ce,_e)=>{var Ve=i6(),Je=o(Ve,!0);n(Ve);var st={};R(()=>{y(Je,(e(_e),m(()=>e(_e).label))),st!==(st=(e(_e),m(()=>e(_e).value)))&&(Ve.value=(Ve.__value=(e(_e),m(()=>e(_e).value)))??"")}),g(Ce,Ve)}),n(Y);var fe=c(Y,2);R(()=>{e(w),Xt(()=>{})}),Mt(fe,5,()=>me,Lt,(Ce,_e)=>{var Ve=n6(),Je=o(Ve,!0);n(Ve);var st={};R(()=>{y(Je,(e(_e),m(()=>e(_e).label))),st!==(st=(e(_e),m(()=>e(_e).value)))&&(Ve.value=(Ve.__value=(e(_e),m(()=>e(_e).value)))??"")}),g(Ce,Ve)}),n(fe);var ce=c(fe,2),J=o(ce,!0);n(ce),n(j);var le=c(j,2),S=o(le),De=c(S,2);n(le),n(ye);var Ue=c(ye,2);{var We=Ce=>{var _e=c6(),Ve=o(_e),Je=o(Ve),st=o(Je);n(Je);var ot=c(Je,2);n(Ve);var Le=c(Ve,2),nt=o(Le);R(()=>{e(z),Xt(()=>{})});var vt=o(nt);vt.value=vt.__value="";var xt=c(vt);Mt(xt,1,()=>ue,Lt,(ne,ie)=>{var Se=o6(),Qe=o(Se,!0);n(Se);var je={};R(()=>{y(Qe,(e(ie),m(()=>e(ie).label))),je!==(je=(e(ie),m(()=>e(ie).value)))&&(Se.value=(Se.__value=(e(ie),m(()=>e(ie).value)))??"")}),g(ne,Se)}),n(nt);var M=c(nt,2),H=o(M);{var O=ne=>{var ie=l6();g(ne,ie)},te=ne=>{var ie=Ya("Apply");g(ne,ie)};X(H,ne=>{e(f)?ne(O):ne(te,!1)})}n(M),n(Le),n(_e),R(()=>{y(st,`${e(s)??""} selected`),M.disabled=!e(z)||e(f)}),Z("click",ot,q),ra(nt,()=>e(z),ne=>p(z,ne)),Z("click",M,Me),g(Ce,_e)};X(Ue,Ce=>{e(s)>0&&Ce(We)})}var ke=c(Ue,2),N=o(ke),V=o(N),G=o(V),de=o(G);At(de),n(G),Et(12),n(V);var ve=c(V,2);Mt(ve,5,()=>e(a),Lt,(Ce,_e)=>{var Ve=_6();let Je;var st=o(Ve),ot=o(st);At(ot),n(st);var Le=c(st,2),nt=o(Le),vt=o(nt);{var xt=Gt=>{var Yt=d6();R(()=>na(Yt,"src",(e(_e),m(()=>e(_e).avatar_url)))),g(Gt,Yt)},M=Gt=>{var Yt=v6();g(Gt,Yt)};X(vt,Gt=>{e(_e),m(()=>e(_e).avatar_url)?Gt(xt):Gt(M,!1)})}n(nt),n(Le);var H=c(Le,2),O=o(H),te=o(O),ne=o(te,!0);n(te);var ie=c(te,2),Se=o(ie,!0);n(ie);var Qe=c(ie,2),je=o(Qe,!0);n(Qe);var ze=c(Qe,2),Re=o(ze,!0);n(ze),n(O),n(H);var it=c(H,2),ft=o(it),mt=o(ft);let ht;var pt=o(mt,!0);n(mt);var _t=c(mt,2),Ge=o(_t);n(_t),n(ft),n(it);var ct=c(it,2),Ze=o(ct),bt=o(Ze),It=c(o(bt),2),Ot=o(It,!0);n(It),n(bt);var Pt=c(bt,2),gt=c(o(Pt),2),yt=o(gt,!0);n(gt),n(Pt),n(Ze),n(ct);var qt=c(ct,2),sa=o(qt),oa=o(sa);let Ia;var ka=c(o(oa),2),St=o(ka,!0);n(ka),n(oa);var Dt=c(oa,2);let Wt;var ea=c(o(Dt),2),Ht=o(ea,!0);n(ea),n(Dt),n(sa),n(qt);var Qt=c(qt,2),la=o(Qt),Ft=o(la),Ct=o(Ft),$t=c(Ct,2);n(Ft);var Zt=c(Ft,2),Da=o(Zt),ta=c(Da,2),Rt=o(ta);{var Ut=Gt=>{var Yt=u6();Z("click",Yt,()=>ae(e(_e),"deactivate")),g(Gt,Yt)},Jt=Gt=>{var Yt=f6();Z("click",Yt,()=>ae(e(_e),"activate")),g(Gt,Yt)};X(Rt,Gt=>{e(_e),m(()=>e(_e).status==="active")?Gt(Ut):Gt(Jt,!1)})}var Ma=c(Rt,2);{var qa=Gt=>{var Yt=p6();Z("click",Yt,()=>ae(e(_e),"unlock")),g(Gt,Yt)},ar=Gt=>{var Yt=h6();Z("click",Yt,()=>ae(e(_e),"lock")),g(Gt,Yt)};X(Ma,Gt=>{e(_e),m(()=>e(_e).is_locked)?Gt(qa):Gt(ar,!1)})}var Ga=c(Ma,2),Qa=c(Ga,2);{var _a=Gt=>{var Yt=m6();Z("click",Yt,()=>ae(e(_e),"delete")),g(Gt,Yt)};X(Qa,Gt=>{e(_e),m(()=>e(_e).id!==u.id)&&Gt(_a)})}n(ta),n(Zt),n(la),n(Qt),n(Ve),R((Gt,Yt,ia,ga,aa,jt,Vt,ca,ya,ua,va,Ta)=>{Je=wt(Ve,1,"table-row svelte-1fk8ioe",null,Je,Gt),vs(ot,Yt),y(ne,(e(_e),m(()=>e(_e).username))),y(Se,(e(_e),m(()=>e(_e).full_name))),y(je,(e(_e),m(()=>e(_e).email))),y(Re,(e(_e),m(()=>e(_e).branch_name))),ht=wt(mt,1,"role-badge svelte-1fk8ioe",null,ht,ia),y(pt,(e(_e),m(()=>e(_e).role_type))),$r(_t,`color: ${ga??""}`),y(Ge,`${aa??""} ${e(_e),m(()=>e(_e).status)??""}`),y(Ot,jt),y(yt,Vt),Ia=wt(oa,1,"security-item svelte-1fk8ioe",null,Ia,ca),y(St,(e(_e),m(()=>e(_e).login_attempts))),Wt=wt(Dt,1,"security-item svelte-1fk8ioe",null,Wt,ya),y(Ht,(e(_e),m(()=>e(_e).is_locked?"🔒 Locked":"🔓 Open"))),Ct.disabled=ua,$t.disabled=va,Da.disabled=Ta},[()=>({selected:e(C).has(e(_e).id)}),()=>(e(C),e(_e),m(()=>e(C).has(e(_e).id))),()=>({master:e(_e).role_type==="Master Admin"}),()=>(e(_e),m(()=>E(e(_e).status))),()=>(e(_e),m(()=>he(e(_e).status))),()=>(e(_e),m(()=>D(e(_e).last_login))),()=>(e(_e),m(()=>D(e(_e).created_at))),()=>({warning:e(_e).login_attempts>0}),()=>({danger:e(_e).is_locked}),()=>(e(i),e(_e),m(()=>!e(i)(e(_e)))),()=>(e(i),e(_e),m(()=>!e(i)(e(_e)))),()=>(e(i),e(_e),m(()=>!e(i)(e(_e))))]),Z("change",ot,()=>xe(e(_e).id)),Z("click",Ct,()=>ge(e(_e))),Z("click",$t,()=>Ne(e(_e))),Z("click",Ga,()=>ae(e(_e),"reset_password")),g(Ce,Ve)}),n(ve),n(N);var Ie=c(N,2);{var Ye=Ce=>{var _e=g6(),Ve=c(o(_e),6);n(_e),Z("click",Ve,Be),g(Ce,_e)};X(Ie,Ce=>{e(a),m(()=>e(a).length===0)&&Ce(Ye)})}n(ke);var oe=c(ke,2);{var se=Ce=>{var _e=x6(),Ve=c(o(_e));n(_e),R(()=>y(Ve,` ${e(h),m(()=>e(h).action||e(h).bulk)??""}`)),g(Ce,_e)};X(oe,Ce=>{e(h),m(()=>e(h).action||e(h).bulk)&&Ce(se)})}var U=c(oe,2);{var W=Ce=>{var _e=b6(),Ve=c(o(_e));n(_e),R(()=>y(Ve,` ${e(_)??""}`)),g(Ce,_e)};X(U,Ce=>{e(_)&&Ce(W)})}var ee=c(U,2),we=o(ee),Ae=o(we),He=o(Ae,!0);n(Ae),Et(2),n(we);var Ke=c(we,2),Oe=o(Ke),Ee=o(Oe,!0);n(Oe),Et(2),n(Ke);var et=c(Ke,2),dt=o(et),ut=o(dt,!0);n(dt),Et(2),n(et);var Pe=c(et,2),qe=o(Pe),tt=o(qe,!0);n(qe),Et(2),n(Pe);var lt=c(Pe,2),Xe=o(lt),at=o(Xe,!0);n(Xe),Et(2),n(lt),n(ee);var Fe=c(ee,2),rt=o(Fe);n(Fe),n(Te),R((Ce,_e,Ve,Je)=>{y(J,e(A)==="asc"?"↑":"↓"),vs(de,(e(s),e(a),m(()=>e(s)===e(a).length&&e(a).length>0))),de.indeterminate=(e(s),e(a),m(()=>e(s)>0&&e(s)<e(a).length)),y(He,Ce),y(Ee,_e),y(ut,Ve),y(tt,Je),y(at,(e(a),m(()=>e(a).length)))},[()=>(e(d),m(()=>e(d).filter(Ce=>Ce.status==="active").length)),()=>(e(d),m(()=>e(d).filter(Ce=>Ce.status==="inactive").length)),()=>(e(d),m(()=>e(d).filter(Ce=>Ce.is_locked).length)),()=>(e(d),m(()=>e(d).filter(Ce=>Ce.role_type==="Master Admin").length))]),zt(B,()=>e(x),Ce=>p(x,Ce)),ra(I,()=>e(T),Ce=>p(T,Ce)),ra(Y,()=>e(b),Ce=>p(b,Ce)),ra(fe,()=>e(w),Ce=>p(w,Ce)),Z("click",ce,()=>p(A,e(A)==="asc"?"desc":"asc")),Z("click",S,L),Z("click",De,Be),Z("change",de,K),Z("click",rt,be),g(t,Te),ma()}var k6=k('<span class="primary-badge svelte-1mgwd7k">PRIMARY</span>'),T6=k('<span class="security-badge svelte-1mgwd7k">🔐 2FA</span>'),E6=k('<span class="current-badge svelte-1mgwd7k">YOU</span>'),A6=k('<div class="admin-item svelte-1mgwd7k"><div class="admin-info svelte-1mgwd7k"><span class="admin-name svelte-1mgwd7k"> </span> <!></div> <div class="admin-status svelte-1mgwd7k"><!> <!></div></div>'),S6=k('<div class="activity-item svelte-1mgwd7k"><span class="activity-icon svelte-1mgwd7k"> </span> <div class="activity-details svelte-1mgwd7k"><p class="activity-action svelte-1mgwd7k"> </p> <div class="activity-meta svelte-1mgwd7k"><span class="activity-user svelte-1mgwd7k"> </span> <span class="activity-time svelte-1mgwd7k"> </span></div></div> <span class="activity-severity svelte-1mgwd7k">●</span></div>'),C6=k('<div class="tab-content svelte-1mgwd7k"><div class="health-cards svelte-1mgwd7k"><div><div class="card-header svelte-1mgwd7k"><h3 class="svelte-1mgwd7k">System Health</h3> <span> </span></div> <div class="health-metrics svelte-1mgwd7k"><div class="metric svelte-1mgwd7k"><span class="label svelte-1mgwd7k">Database:</span> <span class="value svelte-1mgwd7k"> </span></div> <div class="metric svelte-1mgwd7k"><span class="label svelte-1mgwd7k">Last Backup:</span> <span class="value svelte-1mgwd7k"> </span></div> <div class="metric svelte-1mgwd7k"><span class="label svelte-1mgwd7k">Uptime:</span> <span class="value svelte-1mgwd7k"> </span></div></div></div> <div class="health-card svelte-1mgwd7k"><div class="card-header svelte-1mgwd7k"><h3 class="svelte-1mgwd7k">Usage Metrics</h3> <span class="metric-icon svelte-1mgwd7k">📊</span></div> <div class="usage-metrics svelte-1mgwd7k"><div class="usage-item svelte-1mgwd7k"><div class="usage-header svelte-1mgwd7k"><span class="svelte-1mgwd7k">Disk Usage</span> <span class="svelte-1mgwd7k"> </span></div> <div class="usage-bar svelte-1mgwd7k"><div></div></div></div> <div class="metric svelte-1mgwd7k"><span class="label svelte-1mgwd7k">Active Sessions:</span> <span class="value svelte-1mgwd7k"> </span></div> <div class="metric svelte-1mgwd7k"><span class="label svelte-1mgwd7k">Failed Logins (24h):</span> <span> </span></div></div></div> <div class="health-card svelte-1mgwd7k"><div class="card-header svelte-1mgwd7k"><h3 class="svelte-1mgwd7k">Master Admins</h3> <span class="admin-count svelte-1mgwd7k"> </span></div> <div class="admin-summary svelte-1mgwd7k"></div></div></div> <div class="quick-actions svelte-1mgwd7k"><h3 class="svelte-1mgwd7k">Emergency Actions</h3> <div class="action-buttons svelte-1mgwd7k"><button class="emergency-btn backup svelte-1mgwd7k">💾 Emergency Backup</button> <button class="emergency-btn security svelte-1mgwd7k">🔒 Security Settings</button> <button class="emergency-btn create svelte-1mgwd7k">👑 Create Master Admin</button></div></div> <div class="activity-preview svelte-1mgwd7k"><div class="section-header svelte-1mgwd7k"><h3 class="svelte-1mgwd7k">Recent System Activities</h3> <button class="view-all-btn svelte-1mgwd7k">View All →</button></div> <div class="activity-list svelte-1mgwd7k"></div></div></div>'),F6=k('<img alt="Avatar" class="avatar-image svelte-1mgwd7k"/>'),D6=k('<div class="avatar-placeholder svelte-1mgwd7k"><span class="avatar-icon svelte-1mgwd7k">👤</span></div>'),M6=k('<span class="badge primary svelte-1mgwd7k">PRIMARY</span>'),I6=k('<span class="badge current svelte-1mgwd7k">YOU</span>'),R6=k('<span class="badge active svelte-1mgwd7k">ACTIVE</span>'),N6=k('<span class="badge inactive svelte-1mgwd7k">INACTIVE</span>'),P6=k('<button class="svelte-1mgwd7k">❌ Deactivate</button>'),L6=k('<button class="svelte-1mgwd7k">✅ Activate</button>'),O6=k('<button class="svelte-1mgwd7k">🔓 Unlock</button>'),z6=k('<button class="svelte-1mgwd7k">❌ Disable 2FA</button>'),B6=k('<button class="svelte-1mgwd7k">🔐 Enable 2FA</button>'),$6=k('<button class="svelte-1mgwd7k">👑 Make Primary</button>'),U6=k('<button class="danger svelte-1mgwd7k">🗑️ Delete</button>'),q6=k('<div><div class="admin-header svelte-1mgwd7k"><div class="admin-avatar svelte-1mgwd7k"><!></div> <div class="admin-basic-info svelte-1mgwd7k"><h4 class="admin-username svelte-1mgwd7k"> </h4> <p class="admin-fullname svelte-1mgwd7k"> </p> <p class="admin-email svelte-1mgwd7k"> </p></div> <div class="admin-badges svelte-1mgwd7k"><!> <!> <!></div></div> <div class="admin-details svelte-1mgwd7k"><div class="detail-row svelte-1mgwd7k"><span class="label svelte-1mgwd7k">Last Login:</span> <span class="value svelte-1mgwd7k"> </span></div> <div class="detail-row svelte-1mgwd7k"><span class="label svelte-1mgwd7k">Created:</span> <span class="value svelte-1mgwd7k"> </span></div> <div class="detail-row svelte-1mgwd7k"><span class="label svelte-1mgwd7k">Two-Factor:</span> <span> </span></div> <div class="detail-row svelte-1mgwd7k"><span class="label svelte-1mgwd7k">Login Attempts:</span> <span> </span></div></div> <div class="admin-actions svelte-1mgwd7k"><button class="action-btn edit svelte-1mgwd7k">✏️ Edit</button> <div class="dropdown svelte-1mgwd7k"><button class="dropdown-btn svelte-1mgwd7k">⋮</button> <div class="dropdown-content svelte-1mgwd7k"><!> <!> <button class="svelte-1mgwd7k">🔐 Reset Password</button> <!> <!> <!></div></div></div></div>'),j6=k('<div class="tab-content svelte-1mgwd7k"><div class="section-header svelte-1mgwd7k"><h3 class="svelte-1mgwd7k">Master Administrator Accounts</h3> <button class="create-btn svelte-1mgwd7k">➕ Create New Master Admin</button></div> <div class="admins-grid svelte-1mgwd7k"></div></div>'),W6=k('<span class="spinner svelte-1mgwd7k"></span> Updating...',1),H6=k('<div class="tab-content svelte-1mgwd7k"><div class="security-settings svelte-1mgwd7k"><h3 class="svelte-1mgwd7k">System Security Configuration</h3> <div class="settings-form svelte-1mgwd7k"><div class="form-row svelte-1mgwd7k"><div class="form-group svelte-1mgwd7k"><label for="max-admins" class="svelte-1mgwd7k">Maximum Master Admins</label> <input id="max-admins" type="number" min="1" max="10" class="form-input svelte-1mgwd7k"/></div> <div class="form-group svelte-1mgwd7k"><label for="password-expiry" class="svelte-1mgwd7k">Password Expiry (Days)</label> <input id="password-expiry" type="number" min="30" max="365" class="form-input svelte-1mgwd7k"/></div></div> <div class="form-row svelte-1mgwd7k"><div class="form-group svelte-1mgwd7k"><label for="session-timeout" class="svelte-1mgwd7k">Session Timeout (Minutes)</label> <input id="session-timeout" type="number" min="5" max="480" class="form-input svelte-1mgwd7k"/></div> <div class="form-group svelte-1mgwd7k"><label for="audit-retention" class="svelte-1mgwd7k">Audit Retention (Days)</label> <input id="audit-retention" type="number" min="90" max="2555" class="form-input svelte-1mgwd7k"/></div></div> <div class="form-row svelte-1mgwd7k"><div class="form-group svelte-1mgwd7k"><label for="backup-frequency" class="svelte-1mgwd7k">Backup Frequency</label> <select id="backup-frequency" class="form-select svelte-1mgwd7k"><option class="svelte-1mgwd7k">Hourly</option><option class="svelte-1mgwd7k">Daily</option><option class="svelte-1mgwd7k">Weekly</option></select></div></div> <div class="checkbox-group svelte-1mgwd7k"><label class="checkbox-label svelte-1mgwd7k"><input type="checkbox" class="form-checkbox svelte-1mgwd7k"/> Require Two-Factor Authentication for all Master Admins</label> <label class="checkbox-label svelte-1mgwd7k"><input type="checkbox" class="form-checkbox svelte-1mgwd7k"/> Enable Emergency Access Override</label></div> <div class="form-actions svelte-1mgwd7k"><button class="save-btn svelte-1mgwd7k"><!></button></div></div></div></div>'),V6=k('<div class="audit-item svelte-1mgwd7k"><div class="audit-icon svelte-1mgwd7k"> </div> <div class="audit-content svelte-1mgwd7k"><div class="audit-header svelte-1mgwd7k"><span class="audit-action svelte-1mgwd7k"> </span> <span class="audit-timestamp svelte-1mgwd7k"> </span></div> <div class="audit-meta svelte-1mgwd7k"><span class="audit-user svelte-1mgwd7k"> </span> <span class="audit-ip svelte-1mgwd7k"> </span> <span class="audit-type svelte-1mgwd7k"> </span></div></div> <div class="audit-severity svelte-1mgwd7k"> </div></div>'),G6=k('<div class="tab-content svelte-1mgwd7k"><div class="audit-log svelte-1mgwd7k"><h3 class="svelte-1mgwd7k">System Audit Log</h3> <div class="audit-list svelte-1mgwd7k"></div></div></div>'),X6=k('<span class="error-message svelte-1mgwd7k"> </span>'),Y6=k('<span class="error-message svelte-1mgwd7k"> </span>'),K6=k('<span class="error-message svelte-1mgwd7k"> </span>'),Q6=k('<div class="error-banner svelte-1mgwd7k"> </div>'),Z6=k('<span class="spinner svelte-1mgwd7k"></span> Creating...',1),J6=k('<div class="modal-overlay svelte-1mgwd7k" role="dialog" aria-modal="true"><div class="modal-content svelte-1mgwd7k" role="document"><div class="modal-header svelte-1mgwd7k"><h2 class="svelte-1mgwd7k">Create New Master Administrator</h2> <button class="close-btn svelte-1mgwd7k">×</button></div> <form class="create-form svelte-1mgwd7k"><div class="form-row svelte-1mgwd7k"><div class="form-group svelte-1mgwd7k"><label for="new-username" class="svelte-1mgwd7k">Username *</label> <input id="new-username" type="text" required/> <!></div> <div class="form-group svelte-1mgwd7k"><label for="new-fullname" class="svelte-1mgwd7k">Full Name *</label> <input id="new-fullname" type="text" required/> <!></div></div> <div class="form-row svelte-1mgwd7k"><div class="form-group svelte-1mgwd7k"><label for="new-email" class="svelte-1mgwd7k">Primary Email *</label> <input id="new-email" type="email" required/> <!></div> <div class="form-group svelte-1mgwd7k"><label for="new-backup-email" class="svelte-1mgwd7k">Backup Email</label> <input id="new-backup-email" type="email" class="form-input svelte-1mgwd7k"/></div></div> <div class="form-row svelte-1mgwd7k"><div class="form-group svelte-1mgwd7k"><label for="new-phone" class="svelte-1mgwd7k">Phone Number</label> <input id="new-phone" type="tel" class="form-input svelte-1mgwd7k" placeholder="+1-234-567-8900"/></div> <div class="form-group svelte-1mgwd7k"><label for="new-emergency" class="svelte-1mgwd7k">Emergency Contact Email</label> <input id="new-emergency" type="email" class="form-input svelte-1mgwd7k"/></div></div> <div class="checkbox-group svelte-1mgwd7k"><label class="checkbox-label svelte-1mgwd7k"><input type="checkbox" class="form-checkbox svelte-1mgwd7k"/> Require Two-Factor Authentication</label> <label class="checkbox-label svelte-1mgwd7k"><input type="checkbox" class="form-checkbox svelte-1mgwd7k"/> Send Welcome Email with Login Instructions</label></div> <!> <div class="modal-actions svelte-1mgwd7k"><button type="button" class="cancel-btn svelte-1mgwd7k">Cancel</button> <button type="submit" class="create-btn svelte-1mgwd7k"><!></button></div></form></div></div>'),eE=k('<div class="error-banner svelte-1mgwd7k"><strong class="svelte-1mgwd7k">Error:</strong> </div>'),tE=k('<div class="success-banner svelte-1mgwd7k"><strong class="svelte-1mgwd7k">Success:</strong> </div>'),aE=k('<div class="manage-master-admin svelte-1mgwd7k"><div class="header svelte-1mgwd7k"><h1 class="title svelte-1mgwd7k">Master Administrator Control Center</h1> <p class="subtitle svelte-1mgwd7k">Ultimate system control and oversight</p></div> <div class="tab-nav svelte-1mgwd7k"><button>🏠 Overview</button> <button>👑 Master Admins</button> <button>🔒 Security</button> <button>📋 Audit Log</button></div> <!> <!> <!> <!> <!> <!> <!> <div class="window-actions svelte-1mgwd7k"><button class="close-window-btn svelte-1mgwd7k">Close Control Center</button></div></div>');function rE(t,r){pa(r,!1);const a=Q(),s=Q(),i=Q(),l=Jr();let d=Q([]);async function v(){try{const G=await yr.getAllUsers();p(d,G.filter(de=>de.role_type==="Master Admin"))}catch(G){console.error("Error loading master admin users:",G)}}Aa(()=>{v()});let u=Q({max_master_admins:5,require_two_factor:!0,password_expiry_days:90,session_timeout_minutes:30,backup_frequency:"daily",audit_retention_days:365,emergency_access_enabled:!0}),f=Q({database_status:"healthy",backup_status:"completed",last_backup:"2024-01-15T02:00:00Z",disk_usage:68,active_sessions:23,failed_logins_24h:5,system_uptime:"15 days, 6 hours"}),h=[{id:"1",type:"login",user:"master.backup",action:"Successful login",timestamp:"2024-01-15T14:22:00Z",ip:"192.168.1.100",severity:"info"},{id:"2",type:"admin_action",user:"masteradmin",action:"Created new admin user: admin.john",timestamp:"2024-01-15T10:45:00Z",ip:"192.168.1.101",severity:"success"},{id:"3",type:"security",user:"unknown",action:"Failed login attempt from suspicious IP",timestamp:"2024-01-15T08:15:00Z",ip:"203.0.113.42",severity:"warning"},{id:"4",type:"system",user:"system",action:"Daily backup completed successfully",timestamp:"2024-01-15T02:00:00Z",ip:"localhost",severity:"success"},{id:"5",type:"admin_action",user:"masteradmin",action:"Updated system security settings",timestamp:"2024-01-14T16:30:00Z",ip:"192.168.1.101",severity:"info"}],_=Q(!1),x=Q({}),T=Q(""),b=Q("overview"),w=Q(!1),A=Q(!1),C=Q({username:"",email:"",full_name:"",backup_email:"",phone:"",emergency_contact:"",require_two_factor:!0,send_welcome_email:!0}),z=Q({...e(u)});function F(){return[e(f).disk_usage>80,e(f).failed_logins_24h>10,e(f).database_status!=="healthy"].some(de=>de)?"warning":e(f).backup_status==="completed"?"healthy":"error"}function re(G){const de=new Date(G);return de.toLocaleDateString()+" "+de.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}function me(G){switch(G){case"login":return"🔑";case"admin_action":return"⚙️";case"security":return"🔒";case"system":return"🖥️";default:return"📋"}}function ue(G){switch(G){case"success":return"#059669";case"warning":return"#f59e0b";case"error":return"#dc2626";default:return"#6b7280"}}async function D(){if(p(x,{}),e(C).username.trim()||$e(x,e(x).username="Username is required"),e(C).email.trim()||$e(x,e(x).email="Email is required"),e(C).full_name.trim()||$e(x,e(x).full_name="Full name is required"),!(Object.keys(e(x)).length>0)){if(!e(s)){$e(x,e(x).create="Maximum number of Master Administrators reached");return}p(_,!0),p(T,"");try{await new Promise(ve=>setTimeout(ve,2e3));const de={id:(e(d).length+1).toString(),...e(C),status:"active",last_login:null,created_at:new Date().toISOString(),avatar_url:null,login_attempts:0,is_locked:!1,last_password_change:new Date().toISOString(),is_primary:!1,two_factor_enabled:e(C).require_two_factor,is_current_user:!1};p(d,[...e(d),de]),p(T,`Master Administrator "${e(C).username}" created successfully!`),p(C,{username:"",email:"",full_name:"",backup_email:"",phone:"",emergency_contact:"",require_two_factor:!0,send_welcome_email:!0}),p(w,!1),setTimeout(()=>p(T,""),3e3)}catch(G){$e(x,e(x).create=G.message||"Failed to create Master Administrator")}finally{p(_,!1)}}}async function E(G,de){if(G.is_primary&&(de==="deactivate"||de==="delete")){$e(x,e(x).action="Cannot deactivate or delete the primary Master Administrator");return}if(de==="deactivate"&&e(a).length<=1){$e(x,e(x).action="Cannot deactivate the last active Master Administrator");return}p(_,!0),p(x,{}),p(T,"");try{switch(await new Promise(ve=>setTimeout(ve,1e3)),de){case"activate":G.status="active",G.is_locked=!1,G.login_attempts=0,p(T,`${G.username} has been activated`);break;case"deactivate":G.status="inactive",p(T,`${G.username} has been deactivated`);break;case"unlock":G.is_locked=!1,G.login_attempts=0,G.status="active",p(T,`${G.username} has been unlocked`);break;case"reset_password":G.last_password_change=new Date().toISOString(),p(T,`Password reset email sent to ${G.email}`);break;case"enable_2fa":G.two_factor_enabled=!0,p(T,`Two-factor authentication enabled for ${G.username}`);break;case"disable_2fa":G.two_factor_enabled=!1,p(T,`Two-factor authentication disabled for ${G.username}`);break;case"make_primary":e(d).forEach(ve=>ve.is_primary=!1),G.is_primary=!0,p(T,`${G.username} is now the primary Master Administrator`);break;case"delete":p(d,e(d).filter(ve=>ve.id!==G.id)),p(T,`${G.username} has been deleted`);break}setTimeout(()=>p(T,""),3e3)}catch(ve){$e(x,e(x).action=ve.message||"Action failed")}finally{p(_,!1)}}async function he(){p(_,!0),p(x,{}),p(T,"");try{await new Promise(G=>setTimeout(G,1500)),p(u,{...e(z)}),p(T,"Security settings updated successfully!"),p(A,!1),setTimeout(()=>p(T,""),3e3)}catch(G){$e(x,e(x).security=G.message||"Failed to update security settings")}finally{p(_,!1)}}function xe(){p(_,!0),p(T,""),setTimeout(()=>{p(T,"Emergency backup initiated successfully!"),$e(f,e(f).backup_status="in_progress"),p(_,!1),setTimeout(()=>{$e(f,e(f).backup_status="completed"),$e(f,e(f).last_backup=new Date().toISOString())},5e3)},2e3)}function K(G){l("editUser",G)}function q(){l("close")}Nt(()=>e(d),()=>{p(a,e(d).filter(G=>G.status==="active"))}),Nt(()=>(e(a),e(u)),()=>{p(s,e(a).length<e(u).max_master_admins)}),Nt(()=>{},()=>{p(i,F())}),Va(),ha();var ae=aE(),Me=c(o(ae),2),ge=o(Me);let Ne;var Be=c(ge,2);let be;var L=c(Be,2);let Te;var ye=c(L,2);let P;n(Me);var pe=c(Me,2);{var B=G=>{var de=C6(),ve=o(de),Ie=o(ve);let Ye;var oe=o(Ie),se=c(o(oe),2);let U;var W=o(se,!0);n(se),n(oe);var ee=c(oe,2),we=o(ee),Ae=c(o(we),2),He=o(Ae,!0);n(Ae),n(we);var Ke=c(we,2),Oe=c(o(Ke),2),Ee=o(Oe,!0);n(Oe),n(Ke);var et=c(Ke,2),dt=c(o(et),2),ut=o(dt,!0);n(dt),n(et),n(ee),n(Ie);var Pe=c(Ie,2),qe=c(o(Pe),2),tt=o(qe),lt=o(tt),Xe=c(o(lt),2),at=o(Xe);n(Xe),n(lt);var Fe=c(lt,2),rt=o(Fe);let Ce;n(Fe),n(tt);var _e=c(tt,2),Ve=c(o(_e),2),Je=o(Ve,!0);n(Ve),n(_e);var st=c(_e,2),ot=c(o(st),2);let Le;var nt=o(ot,!0);n(ot),n(st),n(qe),n(Pe);var vt=c(Pe,2),xt=o(vt),M=c(o(xt),2),H=o(M);n(M),n(xt);var O=c(xt,2);Mt(O,5,()=>e(a),Lt,(ft,mt)=>{var ht=A6(),pt=o(ht),_t=o(pt),Ge=o(_t,!0);n(_t);var ct=c(_t,2);{var Ze=yt=>{var qt=k6();g(yt,qt)};X(ct,yt=>{e(mt),m(()=>e(mt).is_primary)&&yt(Ze)})}n(pt);var bt=c(pt,2),It=o(bt);{var Ot=yt=>{var qt=T6();g(yt,qt)};X(It,yt=>{e(mt),m(()=>e(mt).two_factor_enabled)&&yt(Ot)})}var Pt=c(It,2);{var gt=yt=>{var qt=E6();g(yt,qt)};X(Pt,yt=>{e(mt),m(()=>e(mt).is_current_user)&&yt(gt)})}n(bt),n(ht),R(()=>y(Ge,(e(mt),m(()=>e(mt).username)))),g(ft,ht)}),n(O),n(vt),n(ve);var te=c(ve,2),ne=c(o(te),2),ie=o(ne),Se=c(ie,2),Qe=c(Se,2);n(ne),n(te);var je=c(te,2),ze=o(je),Re=c(o(ze),2);n(ze);var it=c(ze,2);Mt(it,5,()=>m(()=>h.slice(0,5)),Lt,(ft,mt)=>{var ht=S6(),pt=o(ht),_t=o(pt,!0);n(pt);var Ge=c(pt,2),ct=o(Ge),Ze=o(ct,!0);n(ct);var bt=c(ct,2),It=o(bt),Ot=o(It,!0);n(It);var Pt=c(It,2),gt=o(Pt,!0);n(Pt),n(bt),n(Ge);var yt=c(Ge,2);n(ht),R((qt,sa,oa)=>{y(_t,qt),y(Ze,(e(mt),m(()=>e(mt).action))),y(Ot,(e(mt),m(()=>e(mt).user))),y(gt,sa),$r(yt,`color: ${oa??""}`)},[()=>(e(mt),m(()=>me(e(mt).type))),()=>(e(mt),m(()=>re(e(mt).timestamp))),()=>(e(mt),m(()=>ue(e(mt).severity)))]),g(ft,ht)}),n(it),n(je),n(de),R((ft,mt,ht,pt,_t)=>{Ye=wt(Ie,1,"health-card svelte-1mgwd7k",null,Ye,ft),U=wt(se,1,"health-indicator svelte-1mgwd7k",null,U,mt),y(W,e(i)==="healthy"?"🟢":e(i)==="warning"?"🟡":"🔴"),y(He,(e(f),m(()=>e(f).database_status))),y(Ee,ht),y(ut,(e(f),m(()=>e(f).system_uptime))),y(at,`${e(f),m(()=>e(f).disk_usage)??""}%`),Ce=wt(rt,1,"usage-fill svelte-1mgwd7k",null,Ce,pt),$r(rt,`width: ${e(f),m(()=>e(f).disk_usage)??""}%`),y(Je,(e(f),m(()=>e(f).active_sessions))),Le=wt(ot,1,"value svelte-1mgwd7k",null,Le,_t),y(nt,(e(f),m(()=>e(f).failed_logins_24h))),y(H,`${e(a),m(()=>e(a).length)??""}/${e(u),m(()=>e(u).max_master_admins)??""}`),ie.disabled=e(_),Qe.disabled=!e(s)},[()=>({warning:e(i)==="warning",error:e(i)==="error"}),()=>({healthy:e(i)==="healthy",warning:e(i)==="warning",error:e(i)==="error"}),()=>(e(f),m(()=>re(e(f).last_backup))),()=>({warning:e(f).disk_usage>80}),()=>({warning:e(f).failed_logins_24h>5})]),Z("click",ie,xe),Z("click",Se,()=>p(A,!0)),Z("click",Qe,()=>p(w,!0)),Z("click",Re,()=>p(b,"audit")),g(G,de)};X(pe,G=>{e(b)==="overview"&&G(B)})}var j=c(pe,2);{var I=G=>{var de=j6(),ve=o(de),Ie=c(o(ve),2);n(ve);var Ye=c(ve,2);Mt(Ye,5,()=>e(d),Lt,(oe,se)=>{var U=q6();let W;var ee=o(U),we=o(ee),Ae=o(we);{var He=gt=>{var yt=F6();R(()=>na(yt,"src",(e(se),m(()=>e(se).avatar_url)))),g(gt,yt)},Ke=gt=>{var yt=D6();g(gt,yt)};X(Ae,gt=>{e(se),m(()=>e(se).avatar_url)?gt(He):gt(Ke,!1)})}n(we);var Oe=c(we,2),Ee=o(Oe),et=o(Ee,!0);n(Ee);var dt=c(Ee,2),ut=o(dt,!0);n(dt);var Pe=c(dt,2),qe=o(Pe,!0);n(Pe),n(Oe);var tt=c(Oe,2),lt=o(tt);{var Xe=gt=>{var yt=M6();g(gt,yt)};X(lt,gt=>{e(se),m(()=>e(se).is_primary)&&gt(Xe)})}var at=c(lt,2);{var Fe=gt=>{var yt=I6();g(gt,yt)};X(at,gt=>{e(se),m(()=>e(se).is_current_user)&&gt(Fe)})}var rt=c(at,2);{var Ce=gt=>{var yt=R6();g(gt,yt)},_e=gt=>{var yt=N6();g(gt,yt)};X(rt,gt=>{e(se),m(()=>e(se).status==="active")?gt(Ce):gt(_e,!1)})}n(tt),n(ee);var Ve=c(ee,2),Je=o(Ve),st=c(o(Je),2),ot=o(st,!0);n(st),n(Je);var Le=c(Je,2),nt=c(o(Le),2),vt=o(nt,!0);n(nt),n(Le);var xt=c(Le,2),M=c(o(xt),2);let H;var O=o(M,!0);n(M),n(xt);var te=c(xt,2),ne=c(o(te),2);let ie;var Se=o(ne,!0);n(ne),n(te),n(Ve);var Qe=c(Ve,2),je=o(Qe),ze=c(je,2),Re=c(o(ze),2),it=o(Re);{var ft=gt=>{var yt=Ca(),qt=Bt(yt);{var sa=oa=>{var Ia=P6();Z("click",Ia,()=>E(e(se),"deactivate")),g(oa,Ia)};X(qt,oa=>{e(se),e(a),m(()=>!e(se).is_primary&&!(e(se).is_current_user&&e(a).length<=1))&&oa(sa)})}g(gt,yt)},mt=gt=>{var yt=L6();Z("click",yt,()=>E(e(se),"activate")),g(gt,yt)};X(it,gt=>{e(se),m(()=>e(se).status==="active")?gt(ft):gt(mt,!1)})}var ht=c(it,2);{var pt=gt=>{var yt=O6();Z("click",yt,()=>E(e(se),"unlock")),g(gt,yt)};X(ht,gt=>{e(se),m(()=>e(se).is_locked)&&gt(pt)})}var _t=c(ht,2),Ge=c(_t,2);{var ct=gt=>{var yt=z6();Z("click",yt,()=>E(e(se),"disable_2fa")),g(gt,yt)},Ze=gt=>{var yt=B6();Z("click",yt,()=>E(e(se),"enable_2fa")),g(gt,yt)};X(Ge,gt=>{e(se),m(()=>e(se).two_factor_enabled)?gt(ct):gt(Ze,!1)})}var bt=c(Ge,2);{var It=gt=>{var yt=$6();Z("click",yt,()=>E(e(se),"make_primary")),g(gt,yt)};X(bt,gt=>{e(se),m(()=>!e(se).is_primary)&&gt(It)})}var Ot=c(bt,2);{var Pt=gt=>{var yt=U6();Z("click",yt,()=>E(e(se),"delete")),g(gt,yt)};X(Ot,gt=>{e(se),m(()=>!e(se).is_primary&&!e(se).is_current_user)&&gt(Pt)})}n(Re),n(ze),n(Qe),n(U),R((gt,yt,qt,sa,oa)=>{W=wt(U,1,"admin-card svelte-1mgwd7k",null,W,gt),y(et,(e(se),m(()=>e(se).username))),y(ut,(e(se),m(()=>e(se).full_name))),y(qe,(e(se),m(()=>e(se).email))),y(ot,yt),y(vt,qt),H=wt(M,1,"value svelte-1mgwd7k",null,H,sa),y(O,(e(se),m(()=>e(se).two_factor_enabled?"🔐 Enabled":"❌ Disabled"))),ie=wt(ne,1,"value svelte-1mgwd7k",null,ie,oa),y(Se,(e(se),m(()=>e(se).login_attempts)))},[()=>({current:e(se).is_current_user,primary:e(se).is_primary,inactive:e(se).status!=="active"}),()=>(e(se),m(()=>e(se).last_login?re(e(se).last_login):"Never")),()=>(e(se),m(()=>re(e(se).created_at))),()=>({enabled:e(se).two_factor_enabled}),()=>({warning:e(se).login_attempts>0})]),Z("click",je,()=>K(e(se))),Z("click",_t,()=>E(e(se),"reset_password")),g(oe,U)}),n(Ye),n(de),R(()=>Ie.disabled=!e(s)),Z("click",Ie,()=>p(w,!0)),g(G,de)};X(j,G=>{e(b)==="admins"&&G(I)})}var Y=c(j,2);{var fe=G=>{var de=H6(),ve=o(de),Ie=c(o(ve),2),Ye=o(Ie),oe=o(Ye),se=c(o(oe),2);At(se),n(oe);var U=c(oe,2),W=c(o(U),2);At(W),n(U),n(Ye);var ee=c(Ye,2),we=o(ee),Ae=c(o(we),2);At(Ae),n(we);var He=c(we,2),Ke=c(o(He),2);At(Ke),n(He),n(ee);var Oe=c(ee,2),Ee=o(Oe),et=c(o(Ee),2);R(()=>{e(z),Xt(()=>{})});var dt=o(et);dt.value=dt.__value="hourly";var ut=c(dt);ut.value=ut.__value="daily";var Pe=c(ut);Pe.value=Pe.__value="weekly",n(et),n(Ee),n(Oe);var qe=c(Oe,2),tt=o(qe),lt=o(tt);At(lt),Et(),n(tt);var Xe=c(tt,2),at=o(Xe);At(at),Et(),n(Xe),n(qe);var Fe=c(qe,2),rt=o(Fe),Ce=o(rt);{var _e=Je=>{var st=W6();Et(),g(Je,st)},Ve=Je=>{var st=Ya("💾 Save Security Settings");g(Je,st)};X(Ce,Je=>{e(_)?Je(_e):Je(Ve,!1)})}n(rt),n(Fe),n(Ie),n(ve),n(de),R(()=>rt.disabled=e(_)),zt(se,()=>e(z).max_master_admins,Je=>$e(z,e(z).max_master_admins=Je)),zt(W,()=>e(z).password_expiry_days,Je=>$e(z,e(z).password_expiry_days=Je)),zt(Ae,()=>e(z).session_timeout_minutes,Je=>$e(z,e(z).session_timeout_minutes=Je)),zt(Ke,()=>e(z).audit_retention_days,Je=>$e(z,e(z).audit_retention_days=Je)),ra(et,()=>e(z).backup_frequency,Je=>$e(z,e(z).backup_frequency=Je)),tr(lt,()=>e(z).require_two_factor,Je=>$e(z,e(z).require_two_factor=Je)),tr(at,()=>e(z).emergency_access_enabled,Je=>$e(z,e(z).emergency_access_enabled=Je)),Z("click",rt,he),g(G,de)};X(Y,G=>{e(b)==="security"&&G(fe)})}var ce=c(Y,2);{var J=G=>{var de=G6(),ve=o(de),Ie=c(o(ve),2);Mt(Ie,5,()=>h,Lt,(Ye,oe)=>{var se=V6(),U=o(se),W=o(U,!0);n(U);var ee=c(U,2),we=o(ee),Ae=o(we),He=o(Ae,!0);n(Ae);var Ke=c(Ae,2),Oe=o(Ke,!0);n(Ke),n(we);var Ee=c(we,2),et=o(Ee),dt=o(et);n(et);var ut=c(et,2),Pe=o(ut);n(ut);var qe=c(ut,2),tt=o(qe);n(qe),n(Ee),n(ee);var lt=c(ee,2),Xe=o(lt,!0);n(lt),n(se),R((at,Fe,rt,Ce)=>{$r(U,`color: ${at??""}`),y(W,Fe),y(He,(e(oe),m(()=>e(oe).action))),y(Oe,rt),y(dt,`User: ${e(oe),m(()=>e(oe).user)??""}`),y(Pe,`IP: ${e(oe),m(()=>e(oe).ip)??""}`),y(tt,`Type: ${e(oe),m(()=>e(oe).type)??""}`),$r(lt,`background: ${Ce??""}`),y(Xe,(e(oe),m(()=>e(oe).severity)))},[()=>(e(oe),m(()=>ue(e(oe).severity))),()=>(e(oe),m(()=>me(e(oe).type))),()=>(e(oe),m(()=>re(e(oe).timestamp))),()=>(e(oe),m(()=>ue(e(oe).severity)))]),g(Ye,se)}),n(Ie),n(ve),n(de),g(G,de)};X(ce,G=>{e(b)==="audit"&&G(J)})}var le=c(ce,2);{var S=G=>{var de=J6(),ve=o(de),Ie=o(ve),Ye=c(o(Ie),2);n(Ie);var oe=c(Ie,2),se=o(oe),U=o(se),W=c(o(U),2);At(W);let ee;var we=c(W,2);{var Ae=Se=>{var Qe=X6(),je=o(Qe,!0);n(Qe),R(()=>y(je,(e(x),m(()=>e(x).username)))),g(Se,Qe)};X(we,Se=>{e(x),m(()=>e(x).username)&&Se(Ae)})}n(U);var He=c(U,2),Ke=c(o(He),2);At(Ke);let Oe;var Ee=c(Ke,2);{var et=Se=>{var Qe=Y6(),je=o(Qe,!0);n(Qe),R(()=>y(je,(e(x),m(()=>e(x).full_name)))),g(Se,Qe)};X(Ee,Se=>{e(x),m(()=>e(x).full_name)&&Se(et)})}n(He),n(se);var dt=c(se,2),ut=o(dt),Pe=c(o(ut),2);At(Pe);let qe;var tt=c(Pe,2);{var lt=Se=>{var Qe=K6(),je=o(Qe,!0);n(Qe),R(()=>y(je,(e(x),m(()=>e(x).email)))),g(Se,Qe)};X(tt,Se=>{e(x),m(()=>e(x).email)&&Se(lt)})}n(ut);var Xe=c(ut,2),at=c(o(Xe),2);At(at),n(Xe),n(dt);var Fe=c(dt,2),rt=o(Fe),Ce=c(o(rt),2);At(Ce),n(rt);var _e=c(rt,2),Ve=c(o(_e),2);At(Ve),n(_e),n(Fe);var Je=c(Fe,2),st=o(Je),ot=o(st);At(ot),Et(),n(st);var Le=c(st,2),nt=o(Le);At(nt),Et(),n(Le),n(Je);var vt=c(Je,2);{var xt=Se=>{var Qe=Q6(),je=o(Qe,!0);n(Qe),R(()=>y(je,(e(x),m(()=>e(x).create)))),g(Se,Qe)};X(vt,Se=>{e(x),m(()=>e(x).create)&&Se(xt)})}var M=c(vt,2),H=o(M),O=c(H,2),te=o(O);{var ne=Se=>{var Qe=Z6();Et(),g(Se,Qe)},ie=Se=>{var Qe=Ya("👑 Create Master Admin");g(Se,Qe)};X(te,Se=>{e(_)?Se(ne):Se(ie,!1)})}n(O),n(M),n(oe),n(ve),n(de),R((Se,Qe,je)=>{ee=wt(W,1,"form-input svelte-1mgwd7k",null,ee,Se),Oe=wt(Ke,1,"form-input svelte-1mgwd7k",null,Oe,Qe),qe=wt(Pe,1,"form-input svelte-1mgwd7k",null,qe,je),O.disabled=e(_)},[()=>({error:e(x).username}),()=>({error:e(x).full_name}),()=>({error:e(x).email})]),Z("click",Ye,()=>p(w,!1)),zt(W,()=>e(C).username,Se=>$e(C,e(C).username=Se)),zt(Ke,()=>e(C).full_name,Se=>$e(C,e(C).full_name=Se)),zt(Pe,()=>e(C).email,Se=>$e(C,e(C).email=Se)),zt(at,()=>e(C).backup_email,Se=>$e(C,e(C).backup_email=Se)),zt(Ce,()=>e(C).phone,Se=>$e(C,e(C).phone=Se)),zt(Ve,()=>e(C).emergency_contact,Se=>$e(C,e(C).emergency_contact=Se)),tr(ot,()=>e(C).require_two_factor,Se=>$e(C,e(C).require_two_factor=Se)),tr(nt,()=>e(C).send_welcome_email,Se=>$e(C,e(C).send_welcome_email=Se)),Z("click",H,()=>p(w,!1)),Z("submit",oe,Ur(D)),Z("click",ve,ir(function(Se){Or.call(this,r,Se)})),Z("keydown",ve,ir(function(Se){Or.call(this,r,Se)})),Z("click",de,()=>p(w,!1)),Z("keydown",de,Se=>Se.key==="Escape"&&p(w,!1)),g(G,de)};X(le,G=>{e(w)&&G(S)})}var De=c(le,2);{var Ue=G=>{var de=eE(),ve=c(o(de));n(de),R(()=>y(ve,` ${e(x),m(()=>e(x).action||e(x).security)??""}`)),g(G,de)};X(De,G=>{e(x),m(()=>e(x).action||e(x).security)&&G(Ue)})}var We=c(De,2);{var ke=G=>{var de=tE(),ve=c(o(de));n(de),R(()=>y(ve,` ${e(T)??""}`)),g(G,de)};X(We,G=>{e(T)&&G(ke)})}var N=c(We,2),V=o(N);n(N),n(ae),R((G,de,ve,Ie)=>{Ne=wt(ge,1,"tab-btn svelte-1mgwd7k",null,Ne,G),be=wt(Be,1,"tab-btn svelte-1mgwd7k",null,be,de),Te=wt(L,1,"tab-btn svelte-1mgwd7k",null,Te,ve),P=wt(ye,1,"tab-btn svelte-1mgwd7k",null,P,Ie)},[()=>({active:e(b)==="overview"}),()=>({active:e(b)==="admins"}),()=>({active:e(b)==="security"}),()=>({active:e(b)==="audit"})]),Z("click",ge,()=>p(b,"overview")),Z("click",Be,()=>p(b,"admins")),Z("click",L,()=>p(b,"security")),Z("click",ye,()=>p(b,"audit")),Z("click",V,q),g(t,ae),ma()}var sE=k('<div class="loading-container svelte-ejc1lo"><div class="loading-spinner svelte-ejc1lo"></div> <p class="svelte-ejc1lo">Loading user management data...</p></div>'),iE=k('<div class="error-container svelte-ejc1lo"><div class="error-message svelte-ejc1lo"><h3 class="svelte-ejc1lo">Error Loading Data</h3> <p class="svelte-ejc1lo"> </p> <button class="retry-btn svelte-ejc1lo">🔄 Retry</button></div></div>'),nE=k('<button class="dashboard-card svelte-ejc1lo" tabindex="0"><div><span class="icon"> </span></div> <div class="card-content svelte-ejc1lo"><h3 class="card-title svelte-ejc1lo"> </h3> <p class="card-description svelte-ejc1lo"> </p></div> <div class="card-arrow svelte-ejc1lo"><span>→</span></div></button>'),oE=k("<option> </option>"),lE=k("<option> </option>"),cE=k("<option> </option>"),dE=k('<button class="clear-filters-btn svelte-ejc1lo">Clear Filters</button>'),vE=k('<div class="empty-state svelte-ejc1lo"><div class="empty-icon svelte-ejc1lo">👤</div> <h3 class="svelte-ejc1lo">No Users Found</h3> <p class="svelte-ejc1lo">No users match your current search and filter criteria.</p> <!></div>'),uE=k('<img alt="Avatar" class="user-avatar svelte-ejc1lo"/>'),fE=k('<div class="avatar-placeholder svelte-ejc1lo"><span class="avatar-initials svelte-ejc1lo"> </span></div>'),pE=k('<span class="never-logged-in svelte-ejc1lo">Never</span>'),hE=k('<tr class="svelte-ejc1lo"><td class="avatar-cell svelte-ejc1lo"><!></td><td class="username-cell svelte-ejc1lo"><span class="username svelte-ejc1lo"> </span></td><td class="employee-cell svelte-ejc1lo"> </td><td class="branch-cell svelte-ejc1lo"> </td><td class="role-cell svelte-ejc1lo"><span> </span></td><td class="status-cell svelte-ejc1lo"><span> </span></td><td class="login-cell svelte-ejc1lo"><!></td><td class="actions-cell svelte-ejc1lo"><div class="action-buttons svelte-ejc1lo"><button class="action-btn edit-btn svelte-ejc1lo" title="Edit User">✏️</button> <button> </button> <button> </button></div></td></tr>'),mE=k('<table class="users-table svelte-ejc1lo"><thead><tr class="svelte-ejc1lo"><th class="svelte-ejc1lo">Avatar</th><th class="svelte-ejc1lo">Username</th><th class="svelte-ejc1lo">Employee</th><th class="svelte-ejc1lo">Branch</th><th class="svelte-ejc1lo">Role Type</th><th class="svelte-ejc1lo">Status</th><th class="svelte-ejc1lo">Last Login</th><th class="svelte-ejc1lo">Actions</th></tr></thead><tbody></tbody></table>'),_E=k('<div class="dashboard-grid svelte-ejc1lo"></div> <div class="users-section svelte-ejc1lo"><div class="section-header svelte-ejc1lo"><h2 class="section-title svelte-ejc1lo"> </h2> <div class="section-controls svelte-ejc1lo"><div class="search-box svelte-ejc1lo"><span class="search-icon svelte-ejc1lo">🔍</span> <input type="text" placeholder="Search by Username, Employee, Branch..." class="search-input svelte-ejc1lo"/></div> <div class="filters svelte-ejc1lo"><select class="filter-select svelte-ejc1lo"><option>All Branches</option><!></select> <select class="filter-select svelte-ejc1lo"><option>All Roles</option><!></select> <select class="filter-select svelte-ejc1lo"><option>All Status</option><!></select></div></div></div> <div class="users-table-container svelte-ejc1lo"><!></div></div>',1),gE=k('<div class="user-management svelte-ejc1lo"><div class="header svelte-ejc1lo"><div class="title-section svelte-ejc1lo"><h1 class="title svelte-ejc1lo">User Management Dashboard</h1> <p class="subtitle svelte-ejc1lo">Comprehensive User Account Administration</p></div></div> <!></div>');function xE(t,r){pa(r,!1);const a=()=>sr(us,"$currentUser",s),[s,i]=Zr(),l=Q(),d=Q(),v=Q(),u=Q(),f=Q(),h=Q();let _=Q([]),x=[],T=[],b=Q(!0),w=Q(null),A=Q(""),C=Q(""),z=Q(""),F=Q("");Aa(async()=>{await re()});async function re(){try{p(b,!0),p(w,null);const[ge,Ne,Be]=await Promise.all([yr.getAllUsers(),yr.getBranches(),yr.getUserRoles()]);p(_,ge),x=Ne,T=Be,console.log("Loaded users:",e(_)),console.log("Loaded branches:",x),console.log("Loaded roles:",T)}catch(ge){console.error("Error loading user management data:",ge),p(w,ge.message)}finally{p(b,!1)}}const me=[{id:"create-user",title:"Create User",icon:"👤",description:"Add new user accounts",color:"bg-blue-500"},{id:"assign-roles",title:"Assign Roles",icon:"🎯",description:"Manage user permissions and roles",color:"bg-green-500"},{id:"create-user-roles",title:"Create User Roles",icon:"🔘",description:"Create custom roles and permissions",color:"bg-indigo-500"},{id:"manage-admin-users",title:"Manage Admin Users",icon:"👥",description:"Administer admin user accounts",color:"bg-orange-500"},{id:"manage-master-admin",title:"Manage Master Admin",icon:"🔐",description:"Master admin management (Master Admin only)",color:"bg-red-500"}];function ue(ge){return`${ge}-${Date.now()}-${Math.random().toString(36).substr(2,9)}`}function D(ge){const Ne=me.find(Te=>Te.id===ge),Be=ue(ge),be=Math.floor(Math.random()*1e3)+1;let L;switch(ge){case"create-user":L=q5;break;case"assign-roles":L=jT;break;case"manage-admin-users":L=y6;break;case"manage-master-admin":if(e(d)!=="Master Admin"){alert("Access denied: Master Admin privileges required");return}L=rE;break;case"create-user-roles":if(e(d)!=="Master Admin"&&e(d)!=="Admin"){alert("Access denied: Admin or Master Admin privileges required");return}L=r6;break;default:return}Kt.openWindow({id:Be,title:`${Ne.title} #${be}`,component:L,icon:Ne.icon,size:{width:1e3,height:700},position:{x:50+Math.random()*100,y:50+Math.random()*100},resizable:!0,minimizable:!0,maximizable:!0,closable:!0,props:{onDataChanged:re}})}async function E(ge){const Ne=ue("edit-user"),Be=Math.floor(Math.random()*1e3)+1;Kt.openWindow({id:Ne,title:`Edit User: ${ge.username} #${Be}`,component:yT,icon:"✏️",size:{width:900,height:600},position:{x:50+Math.random()*100,y:50+Math.random()*100},resizable:!0,minimizable:!0,maximizable:!0,closable:!0,props:{user:ge,onDataChanged:re}})}async function he(ge){try{const Ne=ge.status==="active"?"inactive":"active";await yr.updateUser(ge.id,{status:Ne}),await re(),console.log(`User ${ge.username} status changed to ${Ne}`)}catch(Ne){console.error("Error updating user status:",Ne),alert("Failed to update user status: "+Ne.message)}}async function xe(ge){try{const Ne=ge.status==="locked"?"active":"locked";await yr.updateUser(ge.id,{status:Ne}),await re(),console.log(`User ${ge.username} lock status changed to ${Ne}`)}catch(Ne){console.error("Error updating user lock status:",Ne),alert("Failed to update user lock status: "+Ne.message)}}Nt(()=>a(),()=>{p(l,a()||{roleType:"Position-based"})}),Nt(()=>e(l),()=>{var ge;p(d,((ge=e(l))==null?void 0:ge.roleType)||"Position-based")}),Nt(()=>e(_),()=>{p(v,[...new Set(e(_).map(ge=>ge.branch_name).filter(Boolean))])}),Nt(()=>e(_),()=>{p(u,[...new Set(e(_).map(ge=>ge.role_type).filter(Boolean))])}),Nt(()=>{},()=>{p(f,["active","inactive","locked"])}),Nt(()=>(e(_),e(A),e(C),e(z),e(F)),()=>{p(h,e(_).filter(ge=>{const Ne=e(A)===""||ge.username.toLowerCase().includes(e(A).toLowerCase())||ge.employee_name.toLowerCase().includes(e(A).toLowerCase())||ge.branch_name.toLowerCase().includes(e(A).toLowerCase()),Be=e(C)===""||ge.branch_name===e(C),be=e(z)===""||ge.role_type===e(z),L=e(F)===""||ge.status===e(F);return Ne&&Be&&be&&L}))}),Va(),ha();var K=gE(),q=c(o(K),2);{var ae=ge=>{var Ne=sE();g(ge,Ne)},Me=ge=>{var Ne=Ca(),Be=Bt(Ne);{var be=Te=>{var ye=iE(),P=o(ye),pe=c(o(P),2),B=o(pe,!0);n(pe);var j=c(pe,2);n(P),n(ye),R(()=>y(B,e(w))),Z("click",j,re),g(Te,ye)},L=Te=>{var ye=_E(),P=Bt(ye);Mt(P,5,()=>me,Lt,(oe,se)=>{var U=Ca(),W=Bt(U);{var ee=we=>{var Ae=nE(),He=o(Ae),Ke=o(He),Oe=o(Ke,!0);n(Ke),n(He);var Ee=c(He,2),et=o(Ee),dt=o(et,!0);n(et);var ut=c(et,2),Pe=o(ut,!0);n(ut),n(Ee),Et(2),n(Ae),R(()=>{wt(He,1,`card-icon ${e(se),m(()=>e(se).color)??""}`,"svelte-ejc1lo"),y(Oe,(e(se),m(()=>e(se).icon))),y(dt,(e(se),m(()=>e(se).title))),y(Pe,(e(se),m(()=>e(se).description)))}),Z("click",Ae,()=>D(e(se).id)),Z("keydown",Ae,qe=>qe.key==="Enter"&&D(e(se).id)),g(we,Ae)};X(W,we=>{e(se),e(d),m(()=>e(se).id!=="manage-master-admin"||e(d)==="Master Admin")&&we(ee)})}g(oe,U)}),n(P);var pe=c(P,2),B=o(pe),j=o(B),I=o(j);n(j);var Y=c(j,2),fe=o(Y),ce=c(o(fe),2);At(ce),n(fe);var J=c(fe,2),le=o(J);R(()=>{e(C),Xt(()=>{e(v)})});var S=o(le);S.value=S.__value="";var De=c(S);Mt(De,1,()=>e(v),Lt,(oe,se)=>{var U=oE(),W=o(U,!0);n(U);var ee={};R(()=>{y(W,e(se)),ee!==(ee=e(se))&&(U.value=(U.__value=e(se))??"")}),g(oe,U)}),n(le);var Ue=c(le,2);R(()=>{e(z),Xt(()=>{e(u)})});var We=o(Ue);We.value=We.__value="";var ke=c(We);Mt(ke,1,()=>e(u),Lt,(oe,se)=>{var U=lE(),W=o(U,!0);n(U);var ee={};R(()=>{y(W,e(se)),ee!==(ee=e(se))&&(U.value=(U.__value=e(se))??"")}),g(oe,U)}),n(Ue);var N=c(Ue,2);R(()=>{e(F),Xt(()=>{e(f)})});var V=o(N);V.value=V.__value="";var G=c(V);Mt(G,1,()=>e(f),Lt,(oe,se)=>{var U=cE(),W=o(U,!0);n(U);var ee={};R(we=>{y(W,we),ee!==(ee=e(se))&&(U.value=(U.__value=e(se))??"")},[()=>(e(se),m(()=>e(se).charAt(0).toUpperCase()+e(se).slice(1)))]),g(oe,U)}),n(N),n(J),n(Y),n(B);var de=c(B,2),ve=o(de);{var Ie=oe=>{var se=vE(),U=c(o(se),6);{var W=ee=>{var we=dE();Z("click",we,()=>{p(A,""),p(C,""),p(z,""),p(F,"")}),g(ee,we)};X(U,ee=>{(e(A)||e(C)||e(z)||e(F))&&ee(W)})}n(se),g(oe,se)},Ye=oe=>{var se=mE(),U=c(o(se));Mt(U,5,()=>e(h),W=>W.id,(W,ee)=>{var we=hE(),Ae=o(we),He=o(Ae);{var Ke=ne=>{var ie=uE();R(()=>na(ie,"src",(e(ee),m(()=>e(ee).avatar)))),g(ne,ie)},Oe=ne=>{var ie=fE(),Se=o(ie),Qe=o(Se,!0);n(Se),n(ie),R(je=>y(Qe,je),[()=>(e(ee),m(()=>e(ee).username.charAt(0).toUpperCase()))]),g(ne,ie)};X(He,ne=>{e(ee),m(()=>e(ee).avatar)?ne(Ke):ne(Oe,!1)})}n(Ae);var Ee=c(Ae),et=o(Ee),dt=o(et,!0);n(et),n(Ee);var ut=c(Ee),Pe=o(ut,!0);n(ut);var qe=c(ut),tt=o(qe,!0);n(qe);var lt=c(qe),Xe=o(lt),at=o(Xe,!0);n(Xe),n(lt);var Fe=c(lt),rt=o(Fe),Ce=o(rt,!0);n(rt),n(Fe);var _e=c(Fe),Ve=o(_e);{var Je=ne=>{var ie=Ya();R(Se=>y(ie,Se),[()=>(e(ee),m(()=>new Date(e(ee).last_login).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})))]),g(ne,ie)},st=ne=>{var ie=pE();g(ne,ie)};X(Ve,ne=>{e(ee),m(()=>e(ee).last_login)?ne(Je):ne(st,!1)})}n(_e);var ot=c(_e),Le=o(ot),nt=o(Le),vt=c(nt,2);let xt;var M=o(vt,!0);n(vt);var H=c(vt,2);let O;var te=o(H,!0);n(H),n(Le),n(ot),n(we),R((ne,ie,Se)=>{y(dt,(e(ee),m(()=>e(ee).username))),y(Pe,(e(ee),m(()=>e(ee).employee_name||"Not Assigned"))),y(tt,(e(ee),m(()=>e(ee).branch_name||"Not Assigned"))),wt(Xe,1,`role-badge role-${ne??""}`,"svelte-ejc1lo"),y(at,(e(ee),m(()=>e(ee).role_type))),wt(rt,1,`status-badge status-${e(ee),m(()=>e(ee).status)??""}`,"svelte-ejc1lo"),y(Ce,(e(ee),m(()=>e(ee).status))),xt=wt(vt,1,"action-btn status-btn svelte-ejc1lo",null,xt,ie),na(vt,"title",(e(ee),m(()=>e(ee).status==="active"?"Deactivate":"Activate"))),vt.disabled=(e(ee),m(()=>e(ee).role_type==="Master Admin")),y(M,(e(ee),m(()=>e(ee).status==="active"?"🔴":"🟢"))),O=wt(H,1,"action-btn lock-btn svelte-ejc1lo",null,O,Se),na(H,"title",(e(ee),m(()=>e(ee).status==="locked"?"Unlock":"Lock"))),H.disabled=(e(ee),m(()=>e(ee).role_type==="Master Admin")),y(te,(e(ee),m(()=>e(ee).status==="locked"?"🔓":"🔒")))},[()=>(e(ee),m(()=>e(ee).role_type.toLowerCase().replace(/\s+/g,"-"))),()=>({activate:e(ee).status==="inactive",deactivate:e(ee).status==="active"}),()=>({unlock:e(ee).status==="locked",lock:e(ee).status!=="locked"})]),Z("click",nt,()=>E(e(ee))),Z("click",vt,()=>he(e(ee))),Z("click",H,()=>xe(e(ee))),g(W,we)}),n(U),n(se),g(oe,se)};X(ve,oe=>{e(h),m(()=>e(h).length===0)?oe(Ie):oe(Ye,!1)})}n(de),n(pe),R(()=>y(I,`Available Users (${e(_),m(()=>e(_).length)??""})`)),zt(ce,()=>e(A),oe=>p(A,oe)),ra(le,()=>e(C),oe=>p(C,oe)),ra(Ue,()=>e(z),oe=>p(z,oe)),ra(N,()=>e(F),oe=>p(F,oe)),g(Te,ye)};X(Be,Te=>{e(w)?Te(be):Te(L,!1)},!0)}g(ge,Ne)};X(q,ge=>{e(b)?ge(ae):ge(Me,!1)})}n(K),g(t,K),ma(),i()}var bE=k('<button class="action-btn secondary svelte-gn1hc5"><span class="btn-icon svelte-gn1hc5">👥</span> Read Status</button>'),wE=k('<div class="communication-center svelte-gn1hc5"><div class="header svelte-gn1hc5"><h1 class="title svelte-gn1hc5">Communication Center</h1></div> <div class="dashboard-content svelte-gn1hc5"><div class="dashboard-grid svelte-gn1hc5"><div class="dashboard-card primary svelte-gn1hc5"><div class="card-header svelte-gn1hc5"><div class="card-icon svelte-gn1hc5">🔔</div> <div class="card-title svelte-gn1hc5"><h3 class="svelte-gn1hc5">Notification Center</h3> <p class="svelte-gn1hc5">Manage alerts and notifications</p></div></div> <div class="card-content svelte-gn1hc5"><div class="stats svelte-gn1hc5"><div class="stat-item svelte-gn1hc5"><span class="stat-number svelte-gn1hc5"> </span> <span class="stat-label svelte-gn1hc5">Unread</span></div> <div class="stat-item svelte-gn1hc5"><span class="stat-number svelte-gn1hc5"> </span> <span class="stat-label svelte-gn1hc5">Total</span></div></div></div> <div class="card-footer svelte-gn1hc5"><button class="action-btn primary svelte-gn1hc5">Open Notification Center</button> <!></div></div></div></div></div>');function yE(t,r){pa(r,!1);const a=()=>sr(bi,"$notificationCounts",i),s=()=>sr(qs,"$auth",i),[i,l]=Zr(),d=Q(),v=Q(),u=Q(),f=Q();function h(ae){return`${ae}-${Date.now()}-${Math.random().toString(36).substr(2,9)}`}Aa(()=>{Di();const ae=setInterval(Di,3e4);return()=>clearInterval(ae)});function _(){const ae=h("notification-center"),Me=Math.floor(Math.random()*1e3)+1;Kt.openWindow({id:ae,title:`Notification Center #${Me}`,component:Qn,icon:"🔔",size:{width:900,height:600},position:{x:100+Math.random()*100,y:100+Math.random()*100},resizable:!0,minimizable:!0,maximizable:!0,closable:!0}),setTimeout(Hl,1e3)}function x(){const ae=`admin-read-status-${Date.now()}-${Math.random().toString(36).substr(2,9)}`;Kt.openWindow({id:ae,title:"Admin: Read Status Per User",component:Gl,icon:"👥",size:{width:800,height:600},position:{x:100+Math.random()*100,y:100+Math.random()*100},resizable:!0,minimizable:!0,maximizable:!0,closable:!0})}Nt(()=>a(),()=>{p(d,a())}),Nt(()=>s(),()=>{var ae;p(v,(ae=s())==null?void 0:ae.user)}),Nt(()=>e(v),()=>{var ae;p(u,((ae=e(v))==null?void 0:ae.role)||"Position-based")}),Nt(()=>e(u),()=>{p(f,e(u)==="Master Admin")}),Va(),ha();var T=wE(),b=c(o(T),2),w=o(b),A=o(w),C=c(o(A),2),z=o(C),F=o(z),re=o(F),me=o(re,!0);n(re),Et(2),n(F);var ue=c(F,2),D=o(ue),E=o(D,!0);n(D),Et(2),n(ue),n(z),n(C);var he=c(C,2),xe=o(he),K=c(xe,2);{var q=ae=>{var Me=bE();Z("click",Me,x),g(ae,Me)};X(K,ae=>{e(f)&&ae(q)})}n(he),n(A),n(w),n(b),n(T),R(()=>{y(me,(e(d),m(()=>e(d).loading?"...":e(d).unread))),y(E,(e(d),m(()=>e(d).loading?"...":e(d).total)))}),Z("click",xe,_),g(t,T),ma(),l()}var kE=k('<div role="menu" tabindex="-1" class="submenu svelte-129hoe0"><button class="submenu-item svelte-129hoe0"><span class="menu-icon">🏢</span> <span class="menu-text svelte-129hoe0"> </span></button> <button class="submenu-item svelte-129hoe0"><span class="menu-icon">🏪</span> <span class="menu-text svelte-129hoe0">Vendor Master</span></button> <button class="submenu-item svelte-129hoe0"><span class="menu-icon">👥</span> <span class="menu-text svelte-129hoe0">HR Master</span></button> <button class="submenu-item svelte-129hoe0"><span class="menu-icon">📋</span> <span class="menu-text svelte-129hoe0"> </span></button> <button class="submenu-item svelte-129hoe0"><span class="menu-icon">📞</span> <span class="menu-text svelte-129hoe0">Communication Center</span></button></div>'),TE=k('<div role="menu" tabindex="-1" class="submenu svelte-129hoe0"><button class="submenu-item svelte-129hoe0"><span class="menu-icon">👤</span> <span class="menu-text svelte-129hoe0">User Management</span></button></div>'),EE=k('<div class="sidebar svelte-129hoe0"><div class="sidebar-content svelte-129hoe0"><div class="menu-section svelte-129hoe0"><button class="section-button master-button svelte-129hoe0"><span class="section-icon svelte-129hoe0">📁</span> <span class="section-text svelte-129hoe0"> </span> <span class="arrow svelte-129hoe0">▶</span></button></div> <div class="menu-section svelte-129hoe0"><button class="section-button svelte-129hoe0"><span class="section-icon svelte-129hoe0">💼</span> <span class="section-text svelte-129hoe0"> </span></button></div> <div class="menu-section svelte-129hoe0"><button class="section-button svelte-129hoe0"><span class="section-icon svelte-129hoe0">📊</span> <span class="section-text svelte-129hoe0"> </span></button></div> <div class="menu-section svelte-129hoe0"><button class="section-button master-button svelte-129hoe0"><span class="section-icon svelte-129hoe0">⚙️</span> <span class="section-text svelte-129hoe0"> </span> <span class="arrow svelte-129hoe0">▶</span></button></div></div></div> <!> <!>',1);function AE(t,r){pa(r,!1);const a=()=>sr(ql,"$currentLocale",s),[s,i]=Zr(),l=Q();let d=Q(!1),v=Q(!1),u=null,f=Q(),h=Q(),_=Q(0);function x(We){return`${We}-${Date.now()}-${Math.random().toString(36).substr(2,9)}`}function T(){const We=x("branch-master"),ke=Math.floor(Math.random()*1e3)+1;Kt.openWindow({id:We,title:`${da("admin.branchesMaster")||"Branch Master"} #${ke}`,component:eu,icon:"🏢",size:{width:1200,height:800},position:{x:50+Math.random()*100,y:50+Math.random()*100},resizable:!0,minimizable:!0,maximizable:!0,closable:!0}),p(d,!1)}function b(){const We=x("task-master"),ke=Math.floor(Math.random()*1e3)+1;Kt.openWindow({id:We,title:`${da("admin.taskMaster")||"Task Master"} #${ke}`,component:l1,icon:"📋",size:{width:1200,height:800},position:{x:50+Math.random()*100,y:50+Math.random()*100},resizable:!0,minimizable:!0,maximizable:!0,closable:!0}),p(d,!1)}function w(){const We=x("hr-master"),ke=Math.floor(Math.random()*1e3)+1;Kt.openWindow({id:We,title:`HR Master #${ke}`,component:r5,icon:"👥",size:{width:1200,height:800},position:{x:50+Math.random()*100,y:50+Math.random()*100},resizable:!0,minimizable:!0,maximizable:!0,closable:!0}),p(d,!1)}function A(){const We=x("vendor-master"),ke=Math.floor(Math.random()*1e3)+1;Kt.openWindow({id:We,title:`Vendor Master #${ke}`,component:i5,icon:"🏪",size:{width:1200,height:800},position:{x:50+Math.random()*100,y:50+Math.random()*100},resizable:!0,minimizable:!0,maximizable:!0,closable:!0}),p(d,!1)}function C(We){alert(`${We} - ${da("status.pending")||"pending"}...`)}function z(){const We=x("user-management"),ke=Math.floor(Math.random()*1e3)+1;Kt.openWindow({id:We,title:`User Management #${ke}`,component:xE,icon:"👤",size:{width:1200,height:800},position:{x:50+Math.random()*100,y:50+Math.random()*100},resizable:!0,minimizable:!0,maximizable:!0,closable:!0}),p(v,!1)}function F(){const We=x("communication-center"),ke=Math.floor(Math.random()*1e3)+1;Kt.openWindow({id:We,title:`Communication Center #${ke}`,component:yE,icon:"📞",size:{width:1e3,height:700},position:{x:50+Math.random()*100,y:50+Math.random()*100},resizable:!0,minimizable:!0,maximizable:!0,closable:!0}),p(d,!1)}function re(){if(u&&(clearTimeout(u),u=null),e(f)){const We=e(f).getBoundingClientRect();p(_,We.top)}p(d,!0)}function me(){u=setTimeout(()=>{p(d,!1)},300)}function ue(){u&&(clearTimeout(u),u=null)}function D(){u=setTimeout(()=>{p(d,!1)},300)}function E(){if(u&&(clearTimeout(u),u=null),e(h)){const We=e(h).getBoundingClientRect();p(_,We.top)}p(v,!0)}function he(){u=setTimeout(()=>{p(v,!1)},300)}function xe(){u&&(clearTimeout(u),u=null)}function K(){u=setTimeout(()=>{p(v,!1)},300)}Nt(()=>a(),()=>{p(l,a())}),Va(),ha();var q=EE(),ae=Bt(q),Me=o(ae),ge=o(Me),Ne=o(ge),Be=c(o(Ne),2),be=o(Be,!0);n(Be),Et(2),n(Ne),Ms(Ne,We=>p(f,We),()=>e(f)),n(ge);var L=c(ge,2),Te=o(L),ye=c(o(Te),2),P=o(ye,!0);n(ye),n(Te),n(L);var pe=c(L,2),B=o(pe),j=c(o(B),2),I=o(j,!0);n(j),n(B),n(pe);var Y=c(pe,2),fe=o(Y),ce=c(o(fe),2),J=o(ce,!0);n(ce),Et(2),n(fe),Ms(fe,We=>p(h,We),()=>e(h)),n(Y),n(Me),n(ae);var le=c(ae,2);{var S=We=>{var ke=kE(),N=o(ke),V=c(o(N),2),G=o(V,!0);n(V),n(N);var de=c(N,2),ve=c(de,2),Ie=c(ve,2),Ye=c(o(Ie),2),oe=o(Ye,!0);n(Ye),n(Ie);var se=c(Ie,2);n(ke),R((U,W)=>{$r(ke,`top: ${e(_)??""}px;`),y(G,U),y(oe,W)},[()=>(kt(da),m(()=>da("admin.branchesMaster")||"Branch Master")),()=>(kt(da),m(()=>da("admin.taskMaster")||"Task Master"))]),Z("click",N,T),Z("click",de,A),Z("click",ve,w),Z("click",Ie,b),Z("click",se,F),Z("mouseenter",ke,ue),Z("mouseleave",ke,D),g(We,ke)};X(le,We=>{e(d)&&We(S)})}var De=c(le,2);{var Ue=We=>{var ke=TE(),N=o(ke);n(ke),R(()=>$r(ke,`top: ${e(_)??""}px;`)),Z("click",N,z),Z("mouseenter",ke,xe),Z("mouseleave",ke,K),g(We,ke)};X(De,We=>{e(v)&&We(Ue)})}R((We,ke,N,V)=>{y(be,We),y(P,ke),y(I,N),y(J,V)},[()=>(kt(da),m(()=>da("nav.master")||"Master")),()=>(kt(da),m(()=>da("nav.work")||"Work")),()=>(kt(da),m(()=>da("nav.reports")||"Reports")),()=>(kt(da),m(()=>da("nav.settings")||"Settings"))]),Z("mouseenter",Ne,re),Z("mouseleave",Ne,me),Z("click",Te,()=>C(da("nav.work")||"Work")),Z("click",B,()=>C(da("nav.reports")||"Reports")),Z("mouseenter",fe,E),Z("mouseleave",fe,he),g(t,q),ma(),i()}var SE=k('<button class="clear-button svelte-wh9uu8"><svg viewBox="0 0 20 20" width="16" height="16"><path fill="currentColor" d="M6.28 5.22a.75.75 0 0 0-1.06 1.06L8.94 10l-3.72 3.72a.75.75 0 1 0 1.06 1.06L10 11.06l3.72 3.72a.75.75 0 1 0 1.06-1.06L11.06 10l3.72-3.72a.75.75 0 0 0-1.06-1.06L10 8.94 6.28 5.22Z"></path></svg></button>'),CE=k('<div class="no-results svelte-wh9uu8"><div class="no-results-icon svelte-wh9uu8">🔍</div> <div class="no-results-text svelte-wh9uu8"> </div></div>'),FE=k('<div class="command-description svelte-wh9uu8"> </div>'),DE=k('<button><div class="command-icon svelte-wh9uu8"> </div> <div class="command-content svelte-wh9uu8"><div class="command-title svelte-wh9uu8"> </div> <!></div> <div class="command-category svelte-wh9uu8"> </div></button>'),ME=k('<div class="command-palette-backdrop svelte-wh9uu8" role="dialog" aria-modal="true" aria-label="Command palette" tabindex="-1"><div class="command-palette svelte-wh9uu8"><div class="search-container svelte-wh9uu8"><div class="search-icon svelte-wh9uu8"><svg viewBox="0 0 20 20" width="20" height="20"><path fill="currentColor" d="M9 3.5a5.5 5.5 0 1 0 0 11 5.5 5.5 0 0 0 0-11ZM2 9a7 7 0 1 1 12.452 4.391l3.328 3.329a.75.75 0 1 1-1.06 1.06l-3.329-3.328A7 7 0 0 1 2 9Z"></path></svg></div> <input type="text" class="search-input svelte-wh9uu8"/> <!></div> <div class="command-list svelte-wh9uu8"><!></div> <div class="command-footer svelte-wh9uu8"><div class="keyboard-hints svelte-wh9uu8"><span class="hint svelte-wh9uu8"><kbd class="svelte-wh9uu8">↑↓</kbd> Navigate</span> <span class="hint svelte-wh9uu8"><kbd class="svelte-wh9uu8">Enter</kbd> </span> <span class="hint svelte-wh9uu8"><kbd class="svelte-wh9uu8">Esc</kbd> </span></div></div></div></div>');function IE(t,r){pa(r,!1);let a=Ra(r,"visible",12,!1);const s=Jr();let i=Q(),l=Q(""),d=Q(0),v=Q([]);const u=[{id:"minimize-all",title:da("commands.minimizeAll")||"Minimize All Windows",description:da("commands.minimizeAllDesc")||"Minimize all open windows",category:da("commands.window")||"Window",icon:"🔽",action:()=>Kt.minimizeAllWindows()},{id:"close-all",title:da("commands.closeAll")||"Close All Windows",description:da("commands.closeAllDesc")||"Close all open windows",category:da("commands.window")||"Window",icon:"❌",action:()=>Kt.closeAllWindows()},{id:"show-desktop",title:da("commands.showDesktop")||"Show Desktop",description:da("commands.showDesktopDesc")||"Show desktop by minimizing all windows",category:da("commands.window")||"Window",icon:"🖥️",action:()=>Kt.minimizeAllWindows(),keywords:["desktop","minimize"]},{id:"open-branches",title:da("admin.branchesMaster")||"Branch Master",description:da("commands.manageBranches")||"Manage company branches",category:da("admin.title")||"Admin",icon:"🏢",action:()=>f("branch-master"),keywords:["office","location"]},{id:"open-vendors",title:da("admin.vendorsMaster")||"Vendor Master",description:da("commands.manageVendors")||"Manage vendors and suppliers",category:da("admin.title")||"Admin",icon:"🤝",action:()=>f("vendor-master"),keywords:["supplier","contractor"]},{id:"open-invoices",title:da("admin.invoiceMaster")||"Invoice Management",description:da("commands.manageInvoices")||"Manage invoices and billing",category:da("nav.finance")||"Finance",icon:"📄",action:()=>f("invoice-master"),keywords:["bill","payment","finance"]},{id:"open-users",title:da("admin.userManagement")||"User Management",description:da("commands.manageUsers")||"Manage system users and roles",category:da("admin.title")||"Admin",icon:"👤",action:()=>f("user-master"),keywords:["account","permission","role"]},{id:"open-import",title:da("admin.importData")||"Data Import",description:da("commands.importData")||"Import data from Excel files",category:da("commands.tools")||"Tools",icon:"📥",action:()=>f("data-import"),keywords:["excel","xlsx","upload"]},{id:"help",title:da("commands.help")||"Help & Documentation",description:da("commands.helpDesc")||"View system documentation",category:da("commands.helpCategory")||"Help",icon:"❓",action:()=>f("help"),keywords:["docs","manual","guide"]},{id:"about",title:da("commands.about")||"About Aqura",description:da("commands.aboutDesc")||"System information and version",category:da("commands.helpCategory")||"Help",icon:"ℹ️",action:()=>f("about"),keywords:["version","info"]}];Aa(()=>{a()&&e(i)&&e(i).focus()});function f(C){const z={"branch-master":{title:"Branch Master",component:null,icon:"🏢"},"vendor-master":{title:"Vendor Master",component:null,icon:"🤝"},"invoice-master":{title:"Invoice Management",component:null,icon:"📄"},"user-master":{title:"User Management",component:null,icon:"👤"},"data-import":{title:"Data Import",component:null,icon:"📥"},help:{title:"Help & Documentation",component:null,icon:"❓"},about:{title:"About Aqura",component:null,icon:"ℹ️"}}[C];if(z){const F={render:()=>`<div class="p-6"><h2 class="text-xl font-bold mb-4">${z.title}</h2><p>This module is under development.</p></div>`};Kt.openWindow({...z,component:F})}}function h(C){C.action(),_()}function _(){a(!1),p(l,""),p(d,0),s("close")}function x(C){switch(C.key){case"Escape":_();break;case"ArrowDown":C.preventDefault(),p(d,Math.min(e(d)+1,e(v).length-1));break;case"ArrowUp":C.preventDefault(),p(d,Math.max(e(d)-1,0));break;case"Enter":C.preventDefault(),e(v)[e(d)]&&h(e(v)[e(d)]);break}}function T(C){C.target===C.currentTarget&&_()}Nt(()=>e(l),()=>{if(e(l).trim()){const C=e(l).toLowerCase();p(v,u.filter(z=>{var F,re;return z.title.toLowerCase().includes(C)||((F=z.description)==null?void 0:F.toLowerCase().includes(C))||z.category.toLowerCase().includes(C)||((re=z.keywords)==null?void 0:re.some(me=>me.toLowerCase().includes(C)))}))}else p(v,u);p(d,0)}),Nt(()=>(kt(a()),e(i)),()=>{a()&&e(i)&&e(i).focus()}),Va(),ha();var b=Ca(),w=Bt(b);{var A=C=>{var z=ME(),F=o(z),re=o(F),me=c(o(re),2);At(me),Ms(me,be=>p(i,be),()=>e(i));var ue=c(me,2);{var D=be=>{var L=SE();R((Te,ye)=>{na(L,"title",Te),na(L,"aria-label",ye)},[()=>(kt(da),m(()=>da("commands.clearSearch")||"Clear search")),()=>(kt(da),m(()=>da("commands.clearSearch")||"Clear search"))]),Z("click",L,()=>p(l,"")),g(be,L)};X(ue,be=>{e(l)&&be(D)})}n(re);var E=c(re,2),he=o(E);{var xe=be=>{var L=CE(),Te=c(o(L),2),ye=o(Te,!0);n(Te),n(L),R(P=>y(ye,P),[()=>(kt(da),m(()=>da("commands.noResults")||"No commands found"))]),g(be,L)},K=be=>{var L=Ca(),Te=Bt(L);Mt(Te,3,()=>e(v),ye=>ye.id,(ye,P,pe)=>{var B=DE();let j;var I=o(B),Y=o(I,!0);n(I);var fe=c(I,2),ce=o(fe),J=o(ce,!0);n(ce);var le=c(ce,2);{var S=We=>{var ke=FE(),N=o(ke,!0);n(ke),R(()=>y(N,(e(P),m(()=>e(P).description)))),g(We,ke)};X(le,We=>{e(P),m(()=>e(P).description)&&We(S)})}n(fe);var De=c(fe,2),Ue=o(De,!0);n(De),n(B),R(We=>{j=wt(B,1,"command-item svelte-wh9uu8",null,j,We),y(Y,(e(P),m(()=>e(P).icon||"📦"))),y(J,(e(P),m(()=>e(P).title))),y(Ue,(e(P),m(()=>e(P).category)))},[()=>({selected:e(pe)===e(d)})]),Z("click",B,()=>h(e(P))),g(ye,B)}),g(be,L)};X(he,be=>{e(v),m(()=>e(v).length===0)?be(xe):be(K,!1)})}n(E);var q=c(E,2),ae=o(q),Me=c(o(ae),2),ge=c(o(Me));n(Me);var Ne=c(Me,2),Be=c(o(Ne));n(Ne),n(ae),n(q),n(F),n(z),R((be,L,Te)=>{na(me,"placeholder",be),y(ge,` ${L??""}`),y(Be,` ${Te??""}`)},[()=>(kt(da),m(()=>da("commands.searchPlaceholder")||"Type a command or search...")),()=>(kt(da),m(()=>da("commands.execute")||"Execute")),()=>(kt(da),m(()=>da("commands.close")||"Close"))]),zt(me,()=>e(l),be=>p(l,be)),Z("keydown",me,x),Z("click",z,T),Z("keydown",z,x),g(C,z)};X(w,C=>{a()&&C(A)})}g(t,b),ma()}var RE=k('<div class="fixed bottom-4 right-4 bg-white border border-gray-200 rounded-lg shadow-lg p-4 max-w-sm z-40 animate-slide-up svelte-t3rj57"><div class="flex items-start space-x-3"><div class="w-12 h-12 bg-gradient-to-br from-aqua-500 to-orange-500 rounded-lg flex items-center justify-center text-white font-bold text-xl">A</div> <div class="flex-1"><h3 class="font-semibold text-gray-900 text-sm">Install Aqura App</h3> <p class="text-gray-600 text-xs mt-1">Add to your home screen for faster access and offline support</p> <div class="flex space-x-2 mt-3"><button class="bg-gradient-to-r from-aqua-500 to-orange-500 text-white text-xs px-3 py-1.5 rounded-md font-medium hover:opacity-90 transition-opacity">Install</button> <button class="text-gray-500 text-xs px-3 py-1.5 rounded-md hover:bg-gray-100 transition-colors">Later</button></div></div> <button class="text-gray-400 hover:text-gray-600 transition-colors" aria-label="Close install prompt"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg></button></div></div>');function NE(t,r){pa(r,!1);const a=Us(!1),s=Us(null);let i=Q(!1),l=null;Aa(()=>{window.addEventListener("beforeinstallprompt",w=>{console.log("PWA install prompt available"),w.preventDefault(),l=w,s.set(w),p(i,!0),a.set(!0)}),window.addEventListener("appinstalled",()=>{console.log("PWA was installed"),p(i,!1),a.set(!1),f()}),window.matchMedia("(display-mode: standalone)").matches&&(console.log("PWA is already installed"),p(i,!1));const T=/iPad|iPhone|iPod/.test(navigator.userAgent),b="standalone"in window.navigator&&window.navigator.standalone;T&&!b&&setTimeout(()=>{e(i)||(p(i,!0),a.set(!0))},3e3)});async function d(){if(!l){u();return}l.prompt();const{outcome:T}=await l.userChoice;console.log(T==="accepted"?"User accepted the install prompt":"User dismissed the install prompt"),l=null,s.set(null),p(i,!1),a.set(!1)}function v(){p(i,!1),a.set(!1),sessionStorage.setItem("pwa-prompt-dismissed","true")}function u(){const T=document.createElement("div");T.className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",T.innerHTML=`
			<div class="bg-white rounded-lg p-6 max-w-sm mx-auto">
				<h3 class="text-lg font-semibold mb-4">Install Aqura App</h3>
				<div class="space-y-3 text-sm">
					<div class="flex items-center">
						<span class="text-blue-500 mr-2">1.</span>
						<span>Tap the Share button</span>
						<svg class="ml-2 w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
							<path d="M15 8a3 3 0 10-2.977-2.63l-4.94 2.47a3 3 0 100 4.319l4.94 2.47a3 3 0 10.895-1.789l-4.94-2.47a3.027 3.027 0 000-.74l4.94-2.47C13.456 7.68 14.19 8 15 8z"/>
						</svg>
					</div>
					<div class="flex items-center">
						<span class="text-blue-500 mr-2">2.</span>
						<span>Tap "Add to Home Screen"</span>
					</div>
					<div class="flex items-center">
						<span class="text-blue-500 mr-2">3.</span>
						<span>Tap "Add" to install</span>
					</div>
				</div>
				<button onclick="this.parentElement.parentElement.remove()" 
						class="mt-4 w-full bg-blue-500 text-white py-2 px-4 rounded-lg">
					Got it
				</button>
			</div>
		`,document.body.appendChild(T)}function f(){window.gtag&&window.gtag("event","pwa_install",{event_category:"PWA",event_label:"Aqura Management System"})}Aa(()=>{sessionStorage.getItem("pwa-prompt-dismissed")&&(p(i,!1),a.set(!1))}),ha();var h=Ca(),_=Bt(h);{var x=T=>{var b=RE(),w=o(b),A=c(o(w),2),C=c(o(A),4),z=o(C),F=c(z,2);n(C),n(A);var re=c(A,2);n(w),n(b),Z("click",z,d),Z("click",F,v),Z("click",re,v),g(T,b)};X(_,T=>{e(i)&&T(x)})}g(t,h),ma()}function PE(t){const r=t-1;return r*r*r+1}function zl(t){const r=typeof t=="string"&&t.match(/^\s*(-?[\d.]+)([^\s]*)\s*$/);return r?[parseFloat(r[1]),r[2]||"px"]:[t,"px"]}function LE(t,{delay:r=0,duration:a=400,easing:s=PE,x:i=0,y:l=0,opacity:d=0}={}){const v=getComputedStyle(t),u=+v.opacity,f=v.transform==="none"?"":v.transform,h=u*(1-d),[_,x]=zl(i),[T,b]=zl(l);return{delay:r,duration:a,easing:s,css:(w,A)=>`
			transform: ${f} translate(${(1-w)*_}${x}, ${(1-w)*T}${b});
			opacity: ${u-h*A}`}}var OE=k('<div><div class="flex items-start"><div class="flex-shrink-0"><div><span class="text-sm font-semibold"> </span></div></div> <div class="ml-3 flex-1"><p class="text-sm font-medium"> </p></div> <div class="ml-4 flex-shrink-0 flex"><button class="inline-flex text-gray-400 hover:text-gray-600 focus:outline-none focus:text-gray-600 transition ease-in-out duration-150"><svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg></button></div></div></div>'),zE=k('<div class="toast-container fixed top-4 right-4 z-50 space-y-2 svelte-6odm3r"></div>');function BE(t,r){pa(r,!1);const a=()=>sr(sn,"$toastNotifications",s),[s,i]=Zr();function l(f){switch(f){case"success":return"✓";case"error":return"✕";case"warning":return"⚠";case"info":return"i";default:return"i"}}function d(f){switch(f){case"success":return"bg-green-50 border-green-200 text-green-800";case"error":return"bg-red-50 border-red-200 text-red-800";case"warning":return"bg-yellow-50 border-yellow-200 text-yellow-800";case"info":return"bg-blue-50 border-blue-200 text-blue-800";default:return"bg-gray-50 border-gray-200 text-gray-800"}}function v(f){switch(f){case"success":return"bg-green-100 text-green-600";case"error":return"bg-red-100 text-red-600";case"warning":return"bg-yellow-100 text-yellow-600";case"info":return"bg-blue-100 text-blue-600";default:return"bg-gray-100 text-gray-600"}}ha();var u=zE();Mt(u,5,a,f=>f.id,(f,h)=>{var _=OE(),x=o(_),T=o(x),b=o(T),w=o(b),A=o(w,!0);n(w),n(b),n(T);var C=c(T,2),z=o(C),F=o(z,!0);n(z),n(C);var re=c(C,2),me=o(re);n(re),n(x),n(_),R((ue,D,E)=>{wt(_,1,`toast max-w-md w-full shadow-lg rounded-lg border p-4 ${ue??""}`,"svelte-6odm3r"),wt(b,1,`flex items-center justify-center w-8 h-8 rounded-full ${D??""}`,"svelte-6odm3r"),y(A,E),y(F,e(h).message)},[()=>d(e(h).type),()=>v(e(h).type),()=>l(e(h).type)]),Z("click",me,()=>La.remove(e(h).id)),$d(3,_,()=>LE,()=>({x:300,duration:300})),g(f,_)}),n(u),g(t,u),ma(),i()}var $E=k('<div class="mb-4 p-3 bg-red-100 border border-red-400 text-red-700 rounded"> </div>'),UE=k('<div class="flex items-center justify-center py-8"><div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"></div> <span class="ml-2 text-gray-600">Loading...</span></div>'),qE=k('<div class="text-center py-8"><div class="text-gray-500 mb-4"><svg class="w-12 h-12 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path></svg></div> <p class="text-gray-600 mb-4">No other users found on this device</p> <button class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors">Close</button></div>'),jE=k('<span class="ml-2 px-2 py-1 bg-green-100 text-green-800 text-xs rounded-full">Active</span>'),WE=k('<button class="text-gray-400 hover:text-red-600 transition-colors p-1" aria-label="Remove user" title="Remove user from device"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg></button>'),HE=k('<div class="flex-shrink-0 ml-2"><div class="w-3 h-3 bg-green-500 rounded-full"></div></div>'),VE=k('<div role="button" tabindex="0"><div class="flex-shrink-0 w-10 h-10 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full flex items-center justify-center text-white font-medium"> </div> <div class="flex-1 ml-3 min-w-0"><div class="flex items-center justify-between"><p class="text-sm font-medium text-gray-900 truncate"> <!></p> <!></div> <p class="text-xs text-gray-500 truncate"> </p> <div class="flex items-center justify-between mt-1"><span class="text-xs text-gray-500 capitalize"> </span> <span class="text-xs text-gray-400"> </span></div></div> <!></div>'),GE=k('<div class="space-y-3 max-h-64 overflow-y-auto svelte-w1icr4"></div> <div class="mt-6 pt-4 border-t border-gray-200"><div class="flex space-x-3"><button class="flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded hover:bg-gray-50 transition-colors">Cancel</button> <button class="flex-1 px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700 transition-colors">Logout All</button></div></div>',1),XE=k('<div class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50" role="dialog" aria-modal="true" aria-labelledby="user-switch-title"><div class="bg-white rounded-lg shadow-xl max-w-md w-full mx-4 max-h-[80vh] overflow-hidden"><div class="px-6 py-4 border-b border-gray-200"><div class="flex items-center justify-between"><h2 id="user-switch-title" class="text-lg font-semibold text-gray-900">Switch User Account</h2> <button class="text-gray-400 hover:text-gray-600 transition-colors" aria-label="Close"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg></button></div></div> <div class="px-6 py-4"><!> <!></div></div></div>');function YE(t,r){pa(r,!1);let a=Ra(r,"isOpen",8,!1),s=Ra(r,"onClose",8,()=>{}),i=Q([]),l=Q(null),d=Q(!1),v=Q("");Aa(async()=>(await u(),us.subscribe(z=>{p(l,z)})));async function u(){try{p(d,!0),p(i,await Ls.getDeviceUsers())}catch(C){console.error("Error loading device users:",C),p(v,"Failed to load users")}finally{p(d,!1)}}async function f(C){try{p(d,!0),p(v,"");const z=await Ls.switchUser(C);z.success?(await u(),s()()):p(v,z.error||"Failed to switch user")}catch(z){console.error("Error switching user:",z),p(v,"Failed to switch user")}finally{p(d,!1)}}async function h(C,z){var F;z.stopPropagation();try{if(p(d,!0),p(v,""),((F=e(l))==null?void 0:F.id)===C){await Ls.logout(),s()();return}await Ls.removeUserSession(C),await u()}catch(re){console.error("Error removing user:",re),p(v,"Failed to remove user")}finally{p(d,!1)}}function _(C){return C.split(" ").map(z=>z.charAt(0)).join("").toUpperCase().slice(0,2)}function x(C){const z=new Date,F=new Date(C),re=Math.floor((z.getTime()-F.getTime())/(1e3*60));if(re<1)return"Just now";if(re<60)return`${re}m ago`;const me=Math.floor(re/60);return me<24?`${me}h ago`:`${Math.floor(me/24)}d ago`}function T(C){C.target===C.currentTarget&&s()()}ha();var b=Ca(),w=Bt(b);{var A=C=>{var z=XE(),F=o(z),re=o(F),me=o(re),ue=c(o(me),2);n(me),n(re);var D=c(re,2),E=o(D);{var he=ae=>{var Me=$E(),ge=o(Me,!0);n(Me),R(()=>y(ge,e(v))),g(ae,Me)};X(E,ae=>{e(v)&&ae(he)})}var xe=c(E,2);{var K=ae=>{var Me=UE();g(ae,Me)},q=ae=>{var Me=Ca(),ge=Bt(Me);{var Ne=be=>{var L=qE(),Te=c(o(L),4);n(L),Z("click",Te,function(...ye){var P;(P=s())==null||P.apply(this,ye)}),g(be,L)},Be=be=>{var L=GE(),Te=Bt(L);Mt(Te,5,()=>e(i),j=>j.id,(j,I)=>{var Y=VE(),fe=o(Y),ce=o(fe,!0);n(fe);var J=c(fe,2),le=o(J),S=o(le),De=o(S),Ue=c(De);{var We=W=>{var ee=jE();g(W,ee)};X(Ue,W=>{e(l),e(I),m(()=>{var ee;return((ee=e(l))==null?void 0:ee.id)===e(I).id})&&W(We)})}n(S);var ke=c(S,2);{var N=W=>{var ee=WE();Z("click",ee,we=>h(e(I).id,we)),g(W,ee)};X(ke,W=>{e(l),e(I),m(()=>{var ee;return((ee=e(l))==null?void 0:ee.id)!==e(I).id})&&W(N)})}n(le);var V=c(le,2),G=o(V,!0);n(V);var de=c(V,2),ve=o(de),Ie=o(ve,!0);n(ve);var Ye=c(ve,2),oe=o(Ye,!0);n(Ye),n(de),n(J);var se=c(J,2);{var U=W=>{var ee=HE();g(W,ee)};X(se,W=>{e(l),e(I),m(()=>{var ee;return((ee=e(l))==null?void 0:ee.id)===e(I).id})&&W(U)})}n(Y),R((W,ee)=>{wt(Y,1,`flex items-center p-3 rounded-lg border border-gray-200 hover:border-blue-300 hover:bg-blue-50 cursor-pointer transition-all ${e(l),e(I),m(()=>{var we;return((we=e(l))==null?void 0:we.id)===e(I).id?"bg-blue-100 border-blue-400":""})??""}`),y(ce,W),y(De,`${e(I),m(()=>e(I).username)??""} `),y(G,(e(I),m(()=>e(I).email))),y(Ie,(e(I),m(()=>e(I).role))),y(oe,ee)},[()=>(e(I),m(()=>_(e(I).username))),()=>(e(I),m(()=>x(e(I).loginTime)))]),Z("click",Y,()=>f(e(I).id)),Z("keydown",Y,W=>W.key==="Enter"&&f(e(I).id)),g(j,Y)}),n(Te);var ye=c(Te,2),P=o(ye),pe=o(P),B=c(pe,2);n(P),n(ye),Z("click",pe,function(...j){var I;(I=s())==null||I.apply(this,j)}),Z("click",B,()=>{Ls.logout(),s()()}),g(be,L)};X(ge,be=>{e(i),m(()=>e(i).length===0)?be(Ne):be(Be,!1)},!0)}g(ae,Me)};X(xe,ae=>{e(d)?ae(K):ae(q,!1)})}n(D),n(F),n(z),Z("click",ue,function(...ae){var Me;(Me=s())==null||Me.apply(this,ae)}),Z("click",z,T),g(C,z)};X(w,C=>{a()&&C(A)})}g(t,b),ma()}var KE=k('<div class="mb-4 p-3 bg-red-100 border border-red-400 text-red-700 rounded-lg"><div class="flex items-center"><svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg> </div></div>'),QE=k('<div class="mb-4 p-3 bg-green-100 border border-green-400 text-green-700 rounded-lg"><div class="flex items-center"><svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg> </div></div>'),ZE=k('<div class="animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"></div>'),JE=hr('<svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-5 5v-5z"></path></svg>'),e8=k('<button class="w-full flex items-center justify-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"><!> Enable Notifications</button>'),t8=k('<div class="animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"></div>'),a8=hr('<svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path></svg>'),r8=k('<button class="flex-1 flex items-center justify-center px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"><!> Register Device</button>'),s8=k('<div class="animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"></div>'),i8=hr('<svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 12H4"></path></svg>'),n8=k('<button class="flex-1 flex items-center justify-center px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"><!> Unregister</button>'),o8=k('<div class="animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"></div>'),l8=hr('<svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>'),c8=k('<button class="flex-1 flex items-center justify-center px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"><!> Test Notification</button>'),d8=k('<div class="flex space-x-3"><!> <!></div>'),v8=k('<div class="mt-6 space-y-3"><!></div>'),u8=k(`<div class="mt-6 p-4 bg-yellow-50 border border-yellow-200 rounded-lg"><div class="flex items-center"><svg class="w-5 h-5 text-yellow-600 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.082 15.5c-.77.833.192 2.5 1.732 2.5z"></path></svg> <div><p class="font-medium text-yellow-800">Browser Not Supported</p> <p class="text-sm text-yellow-700">Your browser doesn't support push notifications. Please use a modern browser like Chrome, Firefox, or Safari.</p></div></div></div>`),f8=k('<div class="bg-white rounded-lg shadow-lg p-6"><div class="flex items-center mb-6"><div class="p-2 bg-blue-100 rounded-lg mr-3"><svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-5 5v-5z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z"></path></svg></div> <div><h2 class="text-xl font-semibold text-gray-900">Push Notifications</h2> <p class="text-sm text-gray-600">Manage your notification preferences</p></div></div> <!> <!> <div class="space-y-4"><div class="flex items-center justify-between p-4 bg-gray-50 rounded-lg"><div class="flex items-center"><div></div> <div><p class="font-medium text-gray-900">Browser Support</p> <p class="text-sm text-gray-600"> </p></div></div> <span> </span></div> <div class="flex items-center justify-between p-4 bg-gray-50 rounded-lg"><div class="flex items-center"><div></div> <div><p class="font-medium text-gray-900">Permission Status</p> <p class="text-sm text-gray-600">Current notification permission</p></div></div> <span> </span></div> <div class="flex items-center justify-between p-4 bg-gray-50 rounded-lg"><div class="flex items-center"><div></div> <div><p class="font-medium text-gray-900">Registration Status</p> <p class="text-sm text-gray-600"> </p></div></div> <span> </span></div></div> <!> <div class="mt-6 p-4 bg-blue-50 border border-blue-200 rounded-lg"><div class="flex items-start"><svg class="w-5 h-5 text-blue-600 mr-2 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg> <div><p class="font-medium text-blue-800 mb-1">About Push Notifications</p> <ul class="text-sm text-blue-700 space-y-1"><li>• Receive notifications even when the app is closed</li> <li>• Stay updated on new tasks, announcements, and messages</li> <li>• Works on both mobile and desktop devices</li> <li>• You can disable notifications anytime in browser settings</li></ul></div></div></div></div>');function p8(t,r){pa(r,!1);let a=Q(!1),s=Q("default"),i=Q(!1),l=Q(!1),d=Q(""),v=Q("");Aa(async()=>{u(),f(),await h()});function u(){p(a,jr.isPushNotificationSupported())}function f(){p(s,jr.getPushNotificationPermission())}async function h(){p(i,localStorage.getItem("aqura-device-id")!==null)}async function _(){try{p(l,!0),p(d,""),p(v,"");const le=await jr.requestPushNotificationPermission();p(s,le),le==="granted"?(p(v,"Notification permission granted!"),await x()):p(d,"Notification permission denied. You can enable it in browser settings.")}catch(le){console.error("Error requesting permission:",le),p(d,"Failed to request notification permission")}finally{p(l,!1)}}async function x(){try{p(l,!0),p(d,""),p(v,""),await jr.registerForPushNotifications()?(p(i,!0),p(v,"Successfully registered for push notifications!"),await jr.startRealtimeNotificationListener()):p(d,"Failed to register for push notifications")}catch(le){console.error("Error registering for notifications:",le),p(d,"Failed to register for push notifications")}finally{p(l,!1)}}async function T(){try{p(l,!0),p(d,""),p(v,""),await jr.unregisterFromPushNotifications(),p(i,!1),p(v,"Successfully unregistered from push notifications")}catch(le){console.error("Error unregistering from notifications:",le),p(d,"Failed to unregister from push notifications")}finally{p(l,!1)}}async function b(){try{p(l,!0),p(d,""),p(v,""),await jr.sendTestNotification(),p(v,"Test notification sent!")}catch(le){console.error("Error sending test notification:",le),p(d,"Failed to send test notification")}finally{p(l,!1)}}function w(le){switch(le){case"granted":return"Granted";case"denied":return"Denied";case"default":return"Not set";default:return"Unknown"}}function A(le){switch(le){case"granted":return"text-green-600 bg-green-100";case"denied":return"text-red-600 bg-red-100";case"default":return"text-yellow-600 bg-yellow-100";default:return"text-gray-600 bg-gray-100"}}ha();var C=f8(),z=c(o(C),2);{var F=le=>{var S=KE(),De=o(S),Ue=c(o(De));n(De),n(S),R(()=>y(Ue,` ${e(d)??""}`)),g(le,S)};X(z,le=>{e(d)&&le(F)})}var re=c(z,2);{var me=le=>{var S=QE(),De=o(S),Ue=c(o(De));n(De),n(S),R(()=>y(Ue,` ${e(v)??""}`)),g(le,S)};X(re,le=>{e(v)&&le(me)})}var ue=c(re,2),D=o(ue),E=o(D),he=o(E),xe=c(he,2),K=c(o(xe),2),q=o(K,!0);n(K),n(xe),n(E);var ae=c(E,2),Me=o(ae,!0);n(ae),n(D);var ge=c(D,2),Ne=o(ge),Be=o(Ne);Et(2),n(Ne);var be=c(Ne,2),L=o(be,!0);n(be),n(ge);var Te=c(ge,2),ye=o(Te),P=o(ye),pe=c(P,2),B=c(o(pe),2),j=o(B,!0);n(B),n(pe),n(ye);var I=c(ye,2),Y=o(I,!0);n(I),n(Te),n(ue);var fe=c(ue,2);{var ce=le=>{var S=v8(),De=o(S);{var Ue=ke=>{var N=e8(),V=o(N);{var G=ve=>{var Ie=ZE();g(ve,Ie)},de=ve=>{var Ie=JE();g(ve,Ie)};X(V,ve=>{e(l)?ve(G):ve(de,!1)})}Et(),n(N),R(()=>N.disabled=e(l)),Z("click",N,_),g(ke,N)},We=ke=>{var N=Ca(),V=Bt(N);{var G=de=>{var ve=d8(),Ie=o(ve);{var Ye=W=>{var ee=r8(),we=o(ee);{var Ae=Ke=>{var Oe=t8();g(Ke,Oe)},He=Ke=>{var Oe=a8();g(Ke,Oe)};X(we,Ke=>{e(l)?Ke(Ae):Ke(He,!1)})}Et(),n(ee),R(()=>ee.disabled=e(l)),Z("click",ee,x),g(W,ee)},oe=W=>{var ee=n8(),we=o(ee);{var Ae=Ke=>{var Oe=s8();g(Ke,Oe)},He=Ke=>{var Oe=i8();g(Ke,Oe)};X(we,Ke=>{e(l)?Ke(Ae):Ke(He,!1)})}Et(),n(ee),R(()=>ee.disabled=e(l)),Z("click",ee,T),g(W,ee)};X(Ie,W=>{e(i)?W(oe,!1):W(Ye)})}var se=c(Ie,2);{var U=W=>{var ee=c8(),we=o(ee);{var Ae=Ke=>{var Oe=o8();g(Ke,Oe)},He=Ke=>{var Oe=l8();g(Ke,Oe)};X(we,Ke=>{e(l)?Ke(Ae):Ke(He,!1)})}Et(),n(ee),R(()=>ee.disabled=e(l)),Z("click",ee,b),g(W,ee)};X(se,W=>{e(i)&&W(U)})}n(ve),g(de,ve)};X(V,de=>{e(s)==="granted"&&de(G)},!0)}g(ke,N)};X(De,ke=>{e(s)==="default"||e(s)==="denied"?ke(Ue):ke(We,!1)})}n(S),g(le,S)},J=le=>{var S=u8();g(le,S)};X(fe,le=>{e(a)?le(ce):le(J,!1)})}Et(2),n(C),R((le,S)=>{wt(he,1,`w-3 h-3 rounded-full mr-3 ${e(a)?"bg-green-500":"bg-red-500"}`),y(q,e(a)?"Push notifications are supported":"Push notifications not supported"),wt(ae,1,`px-3 py-1 rounded-full text-sm font-medium ${e(a)?"text-green-600 bg-green-100":"text-red-600 bg-red-100"}`),y(Me,e(a)?"Supported":"Not Supported"),wt(Be,1,`w-3 h-3 rounded-full mr-3 ${e(s)==="granted"?"bg-green-500":e(s)==="denied"?"bg-red-500":"bg-yellow-500"}`),wt(be,1,le),y(L,S),wt(P,1,`w-3 h-3 rounded-full mr-3 ${e(i)?"bg-green-500":"bg-gray-400"}`),y(j,e(i)?"Device is registered for notifications":"Device is not registered"),wt(I,1,`px-3 py-1 rounded-full text-sm font-medium ${e(i)?"text-green-600 bg-green-100":"text-gray-600 bg-gray-100"}`),y(Y,e(i)?"Registered":"Not Registered")},[()=>`px-3 py-1 rounded-full text-sm font-medium ${A(e(s))}`,()=>w(e(s))]),g(t,C),ma()}var h8=k('<div class="notification-window svelte-1sn8r06"><!></div>');function m8(t,r){pa(r,!1);let a=Ra(r,"targetNotificationId",8,null),s=Q(null);Aa(()=>{a()&&setTimeout(()=>{i(a())},1e3)});function i(v){try{const u=document.querySelector(`[data-notification-id="${v}"]`);u?(u.scrollIntoView({behavior:"smooth",block:"center"}),u.classList.add("highlighted-notification"),setTimeout(()=>{u.classList.remove("highlighted-notification")},3e3),console.log("✅ [NotificationWindow] Scrolled to notification:",v)):(console.log("⚠️ [NotificationWindow] Notification element not found:",v),setTimeout(()=>{i(v)},2e3))}catch(u){console.error("❌ [NotificationWindow] Error scrolling to notification:",u)}}ha();var l=h8(),d=o(l);Ms(Qn(d,{$$legacy:!0}),v=>p(s,v),()=>e(s)),n(l),g(t,l),ma()}var _8=k('<div class="loading-screen svelte-12qhfyh"><div class="loading-spinner svelte-12qhfyh"></div> <p class="svelte-12qhfyh">Loading...</p></div>'),g8=k('<div class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"><div class="max-w-lg w-full mx-4"><div class="bg-white rounded-lg shadow-xl"><div class="flex items-center justify-between px-6 py-4 border-b border-gray-200"><h2 class="text-lg font-semibold text-gray-900">Notification Settings</h2> <button class="text-gray-400 hover:text-gray-600 transition-colors"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg></button></div> <div class="p-6"><!></div></div></div></div>'),x8=k('<!> <div class="desktop svelte-12qhfyh"><main class="main-content svelte-12qhfyh"><!></main> <!> <!> <!> <!></div> <!> <!>',1),b8=k('<main class="simple-layout svelte-12qhfyh"><!></main>'),w8=k("<div><!></div>"),y8=k("<!> <!>",1);function I8(t,r){pa(r,!1);const a=()=>sr(Zd,"$page",l),s=()=>sr(Hd,"$localeData",l),i=()=>sr(Wl,"$sidebar",l),[l,d]=Zr(),v=Q(),u=Q();Wd();let f=Q(!1),h=Q(!1),_=Q(!1),x=Q(!1),T=Q(!0),b=null,w,A,C=!1;Aa(async()=>{try{await Ls.initializeAuth(),await new Promise(q=>setTimeout(q,100)),localStorage.removeItem("aqura-auth-token"),localStorage.removeItem("aqura-user-data"),console.log("🔐 Legacy auth data cleared on startup"),w=jl.subscribe(q=>{console.log("🔐 Persistent auth state changed:",q),p(x,q),p(T,!1),C||setTimeout(()=>{C=!0,console.log("🔐 Redirects enabled")},1500),!q&&a().url.pathname!=="/login"&&C&&(console.log("🔐 Not authenticated, redirecting to login"),setTimeout(()=>{!e(x)&&a().url.pathname!=="/login"&&Xd("/login")},100))}),A=us.subscribe(q=>{b=q,console.log("Current user changed:",q)}),e(x)&&await z()}catch(q){console.error("Error initializing layout:",q),p(T,!1)}}),Yn(()=>{w&&w(),A&&A()});async function z(){try{const ae=jr.isPushNotificationSupported(),Me=jr.getPushNotificationPermission();ae&&Me==="granted"&&(await jr.registerForPushNotifications(),await jr.startRealtimeNotificationListener()),console.log("🚀 Starting push notification processor..."),_s.start()}catch(ae){console.error("Error initializing notification services:",ae)}const q=ae=>{console.log("🔔 Opening notification window from push notification:",ae.detail),F(ae.detail.notificationId)};return window.addEventListener("openNotificationWindow",q),()=>{window.removeEventListener("openNotificationWindow",q)}}function F(q=null){const ae=`notification-center-${Date.now()}`;Kt.openWindow({id:ae,title:q?"Notifications - Specific Item":"Notifications",component:m8,props:{targetNotificationId:q},icon:"🔔",size:{width:900,height:600},position:{x:100+Math.random()*100,y:100+Math.random()*100},resizable:!0,minimizable:!0,maximizable:!0,closable:!0}),console.log("🔔 Notification window opened:",ae,"targeting notification:",q)}function re(q){e(x)&&((q.ctrlKey||q.metaKey)&&q.shiftKey&&q.key==="P"&&(q.preventDefault(),p(f,!e(f))),(q.ctrlKey||q.metaKey)&&q.shiftKey&&q.key==="U"&&(q.preventDefault(),p(h,!e(h))),(q.ctrlKey||q.metaKey)&&q.shiftKey&&q.key==="N"&&(q.preventDefault(),p(_,!e(_))),q.key==="Escape"&&(p(f,!1),p(h,!1),p(_,!1)))}function me(){p(h,!0)}function ue(){p(_,!0)}Nt(()=>s(),()=>{var q;p(v,((q=s())==null?void 0:q.direction)==="rtl"?"rtl":"ltr")}),Nt(()=>a(),()=>{p(u,a().url.pathname==="/login")}),Va(),ha();var D=y8();Z("keydown",$l,re);var E=Bt(D);{var he=q=>{var ae=_8();g(q,ae)},xe=q=>{var ae=w8(),Me=o(ae);{var ge=Be=>{var be=x8(),L=Bt(be);AE(L,{});var Te=c(L,2),ye=o(Te),P=o(ye);Do(P,r,"default",{}),n(ye);var pe=c(ye,2);vv(pe,{});var B=c(pe,2);IE(B,{get visible(){return e(f)},set visible(J){p(f,J)},$$events:{close:()=>p(f,!1)},$$legacy:!0});var j=c(B,2);YE(j,{get isOpen(){return e(h)},onClose:()=>p(h,!1)});var I=c(j,2);{var Y=J=>{var le=g8(),S=o(le),De=o(S),Ue=o(De),We=c(o(Ue),2);n(Ue);var ke=c(Ue,2),N=o(ke);p8(N,{}),n(ke),n(De),n(S),n(le),Z("click",We,()=>p(_,!1)),g(J,le)};X(I,J=>{e(_)&&J(Y)})}n(Te);var fe=c(Te,2);H0(fe,{$$events:{"user-switch-request":me,"notification-settings-request":ue}});var ce=c(fe,2);BE(ce,{}),R(()=>$r(Te,`margin-left: ${i(),m(()=>i().width)??""}px`)),g(Be,be)},Ne=Be=>{var be=b8(),L=o(be);Do(L,r,"default",{}),n(be),g(Be,be)};X(Me,Be=>{e(x)&&!e(u)?Be(ge):Be(Ne,!1)})}n(ae),R(()=>{wt(ae,1,`app ${e(v)??""}`,"svelte-12qhfyh"),na(ae,"dir",(s(),m(()=>{var Be;return((Be=s())==null?void 0:Be.direction)||"ltr"}))),ae.dir=ae.dir}),g(q,ae)};X(E,q=>{e(T)?q(he):q(xe,!1)})}var K=c(E,2);NE(K,{}),g(t,D),ma(),d()}export{I8 as component};
//# sourceMappingURL=0.DGZ22ZGg.js.map
